/*! buildTime: 2022-05-12T03:23:10.797Z */
!function(){"object"!=typeof window.epoint_local&&(window.epoint_local=function a(i){return Object.getOwnPropertyNames(i).forEach(function(t){var e=i[t];"object"==typeof e&&null!==e&&a(e)}),Object.freeze(i)}({locale:"zh_CN",epoint:"国泰新点软件股份有限公司",search_text:"搜索",search_title:"展开更多条件",reset_text:"重置",close_text:"关闭",selected_text:"已选条件",upload_text:"上传",delete_text:"删除",more_text:"更多",retry_text:"重试",preview_text:"预览",edit_text:"编辑",remove_text:"移除",error_tip:"错误提示",warning_tip:"警告提示",validate_failed:"验证失败",default_error_message:"有字段验证未通过，请再检查一下！",empty_beginning_text:"请输入",no_longer_tips:"不再提示",back_to_top_text:"返回顶部",remove_all_text:"移除全部",helper_text:"帮助提醒",ajax_error_text:"请求出现异常，请联系管理员",detail_text:"详情",service_error_text:"服务不可用",success_text:"成功",failed_text:"失败",operate_text:"操作",click_to_sort_text:"点击排序",click_to_filter_text:"点击过滤",all_text:"全部",save_text:"保存",order_text:"序",select_text:"选择",loadingMsg:"数据加载中，请稍后...",dateInfo:{monthsLong:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],daysLong:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["日","一","二","三","四","五","六"],quarterLong:["一季度","二季度","三季度","四季度"],quarterShort:["Q1","Q2","Q2","Q4"],halfYearLong:["上半年","下半年"],patterns:{d:"yyyy-M-d",D:"yyyy年M月d日",f:"yyyy年M月d日 H:mm",F:"yyyy年M月d日 H:mm:ss",g:"yyyy-M-d H:mm",G:"yyyy-M-d H:mm:ss",m:"MMMd日",o:"yyyy-MM-ddTHH:mm:ss.fff",s:"yyyy-MM-ddTHH:mm:ss",t:"H:mm",T:"H:mm:ss",U:"yyyy年M月d日 HH:mm:ss",y:"yyyy年MM月"},tt:{AM:"上午",PM:"下午"},ten:{Early:"上旬",Mid:"中旬",Late:"下旬"},today:"今天",clockType:24},culture:{name:"zh-CN",numberFormat:{number:{pattern:["n","-n"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3]},percent:{pattern:["n%","-n%"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3],symbol:"%"},currency:{pattern:["$n","$-n"],decimals:2,decimalsSeparator:".",groupSeparator:",",groupSize:[3],symbol:"¥"}}},VTypes:{minDateErrorText:"不能小于日期 {0}",maxDateErrorText:"不能大于日期 {0}",uniqueErrorText:"字段不能重复",requiredErrorText:"不能为空",emailErrorText:"请输入邮件格式",urlErrorText:"请输入URL格式",floatErrorText:"请输入数字",intErrorText:"请输入整数",dateErrorText:"请输入日期格式 {0}",maxLengthErrorText:"不能超过 {0} 个字符",minLengthErrorText:"不能少于 {0} 个字符",maxErrorText:"数字不能大于 {0} ",minErrorText:"数字不能小于 {0} ",rangeLengthErrorText:"字符长度必须在 {0} 到 {1} 之间",rangeCharErrorText:"字符数必须在 {0} 到 {1} 之间",rangeErrorText:"数字必须在 {0} 到 {1} 之间",mobileErrorText:"输入的手机号码格式不正确",telErrorText:"输入的固定电话号码格式不正确",phoneErrorText:"输入的电话号码格式不正确",phoneWithShortNumErrorText:"输入的电话号码格式不正确",postCodeErrorText:"输入的邮政编码格式不正确",orgCodeErrorText:"输入的统一社会信用代码格式不正确",creditCodeErrorText:"输入的统一社会信用代码格式不正确",idCardErrorText:"输入的身份证号码格式不正确，若最后一位为“X”则只允许输入大写的“X”",decimalLengthErrorText:"请输入数字，且最多只能输入{0}位小数",projectCodeErrorText:"输入的投资项目统一代码格式不正确"},Notice:{buttonText:{ok:"确定",cancel:"取消",yes:"是",no:"否"}},WebUploaderUI:{uploadErrorText:"上传出错!",cantPreviewAlert:"此文件不能预览！",filePreviewTitle:"文件预览",cantEditAlert:"文件还未上传，不能编辑！",fileEditTitle:"文件编辑"},MessageBox:{alertTitle:"提醒",confirmTitle:"确认",deleteConfirmTitle:"删除确认",deleteConfirmTpl:"删除后不可恢复，请输入%s确认",confirmErrorText:"输入内容不匹配",prompTitle:"输入",prompMessage:"请输入内容：",buttonText:{ok:"确定",cancel:"取消",yes:"是",no:"否",confirmDelete:"确定删除"}},ValidatorBase:{requiredErrorText:"不能为空"},Calendar:{firstDayOfWeek:0,yesterdayText:"昨天",todayText:"今天",clearText:"清除",okText:"确定",cancelText:"取消",daysShort:["日","一","二","三","四","五","六"],format:"yyyy年MM月",timeFormat:"H:mm"},Pager:{firstText:"首页",prevText:"上一页",nextText:"下一页",lastText:"尾页",reloadText:"刷新",pageInfoText:"每页 {0} 条, 共 {1} 条"},Pagination:{pageInfoText:"共{0}条",jumpText:'跳至<input class="pagination-number"  value="{0}"/>页',sizeText:"条/页"},DataGrid:{emptyText:"没有数据",notSelectedTip:"请选择一条记录！",confirmDeleteTip:"确定删除选中记录？",confirmTitle:"系统提示",waitingText:"操作中，请稍后......",deleteSuccessfulText:"删除成功",deleteFailedText:"删除失败"},WebUploader:{pickerText:"选择文件",startText:"开始上传",pauseText:"暂停上传",batchDownloadText:"下载全部",numLimitErrorText:"选择的文件过多！</br>最多可上传{0}个文件",sizeLimitErrorText:"选择的文件过大！</br>最多可上传{0}KB文件",typeDeniedErrorText:"选择的文件类型错误！</br>可上传的文件类型为：{0}",sizeErrorText:"选择的文件过大！</br>可上传的单文件最大为{0}KB",emptyFileErrorText:"不能上传空文件！",duplicateErrorText:"不能上传重复的文件！",uploadErrorText:"上传失败！请重新上传！",secrecyLevelSaveErrorText:"保密等级保存失败！请重试",noflashInnerHTML:'<a class="noflash" title="要使用上传功能，请下载安装Falsh后，刷新页面" href="http://get.adobe.com/flashplayer/" target="_blank">初始化错误</a>',noflashPageWarning:'检测到您的系统未安装Flash，上传功能不可用。请<a href="http://get.adobe.com/flashplayer/" target="_blank">下载安装Falsh</a>后，刷新页面'},DataExport:{expandText:"导出",collapseText:"导出",exportText:"导 出",panelTitle:"导出列配置",leftListTitle:"待选列",rightListTitle:"已选列",tipInfo:"不填页码即导出当前页",fromText:"从页面导出",pageNumInfo:"页导出到第",pageText:"页",exportModelText:"导出为模板",selectExportText:"仅导出选中行",allExportText:"导出全部",curPageExportText:"导出当前页"},AutoComplete:{popupEmptyText:"无搜索结果",loadingText:"加载中...",errorText:"错误"},HtmlFile:{buttonText:"浏览...",limitTypeErrorText:"上传文件格式为:"},CatalogImport:{pickerText:"导入文件",deleteText:"删除",uploadingText:"正在上传",validateText:"校验结果",resultTpl:"总计：{{0}}条，成功：{{1}}，失败：{{2}}条。",expandText:"展开详情",importResultText:"导入结果",importErrorText:"数据导入失败，请重试！",importSuccessText:"导入已完成",exportText:"校验结果导出"},Cropper:{title:"裁剪",imageSizeText:"图片尺寸",selectImgText:"选择图片",onlinePhotoText:"在线拍照",previewText:"预览",reselectText:"重新选择",finishText:"完成",cancelText:"取消",validateText:"请选择有效的图片文件",imageSizeAlertText:"图片不能超过 ",noImageAlert:"请选择图片或在线拍照"},DataImport:{pickerText:"导入文件",expandText:"展开详情",collapseText:"收起详情",continueImportTip:"上次导入中断，修改完后继续导入",continueText:"继续导入",retryText:"重新导入",retryTip:"重新尝试导入这个文件",viewDetailText:"查看详情",validateText:"校验结果",resultTpl:"总计：{{0}}条，成功：{{1}}，失败：{{2}}条。",importResultText:"导入结果",importFailAlert:"数据导入失败，请重试！",importSuccessText:"导入已完成"},DistrictPicker:{emptyText:"请输入或选择地区",selectText:"请选择"},FilterTree:{emptyText:"请输入内容查询"},ImageUploader:{deleteAlert:"确定移除此图片？",deleteAlertTitle:"删除提醒",typeErrorAlert:"选择的文件类型错误",typeAcceptedText:"可上传的文件类型为",imageCountAlert:"你选择的图片文件过多，只能选择一个",imageNameLengthAlert:"选中的图片文件名不能超过{{0}}个字符",imageSizeAlert:"选中的图片文件过大，最大允许上传{{0}}KB的图片",imageMeasureAlert:"图片宽高校验失败，只允许上传{{0}}px *{{1}}px的图片",fileCountAlert:"您选择的文件过多，最多还能选择 {{0}} 个图片"},LargeFileUploader:{pickerText:"选择文件",startText:"开始上传",pauseText:"暂停上传",numLimitErrorText:"选择的文件过多！</br>最多可上传{0}个文件",sizeLimitErrorText:"选择的文件过大！</br>最多可上传{0}KB文件",typeDeniedErrorText:"选择的文件类型错误！</br>可上传的文件类型为：{0}",sizeErrorText:"选择的文件过大！</br>可上传的单文件最大为{0}KB",emptyFileErrorText:"不能上传空文件！",epointUserText:"国泰新点用户",ntkoLoadErrorText:"不能装载NTKO大文件上传控件",deleteFileConfirmText:"确定删除文件？",systemTipText:"系统提示",ntkoInitErrorTitle:"不能装载NTKO大文件上传控件。请确保使用IE浏览器，并检查浏览器的安全设置。",ntkoInitErrorText:"初始化错误",ntkoErrorCheckBrowserText:"不能装载NTKO大文件上传控件。请确保使用IE浏览器，并检查浏览器的安全设置",analyzingText:"正在分析文件",uploadedText:"已上传",uploadFailedText:"上传失败！请重新上传！",uploadErrorText:"上传出错！"},DateRangePicker:{footTipText:"注：点击某日期两次代表选择某一天",quickSelectText:{thisWeek:"本周",thisMonth:"本月",thisQuarter:"本季度",thisYear:"本年"}},MonthRangePicker:{footTipText:"注：点击某月份两次代表选择某一月",quickSelectText:{thisMonth:"本月",thisQuarter:"本季度",thisYear:"本年"}},QuarterPicker:{itemText:["第1季度","第2季度","第3季度","第4季度"],yearText:"年",clearText:"清除",okText:"确定"},QuarterRangePicker:{footTipText:"注：点击某季度两次代表选择某一季度"},TabsTreeSelect:{selectedPanelTitle:"已选人员",actionTitles:{sort:"一键排序",top:"置顶",bottom:"置底",remove:"删除",removeall:"删除全部",recover:"回到初始状态"},sortTitles:{none:"一键排序",asc:"正序",desc:"倒序"}},VerifyCode:{changeAnotherText:"看不清楚，换一个？"}})),
/**
* jQuery MiniUI v3.0
* 
* Web Site : http://www.miniui.com
*
* Commercial License : http://www.miniui.com/license
*
* Copyright(c) 2012 All Rights Reserved. Shanghai PusSoft Co., Ltd (上海普加软件有限公司) [ services@plusoft.com.cn ]. 
* 
*/
mini={components:{},uids:{},ux:{},doc:document,window:window,isReady:!1,locale:epoint_local.locale,createTime:new Date,byClass:function(t,e){return"string"==typeof e&&(e=mini.byId(e)),jQuery("."+t,e)[0]},getComponents:function(){var t=[];for(var e in mini.components){var i=mini.components[e];i.isControl&&t.push(i)}return t},get:function(t){if(!t)return null;if(mini.isControl(t))return t;if("string"==typeof t&&"#"==t.charAt(0)&&(t=t.substr(1)),"string"==typeof t)return mini.components[t];var e=mini.uids[t.uid];return e&&e.el==t?e:null},getbyUID:function(t){return mini.uids[t]},findControls:function(t,e){if(!t)return[];e=e||mini;var i=[],n=mini.uids;for(var s in n){var o=n[s],r=t.call(e,o);if((!0===r||1===r)&&(i.push(o),1===r))break}return i},getChildControls:function(e){var i=e.el?e.el:e;return mini.findControls(function(t){return!(!t.el||e==t)&&!(!mini.isAncestor(i,t.el)||!t.within)})},emptyFn:function(){},createNameControls:function(t,e){if(t&&t.el){e=e||"_";for(var i=t.el,n=mini.findControls(function(t){return!(!t.el||!t.name)&&!!mini.isAncestor(i,t.el)}),s=0,o=n.length;s<o;s++){var r=n[s],a=e+r.name;!0===e&&(a=r.name[0].toUpperCase()+r.name.substring(1,r.name.length)),t[a]=r}}},getsByName:function(t,e){return mini.getsbyName(t,e)},getsbyName:function(e,i){var t=mini.isControl(i),n=i;i&&t&&(i=i.el),i=(i=mini.byId(i))||document.body;var s=mini.findControls(function(t){return!!t.el&&!(t.name!=e||!mini.isAncestor(i,t.el))},this);if(t&&0==s.length&&n&&n.getbyName){var o=n.getbyName(e);o&&s.push(o)}return s},getbyName:function(t,e){return mini.getsbyName(t,e)[0]},getByName:function(t,e){return mini.getbyName(t,e)},getParams:function(t){var e={};if(t=(t=t||location.href).split("?")[1])for(var i=t.split("&"),n=0,s=i.length;n<s;n++){var o=i[n].split("=");try{e[o[0]]=decodeURIComponent(unescape(o[1]))}catch(r){}}return e},reg:function(t){this.components[t.id]=t,this.uids[t.uid]=t},unreg:function(t){delete mini.components[t.id],delete mini.uids[t.uid]},classes:{},uiClasses:{},getClass:function(t){return t?this.classes[t.toLowerCase()]:null},getClassByUICls:function(t){return this.uiClasses[t.toLowerCase()]},idPre:"mini-",idIndex:1,newId:function(t){return(t||this.idPre)+this.idIndex++},copyTo:function(t,e){if(t&&e)for(var i in e)t[i]=e[i];return t},copyIf:function(t,e){if(t&&e)for(var i in e)mini.isNull(t[i])&&(t[i]=e[i]);return t},createDelegate:function(t,e){return t?function(){return t.apply(e,arguments)}:function(){}},isControl:function(t){return!(!t||!t.isControl)},isElement:function(t){return t&&t.appendChild},isDate:function(t){return!(!t||!t.getFullYear)},isArray:function(t){return!(!t||!t.unshift)},isNull:function(t){return null===t||t===undefined},isNumber:function(t){return!isNaN(t)&&"number"==typeof t},isEquals:function(t,e){return!(0===t||0===e||!mini.isNull(t)&&""!=t||!mini.isNull(e)&&""!=e)||(t&&e&&t.getFullYear&&e.getFullYear?t.getTime()===e.getTime():"object"==typeof t&&"object"==typeof e?t===e:String(t)===String(e))},forEach:function(t,e,i){for(var n=t.clone(),s=0,o=n.length;s<o;s++){var r=n[s];if(!1===e.call(i,r,s,t))break}},sort:function(t,e,i){(function a(t,e){for(var i,n=0,s=t.length;n<s;n++)for(i=n;i<s;i++){var o=t[n],r=t[i];0<e(o,r)&&(t.removeAt(i),t.insert(n,r))}return t})(t,e)},elWarp:document.createElement("div")},"undefined"==typeof mini_debugger&&(mini_debugger=!0),"undefined"==typeof mini_useShims&&(mini_useShims=!1),"undefined"==typeof mini_ajaxAsyncInvoke&&(mini_ajaxAsyncInvoke=!0),mini_regClass=function(t,e){e=e.toLowerCase(),mini.classes[e]||((mini.classes[e]=t).prototype.type=e);var i=t.prototype.uiCls;mini.isNull(i)||mini.uiClasses[i]||(mini.uiClasses[i]=t)},mini_extend=function(t,e,i){if("function"!=typeof e)return this;var n=t,s=n.prototype,o=e.prototype;if(n.superclass!=o){for(var r in n.superclass=o,n.superclass.constructor=e,o)s[r]=o[r];if(i)for(var r in i)s[r]=i[r];return n}},mini.copyTo(mini,{extend:mini_extend,regClass:mini_regClass,debug:!1}),mini.namespace=function(t){if("string"==typeof t){t=t.split(".");for(var e=window,i=0,n=t.length;i<n;i++){var s=t[i],o=e[s];e=o=o||(e[s]={})}}},mini._BindCallbacks=[],mini._BindEvents=function(t,e){mini._BindCallbacks.push([t,e]),mini._EventTimer||(mini._EventTimer=setTimeout(function(){mini._FireBindEvents()},50))},mini._FireBindEvents=function(){for(var t=0,e=mini._BindCallbacks.length;t<e;t++){var i=mini._BindCallbacks[t];i[0].call(i[1])}mini._BindCallbacks=[],mini._EventTimer=null},mini._getFunctoin=function(t){if("string"!=typeof t)return null;for(var e=t.split("."),i=null,n=0,s=e.length;n<s;n++){var o=e[n];if(!(i=i?i[o]:window[o]))break}return i};var cacheParts={};function createPathParts(t){var e=cacheParts[t];if(!e){for(var i=0,n=(e=t.split(".")).length;i<n;i++){var s=e[i],o=s.indexOf("[");-1<o&&(e[i]=s.substr(0,o),e.splice(++i,0,parseInt(s.substr(o+1))))}cacheParts[t]=e}return e}function getValueByPath(t,e){if(t&&e){if(e in t)return t[e];for(var i=createPathParts(e),n=0,s=i.length;n<s&&t;n++)t=t[i[n]];return t}}function listColumnRenderer(t){var e=t.column,i=mini.isNull(t.value)?"":String(t.value),n=i.split(","),s="id",o="text",r={},a=e.editor,l=e.__editor;if(a){l||"combobox"!=a.type&&"treeselect"!=a.type||(l=mini.isControl(a)?a:(a=mini.clone(a),mini.create(a)),t.column.__editor=l),s=l.getValueField(),o=l.getTextField();var h=l.getData();if(!(r=e._valueMaps)||h!==e._data){var d=l.getList?l.getList():h;r={};for(var u=0,c=d.length;u<c;u++){r[(f=d[u])[s]]=f}e._valueMaps=r,e._data=h}}var m=[];for(u=0,c=n.length;u<c;u++){var f;if(f=r[n[u]]){var p=f[o];null!==p&&p!==undefined||(p=""),m.push(p)}}return 0==m.length&&!1===e.valueFromSelect?i:m.join(",")}mini._getMap=function(t,e){if(!t||!e)return undefined;var i=e[t];if(i!==undefined)return i;var n=t.indexOf(".");if(-1==n&&-1==t.indexOf("["))return e[t];if(n==t.length-1)return e[t];try{i=getValueByPath(e,t)}catch(s){return undefined}return i},mini._setMap=function(t,e,i){if(i&&"string"==typeof t){for(var n=t.split("."),s=null,o=0,r=n.length;o<=r-1;o++){t=n[o];if(o==r-1){var a,l,h;if(-1==t.indexOf("]"))i[t]=e;else d(i,l=(a=t.split("["))[0],h=parseInt(a[1]),""),i[l][h]=e;break}if(-1==t.indexOf("]"))s=i[t],o<=r-2&&null==s&&(i[t]=s={}),i=s;else i=d(i,l=(a=t.split("["))[0],h=parseInt(a[1]))}return e}function d(t,e,i,n){var s=t[e];s=s||(t[e]=[]);for(var o=0;o<=i;o++){var r=s[o];r=r||(null===n||n===undefined?s[o]={}:s[o]=n)}return t[e][i]}}
//    if (!obj) return;
//    if (typeof name != "string") return;
//        if (!arr) {
//            if (!arrObj) arrObj = arr[i] = {};
,mini.getAndCreate=function(t){return t?"string"==typeof t?mini.components[t]:"object"==typeof t?mini.isControl(t)?t:mini.isElement(t)?mini.uids[t.uid]:mini.create(t):null:null},mini.create=function(t){if(!t)return null;if(mini.get(t.id)===t)return t;var e=this.getClass(t.type);if(!e)return null;var i=new e;return i.set(t),i},mini.Component=function(){this._events={},this.uid=mini.newId(this._idPre),this._id=this.uid,this.id||(this.id=this.uid),mini.reg(this)},mini.Component.prototype={isControl:!0,id:null,_idPre:"mini-",_idSet:!1,_canFire:!0,set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i=t.renderTo||t.render;for(var n in delete t.renderTo,delete t.render,t)if(0==n.toLowerCase().indexOf("on")){if(this["_$"+n])continue;var s=t[n];this.on(n.substring(2,n.length).toLowerCase(),s),delete t[n]}for(var n in t){var o=t[n],r=this["set"+n.charAt(0).toUpperCase()+n.substring(1,n.length)];r?r.call(this,o):this[n]=o}return i&&this.render&&this.render(i),this._allowLayout=e,this.doLayout&&this.doLayout(),this},fire:function(t,e){if(0!=this._canFire){t=t.toLowerCase();var i=this._events[t];if(i){(e=e||{})&&e!=this&&(e.source=e.sender=this,e.type||(e.type=t));for(var n=0,s=i.length;n<s;n++){var o=i[n];o&&o[0].apply(o[1],[e])}}}},on:function(t,e,i){if("string"==typeof e){var n=mini._getFunctoin(e);if(n)e=n;else{var s=mini.newId("__str_");window[s]=e,e=new Function("e","var s = "+s+";var fn = mini._getFunctoin(s); if(fn) {fn.call(this, e)}else{eval(s);}")}}if("function"!=typeof e||!t)return!1;
// if(!type || !fn) return false;
t=t.toLowerCase();var o=this._events[t];return o=o||(this._events[t]=[]),i=i||this,this.findListener(t,e,i)||o.push([e,i]),this},un:function(t,e,i){
//if (typeof fn != 'function') return false;
t=t.toLowerCase();var n=this._events[t];if(n)if(e){i=i||this;var s=this.findListener(t,e,i);s&&n.remove(s)}else delete this._events[t];return this},findListener:function(t,e,i){t=t.toLowerCase(),i=i||this;var n=this._events[t];if(n)for(var s=0,o=n.length;s<o;s++){var r=n[s];if(r[0]===e&&r[1]===i)return r}},setId:function(t){if(!t)throw new Error("id not null");if(this._idSet)throw new Error("id just set only one");mini.unreg(this),this.id=t,this.el&&(this.el.id=t),this._valueEl&&(this._valueEl.id=t+"$value"),this._textEl&&(this._textEl.id=t+"$text"),this._idSet=!0,mini.reg(this)},getId:function(){return this.id},destroy:function(){mini.unreg(this),this.fire("destroy"),this._events={}}},mini.Control=function(t){mini.Control.superclass.constructor.apply(this,arguments),this._create(),this.el.uid=this.uid,this._initEvents(),this._clearBorder&&(this.el.style.borderWidth="0"),this.addCls(this.uiCls),this.setWidth(this.width),this.setHeight(this.height),this.el.style.display=this.visible?this._displayStyle:"none",t&&mini.applyTo.call(this,t)},mini.extend(mini.Control,mini.Component,{jsName:null,width:"",height:"",visible:!0,readOnly:!1,enabled:!0,tooltip:"",_readOnlyCls:"mini-readonly",_disabledCls:"mini-disabled",_create:function(){this.el=document.createElement("div")},_initEvents:function(){},within:function(t){return!!mini.isAncestor(this.el,t.target)},name:"",setName:function(t){this.name=t},getName:function(){return this.name},isAutoHeight:function(){var t=this.el.style.height;return"auto"==t||""==t},isAutoWidth:function(){var t=this.el.style.width;return"auto"==t||""==t},isFixedSize:function(){var t=this.width,e=this.height;return parseInt(t)+"px"==t&&parseInt(e)+"px"==e},isRender:function(t){return!!(this.el&&this.el.parentNode&&this.el.parentNode.tagName)},render:function(t,e){"string"==typeof t&&(t="#body"==t?document.body:mini.byId(t)),t&&("before"==(e=(e=e||"append").toLowerCase())?jQuery(t).before(this.el):"prepend"==e?jQuery(t).prepend(this.el):"after"==e?jQuery(t).after(this.el):t.appendChild(this.el),this.el.id=this.id,this.doLayout(),this.fire("render"))},
//        while (p != doc && p != null) {
getEl:function(){return this.el},setJsName:function(t){this.jsName=t,window[t]=this},getJsName:function(){return this.jsName},setTooltip:function(t){this.tooltip=t,this.el.title=t,this.tooltipPlacement&&jQuery(this.el).attr("data-placement",this.tooltipPlacement)},getTooltip:function(){return this.tooltip},_sizeChanged:function(){this.doLayout()},setWidth:function(t){parseFloat(t)==t&&(t+="px"),this.width=t,this.el.style.width=t,this._sizeChanged()},getWidth:function(t){var e=this.el,i=t?jQuery(e).width():jQuery(e).outerWidth();if(t&&this._borderEl){var n=mini.getBorders(this._borderEl);i=i-n.left-n.right}return i},setHeight:function(t){parseFloat(t)==t&&(t+="px"),this.height=t,this.el.style.height=t,this._sizeChanged()},getHeight:function(t){var e=t?jQuery(this.el).height():jQuery(this.el).outerHeight();if(t&&this._borderEl){var i=mini.getBorders(this._borderEl);e=e-i.top-i.bottom}return e},getBox:function(){return mini.getBox(this.el)},setBorderStyle:function(t){var e=this._borderEl||this.el;mini.setStyle(e,t),this.doLayout()},getBorderStyle:function(){return this.borderStyle},_clearBorder:!0,setStyle:function(t){this.style=t,mini.setStyle(this.el,t),this._clearBorder&&(this.el.style.borderWidth="0",this.el.style.padding="0px"),this.width=this.el.style.width,this.height=this.el.style.height,this._sizeChanged()},getStyle:function(){return this.style},setCls:function(t){this.addCls(t)},getCls:function(){return this.cls},addCls:function(t){mini.addClass(this.el,t)},removeCls:function(t){mini.removeClass(this.el,t)},_doReadOnly:function(){this.readOnly?this.addCls(this._readOnlyCls):this.removeCls(this._readOnlyCls)},setReadOnly:function(t){this.readOnly=t,this._doReadOnly()},getReadOnly:function(){return this.readOnly},getParent:function(t){for(var e=document,i=this.el.parentNode;i!=e&&null!=i;){var n=mini.get(i);if(n){if(!mini.isControl(n))return null;if(!t||n.uiCls==t)return n}i=i.parentNode}return null},isReadOnly:function(){if(this.readOnly||!this.enabled)return!0;var t=this.getParent();return!!t&&t.isReadOnly()},setEnabled:function(t){this.enabled=t,this.enabled?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),this._doReadOnly()},getEnabled:function(){return this.enabled},enable:function(){this.setEnabled(!0)},disable:function(){this.setEnabled(!1)},_displayStyle:"",setVisible:function(t){this.visible=t,this.el&&(this.el.style.display=t?this._displayStyle:"none",this.doLayout())},getVisible:function(){return this.visible},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},isDisplay:function(t){if(0==mini.WindowVisible||!this.el)return!1;for(var e=document.body,i=this.el;;){if(null==i||!i.style)return!1;if(i&&i.style&&"none"==i.style.display){if(!t)return!1;if(!0!==t(i))return!1}if(i==e)return!0;i=i.parentNode}return!0},_allowUpdate:!0,beginUpdate:function(){this._allowUpdate=!1},endUpdate:function(){this._allowUpdate=!0,this.doUpdate()},doUpdate:function(){},canLayout:function(){return!!mini.enableLayout&&(0!=this._allowLayout&&this.isDisplay())},doLayout:function(){},layoutChanged:function(){0!=this.canLayout()&&this.doLayout()},_destroyChildren:function(t){if(this.el)for(
//            if (!mini.aaa) {
var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++){var s=e[i];!0!==s.destroyed&&s.destroy(t)}},destroy:function(t){if(!0!==this.destroyed&&(mini._destroying||this._destroyChildren(t)),this.el){var e=this.el;e.onclick=e.ondblclick=e.onmousedown=e.onmouseup=e.onmousemove=e.onmouseover=e.onmouseout=e.onkeydown=e.onkeyup=e.oncontextmenu=null,mini.clearEvent(e),!1!==t&&mini.removeNode(e)}this._borderEl=this._contentEl=this._valueEl=this._textEl=this._errorIconEl=null,this.el=null,mini.unreg(this),this.destroyed=!0,this.fire("destroy")},focus:function(){try{this.el.focus()}catch(t){}},blur:function(){try{this.el.blur()}catch(t){}},allowAnim:!0,setAllowAnim:function(t){this.allowAnim=t},getAllowAnim:function(){return this.allowAnim},_getMaskWrapEl:function(){return this.el},mask:function(t){"string"==typeof t&&(t={html:t}),(t=t||{}).el=this._getMaskWrapEl(),t.cls||(t.cls=this._maskCls),mini.mask(t)},unmask:function(){mini.unmask(this._getMaskWrapEl()),this.isLoading=!1},_maskCls:"mini-mask-loading",loadingMsg:epoint_local.loadingMsg,loading:function(t){this.mask(t||this.loadingMsg)},setLoadingMsg:function(t){this.loadingMsg=t},getLoadingMsg:function(){return this.loadingMsg},_getContextMenu:function(t){var e=t;return"string"==typeof t?(e=mini.get(t))||(mini.parse(t),e=mini.get(t)):mini.isArray(t)?e={type:"menu",items:t}:mini.isControl(t)||(e=mini.create(t)),e},__OnHtmlContextMenu:function(t){var e={popupEl:this.el,htmlEvent:t,cancel:!1};if(this.contextMenu.fire("BeforeOpen",e),1!=e.cancel&&(this.contextMenu.fire("opening",e),1!=e.cancel))return this.contextMenu.showAtPos(t.pageX,t.pageY),this.contextMenu.fire("Open",e),!1},contextMenu:null,setContextMenu:function(t){var e=this._getContextMenu(t);e&&this.contextMenu!==e&&(this.contextMenu=e,mini.addClass(e.el,"mini-menu-open"),this.contextMenu.owner=this,mini.on(this.el,"contextmenu",this.__OnHtmlContextMenu,this))},getContextMenu:function(){return this.contextMenu},setDefaultValue:function(t){this.defaultValue=t},getDefaultValue:function(){return this.defaultValue},setValue:function(t){this.value=t},getValue:function(){return this.value},ajaxData:null,ajaxType:"",ajaxOptions:null,setAjaxOptions:function(t){this.ajaxOptions=t},getAjaxOptions:function(){return this.ajaxOptions},setAjaxData:function(t){this.ajaxData=t},getAjaxData:function(){return this.ajaxData},setAjaxType:function(t){this.ajaxType=t},getAjaxType:function(){return this.ajaxType},_afterApply:function(t){},dataField:"",setDataField:function(t){this.dataField=t},getDataField:function(){return this.dataField},tabIndex:0,setTabIndex:function(t){(this._textEl||this.el).tabIndex=t,this.tabIndex=t},getTabIndex:function(){return this.tabIndex},getAttrs:function(t){
//        if (el.tagName.toLowerCase() != this._tagName) {
var e={},i=t.className;i&&(e.cls=i),t.value&&(e.value=t.value),mini._ParseString(t,e,["id","name","width","height","borderStyle","value","defaultValue","tabIndex","contextMenu","tooltip","ondestroy","data-options","ajaxData","ajaxType","dataField","ajaxOptions","data-placement"]),e["data-placement"]&&(this.tooltipPlacement=e["data-placement"]),mini._ParseBool(t,e,["visible","enabled","readOnly"]);
// if (el.readOnly && el.readOnly != "false") attrs.readOnly = true;
var n=t.style.cssText;if(n&&(e.style=n),isIE9){var s=t.style.background;s&&(e.style||(e.style=""),e.style+=";background:"+s)}this.style&&(e.style?e.style=this.style+";"+e.style:e.style=this.style),this.borderStyle&&(e.borderStyle?e.borderStyle=this.borderStyle+";"+e.borderStyle:e.borderStyle=this.borderStyle),"string"==typeof e.ajaxOptions&&(e.ajaxOptions=window.eval("("+e.ajaxOptions+")"));var o=mini._attrs;if(o)for(var r=0,a=o.length;r<a;r++){var l=o[r],h=l[0],d=l[1];"string"==(d=d||"string")?mini._ParseString(t,e,[h]):"bool"==d?mini._ParseBool(t,e,[h]):"int"==d&&mini._ParseInt(t,e,[h])}var u=e["data-options"];return(u=u&&window.eval("("+u+")"))&&mini.copyTo(e,u),e}}),mini._attrs=null,mini.regHtmlAttr=function(t,e){t&&(e=e||"string",mini._attrs||(mini._attrs=[]),mini._attrs.push([t,e]))},__mini_setControls=function(t,e,i){e=e||this._contentEl,i=i||this,t=t||[],mini.isArray(t)||(t=[t]);for(var n=0,s=t.length;n<s;n++){var o=t[n];"string"==typeof o?0==o.indexOf("#")&&(o=mini.byId(o)):mini.isElement(o)||(o=(o=mini.getAndCreate(o)).el),o&&mini.append(e,o)}return mini.parse(e),i.doLayout(),i},mini.Container=function(){mini.Container.superclass.constructor.apply(this,arguments),this._contentEl||(this._contentEl=this.el)},mini.extend(mini.Container,mini.Control,{setControls:__mini_setControls,getContentEl:function(){return this._contentEl},getBodyEl:function(){return this._contentEl},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++){if(e[i].within(t))return!0}return!1}}),mini.ValidatorBase=function(){mini.ValidatorBase.superclass.constructor.apply(this,arguments)},mini.extend(mini.ValidatorBase,mini.Control,{required:!1,requiredErrorText:epoint_local.ValidatorBase.requiredErrorText,_requiredCls:"mini-required",errorText:"",_errorCls:"mini-error",_invalidCls:"mini-invalid",errorMode:"icon",validateOnChanged:!0,validateOnLeave:!0,validateOnInput:!1,resetOnFocus:!0,_IsValid:!0,forceValidate:!1,_afterApply:function(){mini.ValidatorBase.superclass._afterApply.call(this);var t=this;this.on("focus",function(){t.resetOnFocus&&setTimeout(function(){t.setIsValid(!0)},10)})},setForceValidate:function(t){this.forceValidate=t},getForceValidate:function(){return this.forceValidate},keyNavEnabled:!0,setKeyNavEnabled:function(t){this.keyNavEnabled=t},getKeyNavEnabled:function(){return this.keyNavEnabled},indentSpace:!1,_indentCls:"mini-indent",setIndentSpace:function(t){t?this.addCls(this._indentCls):this.removeCls(this._indentCls),this.indentSpace=t},getIndentSpace:function(){return this.indentSpace},isEditable:function(){return!(this.readOnly||!this.allowInput||!this.enabled)},_tryValidate:function(){this._tryValidateTimer&&clearTimeout(this._tryValidateTimer);var t=this;this._tryValidateTimer=setTimeout(function(){t.validate()},30)},validate:function(){var t={value:this.getValue(),errorText:"",isValid:!0};return this.required&&(!mini.isNull(t.value)&&""!==String(t.value).trim()||(t.isValid=!1,t.errorText=this.requiredErrorText)),this.fire("validation",t),this.errorText=t.errorText,this.setIsValid(t.isValid),this.isValid()},isValid:function(){return this._IsValid},setIsValid:function(t){
//if (this._IsValid != value) {
this._IsValid=t,this.doUpdateValid()},getIsValid:function(){return this._IsValid},setValidateOnChanged:function(t){this.validateOnChanged=t},getValidateOnChanged:function(t){return this.validateOnChanged},setValidateOnLeave:function(t){this.validateOnLeave=t},getValidateOnLeave:function(t){return this.validateOnLeave},setValidateOnInput:function(t){this.validateOnInput=t},getValidateOnInput:function(t){return this.validateOnInput},setResetOnFocus:function(t){this.resetOnFocus=t},getResetOnFocus:function(){return this.resetOnFocus},setErrorMode:function(t){t=t||"none",this.errorMode=t.toLowerCase(),0==this._IsValid&&this.doUpdateValid()},getErrorMode:function(){return this.errorMode},setErrorText:function(t){this.errorText=t,0==this._IsValid&&this.doUpdateValid()},getErrorText:function(){return this.errorText},setRequired:function(t){this.required=t,this.required?this.addCls(this._requiredCls):this.removeCls(this._requiredCls)},getRequired:function(){return this.required},setRequiredErrorText:function(t){this.requiredErrorText=t},getRequiredErrorText:function(){return this.requiredErrorText},errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl},_RemoveErrorIcon:function(){},doUpdateValid:function(){this.__doUpdateValid()},errorTooltipPlacement:"right",__doUpdateValid:function(){if(this.el){if(this.removeCls(this._errorCls),this.removeCls(this._invalidCls),"border"==this.errorMode&&(this.el.title=""),0==this._IsValid)switch(this.errorMode){case"icon":this.addCls(this._errorCls);var t=this.getErrorIconEl();t&&(t.title=this.errorText,jQuery(t).attr("data-placement",this.errorTooltipPlacement));break;case"border":this.addCls(this._invalidCls),this.el.title=this.errorText;default:this._RemoveErrorIcon()}else this._RemoveErrorIcon();this.doLayout()}},doValueChanged:function(){this._OnValueChanged()},_OnValueChanged:function(){this.validateOnChanged&&this._tryValidate(),this.fire("valuechanged",{value:this.getValue(),oldValue:this._oldValue}),this._oldValue=this.getValue()},onValueChanged:function(t,e){this.on("valuechanged",t,e)},onValidation:function(t,e){this.on("validation",t,e)},getAttrs:function(t){var e=mini.ValidatorBase.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["onvaluechanged","onvalidation","label","labelStyle","requiredErrorText","errorMode","errorTooltipPlacement"]),mini._ParseBool(t,e,["validateOnChanged","validateOnLeave","validateOnInput","labelField","indentSpace","keyNavEnabled","forceValidate","resetOnFocus"]);var i=t.getAttribute("required");if(!(i=i||t.required)){var n=t.attributes.required;n&&(i="null"==n.value?null:"true")}return i&&(e.required="false"!=i),e},_labelLayout:function(){var t=this._borderEl;if(t)if(this._labelLayouted=!0,this.labelField){var e=this._labelEl.offsetWidth;t.style.marginLeft=e+"px",this._doLabelLayout=0===e}else t.style.marginLeft=0},_labelFieldCls:"mini-labelfield",labelField:!1,label:"",labelStyle:"",setLabelField:function(t){if(this.labelField!=t){if(this.labelField=t,!this._borderEl)return;this._labelEl||(this._labelEl=mini.append(this.el,'<label class="mini-labelfield-label"></label>'),this._labelEl.innerHTML=this.label,mini.setStyle(this._labelEl,this.labelStyle)),this._labelEl.style.display=t?"block":"none",t?mini.addClass(this.el,this._labelFieldCls):mini.removeClass(this.el,this._labelFieldCls),this._labelLayout()}},getLabelField:function(){this.labelField},setLabel:function(t){this.label!=t&&(this.label=t,this._labelEl&&(this._labelEl.innerHTML=t),this._labelLayout())},getLabel:function(){this.label},setLabelStyle:function(t){this.labelStyle!=t&&(this.labelStyle=t,this._labelEl&&mini.setStyle(this._labelEl,t),this._labelLayout())},getLabelStyle:function(){this.labelStyle}}),mini.ListControl=function(t){this.data=[],this._selecteds=[],mini.ListControl.superclass.constructor.call(this,null),this.doUpdate(),t&&mini.applyTo.call(this,t)},mini.ListControl.ajaxType="get",mini.extend(mini.ListControl,mini.ValidatorBase,{defaultValue:"",value:"",valueField:"id",textField:"text",dataField:"",delimiter:",",setDelimiter:function(t){this.delimiter=t},getDelimiter:function(){return this.delimiter},data:null,url:"",valueInCheckOrder:!0,setValueInCheckOrder:function(t){this.valueInCheckOrder=t},getValueInCheckOrder:function(){return this.valueInCheckOrder},_itemCls:"mini-list-item",_itemHoverCls:"mini-list-item-hover",_itemSelectedCls:"mini-list-item-selected",doLayout:function(){this._doLabelLayout&&this._labelLayout()},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.url;delete t.url;var n=t.data;return delete t.data,mini.ListControl.superclass.set.call(this,t),mini.isNull(n)||this.setData(n),mini.isNull(i)||this.setUrl(i),mini.isNull(e)||this.setValue(e),this},uiCls:"mini-list",_create:function(){},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"click",this.__OnClick,this),mini_onOne(this.el,"dblclick",this.__OnDblClick,this),mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"mouseup",this.__OnMouseUp,this),mini_onOne(this.el,"mousemove",this.__OnMouseMove,this),mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this),mini_onOne(this.el,"keydown",this.__OnKeyDown,this),mini_onOne(this.el,"keyup",this.__OnKeyUp,this),mini_onOne(this.el,"contextmenu",this.__OnContextMenu,this)},this)},destroy:function(t){mini.ListControl.superclass.destroy.call(this,t)},name:"",setName:function(t){this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name)},getItemByEvent:function(t){var e=mini.findParent(t.target,this._itemCls);if(e){var i=parseInt(mini.getAttr(e,"index"));return this.data[i]}},addItemCls:function(t,e){var i=this.getItemEl(t);i&&mini.addClass(i,e)},removeItemCls:function(t,e){var i=this.getItemEl(t);i&&mini.removeClass(i,e)},getItemEl:function(t){t=this.getItem(t);var e=this.data.indexOf(t),i=this._createItemId(e);return document.getElementById(i)},_focusItem:function(t,e){if(t=this.getItem(t)){var i=this.getItemEl(t);e&&i&&this.scrollIntoView(t),this._focusedItem!=t&&(this._blurItem(),this._focusedItem=t),i&&mini.addClass(i,this._itemHoverCls)}},_blurItem:function(){if(this._focusedItem){var t=this.getItemEl(this._focusedItem);t&&mini.removeClass(t,this._itemHoverCls),this._focusedItem=null}},getFocusedItem:function(){var t=this._focusedItem;return-1==this.indexOf(t)?null:t},getFocusedIndex:function(){return this.data.indexOf(this._focusedItem)},_scrollViewEl:null,scrollIntoView:function(t){try{var e=this.getItemEl(t),i=this._scrollViewEl||this.el;mini.scrollIntoView(e,i,!1)}catch(n){}},getItem:function(t){return"object"==typeof t?t:"number"==typeof t?this.data[t]:this.findItems(t)[0]},getCount:function(){return this.data.length},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},updateItem:function(t,e){(t=this.getItem(t))&&(mini.copyTo(t,e),this.doUpdate())},load:function(t){"string"==typeof t?this.setUrl(t):this.setData(t)},loadData:function(t){this.setData(t)},setData:function(t){if("string"==typeof t&&(t=window.eval(t)),mini.isArray(t)||(t=[]),this.data=t,this.doUpdate(),""!=this.value){this.deselectAll();var e=this.findItems(this.value);this.selects(e)}},getData:function(){return this.data.clone()},setUrl:function(t){
//if (this.url != url) {
this.url=t,this._doLoad({})},getUrl:function(){return this.url},ajaxData:null,_doLoad:function(t){try{(r=window.eval(this.url))!=undefined&&(this.url=r)}catch(a){}var r=this.url,e=mini.ListControl.ajaxType;r&&(-1==r.indexOf(".txt")&&-1==r.indexOf(".json")||(e="get"));var i=mini._evalAjaxData(this.ajaxData,this);mini.copyTo(t,i);var a={url:this.url,async:!1,type:this.ajaxType?this.ajaxType:e,data:t,params:t,cache:!1,cancel:!1};if(jQuery.extend(!0,a,this.ajaxOptions),this.fire("beforeload",a),a.data!=a.params&&a.params!=t&&(a.data=a.params),1!=a.cancel){var l=me=this;r=a.url;mini.copyTo(a,{success:function(t,e,i){delete a.params;var n={text:t,result:null,sender:me,options:a,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(o){1==mini_debugger&&alert(r+"\njson is error.")}mini.isArray(s)&&(s={data:s}),l.dataField&&(s.data=mini._getMap(l.dataField,s)),s.data||(s.data=[]);var o={data:s.data,cancel:!1,result:s};l.fire("preload",o),1!=o.cancel&&(l.setData(o.data),delete o.cancel,l.fire("load",o),setTimeout(function(){l.doLayout()},100))},error:function(t,e,i){var n={xhr:t,text:t.responseText,textStatus:e,errorMsg:t.responseText,errorCode:t.status};1==mini_debugger&&alert(r+"\n"+n.errorCode+"\n"+n.errorMsg),l.fire("loaderror",n)}}),this._ajaxer=mini.ajax(a)}},setValue:function(t){mini.isNull(t)&&(t=""),
//if (this.value !== value) {
this.deselectAll(),this.value=t,this._valueEl&&(this._valueEl.value=t);var e=this.findItems(this.value);this.selects(e),this.setSelected(e[0])},getValue:function(){return this.value},getFormValue:function(){return this.value},setValueField:function(t){this.valueField=t},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},getItemValue:function(t){return String(mini._getMap(this.valueField,t))},getItemText:function(t){var e=mini._getMap(this.textField,t);return mini.isNull(e)?"":String(e)},getValueAndText:function(t){if(mini.isNull(t)&&(t=[]),mini.isArray(t)||(t=this.findItems(t)),this.valueInCheckOrder){var s=this.getData();mini.sort(t,function(t,e){var i=s.indexOf(t),n=s.indexOf(e);return n<i?1:i<n?-1:0})}for(var e=[],i=[],n=0,o=t.length;n<o;n++){var r=t[n];r&&(e.push(this.getItemValue(r)),i.push(this.getItemText(r)))}return[e.join(this.delimiter),i.join(this.delimiter)]},findItems:function(t){if(mini.isNull(t)||""===t)return[];if("function"==typeof t){for(var e=t,i=[],n=0,s=(o=this.data).length;n<s;n++){!0===e(l=o[n],n)&&i.push(l)}return i}var o,r=String(t).split(this.delimiter),a={};for(n=0,s=(o=this.data).length;n<s;n++){var l=o[n];a[mini._getMap(this.valueField,l)]=l}for(var h=[],d=0,u=r.length;d<u;d++){(l=a[r[d]])&&h.push(l)}return h},removeAll:function(){var t=this.getData();this.removeItems(t)},addItems:function(t,e){mini.isArray(t)&&(mini.isNull(e)&&(e=this.data.length),this.data.insertRange(e,t),this.doUpdate())},addItem:function(t,e){t&&-1==this.data.indexOf(t)&&(mini.isNull(e)&&(e=this.data.length),this.data.insert(e,t),this.doUpdate())},removeItems:function(t){mini.isArray(t)&&(this.data.removeRange(t),this._checkSelecteds(),this.doUpdate())},removeItem:function(t){var e=this.data.indexOf(t);-1!=e&&(this.data.removeAt(e),this._checkSelecteds(),this.doUpdate())},moveItem:function(t,e){t&&mini.isNumber(e)&&(e<0&&(e=0),e>this.data.length&&(e=this.data.length),this.data.remove(t),this.data.insert(e,t),this.doUpdate())},_isSelectedAll:function(){for(var t=this.getData(),e=0,i=t.length;e<i;e++){var n=t[e];if(!1!==n.enabled&&!this.isSelected(n))return!1}return!0},_selected:null,_selecteds:[],multiSelect:!1,_checkSelecteds:function(){for(var t=this._selecteds.length-1;0<=t;t--){var e=this._selecteds[t];-1==this.data.indexOf(e)&&this._selecteds.removeAt(t)}this._selected&&-1==this.data.indexOf(this._selected)&&(this._selected=null);var i=this.getValueAndText(this._selecteds);this.value=i[0],this._valueEl&&(this._valueEl.value=this.value)},setMultiSelect:function(t){this.multiSelect=t},getMultiSelect:function(){return this.multiSelect},isSelected:function(t){return!!t&&-1!=this._selecteds.indexOf(t)},getSelecteds:function(){var t=this._selecteds.clone(),s=this;return this.valueInCheckOrder&&mini.sort(t,function(t,e){var i=s.indexOf(t),n=s.indexOf(e);return n<i?1:i<n?-1:0}),t},setSelected:function(t){t&&(this._selected=t,this.select(t))},getSelected:function(){return this._selected},select:function(t){(t=this.getItem(t))&&(this.isSelected(t)||(this._selected=t,this.selects([t])))},deselect:function(t){(t=this.getItem(t))&&this.isSelected(t)&&this.deselects([t])},selectAll:function(){var t=this.data.clone();this.selects(t)},deselectAll:function(){this.deselects(this._selecteds)},clearSelect:function(){this.deselectAll()},selects:function(t){if(t&&0!=t.length){t=t.clone(),0==this.multiSelect&&1<t.length&&(t.length=1);for(var e=0,i=t.length;e<i;e++){var n=t[e];this.isSelected(n)||this._selecteds.push(n)}this._doSelects()}},deselects:function(t){if(t&&0!=t.length){for(var e=(t=t.clone()).length-1;0<=e;e--){var i=t[e];this.isSelected(i)&&this._selecteds.remove(i)}this._doSelects()}},_doSelects:function(){var t=this.getValueAndText(this._selecteds);this.value=t[0],this._valueEl&&(this._valueEl.value=this.value);for(var e=0,i=this.data.length;e<i;e++){var n=this.data[e],s=this.isSelected(n);s?this.addItemCls(n,this._itemSelectedCls):this.removeItemCls(n,this._itemSelectedCls);var o=this.data.indexOf(n),r=this._createCheckId(o),a=mini.byId(r,this.el);a&&(a.checked=!!s)}},_OnSelectionChanged:function(t,e){var i=this.getValueAndText(this._selecteds);this.value=i[0],this._valueEl&&(this._valueEl.value=this.value);var n={selecteds:this.getSelecteds(),selected:this.getSelected(),value:this.getValue()};this.fire("SelectionChanged",n)},_createCheckId:function(t){return this.uid+"$ck$"+t},_createItemId:function(t){return this.uid+"$"+t},__OnClick:function(t){this._clickTime&&new Date-this._clickTime<100||(this._clickTime=new Date,this._fireEvent(t,"Click"))},__OnDblClick:function(t){this._fireEvent(t,"Dblclick")},__OnMouseDown:function(t){this._fireEvent(t,"MouseDown")},__OnMouseUp:function(t){this._fireEvent(t,"MouseUp")},__OnMouseMove:function(t){this._fireEvent(t,"MouseMove")},__OnMouseOver:function(t){this._fireEvent(t,"MouseOver")},__OnMouseOut:function(t){this._fireEvent(t,"MouseOut")},__OnKeyDown:function(t){this._fireEvent(t,"KeyDown")},__OnKeyUp:function(t){this._fireEvent(t,"KeyUp")},__OnContextMenu:function(t){this._fireEvent(t,"ContextMenu")},_fireEvent:function(t,e){if(this.enabled){var i=this.getItemByEvent(t);if(i){var n=this["_OnItem"+e];if(n)n.call(this,i,t);else{var s={item:i,htmlEvent:t};this.fire("item"+e,s)}}}},allowDeselect:!1,setAllowDeselect:function(t){this.allowDeselect=t},getAllowDeselect:function(){return this.allowDeselect},_OnItemClick:function(t,e){if(this.isReadOnly()||0==this.enabled||!1===t.enabled)e.preventDefault();else{var i=this.getValue(),n={item:t,htmlEvent:e,cancel:!1};this.fire("beforeselect",n);e={item:t,htmlEvent:e,cancel:!1};if(this.fire("beforeitemclick",e),!e.cancel){0==n.cancel&&(this._oldValue=i,this.multiSelect?(this.isSelected(t)?(this.deselect(t),this._selected==t&&(this._selected=null)):(this.select(t),this._selected=t),t.__NullItem&&(this.deselectAll(),this._selected=null),this._OnSelectionChanged()):
//                if (!this.isSelected(item)) {
this.isSelected(t)?this.allowDeselect&&0==this.multiSelect&&(this.deselectAll(),this._OnSelectionChanged()):(this.deselectAll(),this.select(t),this._selected=t,this._OnSelectionChanged()),i!=this.getValue()&&this._OnValueChanged());e={item:t,htmlEvent:e};this.fire("itemclick",e)}}},_blurOnOut:!0,_OnItemMouseOut:function(t,e){if(this.enabled){this._blurOnOut&&this._blurItem();e={item:t,htmlEvent:e};this.fire("itemmouseout",e)}},_OnItemMouseMove:function(t,e){if(this.enabled&&!1!==t.enabled){this._focusItem(t);e={item:t,htmlEvent:e};this.fire("itemmousemove",e)}},onItemClick:function(t,e){this.on("itemclick",t,e)},onItemMouseDown:function(t,e){this.on("itemmousedown",t,e)},onBeforeLoad:function(t,e){this.on("beforeload",t,e)},onLoad:function(t,e){this.on("load",t,e)},onLoadError:function(t,e){this.on("loaderror",t,e)},onPreLoad:function(t,e){this.on("preload",t,e)},getText:function(){var t=this.getSelecteds();if(0==t.length)return"";for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i],o=this.getTextField();e.push(s[o])}return e.join(",")},getAttrs:function(t){var e=mini.ListControl.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["url","data","value","textField","valueField","onitemclick","onitemmousemove","onselectionchanged","onitemdblclick","onbeforeload","onload","onloaderror","ondataload","onbeforeselect","delimiter"]),mini._ParseBool(t,e,["multiSelect","valueInCheckOrder","allowDeselect"]);var i=e.valueField||this.valueField,n=e.textField||this.textField;if("select"==t.nodeName.toLowerCase()){for(var s=[],o=0,r=t.length;o<r;o++){var a=t.options[o],l={};l[n]=a.text,l[i]=a.value,s.push(l)}0<s.length&&(e.data=s)}return e}}),mini._Layouts={},mini.layout=function(t,a){mini.enableLayout&&document.body&&(function l(t){if(t){var e=mini.get(t);if(e)e.doLayout&&(mini._Layouts[e.uid]||(mini._Layouts[e.uid]=e,
//                    if (!mini.isNumber(width) || !mini.isNumber(height)) {
!1===a&&0!=e.isFixedSize()||e.doLayout(!1),delete mini._Layouts[e.uid]));else{var i=t.childNodes;if(i)for(var n=0,s=i.length;n<s;n++){var o=i[n];try{o.toString()}catch(r){continue}l(o)}}}}(t=t||document.body),t==document.body&&mini.layoutIFrames());
//if (!el || el == document || el == document.body) alert("layout");
}
//    if (!el) return this;
//    if (el && el != this.el) {
//    if (mini.isNull(config.defaultValue) && !mini.isNull(config.value)) {
//    if (mini.isNull(config.defaultText) && !mini.isNull(config.text)) {
//    //    if (p && this.el != el) {    //
,mini.applyTo=function(t){if(!(t=mini.byId(t)))return this;if(mini.get(t))throw new Error("not applyTo a mini control");var e=this.getAttrs(t);delete e._applyTo,mini.isNull(e.defaultValue)&&!mini.isNull(e.value)&&(e.defaultValue=e.value),mini.isNull(e.defaultText)&&!mini.isNull(e.text)&&(e.defaultText=e.text);var i=t.parentNode;return i&&this.el!=t&&i.replaceChild(this.el,t),window._mini_set&&_mini_set(e,this),this.set(e),this._afterApply(t),this},mini._doParse=function(t){if(t){var e=t.nodeName.toLowerCase();if(e&&null==jQuery(t).attr("noparser")){var i=String(t.className);if(i)if(!mini.get(t))for(var n=i.split(" "),s=0,o=n.length;s<o;s++){var r=n[s],a=mini.getClassByUICls(r);if(a){mini.removeClass(t,r);var l=new a;mini.applyTo.call(l,t),t=l.el;break}}if(!("select"==e||mini.hasClass(t,"mini-menu")||mini.hasClass(t,"mini-datagrid")||mini.hasClass(t,"mini-treegrid")||mini.hasClass(t,"mini-tree")||mini.hasClass(t,"mini-button")||mini.hasClass(t,"mini-textbox")||mini.hasClass(t,"mini-buttonedit"))){var h=mini.getChildNodes(t,!0);for(s=0,o=h.length;s<o;s++){var d=h[s];1==d.nodeType&&d.parentNode==t&&mini._doParse(d)}}}}},mini._Removes=[],mini._firstParse=!0,mini.parse=function(t,e){
//    if (!el || el == document || el == document.body) mini._rootParsing = true;
if(mini.parsed=!0,mini._firstParse){mini._firstParse=!1;for(var i=document.getElementsByTagName("iframe"),s=[],n=0,o=i.length;n<o;n++){var r=i[n];s.push(r)}for(n=0,o=s.length;n<o;n++){r=s[n];var a=jQuery(r).attr("src");a&&(r.loaded=!1,r._onload=r.onload,r._src=a,r.onload=function(){},r.src="")}setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t];i._src&&""==jQuery(i).attr("src")&&(i.loaded=!0,i.onload=i._onload,i.src=i._src,i._src=i._onload=null)}},20),setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t],n=jQuery(i).attr("data-src");n&&(i.src=n)}},30)}if("string"==typeof t){var l=t;t=(t=mini.byId(l))||document.body}t&&!mini.isElement(t)&&(t=t.el),t=t||document.body;
//if (!context) context = el;
var h=mini.WindowVisible;isIE&&(mini.WindowVisible=!1),mini._doParse(t),mini.WindowVisible=h,!1!==e&&mini.layout(t)},mini._ParseString=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],r=mini.getAttr(t,o);r&&(e[o]=r)}},mini._ParseBool=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],r=mini.getAttr(t,o);r?e[o]="true"==r:""===r&&(e[o]=!0)}},mini._ParseInt=function(t,e,i){for(var n=0,s=i.length;n<s;n++){var o=i[n],r=parseInt(mini.getAttr(t,o));isNaN(r)||(e[o]=r)}}
//            if (!isNaN(value)) {
,mini._ParseColumns=function(t){for(var e=[],i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],r={},a=null,l=null,h=mini.getChildNodes(o);if(h)for(var d=0,u=h.length;d<u;d++){var c=h[d],m=mini.getAttr(c,"property");if(m&&("columns"==(m=m.toLowerCase())&&(r.columns=mini._ParseColumns(c),c.parentNode&&c.parentNode.removeChild(c)),"editor"==m||"filter"==m)){for(var f=c.className.split(" "),p=0,g=f.length;p<g;p++){var _=f[p],v=mini.getClassByUICls(_);if(v){var y=new v;"filter"==m?(l=y.getAttrs(c)).type=y.type:(a=y.getAttrs(c)).type=y.type;break}}c.parentNode&&c.parentNode.removeChild(c)}}if(r.header=o.innerHTML,mini._ParseString(o,r,["name","header","field","editor","filter","renderer","width","type","renderer","headerAlign","align","headerCls","cellCls","headerStyle","cellStyle","displayField","dateFormat","listFormat","mapFormat","numberFormat","trueValue","falseValue","dataType","vtype","currencyUnit","summaryType","summaryRenderer","groupSummaryType","groupSummaryRenderer","defaultValue","defaultText","decimalPlaces","data-options","sortField","sortType"]),mini._ParseBool(o,r,["allowCellWrap","visible","readOnly","allowSort","allowResize","allowMove","allowDrag","autoShowPopup","unique","autoEscape","enabled","hideable","showCellTip","valueFromSelect","navUpdown"]),mini._ParseInt(o,r,["minWidth"]),a&&(r.editor=a),l&&(r.filter=l),"string"==typeof r.editor)try{r.editor=window.eval("("+r.editor+")")}catch(x){}r.dataType&&(r.dataType=r.dataType.toLowerCase()),"true"===r.defaultValue&&(r.defaultValue=!0),"false"===r.defaultValue&&(r.defaultValue=!1),e.push(r);var w=r["data-options"];(w=w&&window.eval("("+w+")"))&&mini.copyTo(r,w)}return e},mini._Columns={},mini._getColumn=function(t){var e=mini._Columns[t.toLowerCase()];return e?e():{}},mini.IndexColumn=function(t){return mini.copyTo({ignoreCollapseIndex:!1,width:30,cellCls:"",align:"center",draggable:!1,allowDrag:!0,hideable:!0,init:function(t){t.on("addrow",this.__OnIndexChanged,this),t.on("removerow",this.__OnIndexChanged,this),t.on("moverow",this.__OnIndexChanged,this),t.isTree&&(t.on("addnode",this.__OnIndexChanged,this),t.on("removenode",this.__OnIndexChanged,this),t.on("movenode",this.__OnIndexChanged,this),t.on("loadnode",this.__OnIndexChanged,this),this._gridUID=t.uid,this._rowIdField="_id")},getNumberId:function(t){return this._gridUID+"$number$"+t[this._rowIdField]},createNumber:function(t,e){return mini.isNull(t.pageIndex)?e+1:t.pageIndex*t.pageSize+e+1},renderer:function(t){var e=t.sender;this.draggable&&(t.cellStyle||(t.cellStyle=""),t.cellStyle+=";cursor:move;");var i='<div id="'+this.getNumberId(t.record)+'">',n=t.rowIndex;return this.ignoreCollapseIndex,mini.isNull(e.getPageIndex)?i+=n+1:i+=e.getPageIndex()*e.getPageSize()+n+1,i+="</div>"},__updateRowNumbers:function(t){for(var e=t.getDataView(),i=0,n=e.length;i<n;i++){var s=e[i],o=this.getNumberId(s),r=document.getElementById(o);r&&(r.innerHTML=this.createNumber(t,i))}},__OnIndexChanged:function(t){var e=t.sender,i=this;i._toIndex||(i._toIndex=setTimeout(function(){i._toIndex=null,i.__updateRowNumbers(e)},10))}},t)},mini._Columns.indexcolumn=mini.IndexColumn,mini.CheckColumn=function(t){return mini.copyTo({width:30,cellCls:"mini-checkcolumn",headerCls:"mini-checkcolumn",hideable:!0,_multiRowSelect:!0,header:function(t){var e=this.uid+"checkall",i='<span class="mini-grid-checkbox mini-icon '+(t._checkedAll?"mini-grid-checkbox-checked":"")+'" id="'+e+'"></span>';return 0==this.multiSelect&&(i=""),i},getCheckId:function(t,e){return this._gridUID+"$checkcolumn$"+t[this._rowIdField]+"$"+e._id},init:function(t){t.on("_selectchange",this.__OnSelectionChanged,this),t.on("HeaderCellClick",this.__OnHeaderCellClick,this);var e=this;t.on("removerow",function(){t.data&&0==t.data.length&&e._doCheckState(t)});e=this;t.on("load",function(){t.uid;e._doCheckState(t)},this)},renderer:function(t){var e=this.getCheckId(t.record,t.column);t.sender.isSelected&&t.sender.isSelected(t.record);return'<span class="mini-grid-'+(t.sender.getMultiSelect()?"checkbox":"radio")+' mini-icon" id="'+e+'"></span>'},__OnHeaderCellClick:function(t){var e=t.sender;if(t.column==this){var i=e.uid+"checkall",n=document.getElementById(i);if(n){var s="mini-grid-checkbox-checked",o=!mini.hasClass(n,s);if(this._checkedAll=o,e.getMultiSelect())if(o){var r=e.getDataView();e.selects(r),mini.addClass(n,s),setTimeout(function(){mini.addClass(n,s)},30)}else{r=e.getDataView();e.deselects(r),mini.removeClass(n,s)}else e.deselectAll(),o&&(e.select(0),mini.addClass(n,s));e.fire("checkall")}}},__OnSelectionChanged:function(t){var e=t.sender,i=e.toArray(),n=this,s=e.isVirtualScroll(),o=e._viewRegion,r=s&&o?o.start:-1,a=o?o.end:-1,l={};if(-1!=r)for(var h=e.getVisibleRows(),d=r,u=a;d<u;d++){var c=h[d];c&&(l[c._id]=!0)}for(d=0,u=i.length;d<u;d++){var m=i[d];-1==r||l[m._id]}this._timer||(this._timer=setTimeout(function(){n._doCheckState(e),n._timer=null},10))},_doCheckState:function(t){var e=t.uid+"checkall",i=document.getElementById(e);if(i){var n=t.getSelecteds(),s=t.isTree?t.getList().length:t.getData().length;n.length==s&&0!=s?jQuery(i).addClass("mini-grid-checkbox-checked"):jQuery(i).removeClass("mini-grid-checkbox-checked")}}},t)},mini._Columns.checkcolumn=mini.CheckColumn,mini.ExpandColumn=function(t){return mini.copyTo({width:30,headerAlign:"center",align:"center",draggable:!1,cellStyle:"padding:0",cellCls:"mini-grid-expandCell",hideable:!0,renderer:function(t){return'<a class="mini-grid-ecIcon mini-icon" href="javascript:#" onclick="return false"></a>'},init:function(t){t.on("cellclick",this.__OnCellClick,this)},__OnCellClick:function(t){var e=t.sender;if(t.column==this&&e.isShowRowDetail&&mini.findParent(t.htmlEvent.target,"mini-grid-ecIcon")){var i=e.isShowRowDetail(t.record);if(i){if(t.cancel=!1,e.fire("beforehiderowdetail",t),!0===t.cancel)return}else if(t.cancel=!1,e.fire("beforeshowrowdetail",t),!0===t.cancel)return;e.autoHideRowDetail&&e.hideAllRowDetail(),i?e.hideRowDetail(t.record):e.showRowDetail(t.record)}}},t)},mini._Columns.expandcolumn=mini.ExpandColumn,mini.CheckBoxColumn=function(t){return mini.copyTo({_type:"checkboxcolumn",editMode:"inline",header:"",headerAlign:"center",trueValue:!0,falseValue:!1,readOnly:!1,getCheckId:function(t,e){return this._gridUID+"$checkbox$"+t[this._rowIdField]+"$"+e._id},getCheckBoxEl:function(t,e){return document.getElementById(this.getCheckId(t,e))},isChecked:function(t,e){var i=this.getCheckBoxEl(t,e);return jQuery(i).hasClass("mini-grid-checkbox-checked")},renderer:function(t){return'<span  id="'+this.getCheckId(t.record,t.column)+'" class="mini-grid-checkbox mini-icon '+(mini._getMap(t.field,t.record)==this.trueValue?"mini-grid-checkbox-checked":"")+'"></span>'},init:function(n){function s(t){if(!n.isReadOnly()&&!this.readOnly&&(t.value=mini._getMap(t.field,t.record),n.fire("cellbeginedit",t),!0!==t.cancel)){var e=mini._getMap(t.column.field,t.record)==this.trueValue?this.falseValue:this.trueValue;n._OnCellCommitEdit&&(n._OnCellCommitEdit(t.record,t.column,e),n._OnCellEndEdit(t.record,t.column))}}(this.grid=n).on("cellclick",function o(t){if(t.column==this){var e=this.getCheckId(t.record,t.column),i=t.htmlEvent.target;if(i.id==e)if(n.allowCellEdit)t.cancel=!1,s.call(this,t);else{if(this.readOnly)return;if(t.value=mini._getMap(t.column.field,t.record),n.fire("cellbeginedit",t),1==t.cancel)return;n.isEditingRow&&n.isEditingRow(t.record)&&setTimeout(function(){
//ck.checked = !ck.checked;
jQuery(i).toggleClass("mini-grid-checkbox-checked")},1)}}},this),mini.on(this.grid.el,"keydown",function(t){if(32==t.keyCode&&n.allowCellEdit){var e=n.getCurrentCell();if(!e)return;if(e[1]!=this)return;var i={record:e[0],column:e[1]};i.field=i.column.field,s.call(this,i),t.preventDefault()}},this);var t=parseInt(this.trueValue),e=parseInt(this.falseValue);isNaN(t)||(this.trueValue=t),isNaN(e)||(this.falseValue=e),"true"==this.trueValue&&(this.trueValue=!0),"false"==this.falseValue&&(this.falseValue=!1)}},t)},mini._Columns.checkboxcolumn=mini.CheckBoxColumn,mini.RadioButtonColumn=function(t){return mini.copyTo({_type:"radiobuttoncolumn",editMode:"inline",header:"",headerAlign:"center",trueValue:!0,falseValue:!1,readOnly:!1,getCheckId:function(t,e){return this._gridUID+"$radio$"+t[this._rowIdField]+"$"+e._id},getCheckBoxEl:function(t,e){return document.getElementById(this.getCheckId(t,e))},renderer:function(t){var e=t.sender,i=this.getCheckId(t.record,t.column),n=mini._getMap(t.field,t.record)==this.trueValue;e._id,t.column.field;
//            if (!grid.allowCellEdit) {
//            if (!grid.allowCellEdit) {
//                if (!grid.isEditingRow(e.record)) {
return'<span id="'+i+'" class="mini-icon mini-grid-radio '+(n?"mini-grid-radio-checked":"")+'"></span>'},init:function(d){function n(t){if(!d.isReadOnly()&&!this.readOnly&&(t.value=mini._getMap(t.field,t.record),d.fire("cellbeginedit",t),!0!==t.cancel)){if((o=mini._getMap(t.column.field,t.record))==this.trueValue)return;for(var e=o==this.trueValue?this.falseValue:this.trueValue,i=d.getData(),n=0,s=i.length;n<s;n++){var o,r=i[n];if(r!=t.record)(o=mini._getMap(t.column.field,r))!=this.falseValue&&d.updateRow(r,t.column.field,this.falseValue)}d._OnCellCommitEdit&&(d._OnCellCommitEdit(t.record,t.column,e),d._OnCellEndEdit(t.record,t.column))}}(this.grid=d).on("cellclick",function i(a){if(a.column==this){var t=this.getCheckId(a.record,a.column),l=a.htmlEvent.target;if(l.id==t)if(d.allowCellEdit)a.cancel=!1,n.call(this,a);else if(d.isEditingRow&&d.isEditingRow(a.record)){var h=this;setTimeout(function(){l.checked=!0;for(var t=d.getData(),e=0,i=t.length;e<i;e++){var n=t[e];if(n!=a.record){var s=a.column.field,o=mini._getMap(s,n);if(o!=h.falseValue&&n!=a.record)if(d._dataSource)mini._setMap(a.column.field,h.falseValue,n),d._dataSource._setModified(n,s,o);else{var r={};mini._setMap(s,h.falseValue,r),d._doUpdateRow(n,r)}}}},1)}}},this),mini.on(this.grid.el,"keydown",function(t){if(32==t.keyCode&&d.allowCellEdit){var e=d.getCurrentCell();if(!e)return;if(e[1]!=this)return;var i={record:e[0],column:e[1]};i.field=i.column.field,n.call(this,i),t.preventDefault()}},this);var t=parseInt(this.trueValue),e=parseInt(this.falseValue);isNaN(t)||(this.trueValue=t),isNaN(e)||(this.falseValue=e)}},t)},mini._Columns.radiobuttoncolumn=mini.RadioButtonColumn,mini.ComboBoxColumn=function(t){return mini.copyTo({renderer:listColumnRenderer},t)},mini._Columns.comboboxcolumn=mini.ComboBoxColumn,mini.TreeSelectColumn=function(t){return mini.copyTo({renderer:listColumnRenderer},t)},mini._Columns.treeselectcolumn=mini.TreeSelectColumn,
//                var value = !mini.isNull(e.value) ? String(e.value) : "";
//                    if (!combo) {
//                    if (!valueMaps || data !== this._data) {
mini._Resizer=function(t){this.owner=t,mini.on(this.owner.el,"mousedown",this.__OnMouseDown,this)},mini._Resizer.prototype={__OnMouseDown:function(t){mini.hasClass(t.target,"mini-resizer-trigger")&&this.owner.allowResize&&this._getResizeDrag().start(t)},_getResizeDrag:function(){return this._resizeDragger||(this._resizeDragger=new mini.Drag({capture:!0,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this._resizeDragger},_OnDragStart:function(t){this.mask=mini.append(document.body,'<div class="mini-resizer-mask mini-fixed"></div>'),this.proxy=mini.append(document.body,'<div class="mini-resizer-proxy"></div>'),this.proxy.style.cursor="se-resize";var e=this.owner.el;e.offsetWidth,this.elBox=mini.getBox(e),mini.setBox(this.proxy,this.elBox)},_OnDragMove:function(t){var e=this.owner,i=t.now[0]-t.init[0],n=t.now[1]-t.init[1],s=this.elBox.width+i,o=this.elBox.height+n;s<e.minWidth&&(s=e.minWidth),o<e.minHeight&&(o=e.minHeight),s>e.maxWidth&&(s=e.maxWidth),o>e.maxHeight&&(o=e.maxHeight),mini.setSize(this.proxy,s,o)},_OnDragStop:function(t,e){if(this.proxy){var i=mini.getBox(this.proxy);jQuery(this.mask).remove(),jQuery(this.proxy).remove(),this.proxy=null,this.elBox=null,e&&(this.owner.setWidth(i.width),this.owner.setHeight(i.height),this.owner.fire("resize"))}}},mini._topWindow=null,mini._getTopWindow=function(t){if(mini._topWindow)return mini._topWindow;var i=[];return function n(t){try{(t.___try=1)==t.___try&&i.push(t)}catch(e){}t.parent&&t.parent!=t&&n(t.parent)}(window),mini._topWindow=i[i.length-1],mini._topWindow};var __ps=mini.getParams();if(__ps._winid)try{window.Owner=mini._getTopWindow()[__ps._winid]}catch(ex){}function fixIEFocus(){var t=mini.getViewportBox(),e=document.createElement("input");e.style.cssText="position:absolute;left:"+t.left+"px;top:"+t.top+"px;",document.body.appendChild(e),e.focus(),e.parentNode.removeChild(e)}mini._WindowID="w"+Math.floor(1e4*Math.random()),mini._getTopWindow()[mini._WindowID]=window,mini.iframeParams={},mini.createIFrame=function(t,e,i,n,s){var o=(t=t||"").split("#");t=o[0];var r="";if(!0!==i&&(r="_t="+Math.floor(1e6*Math.random()),-1==t.indexOf("?")?t+="?"+r:t+="&"+r),t&&-1==t.indexOf("_winid")){r="_winid="+mini._WindowID;-1==t.indexOf("?")?t+="?"+r:t+="&"+r}if(mini.iframeParams)for(var a in mini.iframeParams)t+="&"+a+"="+mini.iframeParams[a];o[1]&&(t=t+"#"+o[1]);var l=-1!=t.indexOf(".mht"),h=l?t:"",d='<iframe name="'+mini.newId("mini-iframe-")+'" src="'+("post"==n?"":h)+'" style="width:100%;height:100%;"  frameborder="0"></iframe>',u=document.createElement("div"),c=mini.append(u,d),m=!1;l?m=!0:setTimeout(function(){c&&("post"!=n&&(c.src=t),m=!0)},5),c.attachEvent?c.attachEvent("onload",_):c.onload=_;var f,p=!1,g=!0;function _(){0==m||p||setTimeout(function(){e&&e(c,g),g=!1},1)}if(c._ondestroy=function(){if(p=!0,c.src="",mini.isIE)try{c.contentWindow.document.write(""),c.contentWindow.document.close()}catch(ex){}c._ondestroy=null,c=null},"post"==n){f=function v(){return jQuery("<form />").attr({method:"post",action:t,enctype:"multipart/form-data",target:c.name}).hide().appendTo("body")}(),setTimeout(function(){f.submit()},10)}return c}
//    if (!url) url = "";
//    if (cache !== true) {
//    var isMHT = url.indexOf(".mht") != -1;
//    //        if (ret !== false) {
,mini._doOpen=function(t){"string"==typeof t&&(t={url:t}),(t=mini.copyTo({width:700,height:400,allowResize:!0,allowModal:!0,closeAction:"destroy",title:"",titleIcon:"",iconCls:"",iconStyle:"",bodyStyle:"padding: 0",url:"",showCloseButton:!0,showFooter:!1},t)).closeAction="destroy";var e=t.onload;delete t.onload;var i=t.ondestroy;delete t.ondestroy;var n=t.url;delete t.url;var s=mini.getViewportBox();if(t.width&&-1!=String(t.width).indexOf("%")){var o=parseInt(t.width);t.width=parseInt(s.width*(o/100))}if(t.height&&-1!=String(t.height).indexOf("%")){var r=parseInt(t.height);t.height=parseInt(s.height*(r/100))}var a=new mini.Window;return a.set(t),a.load(n,e,i),a.show(),mini.isIE&&setTimeout(function(){fixIEFocus()},100),a},mini.getTopWindow=function(){var e=[];return function i(t){try{t.mini&&e.push(t),t.parent&&t.parent!=t&&i(t.parent)}catch(ex){}}(window),e[e.length-1]},mini.open=function(t){if(t){var e,i=(e=(e=t.url)||"").split("#");if((e=i[0])&&-1==e.indexOf("_winid")){var n="_winid="+mini._WindowID;-1==e.indexOf("?")?e+="?"+n:e+="&"+n,i[1]&&(e=e+"#"+i[1])}t.url=e,t.Owner=window;var s=[];!function r(t){try{t.mini&&s.push(t),t.parent&&t.parent!=t&&r(t.parent)}catch(ex){}}(window);var o=s[s.length-1];return t.targetWindow&&(o=t.targetWindow),o.mini._doOpen(t)}},mini.openTop=mini.open,mini._getResult=function(t,e,i,n,s,o){var r=null,a=mini.getText(t,e,function(t,e){r=e,i&&i&&i(t,e)},n,s),l={text:a,result:null,sender:{type:""},options:{url:t,data:e,type:s},xhr:r},h=null;try{mini_doload(l),h=(h=l.result)||mini.decode(a)}catch(ex){1==mini_debugger&&alert(t+"\njson is error")}return!mini.isArray(h)&&o&&(h=mini._getMap(o,h)),mini.isArray(h)&&(h={data:h}),h?h.data:null},mini.getData=function(t,e,i,n,s){var o=mini.getText(t,e,i,n,s);return mini.decode(o)},mini.getText=function(t,e,n,i,s){var o=null;return mini.ajax({url:t,data:e,async:!1,type:s||"get",cache:!1,dataType:"text",success:function(t,e,i){o=t,n&&n(t,i)},error:i}),o},window.mini_RootPath||(mini_RootPath="/"),mini_CreateJSPath=function(t){for(var e=document.getElementsByTagName("script"),i="",n=0,s=e.length;n<s;n++){var o=e[n].src;if(-1!=o.indexOf(t)){i=(r=o.split(t))[0];break}}var r,a=location.href;return(r=(a=(a=a.split("#")[0]).split("?")[0]).split("/")).length=r.length-1,a=r.join("/"),-1==i.indexOf("http:")&&-1==i.indexOf("file:")&&(i=a+"/"+i),i},window.mini_JSPath||(mini_JSPath=mini_CreateJSPath("miniui.js")),mini.update=function(t,e){"string"==typeof t&&(t={url:t}),e&&(t.el=e);var i=mini.loadText(t.url);mini.innerHTML(t.el,i),mini.parse(t.el)},mini.createSingle=function(t){if("string"==typeof t&&(t=mini.getClass(t)),"function"==typeof t){var e=t.single;return e=e||(t.single=new t)}},mini.createTopSingle=function(t){if("function"==typeof t){var e=t.prototype.type;return top&&top!=window&&top.mini&&top.mini.getClass(e)?top.mini.createSingle(e):mini.createSingle(t)}},mini.sortTypes={string:function(t){return String(t).toUpperCase()},date:function(t){return t?mini.isDate(t)?t.getTime():mini.parseDate(String(t)):0},"float":function(t){var e=parseFloat(String(t).replace(/,/g,""));return isNaN(e)?0:e},"int":function(t){var e=parseInt(String(t).replace(/,/g,""),10);return isNaN(e)?0:e},currency:function(t){var e=parseFloat(String(t).replace(/,/g,""));return isNaN(e)?0:e}},mini._ValidateVType=function(t,e,i,n){for(var s=t.split(";"),o=0,r=s.length;o<r;o++){var a=(t=s[o].trim()).split(":"),l=a[0],h=t.substr(l.length+1,1e3);h=h?h.split(","):[];var d=mini.VTypes[l];if(d)if(!0!==d(e,h)){i.isValid=!1;var u=a[0]+"ErrorText";i.errorText=n[u]||mini.VTypes[u]||"",i.errorText=String.format(i.errorText,h[0],h[1],h[2],h[3],h[4]);break}}},mini._getErrorText=function(t,e){return t&&t[e]?t[e]:mini.VTypes[e]},mini.VTypes=jQuery.extend({},epoint_local.VTypes,{required:function(t,e){return!mini.isNull(t)&&""!==t},email:function(t,e){return!(!mini.isNull(t)&&""!==t)||-1!=t.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)},"int":function(t,e){if(mini.isNull(t)||""===t)return!0;return function i(t){t<0&&(t=-t);var e=String(t);return 0<e.length&&!/[^0-9]/.test(e)}(t)},"float":function(t,e){if(mini.isNull(t)||""===t)return!0;return function i(t){var e=String(t);return(-1==e.indexOf("-")||0==e.indexOf("-"))&&(!(2<(e=e.replace("-","")).split(".").length)&&(0<e.length&&!/[^0-9.]/.test(e)&&!("."==e.charAt(e.length-1))))}(t)},date:function(t,e){if(mini.isNull(t)||""===t)return!0;if(!t)return!1;var i=null,n=e[0];if(n){if((i=mini.parseDate(t,n))&&i.getFullYear&&mini.formatDate(i,n)==t)return!0}else if((i=(i=(i=mini.parseDate(t,"yyyy-MM-dd"))||mini.parseDate(t,"yyyy/MM/dd"))||mini.parseDate(t,"MM/dd/yyyy"))&&i.getFullYear)return!0;return!1},maxLength:function(t,e){if(mini.isNull(t)||""===t)return!0;var i=parseInt(e);return!(t&&!isNaN(i))||t.length<=i},minLength:function(t,e){if(mini.isNull(t)||""===t)return!0;var i=parseInt(e);return!!isNaN(i)||t.length>=i},rangeLength:function(t,e){if(mini.isNull(t)||""===t)return!0;if(!t)return!1;var i=parseFloat(e[0]),n=parseFloat(e[1]);return!(!isNaN(i)&&!isNaN(n))||i<=t.length&&t.length<=n},rangeChar:function(t,e){if(mini.isNull(t)||""===t)return!0;
//if (!v) return false;
var i=parseFloat(e[0]),n=parseFloat(e[1]);if(isNaN(i)||isNaN(n))return!0;for(var s,o=0,r=String(t).split(""),a=0,l=r.length;a<l;a++)s=r[a],new RegExp("^[一-龥]+$").test(s)?o+=2:o+=1;return i<=o&&o<=n},range:function(t,e){if(0==mini.VTypes["float"](t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;var i=parseFloat(e[0]),n=parseFloat(e[1]);return!(!isNaN(i)&&!isNaN(n))||i<=t&&t<=n},min:function(t,e){if(0==mini.VTypes["float"](t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;var i=parseFloat(e[0]);return!!isNaN(i)||i<=t},max:function(t,e){if(0==mini.VTypes["float"](t,e))return!1;if(mini.isNull(t)||""===t)return!0;if(t=parseFloat(t),isNaN(t))return!1;var i=parseFloat(e[0]);return!!isNaN(i)||t<=i}}),mini.summaryTypes={count:function(t){return(t=t||[]).length},max:function(t,e){for(var i=null,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],r=parseFloat(mini._getMap(e,o));null===r||r===undefined||isNaN(r)||(null==i||i<r)&&(i=r)}return i},min:function(t,e){for(var i=null,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],r=parseFloat(mini._getMap(e,o));null===r||r===undefined||isNaN(r)||(null==i||r<i)&&(i=r)}return i},avg:function(t,e){if(0==(t=t||[]).length)return 0;for(var i=0,n=0,s=t.length;n<s;n++){var o=t[n],r=parseFloat(mini._getMap(e,o));null===r||r===undefined||isNaN(r)||(i+=r)}return i/t.length},sum:function(t,e){for(var i=0,n=0,s=(t=t||[]).length;n<s;n++){var o=t[n],r=parseFloat(mini._getMap(e,o));null===r||r===undefined||isNaN(r)||(i+=r)}return i}},mini.formatCurrency=function(t,e){null===t||undefined,t=String(t).replace(/\$|\,/g,""),isNaN(t)&&(t="0"),sign=t==(t=Math.abs(t)),t=Math.floor(100*t+.50000000001),cents=t%100,t=Math.floor(t/100).toString(),cents<10&&(cents="0"+cents);for(var i=0;i<Math.floor((t.length-(1+i))/3);i++)t=t.substring(0,t.length-(4*i+3))+","+t.substring(t.length-(4*i+3));return(e=e||"")+(sign?"":"-")+t+"."+cents},mini.getByUid=mini.getbyUID,mini.emptyFn=function(){},mini.Drag=function(t){mini.copyTo(this,t)},mini.Drag.prototype={onStart:mini.emptyFn,onMove:mini.emptyFn,onStop:mini.emptyFn,capture:!1,fps:20,event:null,delay:80,start:function(t){t&&(this.event=t),this.now=this.init=[this.event.pageX,this.event.pageY];var e=document;mini.on(e,"mousemove",this.move,this),mini.on(e,"mouseup",this.stop,this),mini.on(e,"contextmenu",this.contextmenu,this),this.context&&mini.on(this.context,"contextmenu",this.contextmenu,this),this.trigger=t.target,mini.selectable(this.trigger,!1),mini.selectable(e.body,!1),this.capture&&(isIE?this.trigger.setCapture(!0):document.captureEvents&&document.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP|Event.MOUSEDOWN)),this.started=!1,this.startTime=new Date},contextmenu:function(t){this.context&&mini.un(this.context,"contextmenu",this.contextmenu,this),mini.un(document,"contextmenu",this.contextmenu,this),t.preventDefault(),t.stopPropagation()},move:function(t){if(t.preventDefault(),!(this.delay&&new Date-this.startTime<this.delay)){
//处理!!!        
var e=this;this.timer||(this.timer=setTimeout(function(){e.started||(e.started=!0,e.onStart(e)),e.now=[t.pageX,t.pageY],e.event=t,e.onMove(e),e.timer=null},5))}},stop:function(t){this.now=[t.pageX,t.pageY],this.event=t,this.timer&&(clearTimeout(this.timer),this.timer=null);var e=document;mini.selectable(this.trigger,!0),mini.selectable(e.body,!0),isIE&&(this.trigger.setCapture(!1),this.trigger.releaseCapture());var i=mini.MouseButton.Right!=t.button;0==i&&t.preventDefault(),mini.un(e,"mousemove",this.move,this),mini.un(e,"mouseup",this.stop,this);var n=this;setTimeout(function(){mini.un(document,"contextmenu",n.contextmenu,n),n.context&&mini.un(n.context,"contextmenu",n.contextmenu,n)},1),this.started&&this.onStop(this,i)}},mini.JSON=new function(){function l(t,e){var i=n[e];return i||(i=e.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))}var o,r,a,h=[],d=null,u=!!{}.hasOwnProperty,c=function(t,e){if(null!==t){var i=typeof t;if("undefined"!=i)if(t.push){h[h.length]="[";var n=t.length;for(r=0;r<n;r+=1)"undefined"==(i=typeof(a=t[r]))||"function"==i||"unknown"==i||(o&&(h[h.length]=","),c(a),o=!0);h[h.length]="]"}else if(t.getFullYear){var s;d?(h[h.length]='"',h[h.length]="function"==typeof d?d(t,e):mini.formatDate(t,d)):(h[h.length]='"',h[h.length]=t.getFullYear(),h[h.length]="-",s=t.getMonth()+1,h[h.length]=s<10?"0"+s:s,h[h.length]="-",s=t.getDate(),h[h.length]=s<10?"0"+s:s,h[h.length]="T",s=t.getHours(),h[h.length]=s<10?"0"+s:s,h[h.length]=":",s=t.getMinutes(),h[h.length]=s<10?"0"+s:s,h[h.length]=":",s=t.getSeconds(),h[h.length]=s<10?"0"+s:s),h[h.length]='"'}else{if("string"==i)return m.test(t)?(h[h.length]='"',h[h.length]=t.replace(f,l),void(h[h.length]='"')):void(h[h.length]='"'+t+'"');if("number"!=i)if("boolean"!=i){var o,r,a;for(r in h[h.length]="{",t)
//if (!useHasOwn || (o.hasOwnProperty && o.hasOwnProperty(i))) {
u&&!Object.prototype.hasOwnProperty.call(t,r)||"undefined"==(i=typeof(a=t[r]))||"function"==i||"unknown"==i||(o&&(h[h.length]=","),c(r),h[h.length]=":",c(a,r),o=!0);h[h.length]="}"}else h[h.length]=String(t);else h[h.length]=t}else h[h.length]="null"}else h[h.length]="null"},n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m=/["\\\x00-\x1f]/,f=/([\x00-\x1f\\"])/g;this.encode=function(t,e){return h=[],d=e,c(t),d=null,h.join("")},this.decode=(o=/^(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2}(?:\.*\d*)?)Z*$/,r=new RegExp("^/+Date\\((-?[0-9]+).*\\)/+$","g"),a=/[\"\'](\d{4})-(\d{1,2})-(\d{1,2})[T ](\d{1,2}):(\d{1,2}):(\d{1,2})(\.*\d*)[\"\']/g,function(t,n){if(""===t||null===t||t===undefined)return t;function e(t){return!1!==n&&(t=(t=(t=t.replace(__js_dateRegEx,"$1new Date($2)")).replace(a,"new Date($1,$2-1,$3,$4,$5,$6)")).replace(__js_dateRegEx2,"new Date($1)")),window.eval("("+t+")")}"object"==typeof t&&(t=this.encode(t));var i=null;if(window.JSON&&window.JSON.parse)try{var s=t.replace(__js_dateRegEx,'$1"/Date($2)/"');i=window.JSON.parse(s,function(t,e){if("string"==typeof e&&!1!==n){var i;if(o.lastIndex=0,i=o.exec(e))return e=new Date(i[1],i[2]-1,i[3],i[4],i[5],i[6]);if(r.lastIndex=0,i=r.exec(e))return e=new Date(parseInt(i[1]))}return e})}catch(ex){i=e(t)}else i=e(t);return i})},__js_dateRegEx=new RegExp('(^|[^\\\\])\\"\\\\/Date\\((-?[0-9]+)(?:[a-zA-Z]|(?:\\+|-)[0-9]{4})?\\)\\\\/\\"',"g"),__js_dateRegEx2=new RegExp("[\"']/Date\\(([0-9]+)\\)/[\"']","g"),mini.encode=mini.JSON.encode,mini.decode=mini.JSON.decode,mini.clone=function(t,e){if(null===t||t===undefined)return t;var i=mini.encode(t),n=mini.decode(i);return!1!==e&&function r(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];for(var s in delete n._state,delete n._id,delete n._pid,delete n._uid,n){var o=n[s];o instanceof Array&&r(o)}}}(n instanceof Array?n:[n]),n};var DAY_MS=864e5,HOUR_MS=36e5,MINUTE_MS=6e4;mini.copyTo(mini,{clearTime:function(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate()):null},maxTime:function(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59):null},cloneDate:function(t){return t?new Date(t.getTime()):null},addDate:function(t,e,i){switch(i=i||"D",t=new Date(t.getTime()),i.toUpperCase()){case"Y":t.setFullYear(t.getFullYear()+e);break;case"MO":t.setMonth(t.getMonth()+e);break;case"D":t.setDate(t.getDate()+e);break;case"H":t.setHours(t.getHours()+e);break;case"M":t.setMinutes(t.getMinutes()+e);break;case"S":t.setSeconds(t.getSeconds()+e);break;case"MS":t.setMilliseconds(t.getMilliseconds()+e)}return t},getWeek:function(t,e,i){var n=Math.floor((14-e)/12),s=t+4800-n,o=e+12*n-3,r=i+Math.floor((153*o+2)/5)+365*s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400)-32045,a=(31741+r-r%7)%146097%36524%1461,l=Math.floor(a/1460),h=(a-l)%365+l;return NumberOfWeek=Math.floor(h/7)+1,NumberOfWeek},getWeekStartDate:function(t,e){if(6<(e=e||0)||e<0)throw new Error("out of weekday");var i=t.getDay(),n=e-i;return i<e&&(n-=7),new Date(t.getFullYear(),t.getMonth(),t.getDate()+n)},getShortWeek:function(t){return this.dateInfo.daysShort[t]},getLongWeek:function(t){return this.dateInfo.daysLong[t]},getShortMonth:function(t){return this.dateInfo.monthsShort[t]},getLongMonth:function(t){return this.dateInfo.monthsLong[t]},dateInfo:jQuery.extend(!0,{},epoint_local.dateInfo)}),Date.prototype.getHalfYear=function(){return this.getMonth?this.getMonth()<6?0:1:null},Date.prototype.getQuarter=function(){if(!this.getMonth)return null;var t=this.getMonth();return t<3?0:t<6?1:t<9?2:3},mini.formatDate=function(t,e,i){if(!t||!t.getFullYear||isNaN(t))return"";var n=t.toString(),s=mini.dateInfo;if(void 0!==(s=s||mini.dateInfo)){var o="undefined"!=typeof s.patterns[e]?s.patterns[e]:e,r=t.getFullYear(),a=t.getMonth(),l=t.getDate();if("yyyy-MM-dd"==e)return r+"-"+(a=a+1<10?"0"+(a+1):a+1)+"-"+(l=l<10?"0"+l:l);if("MM/dd/yyyy"==e)return(a=a+1<10?"0"+(a+1):a+1)+"/"+(l=l<10?"0"+l:l)+"/"+r;n=(n=o.replace(/yyyy/g,r)).replace(/yy/g,(r+"").substring(2));var h=t.getHalfYear();n=n.replace(/hy/g,s.halfYearLong[h]);var d=t.getQuarter();n=(n=(n=(n=(n=(n=n.replace(/Q/g,s.quarterLong[d])).replace(/q/g,s.quarterShort[d])).replace(/MMMM/g,s.monthsLong[a].escapeDateTimeTokens())).replace(/MMM/g,s.monthsShort[a].escapeDateTimeTokens())).replace(/MM/g,a+1<10?"0"+(a+1):a+1)).replace(/(\\)?M/g,function(t,e){return e?t:a+1});var u=t.getDay();n=(n=(n=(n=n.replace(/dddd/g,s.daysLong[u].escapeDateTimeTokens())).replace(/ddd/g,s.daysShort[u].escapeDateTimeTokens())).replace(/dd/g,l<10?"0"+l:l)).replace(/(\\)?d/g,function(t,e){return e?t:l});var c=t.getHours(),m=12<c?c-12:c;12==s.clockType&&12<c&&(c-=12),n=(n=(n=(n=n.replace(/HH/g,c<10?"0"+c:c)).replace(/(\\)?H/g,function(t,e){return e?t:c})).replace(/hh/g,m<10?"0"+m:m)).replace(/(\\)?h/g,function(t,e){return e?t:m});var f=t.getMinutes();n=(n=n.replace(/mm/g,f<10?"0"+f:f)).replace(/(\\)?m/g,function(t,e){return e?t:f});var p=t.getSeconds();n=(n=(n=(n=n.replace(/ss/g,p<10?"0"+p:p)).replace(/(\\)?s/g,function(t,e){return e?t:p})).replace(/fff/g,t.getMilliseconds())).replace(/tt/g,12<t.getHours()||0==t.getHours()?s.tt.PM:s.tt.AM);var g="";g=(t=t.getDate())<=10?s.ten.Early:t<=20?s.ten.Mid:s.ten.Late,n=n.replace(/ten/g,g)}return n.replace(/\\/g,"")},String.prototype.escapeDateTimeTokens=function(){return this.replace(/([dMyHmsft])/g,"\\$1")},mini.fixDate=function(t,e){if(+t)for(;t.getDate()!=e.getDate();)t.setTime(+t+(t<e?1:-1)*HOUR_MS)},mini.parseDate=function(t,e){try{if((n=window.eval(t))&&n.getFullYear)return n}catch(ex){}if("object"==typeof t)return isNaN(t)?null:t;if("number"==typeof t)return(n=new Date(1e3*t)).getTime()!=t?null:isNaN(n)?null:n;if("string"!=typeof t)return null;if(m=t.match(/^([0-9]{4})([0-9]{2})([0-9]{0,2})$/),m){var i=new Date(parseInt(m[1],10),parseInt(m[2],10)-1);return m[3]&&i.setDate(m[3]),i}if(m=t.match(/^([0-9]{4}).([0-9]*)$/),m)return i=new Date(m[1],m[2]-1);if(t.match(/^\d+(\.\d+)?$/))return(n=new Date(1e3*parseFloat(t))).getTime()!=t?null:n;e===undefined&&(e=!0);var n=mini.parseISO8601(t,e)||(t?new Date(t):null);return isNaN(n)?null:n},mini.parseISO8601=function(t,e){var i=t.match(/^([0-9]{4})([-\/]([0-9]{1,2})([-\/]([0-9]{1,2})([T ]([0-9]{1,2}):([0-9]{1,2})(:([0-9]{1,2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!i)return(i=t.match(/^([0-9]{4})[-\/]([0-9]{2})[-\/]([0-9]{2})[T ]([0-9]{1,2})/))?n=new Date(i[1],i[2]-1,i[3],i[4]):(i=t.match(/^([0-9]{4}).([0-9]*)$/))?n=new Date(i[1],i[2]-1):(i=t.match(/^([0-9]{4}).([0-9]*).([0-9]*)/))?n=new Date(i[1],i[2]-1,i[3]):(i=t.match(/^([0-9]{2})-([0-9]{2})-([0-9]{4})$/))?n=new Date(i[3],i[1]-1,i[2]):null;var n=new Date(i[1],0,1);if(e||!i[14]){var s=new Date(i[1],0,1,9,0);i[3]&&(n.setMonth(i[3]-1),s.setMonth(i[3]-1)),i[5]&&(n.setDate(i[5]),s.setDate(i[5])),mini.fixDate(n,s),i[7]&&n.setHours(i[7]),i[8]&&n.setMinutes(i[8]),i[10]&&n.setSeconds(i[10]),i[12]&&n.setMilliseconds(1e3*Number("0."+i[12])),mini.fixDate(n,s)}else{n.setUTCFullYear(i[1],i[3]?i[3]-1:0,i[5]||1),n.setUTCHours(i[7]||0,i[8]||0,i[10]||0,i[12]?1e3*Number("0."+i[12]):0);var o=60*Number(i[16])+(i[18]?Number(i[18]):0);o*="-"==i[15]?1:-1,n=new Date(+n+60*o*1e3)}return n},mini.parseTime=function(t,e){if(!t)return null;var i=parseInt(t);if(i==t&&e){s=new Date(0);var n=e.charAt(0);return"H"==n?s.setHours(i):"m"==n?s.setMinutes(i):"s"==n&&s.setSeconds(i),isNaN(s)&&(s=null),s}var s=mini.parseDate(t);if(!s){var o=t.split(":"),r=parseInt(parseFloat(o[0])),a=parseInt(parseFloat(o[1])),l=parseInt(parseFloat(o[2]));isNaN(r)||isNaN(a)||isNaN(l)||((s=new Date(0)).setHours(r),s.setMinutes(a),s.setSeconds(l)),isNaN(r)||"H"!=e&&"HH"!=e?isNaN(r)||isNaN(a)||"H:mm"!=e&&"HH:mm"!=e?isNaN(r)||isNaN(a)||"mm:ss"!=e||((s=new Date(0)).setMinutes(r),s.setSeconds(a)):((s=new Date(0)).setHours(r),s.setMinutes(a)):(s=new Date(0)).setHours(r)}return s},function(window){var mini=window.mini;mini=mini||(window.mini={});var cultures=mini.cultures={};function findCulture(t){return mini.cultures[t]}function getCulture(t){return t&&t.name?t:findCulture(t)||mini.cultures.current}mini.getCulture=getCulture,mini.culture=function(t){if(t===undefined)return cultures.current;mini.cultures.current=findCulture(t)},mini.cultures[epoint_local.culture.name]=jQuery.extend(!0,{},epoint_local.culture),mini.culture(epoint_local.culture.name);var STRING="string",NUMBER="number",isArray=function(t){return t&&!!t.unshift},numberRegExp={2:/^\d{1,2}/,4:/^\d{4}/};function pad(t,e,i){var n=(e=typeof e==NUMBER?e:2)-(t+="").length;if(0<n){var s=repeat(n,"0");return i?t+s:s+t}return t}function repeat(t,e){for(var i="";t;)t-=1,i+=e;return i}var numberFormatRegExp=/^(n|c|p)(\d*)$/i,eRegExp=/^(e)(\d*)$/i,clearRegExp=/[^0#]/g,exponentRegExp=/[eE][\-+]?[0-9]+/;function doFormatNumber(number,format,options){number=Math.abs(number);var isGroup=-1!=format.indexOf(","),formats=format.split("."),format0=(formats[0]||"").replace(clearRegExp,""),format1=(formats[1]||"").replace(clearRegExp,""),value="",groupSize=options.groupSize[0],decimalsSeparator=options.decimalsSeparator,groupSeparator=options.groupSeparator,index=format0.indexOf("0");format0=-1==index?"0":format0.substr(index)||"0";var decimals=format1.length,decimalPlaces=format1.substr(0,format1.lastIndexOf("0")+1).length;function round2(number,fractionDigits){with(Math)return round(number*pow(10,fractionDigits))/pow(10,fractionDigits)}number=round2(number,decimals);var values=String(number).split(".");if(value0=values[0],value1=values[1]||"",value0){if(value0=pad(value0,format0.length),isGroup)for(var i=0;i<Math.floor((value0.length-(1+i))/3);i++)value0=value0.substring(0,value0.length-(4*i+3))+groupSeparator+value0.substring(value0.length-(4*i+3));value+=value0}return 0<decimals&&(value+=decimalsSeparator,
//            if (!isNaN(n) && n > 4) {
value+=pad(value1.substr(0,decimals),decimalPlaces,!0)),value}function transformFormat(t,e,i,n){var s=i.numberFormat.number,o=numberFormatRegExp.exec(t);if(null!=o){var r=o[1],a=o[2];"p"==r?s=i.numberFormat.percent:"c"==r&&(s=i.numberFormat.currency);var l=a?parseInt(a):s.decimals,h=s.pattern[e<0?1:0];h=h.replace("n","#,#"+(0<l?"."+repeat(l,"0"):"")),t=t.replace(r+a,h).replace("$",i.numberFormat.currency.symbol).replace("%",i.numberFormat.percent.symbol)}else isNumberFormat(t)&&e<0&&!n[1]&&(t="-"+t);return t}function isNumberFormat(t){return-1!=t.indexOf("0")||-1!=t.indexOf("#")}function getNumberFormat(t){if(!t)return null;var e=function o(t){var e=t.indexOf("0"),i=t.indexOf("#");(-1==e||-1!=i&&i<e)&&(e=i);var n=t.lastIndexOf("0"),s=t.lastIndexOf("#");return(-1==n||-1!=s&&n<s)&&(n=s),[e,n]}(t),i=e[0],n=e[1];return-1<i?{begin:i,end:n,format:t.substring(i,n+1)}:null}function formatNumber(t,e,i){if(typeof t!=NUMBER)return"";if(!e)return String(t);var n=e.split(";");e=n[0],t<0&&2<=n.length&&(e=n[1]),0==t&&3<=n.length&&(e=n[2]);var s=(i=getCulture(i)).numberFormat.number,o=i.numberFormat.percent,r=i.numberFormat.currency,a=-1!=(e=transformFormat(e,t,i,n)).indexOf(r.symbol),l=-1!=e.indexOf(o.symbol),h=(e.indexOf("."),isNumberFormat(e)),d=a?r:l?r:s,u=(t=l?100*t:t,eRegExp.exec(e));if(u){var c=parseInt(u[2]);return isNaN(c)?t.toExponential():t.toExponential(c)}if(!h)return e;var m="",f=getNumberFormat(e);return m=null!=f?(m=doFormatNumber(t,f.format,d),e.substr(0,f.begin)+m+e.substr(f.end+1)):e}mini.parseInt=function(t,e,i){var n=mini.parseFloat(t,e,i);return n&&(n|=0),n},mini.parseFloat=function(t,e,i){if(!t&&0!==t)return null;if(typeof t===NUMBER)return t;if(i&&i.split(";")[2]==t)return 0;if(exponentRegExp.test(t))return t=parseFloat(t),isNaN(t)&&(t=null),t;t=t.toString();var n=(e=mini.getCulture(e)).numberFormat,s=n.number,o=n.percent,r=n.currency,a=-1!=t.indexOf(o.symbol),l=(s=-1!=t.indexOf(r.symbol)?r:a?o:s).pattern[1],h=s.decimals,d=s.decimalsSeparator,u=s.groupSeparator,c=-1<t.indexOf("-");function m(t,e,i){var n=getNumberFormat(e);if(n){var s=e.substr(0,n.begin),o=e.substr(n.end+1);0==t.indexOf(s)&&-1<t.indexOf(o)&&(t=t.replace(s,"").replace(o,""),c=i)}return t}if(i){var f=i.split(";");if(f[1])t=m(t,i=f[1],!0);else{var p=t;p==(t=m(p,i=f[0],!1))&&(t=m(p,"-"+i,!0))}}else 0==c&&(t=m(t,i=l.replace("n","#,#"+(0<h?"."+repeat(h,"0"):"")).replace("$",r.symbol).replace("%",o.symbol),!0));var g=(t=t.split(u).join("").replace(d,".")).match(/([0-9,.]+)/g);return null==g?null:(t=g[0],t=parseFloat(t),isNaN(t)?t=null:c&&(t*=-1),t&&a&&(t/=100),t)},mini.formatNumber=formatNumber}(this);var inBrowser="undefined"!=typeof window,UA=inBrowser&&window.navigator.userAgent.toLowerCase(),isIE=UA&&/msie|trident/.test(UA),isIE9=UA&&0<UA.indexOf("msie 9.0"),isEdge=UA&&0<UA.indexOf("edge/"),isAndroid=UA&&0<UA.indexOf("android"),isIOS=UA&&/iphone|ipad|ipod|ios/.test(UA),isMobile=isAndroid||isIOS;mini.isAndroid=isAndroid,mini.isIOS=isIOS,mini.isMobile=isMobile,mini.Keyboard={Left:37,Top:38,Right:39,Bottom:40,PageUp:33,PageDown:34,End:35,Home:36,Enter:13,ESC:27,Space:32,Tab:9,Del:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};var ua=navigator.userAgent.toLowerCase(),check=function(t){return t.test(ua)},DOC=document,isStrict="CSS1Compat"==document.compatMode,version=function(t,e){var i;return t&&(i=e.exec(ua))?parseFloat(i[1]):0},docMode=document.documentMode,isOpera=check(/opera/),isOpera10_5=isOpera&&check(/version\/10\.5/),isChrome=check(/\bchrome\b/),isWebKit=check(/webkit/),isSafari=!isChrome&&check(/safari/),isSafari2=isSafari&&check(/applewebkit\/4/),isSafari3=isSafari&&check(/version\/3/),isSafari4=isSafari&&check(/version\/4/),isSafari5_0=isSafari&&check(/version\/5\.0/),isSafari5=isSafari&&check(/version\/5/),isIE=!isOpera&&check(/msie/),isIE7=isIE&&(check(/msie 7/)&&8!=docMode&&9!=docMode&&10!=docMode||7==docMode),isIE8=isIE&&(check(/msie 8/)&&7!=docMode&&9!=docMode&&10!=docMode||8==docMode),isIE9=isIE&&(check(/msie 9/)&&7!=docMode&&8!=docMode&&10!=docMode||9==docMode),isIE10=isIE&&(check(/msie 10/)&&7!=docMode&&8!=docMode&&9!=docMode||10==docMode),isIE6=isIE&&!isIE7&&!isIE8&&!isIE9&&!isIE10,isIE11=-1<ua.indexOf("trident")&&-1<ua.indexOf("rv"),isIE=isIE||isIE11,isFirefox=0<navigator.userAgent.indexOf("Firefox"),isGecko=!isWebKit&&check(/gecko/),isGecko3=isGecko&&check(/rv:1\.9/),isGecko4=isGecko&&check(/rv:2\.0/),isGecko5=isGecko&&check(/rv:5\./),isGecko10=isGecko&&check(/rv:10\./),isFF3_0=isGecko3&&check(/rv:1\.9\.0/),isFF3_5=isGecko3&&check(/rv:1\.9\.1/),isFF3_6=isGecko3&&check(/rv:1\.9\.2/),isWindows=check(/windows|win32/),isMac=check(/macintosh|mac os x/),isAir=check(/adobeair/),isLinux=check(/linux/),scrollbarSize=null,chromeVersion=version(!0,/\bchrome\/(\d+\.\d+)/),firefoxVersion=version(!0,/\bfirefox\/(\d+\.\d+)/),ieVersion=version(isIE,/msie (\d+\.\d+)/),IE_V=isIE?parseInt(ieVersion):-1,operaVersion=version(isOpera,/version\/(\d+\.\d+)/),safariVersion=version(isSafari,/version\/(\d+\.\d+)/),webKitVersion=version(isWebKit,/webkit\/(\d+\.\d+)/),isSecure=/^https/i.test(window.location.protocol),isBorderBox=isIE&&!isStrict;if(isIE6)try{DOC.execCommand("BackgroundImageCache",!1,!0)}catch(e){}mini.boxModel=!isBorderBox,mini.isIE=isIE,mini.isIE6=isIE6,mini.isIE7=isIE7,mini.isIE8=isIE8,mini.isIE9=isIE9,mini.isIE10=isIE10,mini.isIE11=isIE11,mini.IE_V=isIE11?11:IE_V,mini.isFirefox=isFirefox,mini.isOpera=isOpera,mini.isSafari=isSafari,mini.isChrome=isChrome,isIE&&jQuery(document.documentElement).addClass("ie ie"+mini.IE_V),jQuery&&(jQuery.boxModel=mini.boxModel),mini.noBorderBox=!1,0==jQuery.boxModel&&isIE&&0==isIE9&&(mini.noBorderBox=!0),mini.MouseButton={Left:0,Middle:1,Right:2},!isIE||isIE9||isIE10||(mini.MouseButton={Left:1,Middle:4,Right:2}),mini.append=function(t,e){if(t=mini.byId(t),e&&t){if("string"!=typeof e)return t.appendChild(e),e;if("#"==e.charAt(0)){if(!(e=mini.byId(e)))return;return t.appendChild(e),e}if(0==e.indexOf("<tr"))return jQuery(t).append(e)[0].lastChild;var i=document.createElement("div");for(i.innerHTML=e,e=i.firstChild;i.firstChild;)t.appendChild(i.firstChild);return e}},mini.prepend=function(t,e){if("string"==typeof e)if("#"==e.charAt(0))e=mini.byId(e);else{var i=document.createElement("div");i.innerHTML=e,e=i.firstChild}return jQuery(t).prepend(e)[0].firstChild},mini.after=function(t,e){if("string"==typeof e)if("#"==e.charAt(0))e=mini.byId(e);else{var i=document.createElement("div");i.innerHTML=e,e=i.firstChild}if(e&&t)return t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e),e},mini.before=function(t,e){if("string"==typeof e)if("#"==e.charAt(0))e=mini.byId(e);else{var i=document.createElement("div");i.innerHTML=e,e=i.firstChild}if(e&&t)return t.parentNode.insertBefore(e,t),e},mini.__wrap=document.createElement("div"),mini.createElements=function(t){mini.removeChilds(mini.__wrap);var e=0==t.indexOf("<tr");return e&&(t="<table>"+t+"</table>"),mini.__wrap.innerHTML=t,e?mini.__wrap.firstChild.rows:mini.__wrap.childNodes},mini_byId=function(t,e){if("string"!=typeof t)return t;if("#"==t.charAt(0)&&(t=t.substr(1)),o=document.getElementById(t))return o;if(e&&!mini.isAncestor(document.body,e)){for(var i=e.getElementsByTagName("*"),n=0,s=i.length;n<s;n++){var o;if((o=i[n]).id==t)return o}o=null}return o},mini_hasClass=function(t,e){if(t=mini.byId(t))return!!t.className&&-1!=String(t.className).split(" ").indexOf(e)},mini_addClass=function(t,e){e&&0==mini.hasClass(t,e)&&jQuery(t).addClass(e)},mini_removeClass=function(t,e){e&&jQuery(t).removeClass(e)};var _ceil=function(t){return Math.ceil(parseFloat(t))},Bx;mini_getMargins=function(t){t=mini.byId(t);var e=jQuery(t);return{top:_ceil(e.css("margin-top"),10)||0,left:_ceil(e.css("margin-left"),10)||0,bottom:_ceil(e.css("margin-bottom"),10)||0,right:_ceil(e.css("margin-right"),10)||0}},mini_getBorders=function(t){t=mini.byId(t);var e=jQuery(t);return{top:_ceil(e.css("border-top-width"),10)||0,left:_ceil(e.css("border-left-width"),10)||0,bottom:_ceil(e.css("border-bottom-width"),10)||0,right:_ceil(e.css("border-right-width"),10)||0}},mini_getPaddings=function(t){t=mini.byId(t);var e=jQuery(t);return{top:_ceil(e.css("padding-top"),10)||0,left:_ceil(e.css("padding-left"),10)||0,bottom:_ceil(e.css("padding-bottom"),10)||0,right:_ceil(e.css("padding-right"),10)||0}},mini_setWidth=function(t,e){if(t=mini.byId(t),e=parseInt(e),!isNaN(e)&&t){if(jQuery.boxModel){var i=mini.getPaddings(t),n=mini.getBorders(t);e=e-i.left-i.right-n.left-n.right}e<0&&(e=0),t.style.width=e+"px"}},mini_setHeight=function(t,e){if(t=mini.byId(t),e=parseInt(e),!isNaN(e)&&t){if(jQuery.boxModel){var i=mini.getPaddings(t),n=mini.getBorders(t);e=e-i.top-i.bottom-n.top-n.bottom}e<0&&(e=0),t.style.height=e+"px"}},mini_getWidth=function(t,e){return"none"==(t=mini.byId(t)).style.display||"text/javascript"==t.type?0:e?jQuery(t).width():jQuery(t).outerWidth()},mini_getHeight=function(t,e){return"none"==(t=mini.byId(t)).style.display||"text/javascript"==t.type?0:e?jQuery(t).height():jQuery(t).outerHeight()},mini_setBox=function(t,e,i,n,s){i===undefined&&(i=e.y,n=e.width,s=e.height,e=e.x),mini.setXY(t,e,i),mini.setWidth(t,n),mini.setHeight(t,s)},mini_getBox=function(t){var e=mini.getXY(t),i={x:e[0],y:e[1],width:mini.getWidth(t),height:mini.getHeight(t)};return i.left=i.x,i.top=i.y,i.right=i.x+i.width,i.bottom=i.y+i.height,i},mini_setStyle=function(t,e){if((t=mini.byId(t))&&"string"==typeof e)for(var i=jQuery(t),n=e.toLowerCase().split(";"),s=0,o=n.length;s<o;s++){var r=n[s].split(":");if(1<r.length)if(2<r.length){var a=r[0].trim();r.removeAt(0);var l=r.join(":").trim();i.css(a,l)}else i.css(r[0].trim(),r[1].trim())}},mini_getStyle=function(){var t=document.defaultView,e=arguments[0],i=arguments[1];return e&&i?("float"===i&&(i=t?"cssFloat":"styleFloat"),jQuery.css(e,i)):null},mini_isAncestor=function(t,i){var n=!1;if((t=mini.byId(t))===(i=mini.byId(i)))return!0;if(t&&i)if(t.contains)try{return t.contains(i)}catch(e){return!1}else{if(t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(i));for(;i=i.parentNode;)n=i==t||n}return n},mini_findParent=function(t,e,i){t=mini.byId(t);var n,s=document.body,o=0;for("number"!=typeof(i=i||50)&&(n=mini.byId(i),i=10);t&&1==t.nodeType&&o<i&&t!=s&&t!=n;){if(mini.hasClass(t,e))return t;o++,t=t.parentNode}return null},mini.copyTo(mini,{byId:mini_byId,hasClass:mini_hasClass,addClass:mini_addClass,removeClass:mini_removeClass,getMargins:mini_getMargins,getBorders:mini_getBorders,getPaddings:mini_getPaddings,setWidth:mini_setWidth,setHeight:mini_setHeight,getWidth:mini_getWidth,getHeight:mini_getHeight,setBox:mini_setBox,getBox:mini_getBox,setStyle:mini_setStyle,getStyle:mini_getStyle,repaint:function(t){t=t||document.body,mini.addClass(t,"mini-repaint"),setTimeout(function(){mini.removeClass(t,"mini-repaint")},1)},getSize:function(t,e){return{width:mini.getWidth(t,e),height:mini.getHeight(t,e)}},setSize:function(t,e,i){mini.setWidth(t,e),mini.setHeight(t,i)},setX:function(t,e){e=parseInt(e);var i=jQuery(t).offset(),n=parseInt(i.top);n===undefined&&(n=i[1]),mini.setXY(t,e,n)},setY:function(t,e){e=parseInt(e);var i=jQuery(t).offset(),n=parseInt(i.left);n===undefined&&(n=i[0]),mini.setXY(t,n,e)},setXY:function(t,e,i){var n={left:parseInt(e),top:parseInt(i)};jQuery(t).offset(n),jQuery.fn.jquery&&-1!=jQuery.fn.jquery.indexOf("1.4")&&jQuery(t).offset(n)},getXY:function(t){var e=jQuery(t).offset();
//if (!xy) xy = { left: 0, top: 0 };
return[parseInt(e.left),parseInt(e.top)]},getViewportBox:function(){var t=jQuery(window).width(),e=jQuery(window).height(),i=jQuery(document).scrollLeft(),n=jQuery(document.body).scrollTop();return 0==n&&document.documentElement&&(n=document.documentElement.scrollTop),{x:i,y:n,top:n,left:i,width:t,height:e,right:i+t,bottom:n+e}},showAt:function(t){jQuery;t=jQuery.extend({el:null,x:"center",y:"center",offset:[0,0],fixed:!1,zindex:mini.getMaxZIndex(),timeout:0,timeoutHandler:null,constrain:!1,animation:!1},t);var e=jQuery(t.el)[0],i=t.x,n=t.y,s=t.offset[0],o=t.offset[1],r=t.zindex,a=t.fixed;t.animation;if(e){t.timeout&&setTimeout(function(){t.timeoutHandler&&t.timeoutHandler()},t.timeout);var l=";position:absolute;display:block;left:auto;top:auto;right:auto;bottom:auto;margin:0;z-index:"+r+";";mini.setStyle(e,l);l="";if(t&&mini.isNumber(i)&&mini.isNumber(n)){if(t.fixed&&!mini.isIE6&&(l+=";position:fixed;"),mini.setStyle(e,l),t.constrain){var h=jQuery(window).width(),d=jQuery(window).height();i+(u=mini.getSize(e)).width>h&&(i=h-u.width),i<0&&(i=0),n+u.height>d&&(n=d-u.height),n<0&&(n=0)}mini.setXY(e,i,n)}else{if("left"==i)l+="left:"+s+"px;";else if("right"==i)l+="right:"+s+"px;";else{l+="left:50%;margin-left:"+.5*-(u=mini.getSize(e)).width+"px;"}if("top"==n)l+="top:"+o+"px;";else if("bottom"==n)l+="bottom:"+o+"px;";else{var u;l+="top:50%;margin-top:"+.5*-(u=mini.getSize(e)).height+"px;"}a&&!mini.isIE6&&(l+="position:fixed"),mini.setStyle(e,l)}}},getChildNodes:function(t,e){if(t=mini.byId(t)){for(var i=t.childNodes,n=[],s=0,o=i.length;s<o;s++){var r=i[s];1!=r.nodeType&&!0!==e||n.push(r)}return n}},removeNode:isIE?function(t){t&&"BODY"!=t.tagName&&((Bx=Bx||document.createElement("div")).appendChild(t),Bx.innerHTML="")}:function(t){t&&t.parentNode&&"BODY"!=t.tagName&&t.parentNode.removeChild(t)},removeChilds:function(t,e){if(t=mini.byId(t))for(var i=mini.getChildNodes(t,!0),n=0,s=i.length;n<s;n++){var o=i[n];e&&o==e||t.removeChild(i[n])}},isAncestor:mini_isAncestor,findParent:mini_findParent,findChild:function(t,e){for(var i=(t=mini.byId(t)).getElementsByTagName("*"),n=0,s=i.length;n<s;n++){t=i[n];if(mini.hasClass(t,e))return t}},isAncestor:function(t,i){var n=!1;if((t=mini.byId(t))===(i=mini.byId(i)))return!0;if(t&&i)if(t.contains)try{return t.contains(i)}catch(e){return!1}else{if(t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(i));for(;i=i.parentNode;)n=i==t||n}return n},getOffsetsTo:function(t,e){var i=this.getXY(t),n=this.getXY(e);return[i[0]-n[0],i[1]-n[1]]},scrollIntoView:function(t,e,i,n){var s=mini.byId(e)||document.body,o=this.getOffsetsTo(t,s),r=o[0]+s.scrollLeft,a=o[1]+s.scrollTop,l=a+t.offsetHeight,h=r+t.offsetWidth,d=s.clientHeight,u=parseInt(s.scrollTop,10),c=parseInt(s.scrollLeft,10),m=u+d,f=c+s.clientWidth;return!1!==n&&(t.offsetHeight>d||a<u?s.scrollTop=a:m<l&&(s.scrollTop=l-d),s.scrollTop=s.scrollTop),!1!==i&&(t.offsetWidth>s.clientWidth||r<c?s.scrollLeft=r:f<h&&(s.scrollLeft=h-s.clientWidth),s.scrollLeft=s.scrollLeft),this},getScrollOffset:function(){if(!mini._scrollOffset){var t=document.createElement("div");t.style.cssText="width:100px;background:#eee;height:50px;overflow:scroll;padding:1px;position:absolute;left:-1000px;top:0;box-sizing:content-box;-moz-box-sizing: content-box;",document.body.appendChild(t),mini._scrollOffset=t.offsetWidth-t.clientWidth,t.parentNode.removeChild(t)}return mini._scrollOffset},setOpacity:function(t,e){jQuery(t).css({opacity:e})},selectable:function(t,e){t=mini.byId(t),e?(jQuery(t).removeClass("mini-unselectable"),isIE?t.unselectable="off":(t.style.MozUserSelect="",t.style.KhtmlUserSelect="",t.style.UserSelect="")):(jQuery(t).addClass("mini-unselectable"),isIE?t.unselectable="on":(t.style.MozUserSelect="none",t.style.UserSelect="none",t.style.KhtmlUserSelect="none"))},selectRange:function(t,i,n){if(t.createTextRange){var s=t.createTextRange();s.moveStart("character",i),s.moveEnd("character",n-t.value.length),s.select()}else t.setSelectionRange&&t.setSelectionRange(i,n);try{t.focus()}catch(e){}},getSelectRange:function(t){if(t=mini.byId(t)){try{t.focus()}catch(e){}var i,n=0,s=0;if(t.createTextRange&&document.selection)(i=document.selection.createRange().duplicate()).moveEnd("character",t.value.length),n=""===i.text?t.value.length:t.value.lastIndexOf(i.text),(i=document.selection.createRange().duplicate()).moveStart("character",-t.value.length),s=i.text.length;else n=t.selectionStart,s=t.selectionEnd;return[n,s]}}}),function(){var r={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},t=document.createElement("div");t.setAttribute("class","t");var a="t"===t.className;mini.setAttr=function(t,e,i){t.setAttribute(a?e:r[e]||e,i)},mini.getAttr=function(t,e){if("height"==e)return jQuery(t).attr("height");if("value"==e&&(isIE6||isIE7)){var i=t.attributes[e];return i?i.value:null}if(!t.getAttribute)return null;var n=t.getAttribute(a?e:r[e]||e);if("function"==typeof n||"maxLength"==e){var s=t.attributes[e];s&&(n=s.value)}if(!n&&"onload"==e){var o=t.getAttributeNode?t.getAttributeNode(e):null;o&&(n=o.nodeValue)}return n}}(),mini_preventDefault=function(){window.event&&(window.event.returnValue=!1)},mini_stopPropogation=function(){window.event&&(window.event.cancelBubble=!0)},mini_onOne=function(t,e,i,n){t&&(t["on"+e.toLowerCase()]=function(t){if((t=t||window.event).target||(t.target=t.srcElement),t.preventDefault||(t.preventDefault=mini_preventDefault),t.stopPropogation||(t.stopPropogation=mini_stopPropogation),!1===i.call(n,t))return!1})},mini_on=function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;if(mini.findListener(t,e,i,n))return!1;var s=mini.createDelegate(i,n);mini.listeners.push([t,e,i,n,s]),mini.isFirefox&&"mousewheel"==e&&(e="DOMMouseScroll"),jQuery(t).bind(e,s)},mini_un=function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;var s=mini.findListener(t,e,i,n);if(!s)return!1;mini._destroying||mini.listeners.remove(s),mini.isFirefox&&"mousewheel"==e&&(e="DOMMouseScroll"),jQuery(t).unbind(e,s[4])},mini.copyTo(mini,{listeners:[],on:mini_on,un:mini_un,_getListeners:function(){return mini.listeners},findListener:function(t,e,i,n){if(t=mini.byId(t),n=n||t,!(t&&e&&i&&n))return!1;for(var s=mini._getListeners(),o=s.length-1;0<=o;o--){var r=s[o];try{if(r[0]==t&&r[1]==e&&r[2]==i&&r[3]==n)return r}catch(ex){}}},clearEvent:function(t,e){if(!(t=mini.byId(t)))return!1;if(mini._destroying)jQuery(t).unbind();else{for(var i=mini._getListeners(),n=i.length-1;0<=n;n--){var s=i[n];s[0]==t&&(e&&e!=s[1]||mini.un(t,s[1],s[2],s[3]))}t.onmouseover=t.onmousedown=null}}}),mini.__windowResizes=[],mini.onWindowResize=function(t,e){mini.__windowResizes.push([t,e])},mini.on(window,"resize",function(t){for(var e=mini.__windowResizes,i=0,n=e.length;i<n;i++){var s=e[i];s[0].call(s[1],t)}}),mini.htmlEncode=function(t){if("string"!=typeof t)return t;return 0==t.length?"":t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")},mini.htmlDecode=function(t){if("string"!=typeof t)return t;return 0==t.length?"":t.replace(/&gt;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"')};var array_extend={add:function(t){return this[this.length]=t,this},getRange:function(t,e){for(var i=[],n=t;n<=e;n++){var s=this[n];s&&(i[i.length]=s)}return i},addRange:function(t){for(var e=0,i=t.length;e<i;e++)this[this.length]=t[e];return this},clear:function(){return this.length=0,this},clone:function(){return 1===this.length?[this[0]]:Array.apply(null,this)},contains:function(t){return 0<=this.indexOf(t)},dequeue:function(){return this.shift()},insert:function(t,e){return this.splice(t,0,e),this},insertRange:function(t,e){for(var i=e.length-1;0<=i;i--){var n=e[i];this.splice(t,0,n)}return this},remove:function(t){var e=this.indexOf(t);return 0<=e&&this.splice(e,1),0<=e},removeAt:function(t){var e=this[t];return this.splice(t,1),e},removeRange:function(t){for(var e=0,i=(t=t.clone()).length;e<i;e++)this.remove(t[e])}},TA;if(Object.defineProperty&&/\[native code\]/.test(Object.defineProperty.toString())){for(var key in array_extend)Object.prototype.hasOwnProperty.call(array_extend,key)&&Object.defineProperty(Array.prototype,key,{value:array_extend[key],configurable:!0,enumerable:!1,writable:!0});key=null}else mini.copyTo(Array.prototype,array_extend);function __BindIFrames(){}function js_isTouchDevice(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}function js_touchScroll(t){if(js_isTouchDevice()){var e="string"==typeof t?document.getElementById(t):t,i=0;e.addEventListener("touchstart",function(t){i=this.scrollTop+t.touches[0].pageY,t.preventDefault()},!1),e.addEventListener("touchmove",function(t){this.scrollTop=i-t.touches[0].pageY,t.preventDefault()},!1)}}array_extend=null,mini.isShowBackdrop=!(mini.isIE&&mini.IE_V<=8),mini._MaskID=1,mini._MaskObjects={},mini.mask=function(t){var e=mini.byId(t);mini.isElement(e)?t={el:e}:"string"==typeof t&&(t={html:t}),(t=mini.copyTo({html:"",cls:"",style:"",backStyle:""},t)).el=mini.byId(t.el),t.el||(t.el=document.body);e=t.el;mini.unmask(t.el),e._maskid=mini._MaskID++,mini._MaskObjects[e._maskid]=t;var i=mini.append(e,'<div class="mini-mask"><div class="mini-mask-background" style="'+t.backStyle+'"></div><div class="mini-mask-msg '+t.cls+'" style="'+t.style+'">'+t.html+"</div></div>");e==document.body&&mini.addClass(i,"mini-fixed"),
//if (!mini.isShowBackdrop) {
t.maskEl=i,mini.isNull(t.opacity)||mini.setOpacity(i.firstChild,t.opacity);var n=i.lastChild;n.style.display="none",setTimeout(function(){!function e(){n.style.display="block";var t=mini.getSize(n);n.style.marginLeft=-t.width/2+"px",n.style.marginTop=-t.height/2+"px",n.style.zIndex=mini.getMaxZIndex()}()},0)},mini.unmask=function(t){t=(t=mini.byId(t))||document.body;var e=mini._MaskObjects[t._maskid];if(e){delete mini._MaskObjects[t._maskid];var i=e.maskEl;e.maskEl=null,i&&i.parentNode&&i.parentNode.removeChild(i)}},mini.showMaskLoading=function(t){return t=$.extend({el:document.body,cls:"mini-mask-loading",html:mini.Control.prototype.loadingMsg||"Loading..."},t),mini.mask(t)},mini.Cookie={get:function(t){for(var e=document.cookie.split("; "),i=null,n=0;n<e.length;n++){var s=e[n].split("=");t==s[0]&&(i=s)}if(i){var o=i[1];return o===undefined?o:unescape(o)}return null},set:function(t,e,i,n){var s=new Date;null!=i&&(s=new Date(s.getTime()+1e3*i*3600*24)),document.cookie=t+"="+escape(e)+(null==i?"":"; expires="+s.toGMTString())+";path=/"+(n?"; domain="+n:"")},del:function(t,e){this.set(t,null,-100,e)}},mini.copyTo(mini,{treeToArray:function(t,e,i,n,s){e=e||"children";for(var o=[],r=0,a=t.length;r<a;r++){var l=t[r];o[o.length]=l,n&&(l[n]=s);var h=l[e];if(h&&0<h.length){var d=l[i],u=this.treeToArray(h,e,i,n,d);o.addRange(u)}}return o},arrayToTree:function(t,e,i,n){e=e||"children",i=i||"_id",n=n||"_pid";for(var s=[],o={},r=0,a=t.length;r<a;r++){if(h=t[r]){var l=mini._getMap(i,h);null!==l&&l!==undefined&&(o[l]=h),delete h[e]}}for(r=0,a=t.length;r<a;r++){var h=t[r],d=o[mini._getMap(n,h)];d?(d[e]||(d[e]=[]),d[e].push(h)):s.push(h)}return s}}),mini.treeToList=mini.treeToArray,mini.listToTree=mini.arrayToTree,mini.UUID=function(){for(var t=[],e="0123456789ABCDEF".split(""),i=0;i<36;i++)t[i]=Math.floor(16*Math.random());t[14]=4,t[19]=3&t[19]|8;for(i=0;i<36;i++)t[i]=e[t[i]];return t[8]=t[13]=t[18]=t[23]="-",t.join("")},String.format=function(t){var i=Array.prototype.slice.call(arguments,1);return(t=t||"").replace(/\{(\d+)\}/g,function(t,e){return i[e]})},String.prototype.trim=(TA=/^\s+|\s+$/g,function(){return this.replace(TA,"")}),mini.copyTo(mini,{measureText:function(t,e,i){if(this.measureEl||(this.measureEl=mini.append(document.body,"<div></div>")),this.measureEl.style.cssText="position:absolute;left:-1000px;top:-1000px;visibility:hidden;","string"==typeof t)this.measureEl.className=t;else{this.measureEl.className="";for(var n=jQuery(t),s=jQuery(this.measureEl),o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],r=0,a=o.length;r<a;r++){var l=o[r];s.css(l,n.css(l))}}return i&&mini.setStyle(this.measureEl,i),this.measureEl.innerHTML=e,mini.getSize(this.measureEl)}}),"undefined"==typeof mini_layoutOnParse&&(mini_layoutOnParse=!0),mini.enableLayout=!0,mini.autoParse=!0,jQuery(function(){mini.autoParse&&setTimeout(function(){mini.__LastWindowWidth=document.documentElement.clientWidth,mini.__LastWindowHeight=document.documentElement.clientHeight,mini.isReady=!0,mini.parse(null,mini_layoutOnParse),mini._FireBindEvents()},1)}),mini_onload=function(t){mini.on(window,"resize",mini_onresize)},mini.on(window,"load",mini_onload),mini.__LastWindowWidth=document.documentElement.clientWidth,mini.__LastWindowHeight=document.documentElement.clientHeight,mini.doWindowResizeTimer=null,mini.allowLayout=!0,mini_onresize=function(t){if(mini.doWindowResizeTimer&&clearTimeout(mini.doWindowResizeTimer),mini.WindowVisible=mini.isWindowDisplay(),0!=mini.WindowVisible&&0!=mini.allowLayout)if("undefined"!=typeof Ext)mini.doWindowResizeTimer=setTimeout(function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;mini.__LastWindowWidth==t&&mini.__LastWindowHeight==e||(mini.__LastWindowWidth=t,mini.__LastWindowHeight=e,mini.layout(null,!1)),mini.doWindowResizeTimer=null},300);else{var e=100;try{parent&&parent!=window&&parent.mini&&(e=0)}catch(ex){}mini.doWindowResizeTimer=setTimeout(function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;mini.__LastWindowWidth==t&&mini.__LastWindowHeight==e||(mini.__LastWindowWidth=t,mini.__LastWindowHeight=e,mini.layout(null,!1)),mini.doWindowResizeTimer=null},e)}},mini.isDisplay=function(t,e){for(var i=e||document.body;;){if(null==t||!t.style)return!1;if(t&&t.style&&"none"==t.style.display)return!1;if(t==i)return!0;t=t.parentNode}return!0},mini.isWindowDisplay=function(){try{var t=window.parent;if(t==window)return!0;for(var i=t.document.getElementsByTagName("iframe"),n=t.document.getElementsByTagName("frame"),s=[],o=0,r=i.length;o<r;o++)s.push(i[o]);for(o=0,r=n.length;o<r;o++)s.push(n[o]);var a=null;for(o=0,r=s.length;o<r;o++){var l=s[o];if(l.contentWindow==window){a=l;break}}return!!a&&mini.isDisplay(a,t.document.body)}catch(e){return!0}},mini.WindowVisible=mini.isWindowDisplay(),mini.layoutIFrames=function(n){if(document.body){var s=(n=n||document.body).getElementsByTagName("iframe");setTimeout(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t];try{mini.isDisplay(i)&&mini.isAncestor(n,i)&&(i.contentWindow.mini&&(0==i.contentWindow.mini.WindowVisible?(i.contentWindow.mini.WindowVisible=i.contentWindow.mini.isWindowDisplay(),i.contentWindow.mini.layout()):i.contentWindow.mini.layout(null,!1)),i.contentWindow.mini.layoutIFrames())}catch(ex){}}},30)}},jQuery.ajaxSetup({cache:!1}),isIE&&setInterval(function(){},2e4),mini_unload=function(t){try{var e=mini._getTopWindow();e[mini._WindowID]="",delete e[mini._WindowID]}catch(ex){}var i=document.body.getElementsByTagName("iframe");if(0<i.length){for(var n=[],s=0,o=i.length;s<o;s++)n.push(i[s]);for(s=0,o=n.length;s<o;s++)try{var r=n[s];if(r._ondestroy=null,r.onload=function(){},jQuery(r).unbind("load"),r.src="",mini.isIE)try{r.contentWindow.document.write(""),r.contentWindow.document.close()}catch(ex){}r.parentNode&&r.parentNode.removeChild(r)}catch(t){}}mini._destroying=!0;var a=mini.getComponents().clone();for(s=0,o=a.length;s<o;s++){var l=a[s];!0!==l.destroyed&&l.destroy(!1)}a.length=0,a=null,mini.clearEvent(window),mini.clearEvent(document),mini.un(window,"unload",mini_unload),mini.un(window,"load",mini_onload),mini.un(window,"resize",mini_onresize),mini.components={},mini.classes={},mini.uiClasses={},mini.uids={},mini.listeners.length=0,mini._topWindow=null,window.mini=null,window.Owner=null,window.CloseOwnerWindow=null},mini.on(window,"unload",mini_unload),mini.zIndex=1e3,mini.zindex=mini.getMaxZIndex=function(){return mini.zIndex++},mini._placeholder=function(i){if((i=mini.byId(i))&&isIE&&!isIE10&&!isIE11)if(i._placeholder)s();else{i._placeholder=!0;var n=document.createElement("label");n.className="mini-placeholder-label",i.parentNode.appendChild(n),(i._placeholder_label=n).onmousedown=function(){try{i.focus()}catch(e){}},i.onpropertychange=function(t){"value"==(t=t||window.event).propertyName&&s()},s(),mini.on(i,"focus",function(t){i.readOnly||(n.style.display="none")}),mini.on(i,"blur",function(t){s()})}function s(){var t=i._placeholder_label;if(t){var e=i.getAttribute("placeholder");e=e||i.placeholder,
//if (!el.value && !el.disabled) {
i.value?t.style.display="none":(t.innerHTML=e,t.style.display="")}}},mini.ajax=function(t){
//    if (!options.contentType) {
return t.dataType||(t.dataType="text"),window.jQuery.ajax(t)},mini._evalAjaxData=function(t,e){var i=t;return"string"==typeof t&&"function"==typeof(i=window.eval("("+t+")"))&&(i=i.call(e)),i};var hasOn=!!jQuery.fn.on,xD;jQuery.fn.on||(jQuery.fn.on=function(t,e,i,n){return this.delegate(e,t,i,n)}),mini._lastDevice,mini.updateDevice=function(){var t="mini-xs",e=jQuery(window).width(),i="xs";768<e&&(t+=" mini-sm",i="sm"),992<e&&(t+=" mini-md",i="md"),1200<e&&(t+=" mini-lg",i="lg"),t+=" mini-"+i+"-active",mini._lastDevice!=i&&(jQuery(document.documentElement).removeClass("mini-xs mini-sm mini-md mini-lg mini-xs-active mini-sm-active mini-md-active mini-lg-active ").addClass(t),mini._lastDevice!=i&&jQuery(window).triggerHandler("devicechange",i),mini._lastDevice=i)},mini.getClipboard=function(t){var e="";return window.clipboardData?e=window.clipboardData.getData("Text"):t&&(e=t.clipboardData.getData("text/plain")),e},mini.setClipboard=function(t){if(window.clipboardData)window.clipboardData.setData("Text",t);else{var e=jQuery('<textarea style="position:absolute;left:0;top:-1000px;width:100px;z-index:1000;"></textarea>').appendTo("body").val(t)[0];e.select(),e.focus(),document.execCommand("copy")}},mini.getActiveElement=function(){try{return document.activeElement}catch(ex){}},mini.getScrollOffset=function(){if(!mini._scrollOffset){var t=document.createElement("div");t.style.cssText="z-index:1000;width:100px;background:#eee;height:50px;overflow:auto;position:absolute;left:100px;top:100px;",t.innerHTML='<div style="width:50px;height:200px;"></div>',document.body.appendChild(t),mini._scrollOffset=t.offsetWidth-t.clientWidth,t.parentNode.removeChild(t)}return mini._scrollOffset}
/***************************************************
* loadJS v1.0
* 
* How to use : http://www.loadjs.org
*
* License : MIT
*
* Date : 2012/04/01
*
***************************************************/,"undefined"==typeof window.rootpath&&(rootpath="/"),mini.loadJS=function(t,e){if(t)return"function"==typeof e?mini.loadJS._async(t,e):mini.loadJS._sync(t)},mini.loadJS._js={},mini.loadJS._async=function(t,e){var i=mini.loadJS._js[t];if((i=i||(mini.loadJS._js[t]={create:!1,loaded:!1,callbacks:[]})).loaded)setTimeout(function(){e()},1);else if(i.callbacks.push(e),!i.create){i.create=!0;var n=document.getElementsByTagName("head")[0],s=document.createElement("script");return s.src=t,s.type="text/javascript",setTimeout(function(){document.all?s.onreadystatechange=function(){"loaded"!=s.readyState&&"complete"!=s.readyState||(o(),i.loaded=!0)}:s.onload=function(){o(),i.loaded=!0},n.appendChild(s)},1),s}function o(){for(var t=0;t<i.callbacks.length;t++){var e=i.callbacks[t];e&&e()}i.callbacks.length=0}},mini.loadJS._sync=function(t){if(!mini.loadJS._js[t]){mini.loadJS._js[t]={create:!0,loaded:!0,callbacks:[]};var e=document.getElementsByTagName("head")[0],i=document.createElement("script");return i.type="text/javascript",i.text=mini.loadText(t),e.appendChild(i),i}},mini.loadText=function(t){var e="",i=document.all&&"file:"==location.protocol,n=null;i?n=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n.onreadystatechange=function o(){if(4==n.readyState){var t=i?0:200;n.status==t&&(e=n.responseText)}};var s="_t="+(new Date).getTime();return s=-1==t.indexOf("?")?"?"+s:"&"+s,t+=s,n.open("GET",t,!1),n.send(null),e},mini.loadJSON=function(t){var e=loadText(t);return window.eval("("+e+")")},mini.loadCSS=function(t,e){if(t&&!mini.loadCSS._css[t]){var i=document.getElementsByTagName("head")[0],n=document.createElement("link");return e&&(n.id=e),n.href=t,n.rel="stylesheet",n.type="text/css",i.appendChild(n),mini.loadCSS._css[t]=n}},mini.loadCSS._css={},mini.innerHTML=function(t,e){if("string"==typeof t&&(t=document.getElementById(t)),t){e='<div style="display:none">&nbsp;</div>'+e,t.innerHTML=e,mini.__executeScripts(t);t.firstChild}},mini.__executeScripts=function(t){for(var e=t.getElementsByTagName("script"),i=0,n=e.length;i<n;i++){var s=(r=e[i]).src;if(s)mini.loadJS(s);else{var o=document.createElement("script");o.type="text/javascript",o.text=r.text,t.appendChild(o)}}for(i=e.length-1;0<=i;i--){var r;(r=e[i]).parentNode.removeChild(r)}},mini.getF9FrameSysParams=function(t){return window.EpFrameSysParams&&window.EpFrameSysParams[t]},mini.getCtrDefaultBySysParams=function(t,e){var i=mini.getF9FrameSysParams(t);return i!==undefined?i:e},mini.htmlUnescape=function(t){return t+""!==t?t:mini.htmlDecode(t)},mini.htmlEscape=function(t){if(t+""!==t)return t;var e=document.createElement("div");e.appendChild(document.createTextNode(t));var i=e.innerHTML;return e=null,i},mini.supportRem=function(){var t=!1,e=document.createElement("span");try{e.style.fontSize="13rem",/rem/.test(e.style.fontSize)&&(t=!0)}catch(i){}return e=null,t}(),mini.getFontSizeRatio=function(){return this._fontSizeRatio||(this._fontSizeRatio=parseInt($("html").css("fontSize"),10)/window.HtmlBaseFontSize||1),this._fontSizeRatio},mini.setFontSizeRatio=function(t){this._fontSizeRatio=t},mini.getStrLength=function(t){return mini.getF9FrameSysParams("security_vtype_length_accurate_enable")?mini.getStrLengthUft8(t):t.length},mini.getStrLengthUft8=function(t){return t.replace(/[^\x00-\xff]/g,"012").length},mini.substr=function(t,e){if(!mini.getF9FrameSysParams("security_vtype_length_accurate_enable"))return t.substr(0,e);if(mini.getStrLength(t)<=e)return t;for(var i=0,n=0,s=t.length;n<s&&(0!=(65280&t.charCodeAt(n))?i+=3:i++,!(e<=i));n++);return t.substr(0,n)},mini.copyTo(mini,{overwrite:function(t,e){var i;if("function"==typeof t)i=t.prototype;else{if("object"!=typeof t)return this;i=t}for(var n=1,s=arguments.length;n<s;++n){var o=arguments[n];for(var r in o)i[r]=o[r]}return t}}),window._rootPath===undefined&&(window._rootPath=(xD=location.pathname,0===xD.indexOf("/")&&(xD=xD.substring(1)),"/"+xD.split("/")[0])),mini.isDisplay=function(t,e,i){"function"==typeof e&&(i=e,e=undefined);for(var n=e||document.body;;){if(null==t||!t.style)return!1;if(t&&("none"===jQuery(t).css("display")||mini.isFirefox&&"IFRAME"===t.nodeName&&0===t.getBoundingClientRect().width&&0===t.getBoundingClientRect().height&&0===t.getBoundingClientRect().x&&0===t.getBoundingClientRect().y)){if(!i)return!1;if(!0!==i(t))return!1}if(t==n)return!0;t=t.parentNode}return!0},mini.externalSrc=_rootPath+"/frame/fui/js/widgets/",mini_useShims=!0,mini_debugger=!1,mini.showPageWarning=function(t){var e=$("#mini-pageWarning");e.length||(e=$("<div></div>",{id:"mini-pageWarning",style:"position:fixed;top:30%;left:50%;margin-left:-280px;width:560px;height:40px;color:#dd2727;background:#f2dede;text-align:center;border-radius:3px;line-height:40px;font-size:13px;"}).html(t.html).append($('<span title= "关闭" style= "position: absolute;top:0;right:10px;font-size:18px;line-height:40px;cursor:pointer" onclick= \'$("#mini-pageWarning").remove();\'>×</span>')).css("z-index",t.zIndex||9999).appendTo("body"),setTimeout(function(){e.remove(),e=null},t.timeout||15e3))};var _oGetAttrs=mini.Control.prototype.getAttrs,JD,KD,wF;mini.overwrite(mini.Control,{getAttrs:function(t){var e,i=_oGetAttrs.call(this,t);return this.getExtraAttrs&&(e=this.getExtraAttrs.call(this,t),mini.copyTo(i,e)),i}}),mini.overwrite(mini.Container,{getAttrs:function(t){return mini.Container.superclass.getAttrs.call(this,t)}}),mini.getValidErrorToolTip=function(){return mini._errorToolTip||(mini._errorToolTip=new mini.ToolTip,mini._errorToolTip.set({selector:".mini-error[data-tooltip]",placement:"topright",trigger:"focus hover",theme:"error",defaultTheme:"error"}),$(document).on("mousewheel",function(){mini._errorToolTip.close()})),mini._errorToolTip},JD=this.jQuery,KD={errorMode:mini.getCtrDefaultBySysParams("ui_form_errormode","icon"),errorTextEl:null,getErrorTextEl:function(){return this._errorTextEl},_RemoveErrorText:function(){},__doUpdateValid:function(){if(this.el){if(this.removeCls(this._errorCls),this.removeCls(this._invalidCls),jQuery(this.el).removeClass("mini-errorMode-text mini-errorMode-icon"),"border"==this.errorMode&&(this.el.title=""),0==this._IsValid)switch(mini.getValidErrorToolTip(),this.errorMode){case"icon":this._RemoveErrorText(),jQuery(this.el).attr("data-tooltip",this.errorText),this.addCls(this._errorCls),jQuery(this.el).addClass("mini-errorMode-icon");this.getErrorIconEl();break;case"border":jQuery(this.el).attr("data-tooltip",this.errorText),this.addCls(this._invalidCls),this.el.title=this.errorText,this._RemoveErrorIcon(),this._RemoveErrorText();break;case"text":this.addCls(this._errorCls);var t=this.getErrorTextEl();jQuery(this.el).addClass("mini-errorMode-text"),t&&JD(t).text(this.errorText).attr("title",this.errorText),this._RemoveErrorIcon();break;default:this._RemoveErrorText(),this._RemoveErrorIcon()}else this._RemoveErrorIcon(),this._RemoveErrorText(),jQuery(this.el).removeAttr("data-tooltip"),mini._errorToolTip&&mini._errorToolTip.close();this.doLayout()}}},mini.overwrite(mini.ValidatorBase,KD),mini.overwrite(mini.ListControl,KD),mini.IndexColumn=function(t){return mini.copyTo({ignoreCollapseIndex:!1,width:56,cellCls:"",align:"left",draggable:!1,allowDrag:!0,hideable:!0,init:function(t){t.on("addrow",this.__OnIndexChanged,this),t.on("removerow",this.__OnIndexChanged,this),t.on("moverow",this.__OnIndexChanged,this),t.isTree&&(t.on("addnode",this.__OnIndexChanged,this),t.on("removenode",this.__OnIndexChanged,this),t.on("movenode",this.__OnIndexChanged,this),t.on("loadnode",this.__OnIndexChanged,this),this._gridUID=t.uid,this._rowIdField="_id")},getNumberId:function(t){return this._gridUID+"$number$"+t[this._rowIdField]},createNumber:function(t,e){return mini.isNull(t.pageIndex)?e+1:t.pageIndex*t.pageSize+e+1},renderer:function(t){var e=t.sender;this.draggable&&(t.cellStyle||(t.cellStyle=""),t.cellStyle+=";cursor:move;");var i='<div id="'+this.getNumberId(t.record)+'">',n=t.rowIndex;return this.ignoreCollapseIndex,mini.isNull(e.getPageIndex)?i+=n+1:i+=e.getPageIndex()*e.getPageSize()+n+1,i+="</div>"},__updateRowNumbers:function(t){for(var e=t.getDataView(),i=0,n=e.length;i<n;i++){var s=e[i],o=this.getNumberId(s),r=document.getElementById(o);r&&(r.innerHTML=this.createNumber(t,i))}},__OnIndexChanged:function(t){var e=t.sender,i=this;i._toIndex||(i._toIndex=setTimeout(function(){i._toIndex=null,i.__updateRowNumbers(e)},10))}},t)},mini._Columns.indexcolumn=mini.IndexColumn,mini.CheckColumn=function(t){return mini.copyTo({width:40,cellCls:"mini-checkcolumn",headerCls:"mini-checkcolumn",hideable:!0,_multiRowSelect:!0,header:function(t){var e=this.uid+"checkall",i='<span class="mini-grid-checkbox mini-icon '+(t._checkedAll?"mini-grid-checkbox-checked":"")+'" id="'+e+'"></span>';return 0==this.multiSelect&&(i=""),i},getCheckId:function(t,e){return this._gridUID+"$checkcolumn$"+t[this._rowIdField]+"$"+e._id},init:function(t){t.on("_selectchange",this.__OnSelectionChanged,this),t.on("HeaderCellClick",this.__OnHeaderCellClick,this);var e=this;t.on("removerow",function(){t.data&&0==t.data.length&&e._doCheckState(t)}),t.on("load",function(){e._doCheckState(t)},this)},renderer:function(t){var e=this.getCheckId(t.record,t.column);t.sender.isSelected&&t.sender.isSelected(t.record);return'<span class="mini-grid-'+(t.sender.getMultiSelect()?"checkbox":"radio")+' mini-icon" id="'+e+'"></span>'},__OnHeaderCellClick:function(t){var e=t.sender;if(t.column==this){var i,n=e.uid+"checkall",s=document.getElementById(n);if(s){var o="mini-grid-checkbox-checked",r=!mini.hasClass(s,o);this._checkedAll=r,e.getMultiSelect()?r?(i=e.getDataView(),e.selects(i),mini.addClass(s,o),setTimeout(function(){mini.addClass(s,o)},30)):(i=e.getDataView(),e.deselects(i),mini.removeClass(s,o)):(e.deselectAll(),r&&(e.select(0),mini.addClass(s,o))),e.fire("checkall")}}},__OnSelectionChanged:function(t){var e,i,n=t.sender,s=n.toArray(),o=this,r=n.isVirtualScroll(),a=n._viewRegion,l=r&&a?a.start:-1,h=a?a.end:-1,d={};if(-1!==l){var u=n.getVisibleRows();for(e=l,i=h;e<i;e++){var c=u[e];c&&(d[c._id]=!0)}}for(e=0,i=s.length;e<i;e++){var m=s[e];-1==l||d[m._id]}this._timer||(this._timer=setTimeout(function(){o._doCheckState(n),o._timer=null},10))},_doCheckState:function(t){var e=t.uid+"checkall",i=document.getElementById(e);if(i){var n=t.getSelecteds(),s=t.isTree?t.getList().length:t.getData().length;n.length==s&&0!=s?(jQuery(i).addClass("mini-grid-checkbox-checked"),this._checkedAll=!0):(jQuery(i).removeClass("mini-grid-checkbox-checked"),this._checkedAll=!1)}}},t)},mini._Columns.checkcolumn=mini.CheckColumn,mini.ExpandColumn=function(t){return mini.copyTo({width:30,headerAlign:"center",align:"center",draggable:!1,cellStyle:"padding:0",cellCls:"mini-grid-expandCell",hideable:!0,renderer:function(t){return'<i class="mini-grid-ecIcon mini-icon" ></i>'},init:function(t){t.on("cellclick",this.__OnCellClick,this)},__OnCellClick:function(t){var e=t.sender;if(t.column==this&&e.isShowRowDetail&&mini.findParent(t.htmlEvent.target,"mini-grid-ecIcon")){var i=e.isShowRowDetail(t.record);if(i){if(t.cancel=!1,e.fire("beforehiderowdetail",t),!0===t.cancel)return}else if(t.cancel=!1,e.fire("beforeshowrowdetail",t),!0===t.cancel)return;e.autoHideRowDetail&&e.hideAllRowDetail(),i?e.hideRowDetail(t.record):e.showRowDetail(t.record)}}},t)},mini._Columns.expandcolumn=mini.ExpandColumn,mini.htmlDecode=function(t){if("string"!=typeof t)return t;if(0==t.length)return"";var e=t;return e=(e=(e=(e=(e=(e=e.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&nbsp;/g," ")).replace(/&#39;/g,"'")).replace(/&quot;/g,'"')).replace(/&amp;/g,"&")},mini.createIFrame=function(t,e,i,n,s){var o=(t=t||"").split("#");t=o[0];var r="";if(!0!==i&&(r="_t="+Math.floor(1e6*Math.random()),-1==t.indexOf("_t=")?-1==t.indexOf("?")?t+="?"+r:t+="&"+r:t=t.replace(/_t=(\d+)/,r)),t&&-1===t.indexOf("_winid")&&(r="_winid="+mini._WindowID,-1===t.indexOf("?")?t+="?"+r:t+="&"+r),mini.iframeParams)for(var a in mini.iframeParams)t+="&"+a+"="+mini.iframeParams[a];o[1]&&(t=t+"#"+o[1]);var l=-1!=t.indexOf(".mht"),h=l?t:"",d='<iframe name="'+mini.newId("mini-iframe-")+'" src="'+("post"==n?"":h)+'" style="width:100%;height:100%;" allowfullscreen="true" frameborder="0"></iframe>',u=document.createElement("div"),c=mini.append(u,d),m=!1;l?m=!0:setTimeout(function(){c&&("post"!==n&&(c.src=t),m=!0)},5),c.attachEvent?c.attachEvent("onload",_):c.onload=_;var f,p=!1,g=!0;function _(){0==m||p||setTimeout(function(){e&&e(c,g),g=!1},1)}return c._ondestroy=function(){if(p=!0,c.src="",mini.isIE)try{c.contentWindow.document.write(""),c.contentWindow.document.close()}catch(ex){}c._ondestroy=null,c=null},"post"===n&&(f=jQuery("<form />").attr({method:"post",action:t,enctype:"multipart/form-data",target:c.name}).hide().appendTo("body"),setTimeout(function(){f.submit()},10)),c},mini.getScrollBarWidth=function(){var t=document.createElement("div"),e=document.createElement("p");t.style.display=e.style.display="block",e.style.height="100px",t.style.padding=0,t.style.border="none",t.style.overflow="auto",t.style.height="10px",t.appendChild(e),document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return t.parentNode.removeChild(t),t=e=null,i},Object.defineProperty&&!mini.isIE8?Object.defineProperty(mini,"_scrollBarWidth",{get:function(){return wF=wF||mini.getScrollBarWidth()}}):jQuery(window).on("load",function(){mini._scrollBarWidth=mini.getScrollBarWidth()}),function(){mini.reservedAttrsReg=[/title/,/data-*/];var s=mini.applyTo;mini.applyTo=function(t){var e=function a(t){if(t&&t.hasAttributes&&t.hasAttributes()){for(var e,i=t.attributes,n={},s=!1,o=0,r=i.length;o<r;o++)e=i[o].name,l(e)&&(s=!0,n[e]=i[o].value);return s?n:null}}(t=mini.byId(t)),i=s.apply(this,arguments);return function n(i,t){if(!i||!t)return;jQuery.map(t,function(t,e){"title"===e&&/mini-panel/.test(i.className)||i.setAttribute(e,t)})}(this.el,e),i};var l=Array.prototype.some?function(e){return mini.reservedAttrsReg&&mini.reservedAttrsReg.some(function(t){return t.test(e)})}:function(t){if(!mini.reservedAttrsReg||!mini.reservedAttrsReg.length)return!1;for(var e=0,i=mini.reservedAttrsReg.length;e<i;e++)if(mini.reservedAttrsReg[e].test(t))return!0;return!1}}(),mini._ValidateVType=function(t,e,i,n){(-1<t.indexOf("int")||-1<t.indexOf("float")&&-1===t.indexOf("decimalLength"))&&-1==t.indexOf("range")&&(t+=";range:"+mini._minimumNumber+","+mini._maximumNumber),-1<t.indexOf("decimalLength")&&-1==t.indexOf("range:")&&(t+=";range:0,9999999999999"),-1<t.indexOf("float")&&-1==t.indexOf("rangeLength")&&(t+=";rangeLength:0,16");for(var s=t.split(";"),o=0,r=s.length;o<r;o++){var a=(t=s[o].trim()).split(":"),l=a[0],h=t.substr(l.length+1,1e3);h=h?h.split(","):[];var d=mini.VTypes[l];if(d)if(!0!==d(e,h)){i.isValid=!1;var u=a[0]+"ErrorText";i.errorText=n.validateErrorText||n[u]||mini.VTypes[u]||"",i.errorText=String.format(i.errorText,h[0],h[1],h[2],h[3],h[4]);break}}i.isValid&&/[\x00-\x08\x0b-\x0c\x0e-\x1f\x7f]/.test(e)&&(i.isValid=!1,i.errorText="输入的内容中包含非法的特殊字符")},mini._maximumNumber=2147483647,mini._minimumNumber=-2147483648,jQuery.extend(mini.VTypes,{decimalLength:function(t,e){if(0==mini.VTypes["float"](t,e))return!1;if(mini.isNull(t)||""===t)return!0;var i=parseInt(e);if(!t||isNaN(i))return!0;var n=(t=String(t)).split(".");return 1==n.length||n[1].length<=i},mobile:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^1[3456789]\d{9}$/.test(t)},tel:function(t,e){return!(!mini.isNull(t)&&""!==t)||(/^0\d{2}-\d{8}$/.test(t)||/^0\d{3}-\d{7,8}$/.test(t)||/^\d{7,8}$/.test(t))},phone:function(t,e){return!(!mini.isNull(t)&&""!==t)||(/^1[3456789]\d{9}$/.test(t)||/^0\d{2}-\d{8}$/.test(t)||/^0\d{3}-\d{7,8}$/.test(t)||/^\d{7,8}$/.test(t))},phoneWithShortNum:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^\d[\d-]{2,10}(?!-)$/.test(t)},postCode:function(t,e){return!(!mini.isNull(t)&&""!==t)||/^\d{6}$/.test(t)},orgCode:function(t,e){return!(!mini.isNull(t)&&""!==t)||(!!/^[A-Z0-9]{8}-[A-Z0-9]$/.test(t)||mini.VTypes._isCreditCode(t))},creditCode:function(t,e){return!(!mini.isNull(t)&&""!==t)||mini.VTypes._isCreditCode(t)},_isCreditCode:function(t){if(!/^(?![IOSV])([0-9A-Y])([0-9]{7})(((?![IOSV])[0-9A-Y]){10})$/.test(t))return!1;for(var e,i=0,n=[1,3,9,27,19,26,16,17,20,29,25,13,8,24,10,30,28],s="0123456789ABCDEFGHJKLMNPQRTUWXY",o=0;o<t.length-1;o++)e=t.charAt(o),i+=s.indexOf(e)*n[o];var r=31-i%31;return 31===r&&(r=0),(r=s.charAt(r))===t.charAt(17)},idCard:function(t,e){if(mini.isNull(t)||""===t)return!0;return function a(t){if(!/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[X])$)$/.test(t))return!1;if(18===t.length){for(var e=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),i=new Array(1,0,10,9,8,7,6,5,4,3,2),n=0,s=0;s<17;s++)n+=t.substring(s,s+1)*e[s];var o=n%11,r=t.substring(17);return 2==o?"X"===r:r==i[o]}}(t)||mini.VTypes._isHkIdCard(t)},hkIdCard:function(t){return!(!mini.isNull(t)&&""!==t)||mini.VTypes._isHkIdCard(t)},_isHkIdCard:function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",i=t.match(/^([A-Z]{1,2})([0-9]{6})[(（]([A0-9])[)）]$/);if(null===i)return!1;var n=i[1],s=i[2],o=i[3],r=0;2===n.length?(r+=9*(10+e.indexOf(n.charAt(0))),r+=8*(10+e.indexOf(n.charAt(1)))):(r+=324,r+=8*(10+e.indexOf(n)));for(var a=0,l=7;a<s.length;a++,l--)r+=l*s.charAt(a);var h=r%11,d=0==h?0:11-h;return d+""===o||10==d&&"A"===o},projectCode:function(t){return!(!mini.isNull(t)&&""!==t)||/^(19|20)\d{2}-\d{6}-\d{2}-\d{2}-\d{6}$/.test(t)},
/**
     * 重写 url 验证规则
     * 支持带一部分协议或无协议
     * 支持 ipv4 和 域名 localhost 形式
     * 支持 端口号 验证
     * !不支持 中文域名
     * !不支持 ipv6
     * !不支持 url中带用户名和密码 http://username:password@abc.com/
     * 原来 miniui 中的正则有严重性能问题 输入10位以上的数字基本会直接导致浏览器卡死
     * @param {string} v 待检查字符
     * @author chends
     */
url:function(t){return!(!mini.isNull(t)&&""!==t)||function o(t){var e=t.split("?")[0],i=/^(http|https|ws|wss|ftp|rtsp|mailto|ed2k|thunder):\/\//i.exec(e);i&&(e=e.substr(i[0].length));var n,s;(n=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.exec(e))?e=e.substr(n[0].length):(s=/^(?:localhost|(\w+\.(?!\.))+[a-z]{2,})/i.exec(e))&&(e=e.substr(s[0].length));if(!n&&!s)return!1;if(i=/^:\d{1,5}/.exec(e)){if(e=e.substr(i[0].length),65535<parseInt(i[0].substr(1),10))return!1}return 0===e.length||"/"===e||/^\/[\s\S]+/i.test(e)}(t)},maxLength:function(t,e){if(mini.isNull(t)||""===t)return!0;var i=parseInt(e,10);return!(t&&!isNaN(i))||mini.getStrLength(t)<=i},minLength:function(t,e){if(mini.isNull(t)||""===t)return!0;var i=parseInt(e,10);return!!isNaN(i)||i<=mini.getStrLength(t)},rangeLength:function(t,e){if(mini.isNull(t)||""===t)return!0;if(!t)return!1;var i,n=parseFloat(e[0]),s=parseFloat(e[1]);return!(!isNaN(n)&&!isNaN(s))||n<=(i=mini.getStrLength(t))&&i<=s}}),mini.__mouseWheelHandles={_unDocumentMousewheel:function(){mini.un(document,"mousewheel",this.__OnDocumentMousewheel,this),this._mousewheelXY=null},_onDocumentMousewheel:function(){this._unDocumentMousewheel(),this.popupEl&&(this._mousewheelXY=mini.getXY(this.popupEl),mini.on(document,"mousewheel",this.__OnDocumentMousewheel,this))},__OnDocumentMousewheel:function(t){var i=this;setTimeout(function n(){if(i.isPopup){var t=i._mousewheelXY,e=mini.getXY(i.popupEl);t[0]!=e[0]||t[1]!=e[1]?i.hide():setTimeout(n,300)}},300)}},mini._ParseColumns=function(t){for(var i=[],n=mini.getChildNodes(t),s=0,o=n.length;s<o;s++){var r=n[s],a={},l=null,h=null,d=null,u=mini.getChildNodes(r);if(u)for(var c=0,m=u.length;c<m;c++){var f=u[c],p=mini.getAttr(f,"property");if(p)if("columns"==(p=p.toLowerCase())&&(a.columns=mini._ParseColumns(f),f.parentNode&&f.parentNode.removeChild(f)),"editor"==p||"filter"==p){for(var g=f.className.split(" "),_=0,v=g.length;_<v;_++){var y=g[_],w=mini.getClassByUICls(y);if(w){var x=new w;"filter"==p?(h=x.getAttrs(f)).type=x.type:(l=x.getAttrs(f)).type=x.type;break}}f.parentNode&&f.parentNode.removeChild(f)}else"template"===p&&(d=jQuery.trim(f.innerHTML),f.parentNode&&f.parentNode.removeChild(f),window.Mustache||mini.loadJS(mini.externalSrc+"mustache.min.js"))}if(a.header=r.innerHTML,mini._ParseString(r,a,["name","header","field","editor","filter","renderer","width","type","renderer","beforeRender","rendered","headerAlign","align","headerCls","cellCls","headerStyle","cellStyle","displayField","dateFormat","listFormat","mapFormat","numberFormat","trueValue","falseValue","dataType","vtype","currencyUnit","summaryType","summaryRenderer","groupSummaryType","groupSummaryRenderer","defaultValue","defaultText","decimalPlaces","data-options","sortField","sortType","emptyText"]),mini._ParseBool(r,a,["allowCellWrap","visible","readOnly","allowSort","allowResize","allowMove","allowDrag","autoShowPopup","unique","autoEscape","enabled","hideable","showCellTip","valueFromSelect","navUpdown"]),mini._ParseInt(r,a,["minWidth"]),l&&(a.editor=l),h&&(a.filter=h),d&&(a.template=d),"string"==typeof a.editor)try{a.editor=window.eval("("+a.editor+")")}catch(e){}a.dataType&&(a.dataType=a.dataType.toLowerCase()),mini.getF9FrameSysParams("gridColumnEmptyText")!==undefined&&(a.emptyText=mini.getF9FrameSysParams("gridColumnEmptyText")),a.emptyText||!1===mini.getF9FrameSysParams("gridEnableColumnEmptyText")||(a.dataType&&-1!==jQuery.inArray(a.dataType,["int","float","date","boolean","currency"])?"int"!=a.dataType&&"float"!=a.dataType||(a.emptyText=0):a.emptyText="--"),"true"===a.defaultValue&&(a.defaultValue=!0),"false"===a.defaultValue&&(a.defaultValue=!1),i.push(a);var C=a["data-options"];(C=C&&window.eval("("+C+")"))&&mini.copyTo(a,C)}return i};var _oParseFloat=mini.parseFloat,jI,kI;mini.parseFloat=function(t,e,i){if(!t&&0!==t)return null;if("number"==typeof t)return t;if(t=t.toString(),0===i.indexOf("n")){var n=parseInt(i.substr(1),10),s=t.indexOf(".");n&&-1<s&&(t=t.substr(0,s+n))}return _oParseFloat(t,e,i)},jI=jQuery,kI=window.mini.regClass||window.mini_regClass,mini._EpointExt={},window.mini.addEpointExt=function(t,e){t=t.toLowerCase();var i=mini._EpointExt[t];(i=i||(mini._EpointExt[t]=[])).push(e)},window.mini.getEpointExt=function(t){t=t.toLowerCase();var e=mini._EpointExt[t];if(delete mini._EpointExt[t],jI.isArray(e)&&e.length){var n=[];return jI.each(e,function(t,e){if(e&&"function"==typeof e){var i=e();jI.isArray(i)?n.push.apply(n,i):n.push(i)}}),n}return[]},window.mini_regClass=window.mini.regClass=function(t,e){var i=[t],n=mini.getEpointExt(e);return jI.isArray(n)&&n.length&&(jI.each(n,function(t,e){i.push(e)}),mini.overwrite.apply(mini,i)),kI.apply(this,arguments)},mini.addEpointExt("control",function(){return{setWidth:function(t){t&&(parseFloat(t)==t&&(t+="px"),this.width=t,this.el.style.width=t,this._sizeChanged())},setHeight:function(t){t&&(parseFloat(t)==t&&(t+="px"),this.height=t,this.el.style.height=t,this._sizeChanged())}}}),mini.overwrite(mini.ListControl,{autoLoad:!0,getAutoLoad:function(){return this.autoLoad},setAutoLoad:function(t){this.autoLoad=t},setUrl:function(t){this.url=t,this.autoLoad&&this._doLoad({})},setData:function(t){if("string"==typeof t&&(t=window.eval(t)),mini.isArray(t)||(t=[]),this.data=t,this.doUpdate(),""!=this.value){var e=this.findItems(this.value);this.deselectAll(),this.selects(e)}}}),mini.debounce=function(i,n,s){var o;return n=n||17,function(){var t=arguments,e=s||this;clearTimeout(o),o=setTimeout(function(){i.apply(e,t)},n)}},mini.throttle=function(n,s,o){s=s||200;var r,a=+new Date;return function(){clearTimeout(r);var t=arguments,e=o||this,i=+new Date-a;s<=i?(n.apply(e,t),a=+new Date):r=setTimeout(function(){n.apply(e,t),a=+new Date},s-i)}},mini.formatAmountToChinese=function(t,e){var i,n,s,o,r,a,l,h=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],d=["","拾","佰","仟"],u=["","万","亿","兆"],c=["角","分","毫","厘"],m="";if(t=parseFloat(t),!mini.isNumber(t)||t<0)return"";if(0===t)return m=h[0]+"圆整";if(e=e||parseInt(mini.getF9FrameSysParams("ui_money_decimal_length"),10)||2,n=-1===(t=t.toString()).indexOf(".")?(i=t,""):(i=(s=t.split("."))[0],s[1].substr(0,e)),0<parseInt(i,10)){for(l=0,r=i.length,o=0;o<r;o++){var f=r-o-1,p=f/4,g=f%4;"0"===(a=i.substr(o,1))?l++:(0<l&&(m+=h[0]),l=0,m+=h[parseInt(a,10)]+d[g]),0==g&&l<4&&(m+=u[p])}m+="圆"}if(""!==n)for(r=Math.min(n.length,4),o=0;o<r;o++)"0"!==(a=n.substr(o,1))&&(m+=h[parseInt(a,10)]+c[o]);return""===m?m+=h[0]+"圆整":""===n&&(m+="整"),m},mini.numeralUtil={addPrefixFormat:function(){window.numeral?numeral.register("format","prefix",{regexps:{format:/(#)/,unformat:/(#)/},format:function(t,e,i){var n,s=numeral._.includes(e,"# ")?" ":"",o=e.replace(/\(?([\s\S]*)#[\s\S]*/,"$1");return e=e.replace(o+"#"+s,""),n=numeral._.numberToFormat(t,e,i),n=numeral._.includes(n,"(")?((n=n.split("")).splice(1,0,o+s),n.join("")):o+s+n},unformat:function(t){return numeral._.stringToNumber(t)}}):console.error("未加载 numeral.js，addPrefixFormat 失败！")},addSuffixFormat:function(){window.numeral?numeral.register("format","suffix",{regexps:{format:/(@)/,unformat:/(@)/},format:function(t,e,i){var n,s=numeral._.includes(e," @")?" ":"",o=e.indexOf("@"),r=e.lastIndexOf(")"),a=e.substring(o+1,-1===r?e.length:r);return e=e.replace(s+"@"+a,""),n=numeral(t).format(e),n=numeral._.includes(n,")")?((n=n.split("")).splice(-1,0,s+a),n.join("")):n+s+a},unformat:function(t){return numeral._.stringToNumber(t)}}):console.error("未加载 numeral.js，addSuffixFormat 失败！")},addRmbFormat:function(){window.numeral?numeral.register("format","rmb",{regexps:{format:/(RMB)/},format:function(t,e,i){var n,s,o=1,r=(e=e.replace(/\s?RMB\s?/,"")).match(/(0*)\.?(0*)/);if(r){s=r[1].length,n=r[2].length;for(var a=1;a<s;a++)o*=10}return mini.formatAmountToChinese(t*o,n)}}):console.error("未加载 numeral.js，addRmbFormat 失败！")},initNumeral:function(t){window.numeral?numeral.nullFormat(""):mini.loadJS(mini.externalSrc+"numeral/numeral.js",function(){Object.freeze(numeral),numeral.nullFormat(""),"zh_CN"==mini.locale&&(numeral.locales&&!numeral.locales.chs&&numeral.register("locale","chs",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"千",million:"百万",billion:"十亿",trillion:"兆"},ordinal:function(t){return"."},currency:{symbol:"¥"}}),numeral.locale("chs")),numeral.formats.suffix||mini.numeralUtil.addSuffixFormat(),numeral.formats.prefix||mini.numeralUtil.addPrefixFormat(),numeral.formats.rmb||mini.numeralUtil.addRmbFormat();var a=numeral.formats.currency.format;a.isOverWrite||(numeral.formats.currency.format=function(t,e,i){var n,s=e.replace(/\s?\$\s?/,"").match(/(0*)\.?(0*)/),o=1;if(s){n=s[1].length;for(var r=1;r<n;r++)o*=10}return a(t*o,e,i)},numeral.formats.currency.format.isOverWrite=!0),t&&t()})}},mini.addEpointExt("AutoComplete",function(){return{isLocalData:!1,setIsLocalData:function(t){this.isLocalData=t,this.isLocalData&&(this.setRemote(!1),this.setData(this._getLocalListData()))},_localKey:undefined,_getLocalKey:function(){return this._localKey||(this._localKey=this.id+"_local_data"),this._localKey},_localData:undefined,_getLocalData:function(){return this._localData||(this._localData=window.localStorage.getItem(this._getLocalKey())||""),this._localData},_localListData:undefined,_getLocalListData:function(){var t,e=[];if(!this._localListData){for(var i=0,n=(t=this._getLocalData().split(";")).length;i<n;i++)e.push({id:t[i],text:t[i]});this._localListData=e}return this._localListData},_updateLocalData:function(t){this._localData=t,window.localStorage.setItem(this._getLocalKey(),t)},_updateLocalListData:function(t){this._localListData=t,this.setData(t)},_addLocalData:function(t){var e=this._getLocalData(),i=this._getLocalListData(),n={};!t||-1<(";"+e+";").indexOf(";"+t+";")||(n[this.textField]=t,n[this.valueField]=t,i.unshift(n),e=t+(e?";"+e:""),10<i.length&&(i.length=10,e=e.substr(0,e.lastIndexOf(";"))),this._updateLocalData(e),this._updateLocalListData(i))},_OnValueChanged:function(){mini.AutoComplete.superclass._OnValueChanged.call(this);var t=this.getValue();t&&this.isLocalData&&this._addLocalData(t)},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["isLocalData"]),e}}}),mini.addEpointExt("button",function(){return{disableMultiClick:mini.getCtrDefaultBySysParams("buttonDisableMultiClick",!0),iconPosition:"left",size:"default",_sizeList:["default","small"],_sizePrefix:"mini-button-size-",_iconOnlyCls:"mini-button-iconOnly",_iconPosCls:{left:"mini-button-iconLeft",right:"mini-button-iconRight",top:"mini-button-iconTop",bottom:"mini-button-iconBottom"},ghostCls:"mini-button-ghost",state:"default",_statePrefix:"mini-button-state-",_stateList:["default","primary","info","success","warning","danger"],_semantic2state:{"mini-btn-primary":"primary","mini-btn-info":"info","mini-btn-success":"success","mini-btn-warning":"warning","mini-btn-danger":"danger"},_loadingSvg:mini.isIE8||mini.isIE9?"":'<svg class="mini-button-loading-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="128" height="128" fill="currentColor" ><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg>',set:function(t){return"string"==typeof t||(this._allowUpdate=!(t.text||t.iconStyle||t.iconCls||t.iconPosition),this._applyState(t),this._applyGhost(t),t.state=t.state||this.state,mini.Button.superclass.set.call(this,t),!1===this._allowUpdate&&(this._allowUpdate=!0,this.doUpdate())),this},_create:function(){this.el=document.createElement("a"),this.el.className="mini-button mini-corner-all mini-button-state-default",this.el.hideFocus=!0,this.el.href="javascript:void(0)",this.doUpdate()},setIconPosition:function(t){this.iconPosition=t,this.doUpdate()},setGhost:function(t){this.ghost=!!t,this.ghost?this.addCls(this.ghostCls):this.removeCls(this.ghostCls)},getGhost:function(){return this.ghost},_applyGhost:function(t){var e=t.state||this.state;t.ghost===undefined&&(t.ghost="primary"!==e)},_applyState:function(t){var e=t.cls;if(e)for(var i="",n=(e=e.split(" ")).length-1;0<=n;n--)if(i=e[n],/mini-btn-(?:primary|info|success|warning|danger)/.test(i)){t.state=this._semantic2state[i]||"default";break}},setState:function(t){return-1!==jQuery.inArray(t,this._stateList)?(this.removeCls(this._statePrefix+this.state),this.state=t,this.addCls(this._statePrefix+this.state)):window.console&&console.error&&console.error(t+"不是有效的state值"),this.state},getState:function(){return this.state},setSize:function(t){return-1!==jQuery.inArray(t,this._sizeList)?(this.removeCls(this._sizePrefix+this.size),this.size=t,this.addCls(this._sizePrefix+this.size)):window.console&&console.error&&console.error(t+"不是有效的size值"),this.size},doUpdate:function(){if(!1!==this._allowUpdate){var t=this.text,e=this.iconCls,i=this.iconStyle||"",n=this.iconPosition,s=this.plain,o=e||i||this.img,r=[];if(""===t?this.addCls(this._iconOnlyCls):(this.removeCls(this._iconOnlyCls),r.push('<span class="mini-button-text">'+t+"</span>")),s?this.addCls(this._plainCls):this.removeCls(this._plainCls),o){mini.hasClass(this.el,this._iconOnlyCls)||(this.__prevIconPos&&this.removeCls(this._iconPosCls[this.__prevIconPos]),this.addCls(this._iconPosCls[n]),this.__prevIconPos=n);var a="top"==n||"left"==n,l="";this.img&&(l+="background: url("+this.img+") center no-repeat;"),i&&(l+=i);var h='<i class="mini-button-icon '+e+'" '+l+"></i>";a?(r.unshift(h),r.unshift(this._loadingSvg)):(r.push(h),r.push(this._loadingSvg)),this.removeCls("mini-button-textOnly")}else this.addCls("mini-button-textOnly"),r.unshift(this._loadingSvg);this.allowCls&&r.push('<span class="mini-button-allow mini-icon '+this.allowCls+'"></span>'),this.el.innerHTML=r.join("")}},setIsLoading:mini.isIE8||mini.isIE9?function(t){this.isLoading=!!t,this.setEnabled(!this.isLoading)}:function(t){this.enabled&&(this.isLoading=!!t,this.isLoading?this.addCls("mini-btn-loading"):this.removeCls("mini-btn-loading"))},getIsLoading:function(){return this.isLoading},_enableTimer:undefined,_initEvents:function(){var e=this;mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"click",function(t){e.isLoading||(mini._lastClickedBtn={id:e.id,text:e.text},e.__OnClick(t),e.disableMultiClick&&e.enabled&&(e.setEnabled(!1),e._enableTimer=setTimeout(function(){e.setEnabled(!0)},1e3)),mini._lastClickedBtn=undefined)},this)},this)},setEnabled:function(t){this._enableTimer&&clearTimeout(this._enableTimer),mini.Button.superclass.setEnabled.call(this,t)},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["disableMultiClick","isloading","ghost"]),mini._ParseString(t,e,["state","size"]),e}}}),mini.addEpointExt("MenuButton",function(){var i=mini.MenuButton.prototype.setMenu;return{yOffset:2,setMenu:function n(t){var e=i.call(this,t);return this.menu&&this.menu.setyOffset&&this.menu.setyOffset(this.yOffset),e},disableMultiClick:!1}}),mini.addEpointExt("ButtonEdit",function(){return{autoClear:!0,errorTextEl:null,getErrorTextEl:function(){return this.errorTextEl||(this.errorTextEl=mini.append(this.el,'<span class="mini-errorText"></span>')),this.errorTextEl},_RemoveErrorText:function(){if(this.errorTextEl){var t=this.errorTextEl;jQuery(t).remove()}this.errorTextEl=null}}}),mini.addEpointExt("Calendar",function(){var t={__OnClick:function(t){var e=this.viewDate;if(0!=this.enabled){var i=t.target,n=mini.findParent(t.target,"mini-calendar-title");if(!mini.hasClass(i,"mini-button-disabled")){if(mini.findParent(i,"mini-calendar-monthNext"))e.setDate(1),e.setMonth(e.getMonth()+1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-yearNext"))e.setDate(1),e.setFullYear(e.getFullYear()+1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-monthPrev"))e.setDate(1),e.setMonth(e.getMonth()-1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-yearPrev"))e.setDate(1),e.setFullYear(e.getFullYear()-1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-tadayButton")){var s=!!mini.findParent(i,"yesterday"),o=new Date;if(s&&o.setDate(o.getDate()-1),this.setViewDate(o),this.setSelectedDate(o),this.currentTime){var r=new Date;this.setTime(r)}this._OnDateClick(o,"today")}else mini.findParent(i,"mini-calendar-clearButton")?(this.setSelectedDate(null),this.setTime(null),this._OnDateClick(null,"clear")):mini.findParent(i,"mini-calendar-okButton")?this._OnDateClick(null,"ok"):n&&this.showMenu();var a=mini.findParent(t.target,"mini-calendar-date");if(a&&!mini.hasClass(a,"mini-calendar-disabled")){var l=a.id.split("$"),h=parseInt(l[l.length-1]);if(-1==h)return;var d=new Date(h);this._OnDateClick(d)}}}},enbaleOkButton:function(t){this.showOkButton&&mini[t?"removeClass":"addClass"](this.okButtonEl,"mini-button-disabled")},_OnValueChanged:function(){this.showOkButton&&mini[this.getValue()?"removeClass":"addClass"](this.okButtonEl,"mini-button-disabled"),this.fire("valuechanged")},getShortWeek:function(t){return 6<t&&(t=7-t),this.daysShort[t]},getFirstDayOfWeek:function(){return this.firstDayOfWeek},setFirstDayOfWeek:function(t){"number"!=typeof t&&(t=window.parseInt(t,10)),6<t||t<0||(this.firstDayOfWeek=t,this.doUpdate())},getExtraAttrs:function(t){var e={};return mini._ParseInt(t,e,["firstDayOfWeek"]),e},width:"",height:""};return t}),mini.addEpointExt("CheckBoxList",function(){return{autoLoad:!1,setUrl:function(t){this.url=t,this.autoLoad&&this._doLoad({})},repeatLayout:"flow",errorTooltipPlacement:"topright",getErrorTextEl:function(){return this.errorTextEl||(this.errorTextEl=mini.append(this.cellEl,'<span class="mini-errorText"></span>')),this.errorTextEl},_RemoveErrorText:function(){if(this.errorTextEl){var t=this.errorTextEl;jQuery(t).remove()}this.errorTextEl=null}}}),mini.addEpointExt("ComboBox",function(){return{showClose:window.EpFrameSysParams&&EpFrameSysParams.ui_combobox_showclose||!1,autoLoad:!0,__input:function(t){document.activeElement==this._textEl&&t.which&&this._tryQuery()},_createPopup:function(){mini.ComboBox.superclass._createPopup.call(this),this.multiSelect&&this._createLabel(),this._listbox=new mini.ListBox,this.listbox=this._listbox,this._listbox.delimiter=this.delimiter,this._listbox.setBorderStyle("border:0;"),this._listbox.setStyle("width:100%;height:auto;"),this._listbox.render(this.popup._contentEl),this._listbox.on("beforeitemclick",this.__OnBeforeItemClick,this),this._listbox.on("itemclick",this.__OnItemClick,this),this._listbox.on("drawcell",this.__OnItemDrawCell,this);var e=this;this._listbox.on("beforeload",function(t){window.DtoUtils&&window.DtoUtils.processBeforeLoad(t),e.fire("beforeload",t),t.data=Util.addReplayAttackData(t.data,t.url)},this),this._listbox.on("preload",function(t){e.fire("preload",t)},this),this._listbox.on("load",function(t){e.data=t.data,e.fire("load",t)},this),this._listbox.on("loaderror",function(t){e.fire("loaderror",t)},this)},_createLabel:function(){if(!this._$labelwrap){var t=document.createElement("div");t.className="mini-combobox-labelwrap";var e=document.createElement("ul");e.className="mini-combobox-labellist clearfix",t.appendChild(e),mini.after(this._textEl,t),this._$labelwrap=jQuery(t),this._$labellist=jQuery(e),mini.on(e,"wheel",this.__OnLabelScroll,this),mini.on(e,"click",this.__OnLabelClick,this),mini.on(window,"resize",this._layoutLabel,this),this._renderLabel()}},_destroyLabel:function(){this._$labelwrap&&(mini.un(this._$labellist,"wheel",this.__OnLabelScroll,this),mini.un(this._$labellist,"click",this.__OnLabelClick,this),mini.un(window,"resize",this._layoutLabel,this),this._$labelwrap.remove(),this._$labelwrap=null,this._$labellist=null)},_afterApply:function(){this._doInputLayout(!1)},setUrl:function(t,e){this.getPopup(),this.autoLoad||e?(this._listbox.setUrl(t),this.url=this._listbox.url,this.data=this._listbox.data,this.doDataChange()):(this.url=t,this.isLoaded=!1)},load:function(t){"string"==typeof(t=t||this.url)?this.setUrl(t,!0):this.setData(t)},setAutoLoad:function(t){this.autoLoad=!!t},getAutoLoad:function(){return this.autoLoad},showPopup:function(){0==this.isLoaded&&this.load();var t={cancel:!1};if(this.fire("beforeshowpopup",t),this._firebeforeshowpopup=!1,1!=t.cancel){this._listbox.setHeight("auto"),mini.ComboBox.superclass.showPopup.call(this);var e=this.popup.el.style.height;""==e||"auto"==e?this._listbox.setHeight("auto"):this._listbox.setHeight("100%");if(!this.multiSelect){var i=jQuery("table .mini-listbox-checkbox",this._listbox.el),n=i.css("display");i.css("display","table-cell"),i.css("display",n)}this._listbox.setValueInCheckOrder(this.valueInCheckOrder),this._listbox.setValue(this.value),this.autoFocusItem&&(""==this.value||mini.isNull(this.value))&&this._listbox._focusItem(0)}},setValue:function(t){mini.isNull(t)&&(t="");var e=this._listbox.getValueAndText(t),i=this._listbox.findItems(t),n=e[0],s=e[1];""!==s&&!mini.isNull(s)||(s=t),this.valueFromSelect&&(""===n||mini.isNull(n))?(this.isLoaded||(this._temporaryValue=t),t=s=""):this._temporaryValue="",this.value=t,this._valueEl.value=this.value,this.setText(s),this.multiLabel&&this._renderLabel(i)},setText:function(t){null!==t&&t!==undefined||(t=""),t=mini.htmlDecode(t);this.text;this.text=t,this._textEl.value=t,this._doEmpty()},_renderLabel:function(t){if(this.multiSelect){var e,i=this;e=(t=t||this._listbox.getSelecteds()).map(function(t){return{value:i._listbox.getItemValue(t),text:i._listbox.getItemText(t)}}),this._$labellist.html(Mustache.render('{{#.}}<li class="mini-combobox-label" data-value="{{value}}">{{text}}<span class="mini-combobox-label-close"></span></li>{{/.}}',e)),this._layoutLabel()}},_layoutLabel:function(){var t,e,i=this._$labellist.children(),n=this._$labelwrap.width(),s=0;i.each(function(t,e){s+=jQuery(e).outerWidth(!0)}),t=s<=n?0:(e=n-s,t=this._$labellist.data("x")||0,Math.max(e,Math.min(0,t))),this._$labellist.data({x:t,w:s}),this._labelListStyle()},_labelListStyle:function(){if(!this.timer){var o=this;this.timer=setTimeout(function(){var t=o._$labellist.data(),e=t.x,i=t.w,n=(e||0)+"px",s=i?Math.ceil(i)+"px":"auto";o._$labellist.attr("style","transform: translateX("+n+"); width: "+s),o.timer=null},33)}},__OnLabelScroll:function(t){var e,i,n=t.originalEvent.deltaY,s=this._$labelwrap.width(),o=this._$labellist.width(),r=Math.min(s/2,100);o<=s||(e=s-o,i=this._$labellist.data("x")||0,0<n?i-=r:i+=r,i=Math.max(e,Math.min(0,i)),this._$labellist.data("x",i),this._labelListStyle())},__OnLabelClick:function(t){var e,i=jQuery(t.target);i.is(".mini-combobox-label-close")&&(t.stopPropagation(),e=i.parent().data("value"),this.deselect(e))},doDataChange:function(){var t=this._listbox.getValueAndText(this.value||this._temporaryValue),e=t[0],i=t[1];""!==e||this.clearOnLoad||(e=this.value,i=this.text,this.value=null),this.text=this._textEl.value=i,this.setValue(e),this.isLoaded=!0},__OnInputTextChanged:function(t){if(this.isShowPopup())this._textChanged=!0;else if(this._textChanged=!1,this._oldValue=this.getValue(),!1===this.multiSelect){for(var e=this._textEl.value,i=this.getData(),n=null,s=0,o=i.length;s<o;s++){var r=i[s],a=this._listbox.getItemText(r),l=r[this.valueField];if(a==e&&(mini.isNull(this.value)||""===this.value||this.value==l)){n=r;break}}if(n){this._listbox.setValue(n?n[this.valueField]:"");var h=this._listbox.getValue(),d=this._listbox.getValueAndText(h),u=this.getValue();this.setValue(h),this.setText(d[1])}else this.valueFromSelect?(this.setValue(""),this.setText("")):(this.setValue(e),this.setText(e));if(u!=this.getValue()){this._OnValueChanged()}}},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["autoLoad"]),e}}}),mini.addEpointExt("DataGrid",function(){function i(t){if(!t)throw new Error("options is required");var e=t.grid;if(e+""===e&&(e=mini.get(e)),!e||!mini.isControl(e))throw new Error("必须配置表格");this.grid=e,this._events={},this.options=m.extend({},i.defaultOptions,t),~["server","client"].indexOf(this.options.filterMode)||(window.console&&console.error(this._logPrefix,'[filterMode] must be one of "server" or "client"'),this.options.filterMode="client"),this.onFilter=this.options.onFilter,delete this.options.onFilter,this.init()}var m,t;!function(a){var t=mini.GridView.prototype._createPagers;mini.overwrite(mini.DataGrid,{pagerType:"pagination",_createPagers:function(){t.apply(this,arguments),"pager"!==this.pagerType&&this.setPagerType(this.pagerType)}});var n=mini.FrozenGridView.prototype._createRowsHTML;mini.FrozenGridView.prototype._createRowsHTML=function(){var t=n.apply(this,arguments),e=parseInt(a(this.el).find(".mini-grid-rows-view").height(),10);if(e&&200<e){e=.3*e>>0;var i=a(t);return i.find(".mini-grid-emptyText").css({paddingTop:e+80,backgroundPosition:"center "+e+"px"}),i[0].outerHTML}return t};var i=mini.DataGrid.prototype.setShowVGridLines,s=mini.DataGrid.prototype.setShowHGridLines;function o(t){var e=a(t.sender.el).find(".datagrid-columns-width-tr");a.each(e,function(t,e){var i=a(e),n=null,s=[].slice.call(i.children()).reduce(function(t,e){return/datagrid-autowidth-column/.test(e.className)?(n=e,t):t+=e.getBoundingClientRect().width},0);if(n){var o=i.width()-s,r=parseInt(n.getAttribute("data-min-width"),10)||100;n.style.width=r<o?"100%":r+"px"}})}function r(t){if(!0===this.showCellTip){var e=this._contentEl;t.record&&(e=this.getRowEl(t.record),this.isFrozen()&&(e=[e,this.getRowEl(t.record,1)])),"treegrid"!==this.type&&"pagertree"!=this.type||a(e).find(".mini-tree-nodetext").each(function(t,e){e.title=a.trim(e.textContent||e.innerText)}),a(e).find(".mini-grid-cell-inner").add(a(this._columnsEl).find(".mini-grid-headerCell-inner")).each(function(t,e){a(e).parent().hasClass("mini-tree-treecell")||(e.title=a.trim(e.textContent||e.innerText))}),a(this._columnsEl).find(".mini-grid-sortIcon:not([title]),.mini-grid-allowsort:not([title])").each(function(t,e){e.title=epoint_local.click_to_sort_text})}}mini.DataGrid.prototype.setShowVGridLines=function(t){var e=i.apply(this,arguments);return t?a(this.el).addClass("mini-grid-showVGridLines"):a(this.el).removeClass("mini-grid-showVGridLines"),e},mini.DataGrid.prototype.setShowHGridLines=function(t){var e=s.apply(this,arguments);return t?a(this.el).addClass("mini-grid-showHGridLines"):a(this.el).removeClass("mini-grid-showHGridLines"),e},mini._Grid_CellToolTip.prototype.destroy=function(){mini.un(this.owner.el,"mousemove",this.__OnGridMouseMove,this)},mini.DataGrid.prototype._afterApply=function(){if(function n(){this.showHGridLines?a(this.el).addClass("mini-grid-showHGridLines"):a(this.el).removeClass("mini-grid-showHGridLines"),this.showVGridLines?a(this.el).addClass("mini-grid-showVGridLines"):a(this.el).removeClass("mini-grid-showVGridLines")}.apply(this,arguments),this._CellToolTip&&this._CellToolTip.destroy){this._CellToolTip.destroy();var e=this;this.on("update",r,this),this.on("updaterow",r,this),this.on("cellbeginedit",r,this),this.on("expand",function(t){setTimeout(function(){r.call(e,t)},500)}),this.on("collapse",function(t){setTimeout(function(){r.call(e,t)},500)})}this.on("update",o,this);var t,i=this;a(window).on("resize",function(){clearTimeout(t),t=setTimeout(function(){o({sender:i})},100)})},a(function(){mini.grid_error_toolTip=new mini.ToolTip,mini.grid_error_toolTip.set({selector:".mini-grid-cell-error",placement:"top",trigger:"hover",theme:"error",autoHide:!0,defaultTheme:"error",onbeforeopen:function(t){var e=t.element.getAttribute("id"),i=mini.getAndCreate(a(t.element).closest(".mini-grid")[0]);if(e&&i){e=e.replace("$cell$","$");var n=i._cellMapErrors&&i._cellMapErrors[e];n&&(t.content=n.errorText,t.cancel=!1)}}})})}(window.jQuery),window,m=window.jQuery,i.defaultOptions={keepFilter:!0,columns:[],filterMode:"client",onFilter:function(){}},m.extend(i.prototype,{on:mini.Control.prototype.on,fire:mini.Control.prototype.fire,un:mini.Control.prototype.un,findListener:mini.Control.prototype.findListener,_logPrefix:"[HeaderFilter]",__genderId:(t=0,function(){return"HeaderFilter-"+t++}),init:function(){if(this.grid.__headerFilter)try{this.grid.__headerFilter.destroy()}catch(t){}this._id=this.__genderId(),this._columnControls=[],this.setColumns(this.options.columns),this.grid.on("headercellclick",this.__handleFilterClick,this),this.grid.on("columnschanged",this.__handleGridColumnChanged,this),this.grid.on("update",this.__handleGridUpdate,this),this.grid._dataSource.on("loaddata",this.__handleNewData,this),(this.grid.__headerFilter=this).fire("init")},destroy:function(){this.clearFilter(),this.__clearOldColumns(),m(this.grid.el).find(".mini-datagrid-headerfilter-trigger").remove(),this.grid.un("headercellclick",this.__handleFilterClick,this),this.grid.un("columnschanged",this.__handleGridColumnChanged,this),this.grid.un("update",this.__restoreFilterStatus,this),this.grid._dataSource.un("loaddata",this.__handleNewData,this),this.grid.__headerFilter=null,delete this.grid.__headerFilter},__handleNewData:function(){if(!this.options.keepFilter)return this.clearFilter(),this;var n=!1,s=this;return m.each(this.filterColumns,function(t,e){var i=s.filterColumnCfgMap[e.name];if(i.__filterChecked&&i.__filterChecked.length)return!(n=!0)}),n&&this.__doFilter(),this},__handleGridColumnChanged:function(){this.__gridColumnChanged=!0},__doGridColumnChanged:function(){var e={},i=this.filterColumnCfgMap;Object.keys(i).forEach(function(t){e[t]=i[t].__filterChecked}),this.__clearOldColumns(),m.map(this._columnControls,function(t){t.destroy&&t.destroy(!0)}),this._columnControls=[],this.setColumns(this.options.columns);var n=this.filterColumnCfgMap;Object.keys(n).forEach(function(t){e[t]&&(n[t].__filterChecked=e[t])}),n=i=null},__handleGridUpdate:function(t){this.__gridColumnChanged!==undefined&&this.__gridColumnChanged&&(this.__doGridColumnChanged(t),this.__gridColumnChanged=undefined),this.__restoreFilterStatus(t)},__handleFilterClick:function(t){var e=t.htmlEvent,i=m(e.target);if(i.hasClass("mini-datagrid-headerfilter-trigger")){e.stopPropagation();var n=t.column;i.hasClass("show")?(i.removeClass("show"),this.hideColumnFilter(n)):(i.addClass("show"),this.showColumnFilter(n,e.target))}},__getHeaderElByTrigger:function(t){return m(t).closest(".mini-grid-headerCell")[0]},setColumns:function(t){var e=m.isArray(t)?t:[],r=[],a={},l={},h=this.grid,d=this,u=this.options.filterMode;return m.each(e,function(t,e){if(e&&e.name&&("client"!=u||"function"==typeof e.filterMethod)){var i=h.getColumn(e.name);if(i){if(/mini-datagrid-headerfilter-trigger/.test(i.header)||(i.header+='<span class="mini-datagrid-headerfilter-trigger action-icon icon-filter" title="'+epoint_local.click_to_filter_text+'">️</span>'),i.inited){var n=h.getHeaderCellEl(i),s=m(n).find(".mini-grid-headerCell-inner"),o=m('<span class="mini-datagrid-headerfilter-trigger action-icon icon-filter" title="'+epoint_local.click_to_filter_text+'">️</span>');s.find("> .mini-datagrid-headerfilter-trigger").length||(s.children().length?o.insertBefore(s.children().eq(0)):o.appendTo(s))}e.__filterChecked=[],r.push(i),a[i.name]=i,l[i.name]=e}else window.console&&console.error(d._logPrefix,"can't find column that named "+e.name)}else window.console&&console.error(d._logPrefix,e," is not a valid filter column")}),this.filterColumns=r,this.filterColumnMap=a,this.filterColumnCfgMap=l,this},__clearOldColumns:function(){m.map(this.filterColumnCfgMap,function(t){t.__filterChecked=[],t.popup&&(t.popup.destroy&&t.popup.destroy(),t.popup=null)}),this.filterColumns=[],this.filterColumnMap={},this.filterColumnCfgMap={}},showColumnFilter:function(t,e){var i=this.__renderColumnFilter(t),n=e||this.grid.getHeaderCellEl(t);i.popupEl=n,[].some&&mini.getChildControls(i).some(function(t){if("panel"==t.type)return t.setMaxHeight(window.innerHeight-120),!0}),i.showAtEl(n)},hideColumnFilter:function(t){var e=this.filterColumnCfgMap[t.name];e.popup&&e.popup.hide()},__restoreFilterStatus:function(){var n=this;return m.map(this.filterColumns,function(t){var e=n.filterColumnCfgMap[t.name],i=m(n.grid.getHeaderCellEl(t)).find(".mini-datagrid-headerfilter-trigger");e.__filterChecked&&e.__filterChecked.length?i.addClass("active"):i.removeClass("active")}),this},__renderColumnFilter:function(t){var e=this.filterColumnCfgMap[t.name];return this.__createPopupPanel(e,t)},__createPopupPanel:function(e,i){var n=this,t=e.filterMultiple?e.filters:[{id:"",text:epoint_local.all_text}].concat(e.filters);if(e.popup)return e.popup;var s=Math.min(12,Math.max.apply(Math,m.map(t,function(t){return(t.text||t.id).length}))),o=e.listBox=new mini.ListBox;this._columnControls.push(o),o.set({showCheckBox:e.filterMultiple,multiSelect:e.filterMultiple,data:t}),m(o._borderEl).css({borderWidth:0});var r=mini.getFontSizeRatio()||1,a=Math.ceil(2*(32*r+28*r+2)+16*r+20);a<160&&(a=160);var l=e.popup=new mini.Popup;this._columnControls.push(l),l.addCls("mini-datagrid-headerfilter-popup");var h=new mini.Panel;this._columnControls.push(h);var d=Math.max(20*s,i.pxWidth);if(e.filterMultiple&&d<a&&(d=a),h.set({maxWidth:400,width:d,showToolbar:!1,showFooter:e.filterMultiple,showHeader:!1,maxHeight:window.innerHeight-120}),e.filterMultiple&&h.set({minWidth:a}),l.on("Open",function(){var t=e.__filterChecked.join(",");o.setValue(t),e.filterMultiple||t||o.setSelected(o.data[0])}),l.on("close",function(){n.clearFilterState(i,"show")}),e.popup.render(document.body),h.render(e.popup.el),o.render(h._bodyEl),e.filterMultiple){var u=new mini.Button,c=new mini.Button;this._columnControls.push(u,c),u.set({text:epoint_local.search_text,disableMultiClick:!1,onclick:function(){n.doFilter(o.getValue(),i),l.hide()}}),u.addCls("mini-btn-primary"),c.set({text:epoint_local.reset_text,disableMultiClick:!1,onclick:function(){o.setValue(""),n.clearFilter(i),l.hide()}}),u.render(h._footerEl),c.render(h._footerEl),m(h._footerEl).css("text-align","center")}else o.on("itemclick",function(t){""===t.item.id?n.clearFilter(i):n.doFilter(o.getValue(),i),l.hide()});return e.popup},__buildFilterParams:function(){var t={},e={sender:this,grid:this.grid,condition:t};for(var i in this.filterColumnCfgMap)if(Object.prototype.hasOwnProperty.call(this.filterColumnCfgMap,i)){var n=this.filterColumnCfgMap[i];n.__filterChecked&&n.__filterChecked.length&&(t[i]=n.__filterChecked.join(","))}return e},doFilter:function(t,e){var i=this.filterColumnCfgMap[e.name];i.__filterChecked=m.isArray(t)?t:t.split(",");var n=this.grid.getHeaderCellEl(e),s=m(n).find(".mini-datagrid-headerfilter-trigger");i.__filterChecked.length?s.addClass("active"):s.removeClass("active"),this.__doFilter();var o=this.__buildFilterParams();return this.onFilter(o),this.fire("filter",o),this},__doFilter:function(){if("client"!==this.options.filterMode)return this;var t=this.filterColumns,l=this;this.grid.filter(function(a){return t.every(function(t){if(!t.visible)return!0;var e=l.filterColumnCfgMap[t.name],i=e.filterMethod,n=e.__filterChecked;if(!n||!n.length)return!0;for(var s=!1,o=0,r=n.length;o<r&&!(s=i.apply(l,[n[o],a,t,l.grid,l]));o++);return s})})},clearFilter:function(t){this.clearFilterState(t);var i=this;if(t)return this.doFilter([],t),this;m.each(this.filterColumns,function(t,e){i.filterColumnCfgMap[e.name].__filterChecked=[]}),this.grid.clearFilter();var e=this.__buildFilterParams();return this.onFilter(e),this.fire("filter",e),this},clearFilterState:function(t,e){var i;i=t?m.isArray(t)?t:[t]:this.filterColumns;var n=this;return m.map(i,function(t){n.__clearFilterState(t,e)}),this},__clearFilterState:function(t,e){var i=this.filterColumnCfgMap[t.name];i.popup&&i.popup.isPopup&&i.popup.hide();var n=this.grid.getHeaderCellEl(t);return m(n).find(".mini-datagrid-headerfilter-trigger").removeClass(e||"show active"),this}}),mini.DataGrid.HeaderFilter=i,function(t,h){function s(t){var e=h.extend({},s.defaultOptions,t),i=(this.options=e).grid;if(i+""===i&&(i=mini.get(i)),!i)throw new Error("必须配置表格！");this.grid=i;var n=e.autoCreate?this.__autoCreateBtn():h(e.trigger)[0];n||window.console&&console.warn&&console.warn("无法获取触发按钮, 只能通过api显示隐藏"),this.triggerEl=n,this._saveKey="GRID_COLUMN_VISIBLE-"+this.grid._id+"-"+location.pathname,this._id=this.__genderId(),this.__createControls=[],this._originColumns=[],this._allColumns=[],this.checkedIndexArr=[],this.data=[],this.init()}var e;s.defaultOptions={trigger:"",grid:"",autoCreate:!0,showButton:!0,disabledColumns:[{type:"indexcolumn"},{type:"checkcolumn"},{type:"checkcolumn"}]},h.extend(s.prototype,{__genderId:(e=0,function(){return"GridColumnsHide-"+e++}),popupCls:"mini-button-popup",__autoCreateBtn:function(){var t=h(".fui-toolbar").eq(0);if(!t.length)return!1;var e=new mini.Button;e.set({iconCls:"icon-gear",disableMultiClick:!1}),e.addCls("r"),e.render(t[0]);var i=h(e.el),n=t.find("> .r");return n.length?i.insertBefore(n):i.appendTo(t),e.el},init:function(){this._allColumns=this.grid.getColumns(),this.__rememberOrigin(),this.restoreLocal(undefined,!0),this.__syncCheckColumns();var t=this,e=h(this.triggerEl);e.on("click."+this._id,function(){e.hasClass(t.popupCls)?t.hidePanel():(e.addClass(t.popupCls),t.showPanel())})},destroy:function(){h(this.triggerEl).off("click."+this._id),h.each(this.__createControls,function(t,e){e.destroy&&e.destroy(!0)})},__rememberOrigin:function(){var i=[];h.each(this.grid.getColumns(),function(t,e){i.push({visible:e.visible})}),this._originColumns=i},__restoreOrigin:function(){var i=this.grid,t=this._originColumns;h.each(t,function(t,e){i.updateColumn(t,e)}),this.setData([]),this.__syncCheckColumns()},__syncCheckColumns:function(){var i=[];h.each(this._allColumns,function(t,e){e.visible&&i.push(t)}),this.checkedIndexArr=i},getLocalData:function(){var t=localStorage.getItem(this._saveKey);if(!t)return[];var e=JSON.parse(t);return h.isArray(e)?e:[]},getData:function(){if(!this._listBox)return[];var n=this.checkedIndexArr,s=[];return h.each(this._allColumns,function(t,e){var i={visible:-1!==h.inArray(t,n)};e.field&&(i.field=e.field),e.type&&(i.type=e.type),s.push(i)}),s},setData:function(t,e){if(this.data=h.isArray(t)?t:[],e){var i=[];h.each(this.data,function(t,e){e.visible&&i.push(t)}),this.checkedIndexArr=i}localStorage.setItem(this._saveKey,JSON.stringify(t)),this.restoreLocal(t)},__checkColumnsChanged:function(t,e){if(!h.isArray(t)||!h.isArray(e)||t.length!==e.length)return!0;for(var i,n,s=!1,o=0,r=t.length;o<r;o++)if(i=t[o],n=e[o],i.field!=n.field||i.type!=n.type){s=!0;break}return s},restoreLocal:function(t,e){var i=this.grid,n=this.data=t||this.getLocalData(),s=this._allColumns;n&&n.length&&(e&&this.__checkColumnsChanged(n,s)?this.setData([]):h.map(n,function(t,e){i.updateColumn(e,{visible:t.visible})}))},__handleSave:function(){var t=h.map(this._listBox.getValue().split(","),function(t){return parseInt(t,10)});this.checkedIndexArr=t;var e=this.getData();this.setData(e,!0)},getColumnListFromGrid:function(){var n=this;return h.map(this._allColumns,function(t,e){return{text:function i(t){var e=t.header;if(e&&"string"==typeof e)return r.innerHTML=e,h.trim(r.textContent||r.innerText);if(t.type)return o[t.type]||"";return""}(t),id:e,enabled:n.__getColumnEnable(t,e)}})},__getColumnEnable:function(n,o){return!(n&&this.options.disabledColumns&&this.options.disabledColumns.length)||!this.options.disabledColumns.some(function(t){return function s(t){var e=Object.prototype.hasOwnProperty,i=[];for(var n in t)e.call(t,n)&&i.push([n,t[n]]);return i}(t).every(function(t){var e=t[0],i=t[1];return"index"==e?i==o:n[e]==i})})},__createPopup:function(){if(this.popup)return this.popup;var t=this,e=this.getColumnListFromGrid(),i=new mini.ListBox;(this._listBox=i).set({showCheckBox:!0,multiSelect:!0,data:e,value:this.checkedIndexArr.join(",")}),h(i._borderEl).css({borderWidth:0}),this.__createControls.push(i);var n=new mini.Popup;this.__createControls.push(n),n.set({xAlign:"right"}),n.__parent=this,n.el.setAttribute("attached","true"),n.on("close",function(){h(t.triggerEl).removeClass(t.popupCls)});var s=Math.min(6,Math.max.apply(Math,h.map(e,function(t){return t.text.length}))),o=Math.max(this.options.showButton?180:120,14*s),r=new mini.Panel;if(this.__createControls.push(r),r.set({showToolbar:!1,showFooter:this.options.showButton,showHeader:!1,minWidth:200,maxWidth:300,width:o}),i.render(r._bodyEl),r.render(n.el),this.options.showButton){var a=new mini.Button,l=new mini.Button;this.__createControls.push(a,l),a.set({text:epoint_local.save_text,disableMultiClick:!1,onclick:function(){t.__handleSave(),n.hide()}}),a.addCls("mini-btn-primary"),l.set({text:epoint_local.reset_text,disableMultiClick:!1,onclick:function(){t.__restoreOrigin(),n.hide()}}),a.render(r._footerEl),l.render(r._footerEl)}else i.on("itemclick",function(){t.__handleSave()},this);this.popup=n},showPanel:function(){this.popup||(this.__createPopup(),this.popup.popupEl=this.triggerEl),this._listBox.setValue(this.checkedIndexArr.join(",")),this.popup.showAtEl(this.triggerEl)},hidePanel:function(){this.popup&&this.popup.hide()},showAtEl:function(){this.popup||this.__createPopup(),this.popup.showAtEl.apply(this.popup,arguments)},showAtPos:function(){this.popup||this.__createPopup(),this.popup.showAtPos.apply(this.popup,arguments)},hide:function(){this.popup&&this.popup.hide()}}),t.mini.DataGrid.ColumnsHide=s;var o={indexcolumn:epoint_local.order_text,checkcolumn:epoint_local.select_text,actioncolumn:epoint_local.operate_text},r=document.createElement("div")}(window,window.jQuery),mini._Grid_Sorter.prototype.__OnGridHeaderCellClick=function(t){var e=this.owner,i=t.htmlEvent.type;if(("dblclick"!=i||e.sortDblClick)&&("click"!=i||!e.sortDblClick)&&/mini-grid-headerCell-inner|mini-grid-sortIcon|mini-grid-allowsort/.test(t.htmlEvent.target.className)&&e.allowSortColumn&&0==e.isEditing()){var n=t.column;if(!n.columns||0==n.columns.length){var s=n.sortField||n.field;if(s&&!1!==n.allowSort)if(e.allowCancelSort&&"desc"==e.getSortOrder())e.clearSort();else{var o="asc";e.getSortField()==s&&(o="asc"==e.getSortOrder()?"desc":"asc"),e.sortBy(s,o)}}}};var n=mini.DataGrid.prototype.beginEditRow,e=mini.DataGrid.prototype.cancelEditRow;return{allowAlternating:mini.getCtrDefaultBySysParams("gridAllowAlternating",!1),showHGridLines:mini.getCtrDefaultBySysParams("gridShowHGridLines",!0),showVGridLines:mini.getCtrDefaultBySysParams("gridShowVGridLines",!1),showSortIcon:mini.getCtrDefaultBySysParams("gridShowSortIcon",!0),allowResize:mini.getCtrDefaultBySysParams("gridAllowResize",!1),showEmptyText:mini.getCtrDefaultBySysParams("gridShowEmptyText",!0),emptyText:mini.getCtrDefaultBySysParams("gridEmptyText","暂无数据"),holdSelectedStatus:!1,allowUnselect:window.EpFrameSysParams&&EpFrameSysParams.grid_allow_unselect||!1,selectMaps:{},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.url;delete t.url;var n=t.data;delete t.data;var s=t.columns;delete t.columns;var o=t.sizeList;delete t.sizeList;var r=t.defaultColumnWidth;return delete t.defaultColumnWidth,r&&this.setDefaultColumnWidth(r),mini.isNull(s)||this.setColumns(s),mini.DataGrid.superclass.set.call(this,t),mini.isNull(n)||this.setData(n),mini.isNull(i)||this.setUrl(i),mini.isNull(e)||this.setValue(e),mini.isNull(o)||this.setSizeList(o),this},beginEditRow:function(t){var e=n.apply(this,arguments);return this._editingCell=[t,this.getColumn(0)],e},cancelEditRow:function(){var t=e.apply(this,arguments);return this._editingCell=null,t},getColumnData:function(t){for(var e=[],i=this.getData(),n=0,s=i.length;n<s;n++)e.push(i[n][t]);return e},_OnCellBeginEdit:function(t,e,i,n){var s,o=mini._getMap(e.field,t),r={sender:this,rowIndex:this.indexOf(t),row:t,record:t,column:e,field:e.field,editor:i,value:o,cancel:!1};if(this.fire("cellbeginedit",r),!mini.isNull(e.defaultValue)&&(mini.isNull(r.value)||""===r.value)){var a=e.defaultValue;s=mini.clone({d:a}),r.value=s.d}if(i=r.editor,o=r.value,r.cancel)return!1;
//if (!editor) return false;
//column.editor = editor;   //!!!不能加
if(!i&&"inline"!=e.editMode)return!1;if(!0===e.readOnly)return!1;if(!1===n)return!0;
//        if (column.editMode != "inline") {
if("inline"!=e.editMode){if(mini.isNull(o)&&(o=""),i.setValue&&i.setValue(mini.htmlUnescape(o)),i.ownerRowID=t._uid,e.displayField&&i.setText){var l=mini._getMap(e.displayField,t);mini.isNull(e.defaultText)||!mini.isNull(l)&&""!==l||(l=(s=mini.clone({d:e.defaultText})).d),i.setText(mini.htmlUnescape(l))}this.allowCellEdit&&(this._editingControl=r.editor)}return!0},_OnCellCommitEdit:function(t,e,i,n){var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:n||this.getCellEditor(e),value:mini.isNull(i)?"":i,text:"",cancel:!1};if(s.editor&&s.editor.getValue){try{s.editor.blur()}catch(ex){}s.value=s.editor.getValue()}s.editor&&s.editor.getText&&(s.text=s.editor.getText());var o=mini._getMap(e.field,t),r=s.value;if(s.oldValue=o,mini.isEquals(o,r))return s;if(this.fire("cellcommitedit",s),0==s.cancel&&(s.value=mini.htmlEscape(s.value),s.text=mini.htmlEscape(s.text),this.allowCellEdit)){var a={};a[e.field]=s.value,e.displayField&&(a[e.displayField]=s.text),this.updateRow(t,a)}return s},_initData:function(){this.data=this._dataSource.getSource(),this.pageIndex=this.getPageIndex(),this.pageSize=this.getPageSize(),this.totalCount=this.getTotalCount(),this.totalPage=this.getTotalPage(),this.sortField=this.getSortField(),this.sortOrder=this.getSortOrder(),this.url=this.getUrl(),0<this.totalPage&&this.pageIndex>this.totalPage-1&&this.setPageIndex(this.totalPage-1),this._mergedCellMaps={},this._mergedCells={},this._cellErrors=[],this._cellMapErrors={},this.isGrouping()&&(this.groupBy(this._groupField,this._groupDir),this.collapseGroupOnLoad&&this.collapseGroups())},_setEditorBox:function(t,e){if(t.setHeight&&"textarea"==t.type){var i=e.height-2;t.minHeight&&i<t.minHeight&&(i=t.minHeight),t.setHeight(i)}if(t.setWidth){var n=e.width-12;t.minWidth&&n<t.minWidth&&(n=t.minWidth),t.setWidth(n<20?20:n)}var s=e;mini.setXY(this._editWrap,s.x+1,s.y+1),mini.setWidth(this._editWrap,s.width-2),mini.setHeight(this._editWrap,s.height-2);var o=(s.height-2-jQuery(t.el).outerHeight())/2;0<=o?o+="px":o="",this._editWrap.style.paddingTop=o;var r=document.body.scrollWidth;s.x>r&&mini.setX(this._editWrap,-1e3)},_OnDrawCell:function(t,e,i,n){var s=mini.DataGrid.superclass._OnDrawCell.apply(this,arguments);return!e.emptyText||null!==s.cellHtml&&s.cellHtml!==undefined&&""!==s.cellHtml&&"&nbsp;"!=s.cellHtml||(s.cellHtml=e.emptyText),s},_OnCellShowingEdit:function(t,e){if(!this._editingControl)return!1;var i=this.getCellBox(t,e);if(i){var n=document.body.scrollWidth;i.right>n&&(i.width=n-i.left,i.width<10&&(i.width=10),i.right=i.left+i.width)}var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,cellBox:i,editor:this._editingControl};this.fire("cellshowingedit",s);var o=s.editor;if(o&&o.setIsValid&&o.setIsValid(!0),i){this._getEditWrap(o);this._editWrap.style.zIndex=mini.getMaxZIndex(),this._setEditorBox(o,i),mini.on(document,"mousedown",this.__OnBodyMouseDown,this),e.autoShowPopup&&o.showPopup&&o.showPopup()}o&&(this.navEditMode&&(o.keyNavEnabled=!(!1!==e.navUpdown)),o.setValue(mini.htmlUnescape(t[e.field])),o._doInputLayout&&o._doInputLayout())},focus:function(){},_tryUpdateScroll:function(){if(this._canVirtualUpdate()||this.isFrozen())if(this._scrollPaging){this.reload(null,null,function(t){})}else{new Date;var t=this._rowsViewEl.scrollLeft;this._doRemoveRowContent(),this.doUpdateRows(),this.deferLayout(50),this._syncScrollOffset(t)}},refreshRow:function(t,e){if("object"!=typeof(t=t||this.getSelected())&&(t=this.getRow(t)),e=e||{},t){var r=t[this.idField];e.refreshRowGuid=r;var a=this;this._dataSource._doLoadAjax(e,"","","",function(t){for(var e,i=t.data||t,n=a.getRow(r),s=0,o=i.length;s<o;s++)if(i[s][a.idField]===r){e=i[s];break}e?a.updateRow(n,e):console.warn("DataGrid 控件的 refreshRow 方法返回数据中没有新数据！"),a.unmask()})}else console.warn("DataGrid 控件的 refreshRow 方法必须传 row 参数！")},setHoldSelectedStatus:function(t){if(this.holdSelectedStatus=t,this.holdSelectedStatus&&!this.isInitHold){var i=this;this.on("load",function(t){if(this.multiSelect)for(var e in i.selectMaps)i.select(i.selectMaps[e])}),this.isInitHold=!0}},__OnSelectionChanged:function(t){if(!1!==t.fireEvent&&(t.select?this.fire("rowselect",t):this.fire("rowdeselect",t)),this.holdSelectedStatus){var e=t._records,i=0,n=e.length;if(t.select)for(;i<n;i++)this.selectMaps[e[i][this.idField]]=e[i];else for(;i<n;i++)this.selectMaps[e[i][this.idField]]=undefined,delete this.selectMaps[e[i][this.idField]]}var s=this;this._selectionTimer&&(clearTimeout(this._selectionTimer),this._selectionTimer=null),this._selectionTimer=setTimeout(function(){s._selectionTimer=null,!1!==t.fireEvent&&s.fire("SelectionChanged",t),s.fire("_selectchange",t)},1),this._doRowSelect(t._records,t.select)},clearSelectedStatus:function(){this.holdSelectedStatus&&(this.selectMaps={}),this.clearSelect()},getAllSelecteds:function(){var t=[];if(this.holdSelectedStatus&&this.multiSelect)for(var e in this.selectMaps)t.push(this.selectMaps[e]);else t=this.getSelecteds();return t},getSelectedIds:function(){for(var t=this.getSelecteds(),e=[],i=0,n=t.length;i<n;i++){var s=t[i];e.push(s[this.idField])}return e},deleteRows:function(t){"string"==typeof t&&(t={url:t});var e=t.url,i=t.notSelectedTip||epoint_local.DataGrid.notSelectedTip,n=t.confirmTip||epoint_local.DataGrid.confirmDeleteTip,s=t.confirmTitle||epoint_local.DataGrid.confirmTitle,o=t.params||{},r=t.callback,a=this,l=this.getSelectedIds();0<l.length?mini.confirm(n,s,function(t){"ok"==t&&(a.loading(epoint_local.DataGrid.waitingText),Util.getRightUrl&&(e=Util.getRightUrl(e)),o.ids=l.join(","),jQuery.ajax({url:e,type:"post",dataType:"json",data:o}).done(function(t){r&&!1===r.call(a,t)||(t.success?mini.alert(t.msg||epoint_local.DataGrid.deleteSuccessfulText):mini.alert(t.msg||epoint_local.DataGrid.deleteFailedText),a.url&&a.reload())}).fail(function(t,e,i){mini.alert(t.responseText),a.unmask()}))}):mini.alert(i)},removeNewRow:function(){for(var t=this.getAllSelecteds(),e=!0,i=0,n=t.length;i<n;i++)if(t[i][this.idField]){e=!1;break}return e&&this.removeRows(t),e}}}),mini.addEpointExt("FrozenGridView",function(){return{doUpdateRows:function(){var t,e,i,n=this.getVisibleRows(),s=this.getFrozenColumns(),o=this.getUnFrozenColumns(),r=this.getFrozenRightColumns();i=this.isGrouping()?(t=this._createGroupingHTML(s,1),e=this._createGroupingHTML(r,3),this._createGroupingHTML(o,2)):(t=this._createRowsHTML(s,1,this.isFrozen()?n:[]),e=this._createRowsHTML(r,3,this.isFrozenRight()?n:[]),this._createRowsHTML(o,2,n)),this._rowsLockContentEl.innerHTML=t,this._rowsRightLockContentEl.innerHTML=e,this._rowsViewContentEl.innerHTML=i;var a=this._rowsLockContentEl.firstChild,l=this._rowsRightLockContentEl.firstChild;a.style.width="0px",l.style.width="0px";var h=this.getScrollTop(),d=this._columnsViewEl.scrollLeft;this._rowsViewEl.scrollTop===h&&this._rowsViewEl.scrollLeft===d||this._syncScrollOffset(d,h)}}}),mini.ActionColumn=function(config){return mini.copyTo({width:152,cellCls:"mini-actioncolumn mini-actioncolumn-cell",headerCls:"mini-actioncolumn",hideable:!0,allowDrag:!0,minWidth:88,iconWidth:16,textWidth:54,itemGap:16,asText:!1,plain:!1,defaultShowItems:4,calcWidth:function(t){var e=Math.min(t,this.defaultShowItems),i=this.asText?this.textWidth:this.iconWidth;return Math.max(this.minWidth,i*e+this.itemGap*(e-1)+24)+"px"},renderer:function(s){var r=this,o=s.sender,a=s.record,l=s.column,t=l.__actions;if(!t||!t.length)return"";var e="",h=l._id,d={};if(l.__hasIconRender){$.each(t,function(t,e){if(e.renderer+""===e.renderer&&(e.renderer=r.__getFun(e.renderer,!0)),e&&"function"===$.type(e.renderer)){var i={sender:o,record:a,row:s.row,column:l,icon:{icon:e.icon}},n=e.renderer.call(o,i);"string"===$.type(n)&&n.length&&window.console&&console.warn&&console.warn("图标渲染内容不可自定义，仅可通过e.icon.disabled 和 e.icon.visible 控制图标按钮的禁用和显示状态"),d[e._id]={disabled:!0===i.icon.disabled,visible:!1!==i.icon.visible}}else d[e._id]={disabled:!1,visible:!0}});var i=$.grep(t,function(t){return d[t._id].visible});if(i.length>r.defaultShowItems){e=$.map(i.slice(0,r.defaultShowItems-1),function(t){return c(t,d[t._id].disabled)}).join("");var n=[],u=[];$.map(i.slice(r.defaultShowItems-1),function(t){n.push(t._id),d[t._id].disabled&&u.push(t._id)}).join(","),e+=c(l.__actionsMap.showMore,!1,n.join(","),u.join(","))}else e=$.map(i,function(t){return c(t,d[t._id].disabled)}).join("")}else e=$.map(t.slice(0,r.defaultShowItems),function(t){return c(t)}).join("");return'<div class="mini-actioncolumn-wrap" data-column-id="'+h+'" data-record-id="'+a._uid+'">'+e+"</div>";function c(t,e,i,n){var s='<i class="action-icon '+(r.asText?"":t.icon)+(e?" mini-disabled":"")+'" data-tooltip="'+t.title+'" data-column-id="'+h+'" data-icon-id="'+t._id+'" data-record-id="'+a._uid+'" '+(i?'data-over-ids="'+i+'"':"")+(n?' data-disabled-ids="'+n+'"':"")+"></i>";if(r.asText){var o=$(s);return o.removeClass("action-icon").addClass("action-text").text(o.attr("data-tooltip")).css("width",r.textWidth),r.plain||o.addClass("asBtn"),o[0].outerHTML}return s}},__onCellClick:function(t){if(t.column._id===this._id){var e=t.htmlEvent.target,i=e.getAttribute("data-icon-id"),n=t.column.__actionsMap[i];n&&n.handle&&!$(e).hasClass("mini-disabled")&&this.__callHandle(n.handle,t.record,t.sender,e)}},__callHandle:function(fn,record,grid,el){var type=$.type(fn);if("function"===type)return fn.call(grid,record,el);if("string"!==type);else{var isCall=/\(.*\)/.test(fn);isCall?eval(fn):eval(fn)(record,el)}},__getFun:function(t,e){return window[t]&&"function"===$.type(window[t])?window[t]:!e&&t},init:function(s){var o=this,t=$("<div></div>").html(o.header),n=[];o.__hasIconRender=!1;var r={},e=[],i=t.find('[type="action"]').remove();if(e=$.isArray(o.buttons)&&o.buttons.length?o.buttons.map(function(t,e){var i={id:t.id||e+1,_id:e+1,icon:t.icon,title:t.text,handle:t.onclick,renderer:t.renderer};return i.handle||n.push(i),(r[i._id]=i).renderer&&(o.__hasIconRender=!0),i}):$.map(i,function(t,e){var i={id:t.getAttribute("id")||e+1,_id:e+1,icon:t.getAttribute("icon"),title:t.textContent||t.innerText||t.getAttribute("title"),handle:t.getAttribute("onclick"),renderer:t.getAttribute("renderer")};return i.handle||n.push(i),(r[i._id]=i).renderer&&(o.__hasIconRender=!0),i}),t.find(">*").remove(),o.header=$.trim(t.text())||epoint_local.operate_text,o.__actions=e,o.__actionsMap=r,o.width=o.calcWidth(e.length),e.length>this.defaultShowItems){var a={_id:"showMore",icon:"icon-omit",title:epoint_local.more_text,handle:function l(t,e){o.__extMenu||o.__createExtMenu(s);if(o.__extMenu.__currentRecordId=t._uid,o.__hasIconRender){var i=(e.getAttribute("data-over-ids")||"").split(","),n=(e.getAttribute("data-disabled-ids")||"").split(",");o.__extMenu.setItems($.map(i,function(t){var e=o.__actionsMap[t];return{id:t,text:e.title,iconCls:e.icon,enabled:-1===n.indexOf(t)}}))}o.__extMenu.popupEl=e,o.__extMenu.showAtEl(e),$(e).addClass("active")}};r[a._id]=a,o.__hasIconRender||(e.splice(o.defaultShowItems-1,0,a),this.__createExtMenu(s),this.__extMenu.setItems($.map(this.__actions.slice(o.defaultShowItems),function(t){return{id:t._id,text:t.title,iconCls:t.icon}})))}n.length&&$.each(n,function(t,e){console&&console.warn&&console.warn(o.header+"列的【"+e.icon+"】未配置点击事件！！！")}),n=null,s.on("cellClick",this.__onCellClick,this),o.__inited=!0},__createExtMenu:function(o){var r=this;if(!this.__extMenuInited){var a=new mini.Menu;a.set({minWidth:50,yOffset:4}),a.on("itemclick",function(t){var e=t.item.id,i=r.__actionsMap[e],n=a.__currentRecordId,s=o.getRowByUID(n);i&&i.handle&&r.__callHandle(i.handle,s,o)});var t=a.hide;function e(){a.hide()}a.hide=function(){t.apply(this,arguments),$('[data-icon-id="showMore"]').removeClass("active"),o._rowsEl.removeEventListener&&o._rowsEl.removeEventListener("scroll",e,!0)},this.__extMenu=a,this.__extMenuInited=!0,o._rowsEl.addEventListener&&a.on("open",function(){o._rowsEl.addEventListener("scroll",e,!0)})}return this.__extMenu}},config)},mini._Columns.actioncolumn=mini.ActionColumn,mini.addEpointExt("ListBox",function(){return function(s){if(!mini.isIE8){var i="check-beauty",o=mini.ListBox.prototype.doUpdate;mini.ListBox.prototype.doUpdate=function(){var t=o.apply(this,arguments),e=s(this._viewEl).find(".mini-listbox-items");if(function n(t){t.find("td").each(function(t,e){var i=s(e);i.hasClass(".mini-listbox-checkbox")||i.attr("title",i.text())})}(e),!this.showCheckBox)return t;var i=s(this._headerEl).find(".mini-listbox-headerInner");return r(e),r(i),t}}function r(t){var e=t.find(".mini-listbox-checkbox");!t.hasClass(i)&&e.find('input[type="checkbox"]').length&&(s.map(e,function(t){var e=s(t).find('input[type="checkbox"]')[0];if(e){var i=e.id;i&&s('<label class="mini-listbox-checkbox-icon" for="'+i+'"></label>').appendTo(t)}}),t.addClass(i))}}(window.jQuery),{getItemText:function(t){var e=mini._getMap(this.textField,t);return mini.isNull(e)?"":mini.htmlDecode(String(e))},_OnDrawCell:function(t,e,i){var n=i?mini._getMap(i.field,t):this.getItemText(t),s={sender:this,index:e,rowIndex:e,record:t,item:t,column:i,field:i?i.field:null,value:n,cellHtml:n,rowCls:null,cellCls:i&&i.cellCls||"",rowStyle:null,cellStyle:i&&i.cellStyle||""};if(this.columns&&0<this.columns.length||0===e&&this.showNullItem&&(s.cellHtml=this.nullItemText),s.cellHtml=mini.htmlEncode(s.cellHtml),i){i.dateFormat&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(n,i.dateFormat):s.cellHtml=n);var o=i.renderer;if(o){var r="function"==typeof o?o:window[o];r&&(s.cellHtml=r.call(i,s))}}return this.fire("drawcell",s),null!==s.cellHtml&&s.cellHtml!==undefined&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s}}}),mini.addEpointExt("Menu",function(){var e=mini.Menu.prototype._create;return[{_create:function(){var t=e.apply(this,arguments);return this.on("open",this._onDocumentMousewheel,this),this.on("close",this._unDocumentMousewheel,this),t}},mini.__mouseWheelHandles]}),mini.addEpointExt("Pager",function(){return{set:function(t){if("string"==typeof t)return this;var e=t.pageIndex;delete t.pageIndex;var i=t.sizeList;return delete t.sizeList,mini.Pager.superclass.set.call(this,t),mini.isNull(e)||this.setPageIndex(e),mini.isNull(i)||this.setSizeList(i),this},update:function(t,e,i){mini.isNumber(t)&&(this.pageIndex=parseInt(t,10)),mini.isNumber(e)&&(this.pageSize=parseInt(e,10)),mini.isNumber(i)&&(this.totalCount=parseInt(i,10)),this.showTotalCount&&(this.totalPage=parseInt(this.totalCount/this.pageSize,10)+1,(this.totalPage-1)*this.pageSize===this.totalCount&&(this.totalPage-=1),0===this.totalCount&&(this.totalPage=0),0<=this.totalCount&&this.pageIndex>this.totalPage-1&&(this.pageIndex=this.totalPage-1),this.pageIndex<=0&&(this.pageIndex=0),this.totalPage<=0&&(this.totalPage=0)),this.firstButton.enable(),this.prevButton.enable(),this.nextButton.enable(),this.lastButton.enable(),0===this.pageIndex&&(this.firstButton.disable(),this.prevButton.disable()),this.showTotalCount&&this.pageIndex>=this.totalPage-1&&(this.nextButton.disable(),this.lastButton.disable());var n=-1<this.pageIndex?this.pageIndex+1:0;this.showTotalCount&&0==this.totalCount&&(n=0),this.numInput.value=n,this.pagesLabel.innerHTML="/ "+this.totalPage;var s=this.sizeList.clone();-1===s.indexOf(this.pageSize)&&(s.push(this.pageSize),s=s.sort(function(t,e){return t-e}),this.sizeList=s);for(var o=[],r=0,a=s.length;r<a;r++){var l=s[r],h={};h.text=l,h.id=l,o.push(h)}this.sizeCombo.setData(o),this.sizeCombo.setValue(this.pageSize),this.sizeTextEl.innerHTML=this.sizeText,this.sizeTextEl.style.display=this.sizeText?"":"none";var d=this.firstText,u=this.prevText,c=this.nextText,m=this.lastText,f=this.reloadText;0==this.showButtonText&&(d=u=c=m=f=""),this.firstButton.setText(d),this.prevButton.setText(u),this.nextButton.setText(c),this.lastButton.setText(m),this.reloadButton.setText(f),this.firstButton.setIconCls(this.showButtonIcon?"mini-pager-first":""),this.prevButton.setIconCls(this.showButtonIcon?"mini-pager-prev":""),this.nextButton.setIconCls(this.showButtonIcon?"mini-pager-next":""),this.lastButton.setIconCls(this.showButtonIcon?"mini-pager-last":""),this.reloadButton.setIconCls(this.showButtonIcon?"mini-pager-reload":""),this.reloadButton.setVisible(this.showReloadButton);var p=this.reloadButton.el.previousSibling;p&&(p.style.display=this.showReloadButton?"":"none"),this._rightEl.innerHTML=String.format(this.pageInfoText,this.pageSize,this.totalCount),this.indexEl.style.display=this.showPageIndex?"":"none",this.sizeEl.style.display=this.showPageSize?"":"none",this._rightEl.style.display=this.showPageInfo&&this.showTotalCount?"":"none",this.pagesLabel.style.display=this.showTotalCount?"":"none",this.showTotalCount?(this.firstButton.setVisible(0<=this.totalCount),this.lastButton.setVisible(0<=this.totalCount),this.totalCount<0&&(this.firstButton.enable(),this.nextButton.enable(),0==this.pageIndex&&this.firstButton.disable())):(this.firstButton.setVisible(!1),this.lastButton.setVisible(!1))},_OnPageChanged:function(t,e){var i={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};this.showTotalCount&&0<=this.totalCount&&i.pageIndex>this.totalPage-1&&(i.pageIndex=this.totalPage-1),i.pageIndex<0&&(i.pageIndex=0),this.fire("beforepagechanged",i),1!=i.cancel&&(this.fire("pagechanged",i),this.update(i.pageIndex,i.pageSize))},_initEvents:function(){function e(){if(!i){i=!0;var t=parseInt(this.numInput.value);isNaN(t)?(this.update(),n=1):n!=t&&(this._OnPageChanged(t-1),n=t),setTimeout(function(){i=!1},100)}}mini.Pager.superclass._initEvents.call(this),this.firstButton.set({disableMultiClick:!1}).on("click",function(){this._OnPageChanged(0)},this),this.prevButton.set({disableMultiClick:!1}).on("click",function(){this._OnPageChanged(this.pageIndex-1)},this),this.nextButton.set({disableMultiClick:!1}).on("click",function(){this._OnPageChanged(this.pageIndex+1)},this),this.lastButton.set({disableMultiClick:!1}).on("click",function(){this._OnPageChanged(this.totalPage)},this),this.reloadButton.on("click",function(){this._OnPageChanged()},this);var i=!1,n=parseInt(this.numInput.value,10);mini.on(this.numInput,"change",function(){e.call(this)},this),mini.on(this.numInput,"keydown",function(t){13===t.keyCode&&(e.call(this),t.stopPropagation())},this),this.sizeCombo.on("valuechanged",this.__OnPageSelectChanged,this)}}}),mini.addEpointExt("Panel",function(){return{_doTitle:function(){var t=""==this.title?"&nbsp":this.title;this._titleEl.innerHTML=t,this._titleEl.title=mini.htmlUnescape(t),this._iconEl.style.display=this.iconCls||this.iconStyle?"inline":"none",this._iconEl.className="mini-panel-icon mini-icon mini-iconfont "+this.iconCls,mini.setStyle(this._iconEl,this.iconStyle)},hide:function(){var t=mini.Panel.superclass.hide.apply(this,arguments);return this.fire("close"),t},setMaxHeight:function(t){(t=parseInt(t,10))&&(this.maxHeight=t,jQuery(this.el).css("max-height",t))}}}),mini.addEpointExt("Popup",function(){return[{yOffset:2,_getWindowOffset:function(){return[0,2]},_create:function(){this.el=document.createElement("div");this.el.className="mini-popup",this._contentEl=this.el,this.on("open",this._onDocumentMousewheel,this),this.on("close",this._unDocumentMousewheel,this)}},mini.__mouseWheelHandles]}),mini.addEpointExt("Tabs",function(){var i=mini.Tabs.prototype._createHeaderMenu,t={_createHeaderMenu:function(){var t=i.apply(this,arguments),e=this._headerMenuEl;return this._headerMenu&&this._headerMenu.setyOffset&&this._headerMenu.setyOffset(2),this._headerMenu&&e&&(this._headerMenu.on("open",function(){$(e).addClass("popup")}),this._headerMenu.on("close",function(){$(e).removeClass("popup")})),t}};return window.isLinux&&$.extend(t,{setActiveIndex:function(t,e){var i,n,s=this.getTab(t),o=this.getTab(this.activeIndex),r=s!=o,a=this.getTabBodyEl(this.activeIndex);if(a&&jQuery(a).css({position:"absolute",width:"100%",left:"-200%"}),this.activeIndex=s?this.tabs.indexOf(s):-1,(a=this.getTabBodyEl(this.activeIndex))&&jQuery(a).css({position:"relative",width:"100%",left:"0"}),(a=this.getTabEl(o))&&mini.removeClass(a,this._tabActiveCls),(a=this.getTabEl(s))&&mini.addClass(a,this._tabActiveCls),a&&r){"bottom"===this.tabPosition?(i=mini.findParent(a,"mini-tabs-header"))&&jQuery(this._headerEl).prepend(i):"left"==this.tabPosition?(n=mini.findParent(a,"mini-tabs-header").parentNode)&&n.parentNode.appendChild(n):"right"==this.tabPosition?(n=mini.findParent(a,"mini-tabs-header").parentNode)&&jQuery(n.parentNode).prepend(n):(i=mini.findParent(a,"mini-tabs-header"))&&this.allowClickWrap&&this._headerEl.appendChild(i);var l=!!(o=this.getTab(this.activeIndex))&&!o._layouted;(this.isAutoHeight()||l)&&(o&&(o._layouted=!0),this.doLayout(),o&&(o._layouted=!1)),1<this.getTabRows().length||(this._scrollToTab(this.activeIndex),this._doScrollButton());for(var h=0,d=this.tabs.length;h<d;h++){var u=this.getTabEl(this.tabs[h]);u&&mini.removeClass(u,this._tabHoverCls)}}var c=this;if(r){var m={tab:s,index:this.tabs.indexOf(s),name:s?s.name:""};setTimeout(function(){c.fire("ActiveChanged",m)},1)}if(this._cancelLoadTabs(s),!1!==e&&s&&s.url&&!s.loadedUrl&&c.loadTab(s.url,s),s&&mini.isChrome){var f=this.getTabIFrameEl(s);f&&(f.style.position="relative",f.style.left="1px",f.offsetWidth,f.style.left="0px")}if(c.canLayout())try{mini.layoutIFrames(c.el)}catch(p){}},addTab:function(t,e){"string"==typeof t&&(t={title:t}),(t=this.createTab(t)).name||(t.name="");var i=this.getActiveTab();"number"!=typeof e&&(e=this.tabs.length),this.tabs.insert(e,t),i&&(this.activeIndex=this.tabs.indexOf(i));var n='<div id="'+this._createTabBodyId(t)+'" class="mini-tabs-body '+t.bodyCls+'" style="'+t.bodyStyle+';position:absolute;left:-200%;width:100%;"></div>';mini.append(this._bodyEl,n);var s=this.getTabBodyEl(t),o=t.body;if(delete t.body,o){mini.isArray(o)||(o=[o]);for(var r=0,a=o.length;r<a;r++)mini.append(s,o[r])}if(t.bodyParent)for(var l=t.bodyParent;l.firstChild;)8==l.firstChild.nodeType?l.removeChild(l.firstChild):s.appendChild(l.firstChild);return delete t.bodyParent,t.controls&&(this.setTabControls(t,t.controls),delete t.controls),this.doUpdate(),t}}),t}),mini.addEpointExt("TextBox",function(){return{
//         if (!this.inputStyle) {
isDesensitization:!1,__OnBlur:function(t){this.isDesensitization&&this.desensitizationValue&&!this._textEl.value&&(this._textEl.value=this.desensitizationValue),this._focused=!1;var e=this;setTimeout(function(){0==e._focused&&e.removeCls(e._focusCls)},2),
//        if (!this._inputChangedTime || new Date() - this._inputChangedTime < 50) {
this.__OnInputTextChanged(),this.fire("blur",{htmlEvent:t}),this.validateOnLeave&&this.isEditable()&&this._tryValidate()},__OnFocus:function(t){if(this.isDesensitization&&this.value==this.desensitizationValue&&(this._textEl.value=""),this.doUpdate(),!this.isReadOnly()){if(this._focused=!0,this.addCls(this._focusCls),this._initInputEvents(),this.selectOnFocus){var e=this;setTimeout(function(){e.selectText()},1)}this.fire("focus",{htmlEvent:t})}},__OnInputTextChanged:function(t,e){this.isDesensitization&&this.desensitizationValue!==this._textEl.value&&(this.desensitizationValue="");var i=this.value;this._oldValue=i,this.setValue(this._textEl.value),i===this.getValue()&&!0!==e||this._OnValueChanged()},setValue:function(t,e){null!==t&&t!==undefined||(t=""),(t=String(t)).length>this.maxLength&&(t=t.substring(0,this.maxLength)),
//if (this.value !== value) {
this.value=t,this._valueEl.value=this._textEl.value=t,this._doEmpty(),e&&(this.isDesensitization=!0,this.desensitizationValue=t),this._maxLengthInfo&&(this._maxLengthInfo.innerText=this.value.length+"/"+this.maxLength)},__OnValidation:function(t){0!=t.isValid&&(this.isDesensitization&&this.desensitizationValue||mini._ValidateVType(this.vtype,t.value,t,this))},showClose:!1,_closeCls:"mini-textbox-close",setShowClose:function(t){this.showClose=t,this._closeEl||(this._closeEl=mini.after(this._valueEl,'<span class="mini-textbox-close mini-icon"></span>')),this._closeEl.style.display=this.showClose?"inline-block":"none",this._doInputLayout()},getShowClose:function(){return this.showClose},_doInputLayout:function(){var t=0;"textarea"!=this._InputType&&this._initMaxLengthInfo&&(t+=14*(this.maxLength+"").length),this.showClose&&(t+=mini.getWidth(this._closeEl)),0<t&&mini.setStyle(this._textEl,"width:calc(100% - "+t/100+"rem);")},__OnMouseDown:function(t){var e=this;mini.findParent(t.target,this._closeCls)&&(this.__OnInputTextChanged(),""!==this.value&&(this._oldValue=this.value,this.setValue(""),this.setText(""),this._OnValueChanged())),e._textEl.focus(),mini.isAncestor(this._textEl,t.target)||setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e4,1e4)},1)},errorTextEl:null,getErrorTextEl:function(){return this.errorTextEl||(this.errorTextEl=mini.append(this.el,'<span class="mini-errorText"></span>')),this.errorTextEl},_RemoveErrorText:function(){if(this.errorTextEl){var t=this.errorTextEl;jQuery(t).remove()}this.errorTextEl=null},setMaxLength:function(t){this.maxLength=t,mini.setAttr(this._textEl,"maxLength",t),"textarea"==this._InputType&&mini.isIE&&(mini.on(this._textEl,"keyup",this.__OnMaxLengthKeyUp,this),mini.on(this._textEl,"keypress",this.__OnMaxLengthKeyUp,this),mini.on(this._textEl,"paste",this.__OnPaste,this)),this._bindMaxLengthInfo(),this._updateMaxLengthInfo(this.value),this._doInputLayout()},__OnPaste:function(t){var e=this;setTimeout(function(){var t=e._textEl.value;e._textEl.value=mini.substr(t,e.maxLength),e.__OnInputTextChanged()},0)},__OnMaxLengthKeyUp:function(t){mini.getStrLength(this._textEl.value)>=this.maxLength&&(this.__OnPaste(t),t.preventDefault())},_initMaxLengthInfo:!1,_bindMaxLengthInfo:function(){var t=this;this._initMaxLengthInfo||(this._maxLengthInfo=mini.append(this._borderEl,'<span class="mini-maxlength-info"></span>'),mini.on(this._textEl,"input",function(){t._updateMaxLengthInfo(t._textEl.value)},this),this._initMaxLengthInfo=!0)},_updateMaxLengthInfo:function(t){this._maxLengthInfo.innerText=mini.getStrLength(t)+"/"+this.maxLength},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["mobileErrorText","telErrorText","phoneErrorText","postCodeErrorText","orgCodeErrorText","idCardErrorText","validateErrorText","decimalLengthErroeText"]),mini._ParseBool(t,e,["showClose"]),e}}}),mini.addEpointExt("TextArea",function(){return{minHeight:62,maxHeight:0,autoSize:!1,
//     if (!mini.isAncestor(this._textEl, e.target)) {
setHeight:function(t){parseFloat(t)==t&&(t+="px"),this.height=t,"textarea"===this._InputType&&this.doLayout()},setAutoSize:function(t){this.autoSize=!!t,this.doLayout()},getAutoSize:function(){return this.autoSize},setValue:function(t){mini.TextArea.superclass.setValue.call(this,t),this.autoSize&&this.doLayout()},setText:function(t){mini.TextArea.superclass.setText.call(this,t),this.autoSize&&this.doLayout()},__OnInput:function(t){this.fire("input",{htmlEvent:t}),this.autoSize&&this.doLayout()},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this._textEl,"drop",this.__OnDropText,this),mini_onOne(this._textEl,"change",this.__OnInputTextChanged,this),mini_onOne(this._textEl,"focus",this.__OnFocus,this),mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this._textEl,"input",this.__OnInput,this);var t=this.value;this.value=null,this.el&&this.setValue(t)},this),this.on("validation",this.__OnValidation,this)},doLayout:function(){var t;this.canLayout()&&(mini.TextArea.superclass.doLayout.call(this),this.autoSize?(this._textEl.style.height="0px",t=this._textEl.scrollHeight+2):(t=this.height)+""===t&&(-1<t.indexOf("%")&&(this.el.style.height=t,t=mini.getHeight(this.el),this.el.style.height=t+"px"),t=parseInt(t,10)||0),this.minHeight&&t<this.minHeight&&(t=this.minHeight),this.maxHeight&&t>this.maxHeight&&(t=this.maxHeight),(t-=2)<0&&(t=0),this._textEl.style.height=t+"px")},getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["autoSize"]),mini._ParseInt(t,e,["maxHeight"]),e}}}),mini.addEpointExt("TextBoxList",function(){return{popupYOffset:2,showPopup:function(t){if(0!=this.isDisplay()){this.isShowPopup=!0;var e=this._createPopup();e.el.style.zIndex=mini.getMaxZIndex();var i=this._listbox;i.emptyText=this.popupEmptyText,"loading"==t?(i.emptyText=this.popupLoadingText,this._listbox.setData([])):"error"==t&&(i.emptyText=this.popupLoadingText,this._listbox.setData([])),this._listbox.doUpdate();var n=this.getBox(),s=n.x,o=n.y+n.height;this.popup.el.style.display="block",mini.setXY(e.el,-1e3,-1e3),this.popup.setWidth(n.width),this.popup.setHeight(this.popupHeight);var r=this.popup.getHeight();r>this.popupMaxHeight&&this.popup.setHeight(this.popupMaxHeight),r<this.popupMinHeight&&this.popup.setHeight(this.popupMinHeight),mini.setXY(e.el,s,o+this.popupYOffset)}},errorTextEl:null,getErrorTextEl:function(){return this.errorTextEl||(this.errorTextEl=mini.append(this.el,'<span class="mini-errorText"></span>')),this.errorTextEl},_RemoveErrorText:function(){if(this.errorTextEl){var t=this.errorTextEl;jQuery(t).remove()}this.errorTextEl=null}}}),mini.addEpointExt("TimeSpinner",function(){return{timeType:"hours",_timeType:"hours",setTimeType:function(t){this.timeType=this._timeType=t},increment:1,setIncrement:function(t){t=parseFloat(t),isNaN(t)||this.increment!=t&&(this.increment=t)},__OnButtonMouseDown:function(t){this._DownValue=this.getFormValue(),"up"==t.spinType?this._StartSpin(this.increment,230,2):this._StartSpin(-this.increment,230,2)},_ChangeValue:function(t,e){var i,n=this.getValue();if(n){switch(e){default:case"hours":i=mini.addDate(n,t,"H");break;case"minutes":i=mini.addDate(n,t,"M");break;case"seconds":i=mini.addDate(n,t,"S")}1<i.getDate()?i=n:n=i}else n="00:00:00";this.setValue(n)},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["timeType","increment"]),e}}}),mini.addEpointExt("ToolTip",function(){return{autoHide:!0,theme:"dark",defaultTheme:"dark",setTheme:function(t){if(t){this.theme=t;var e="mini-tooltip-theme-",i=jQuery.grep(this.el.className.split(" "),function(t){return-1!=t.indexOf(e)}).join(" ");jQuery(this.el).removeClass(i).addClass(e+t)}},getTheme:function(){return this.theme},applyTheme:function(){if(this._target){var t=jQuery(this._target).attr("data-theme");this.setTheme(t||this.defaultTheme)}},setContent:function(t){this.$element.children(".mini-tooltip-inner").html(t||"&nbsp;"),this.applyPlacement(),this.applyTheme()},open:function(t){t=jQuery(t)[0]||this.target;var e=this.getContent(t),i={element:t,content:e,cancel:!1};if(e&&jQuery(t).is(":visible")||(i.cancel=!0),this.fire("beforeopen",i),!i.cancel){this.$element.css("z-index",mini.getMaxZIndex()).show(),this._target=t;try{this.setContent(i.content)}catch(ex){}this.fire("open",{element:t})}},_bindTooltip:function(){var t=jQuery(this.scope||document),e=this.selector,i="tooltip-"+this.uid;this.setTheme(this.theme),t.unbind("."+i);for(var n=this.trigger.split(" "),s=n.length;s--;){var o=n[s];if("click"==o)t.on("click."+i,e,jQuery.proxy(this._toggle,this));else if("manual"!=o){var r="hover"==o?"mouseenter":"focus",a="hover"==o?"mouseleave":"blur";t.on(r+"."+i,e,jQuery.proxy(this._enter,this)),this.autoHide&&t.on(a+"."+i,e,jQuery.proxy(this._leave,this))}}},_toggle:function(t){"none"==this.$element.css("display")?this._enter(t):this._leave(t)},applyPlacement:function(){if(this._target&&"none"!=this.$element.css("display")){var t=this._target,e=jQuery(t).attr("data-placement")||this.placement,i=this.$element;if(t&&i[0]){i.show().css({left:"-2000px",top:"-2000px"});var n=mini.getBox(t),s=mini.getViewportBox(),o=n.top-s.top,r=s.bottom-n.bottom,a=n.left-s.left,l=s.right-n.right;m(e);var h=mini.getBox(i[0]),d=mini.getCalculatedOffset(e,n,h.width,h.height);if(0===e.indexOf("bottom")?r<o&&d.top+h.height>s.bottom&&(e=e.replace("bottom","top")):0===e.indexOf("top")&&o<r&&d.top<s.top&&(e=e.replace("top","bottom")),-1!==e.indexOf("left")?l<a&&h.width+d.left>s.width&&(e=e.replace("left","right")):-1!==e.indexOf("right")&&a<l&&(d.left<0||n.left+n.width<h.wihth)&&(e=e.replace("right","left")),"bottom"!==e&&"top"!==e||(l<a&&h.width+d.left>s.width?e+="right":a<l&&(d.left<0||n.left+n.width<h.wihth)&&(e+="left")),m(e),(d=mini.getCalculatedOffset(e,n,h.width,h.height)).left<8&&(d.left=8),"right"==e||"left"==e){var u=$(i).children(".mini-tooltip-arrow");function c(){var t=n.top+n.height/2-u.height()/2-d.top;u.css("top",t)}u.css("top",""),s=mini.getViewportBox(),d.top<s.y?(d.top=s.y,c()):d.top+h.height>s.bottom&&(d.top=s.bottom-h.height,c())}!function f(t){i.offset(t)}(d),h=mini.getBox(i[0]),0===e.indexOf("bottom")?h.height+d.top>=s.height&&i.css("bottom","8px"):0===e.indexOf("top")&&h.height+d.bottom>=s.height&&i.css("top","8px")}}function m(t){i.removeClass("mini-tooltip-left mini-tooltip-top mini-tooltip-right mini-tooltip-bottom mini-tooltip-bottomleft mini-tooltip-topleft mini-tooltip-bottomright mini-tooltip-topright").addClass("mini-tooltip-"+t)}},setAutoHide:function(t){this.autoHide!=t&&(this.autoHide=t,this._bindTooltip())},getAutoHide:function(){return this.autoHide},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["theme"]),mini._ParseBool(t,e,["autoHide"]),e}}}),mini.addEpointExt("Tree",function(){return{autoLoad:!1}}),mini.addEpointExt("TreeGrid",function(){return{showHGridLines:!0,showVGridLines:!1,showSortIcon:!0,dataField:"data",autoLoad:!1,resultAsTree:!1,_setEditorBox:function(t,e){mini.DataGrid.prototype._setEditorBox.call(this,t,e)},getAllSelecteds:function(){return this.getSelecteds()}}}),mini.addEpointExt("DataTree",function(){return{loadNode:function(r,a){var t={node:this._loadingNode=r,cancel:!1};if(this.fire("beforeloadnode",t),!0!==t.cancel){var e=new Date,l=this;l._doLoadAjax(l.loadParams,null,null,null,function(o){var t=new Date-e;t<60&&(t=60-t),setTimeout(function(){o.node=r,l._OnPreLoad(o),l._loadingNode=null,l.loadParams&&delete l.loadParams[l.idField];var t=r[l.nodesField];l.removeNodes(t);var e=o.data;if(e&&0<e.length){l.collapse(r),l.addNodes(e,r);for(var i=l.getAllChildNodes(r),n=0,s=i.length;n<s;n++){delete i[n]._state}!1!==a?l.expand(r,!0):l.collapse(r,!0)}else delete r[l.leafField],l.expand(r,!0);l.fire("loadnode",o),l.fire("load",o)},10)},!0)}}}}),mini.addEpointExt("Tree",function(){return function(t,s){if(!mini.isIE8&&!mini.isIE9){var o=mini.TreeGrid.prototype._createTreeColumn;mini.Tree.prototype._createTreeColumn=mini.TreeGrid.prototype._createTreeColumn=function(t){var e=o.apply(this,arguments),i=s(t.cellHtml);if(i.hasClass("mini-tree-parentNode")&&(i.find(">.mini-tree-node-ecicon").append('<svg class="mini-tree-loading-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="128" height="128" fill="currentColor" ><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg>'),t.cellHtml=i[0].outerHTML),!0===this.showCellTip){var n=i.find(".mini-tree-nodetext");n.attr("title",jQuery.trim(n.text())),t.cellHtml=i[0].outerHTML}return e},mini.Tree.prototype.__OnBeforeLoadNode=mini.TreeGrid.prototype.__OnBeforeLoadNode=function(t){this.__showLoading=this.showLoading,this.showLoading=!1,clearTimeout(this.__loadingTimer);var e=this;this.__loadingTimer=setTimeout(function(){e.addNodeCls(t.node,"mini-tree-loading")},100),this.fire("beforeloadnode",t)},mini.Tree.prototype.__OnLoadNode=mini.TreeGrid.prototype.__OnLoadNode=function(t){clearTimeout(this.__loadingTimer),this.showLoading=this.__showLoading,this.removeNodeCls(t.node,"mini-tree-loading"),this.fire("loadnode",t)}}}(window,window.jQuery),{showTreeLines:!1,showFullPath:!1,fullPathDelimiter:"-",includeRootNode:!1,allowAlternating:!1,
//             if (this.showCellTip !== true) return;
setShowFullPath:function(t){this.showFullPath=!!t},getShowFullPath:function(){return this.showFullPath},replaceNodes:function(t,e){var i=e[this.nodesField];this.removeNodes(i),this.addNodes(t,e)},_OnDrawCell:function(t,e,i,n){var s=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);if(this._treeColumn&&this._treeColumn==e.name){var o=s.node;!1===o.ckr&&(s.showCheckBox=!1,s.showRadioButton=!1),this.fire("drawnode",s),s.nodeStyle&&(s.cellStyle=s.nodeStyle),s.nodeCls&&(s.cellCls=s.nodeCls),s.nodeHtml?s.cellHtml=s.nodeHtml:o.textCls&&(s.cellHtml='<span class="'+o.textCls+'">'+s.cellHtml+"</span>"),this._createTreeColumn(s)}return s},getValueAndText:function(t,e){mini.isNull(t)&&(t=[]),e=e||this.delimiter,"string"==typeof t||"number"==typeof t?t=this._dataSource.getsByIds(t):mini.isArray(t)||(t=[t]);for(var i=[],n=[],s=0,o=t.length;s<o;s++){var r=t[s];r&&(i.push(this.getItemValue(r)),n.push(this.getItemText(r)))}return[i.join(e),n.join(e)]},getItemValue:function(t){if(!t)return"";var e=mini._getMap(this.idField,t);return mini.isNull(e)?"":String(e)},getItemText:function(t){if(!t)return"";var e="";return e=this.showFullPath?this.getFullPath(t):mini._getMap(this.textField,t),mini.isNull(e)?"":String(e).replace(/<\/?.+?>/g,"")},getFullPath:function(t){if(t.fullPath)return t.fullPath;for(var e=this.getAncestors(t),i="",n=0,s=e.length;n<s;n++)0==n&&!this.includeRootNode||(i+=mini._getMap(this.textField,e[n])+this.fullPathDelimiter);return t.fullPath=i+=mini._getMap(this.textField,t),i},getText:function(){var t,e=[];this.showCheckBox?e=this.getCheckedNodes():(t=this.getSelectedNode())&&e.push(t);for(var i=[],n=this.getTextField(),s=0,o=e.length;s<o;s++)t=e[s],i.push(t[n].replace(/<\/?.+?>/g,""));return i.join(",")},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["fullPathDelimiter"]),e}}}),mini.addEpointExt("Window",function(){var t={showRefreshButton:!1,maskOnLoad:!1,lockScroll:!0,_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);var e=this.createButton({name:"min",cls:"mini-tools-min",visible:this.showMinButton});this.buttons.push(e);var i=this.createButton({name:"max",cls:"mini-tools-max",visible:this.showMaxButton});this.buttons.push(i);var n=this.createButton({name:"refresh",cls:"mini-tools-refresh",visible:this.showRefreshButton});this.buttons.push(n);var s=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(s)},_OnButtonClick:function(t,e){var i=mini.Window.superclass._OnButtonClick.call(this,t,e);return 1==i.cancel||("max"==i.name?"max"==this.state?this.restore():this.max():"refresh"==i.name&&this.refresh()),i},hide:function(){this.fire("close"),this.setVisible(!1),this._doModal()},refresh:function(){return this.reload(),this},restore:function(){this.state="restore",this.show(this.x,this.y);var t=this.getButton("max");t&&(t.cls="mini-tools-max",this._doTools()),this.fire("restore")},setShowRefreshButton:function(t){this.showRefreshButton=t;var e=this.getButton("refresh");e&&(e.visible=t,this._doTools())},getShowRefreshButton:function(){return this.showRefreshButton},doLayout:function(){if(this.canLayout()){if("max"==this.state){var t=this.getParentBox();this.el.style.left="10px",this.el.style.top="10px",mini.setSize(this.el,t.width-20,t.height-20)}mini.Window.superclass.doLayout.call(this),this.allowDrag&&mini.addClass(this.el,this._dragCls),"max"==this.state&&(this._resizeGridEl.style.display="none",mini.removeClass(this.el,this._dragCls)),this._doModal()}},_doShow:function(t,e){var i,n=this.getParentBox();"max"==this.state?(this._width||(i=this.getBox(),this._width=i.width,this.expanded&&(this._height=i.height),this.x=i.x,this.y=i.y),this.el.style.left="-10000px",this.el.style.top="-10000px"):(mini.isNull(t)&&(t="center"),mini.isNull(e)&&(e="middle"),this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this._width&&(this.setWidth(this._width),this.setHeight(this._height),delete this._width,delete this._height),this._measureSize(),i=this.getBox(),"left"==t&&(t=0),"center"==t&&(t=n.width/2-i.width/2),"right"==t&&(t=n.width-i.width),"top"==e&&(e=0),"middle"==e&&(e=n.height/2-i.height/2),"bottom"==e&&(e=n.height-i.height),t+i.width>n.right&&(t=n.right-i.width),e+i.height>n.bottom&&(e=n.bottom-i.height),t<0&&(t=0),e<0&&(e=0),this.el.style.display="",this.el.style.left=t+"px",this.el.style.top=e+"px"),this.doLayout()},getExtraAttrs:function(t){var e={};mini._ParseString(t,e,["onrestore","onclose"]),mini._ParseBool(t,e,["showRefreshButton","lockScroll"])}},e=mini.Window.prototype.setVisible;t.setVisible=function(t){this.lockScroll&&(t?$("html,body").addClass("mini-window-lock-scroll"):$("html,body").removeClass("mini-window-lock-scroll")),e.apply(this,arguments)};var i=mini.Window.prototype.destroy;return t.destroy=function(){$("html,body").removeClass("mini-window-lock-scroll"),i.apply(this,arguments)},t}),mini.Hidden=function(){mini.Hidden.superclass.constructor.apply(this,arguments)},mini.extend(mini.Hidden,mini.Control,{_clearBorder:!1,formField:!0,value:"",uiCls:"mini-hidden",_create:function(){this.el=document.createElement("input"),this.el.type="hidden",this.el.className="mini-hidden"},setName:function(t){this.name=t,this.el.name=t},setValue:function(t){if(null!==t&&t!==undefined||(t=""),this.value=t,mini.isDate(t)){var e=t.getFullYear(),i=t.getMonth()+1,n=t.getDate();i=i<10?"0"+i:i,n=n<10?"0"+n:n,this.el.value=e+"-"+i+"-"+n}else this.el.value=t},getValue:function(){return this.value},getFormValue:function(){return this.el.value}}),mini.regClass(mini.Hidden,"hidden"),mini.Popup=function(){mini.Popup.superclass.constructor.apply(this,arguments),this.setVisible(!1),this.setAllowDrag(this.allowDrag),this.setAllowResize(this.allowResize)},mini.extend(mini.Popup,mini.Container,{alwaysView:!0,_clearBorder:!1,uiCls:"mini-popup",_create:function(){this.el=document.createElement("div");this.el.className="mini-popup",this._contentEl=this.el},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this)},this)},doLayout:function(){if(this.canLayout()){mini.Popup.superclass.doLayout.call(this),this._doShadow();var t=this.el.childNodes;if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];mini.layout(n)}}},destroy:function(t){this.el&&(this.el.onmouseover=null),mini._destroying||(mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this)),!1!==t&&(this._modalEl&&jQuery(this._modalEl).remove(),this.shadowEl&&jQuery(this.shadowEl).remove(),this._shimEl&&jQuery(this._shimEl).remove()),this._modalEl=null,this.shadowEl=null,this._shimEl=null,mini.Popup.superclass.destroy.call(this,t)},setWidth:function(t){parseFloat(t)==t&&(t+="px"),-1!=(this.width=t).indexOf("px")?mini.setWidth(this.el,t):this.el.style.width=t,this._sizeChanged()},setHeight:function(t){parseFloat(t)==t&&(t+="px"),-1!=(this.height=t).indexOf("px")?mini.setHeight(this.el,t):this.el.style.height=t,this._sizeChanged()},setBody:function(t){if(t){mini.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++)mini.append(this._contentEl,t[e])}},getAttrs:function(t){var e=mini.Popup.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["popupEl","popupCls","showAction","hideAction","xAlign","yAlign","modalStyle","onbeforeopen","open","onbeforeclose","onclose"]),mini._ParseBool(t,e,["showModal","showShadow","allowDrag","allowResize"]),mini._ParseInt(t,e,["showDelay","hideDelay","xOffset","yOffset","minWidth","minHeight","maxWidth","maxHeight"]);var i=mini.getChildNodes(t,!0);return e.body=i,e}}),mini.regClass(mini.Popup,"popup"),mini.Popup_prototype={isPopup:!1,popupEl:null,popupCls:"",showAction:"mouseover",hideAction:"outerclick",showDelay:300,hideDelay:500,xAlign:"left",yAlign:"below",xOffset:0,yOffset:0,minWidth:50,minHeight:25,maxWidth:2e3,maxHeight:2e3,showModal:!1,showShadow:!0,modalStyle:"opacity:0.2",_dragCls:"mini-popup-drag",_resizeCls:"mini-popup-resize",allowDrag:!1,allowResize:!1,_unbindPopupEl:function(){this.popupEl&&(mini.un(this.popupEl,"click",this.__OnLeftClick,this),mini.un(this.popupEl,"contextmenu",this.__OnRightClick,this),mini.un(this.popupEl,"mouseover",this.__OnMouseOver,this))},_bindPopupEl:function(){this.popupEl&&(mini.on(this.popupEl,"click",this.__OnLeftClick,this),mini.on(this.popupEl,"contextmenu",this.__OnRightClick,this),mini.on(this.popupEl,"mouseover",this.__OnMouseOver,this))},doShow:function(t){var e={popupEl:this.popupEl,htmlEvent:t,cancel:!1};if(this.fire("BeforeOpen",e),1!=e.cancel&&(this.fire("opening",e),1!=e.cancel))if(this.popupEl){var i={};t&&(i.xy=[t.pageX,t.pageY]),this.showAtEl(this.popupEl,i)}else this.show()},doHide:function(t){var e={popupEl:this.popupEl,htmlEvent:t,cancel:!1};this.fire("BeforeClose",e),1!=e.cancel&&this.close()},show:function(t,e){this.showAtPos(t,e)},showAtPos:function(t,e){
//if (!this.isRender()) {
this.render(document.body),t||0===t||(t="center"),e||0===e||(e="middle"),this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this._measureSize();var i=mini.getViewportBox(),n=mini.getBox(this.el);"left"==t&&(t=0),"center"==t&&(t=i.width/2-n.width/2),"right"==t&&(t=i.width-n.width),"top"==e&&(e=0),"middle"==e&&(e=i.y+i.height/2-n.height/2),"bottom"==e&&(e=i.height-n.height),t+n.width>i.right&&(t=i.right-n.width),e+n.height>i.bottom&&(e=i.bottom-n.height-2),this._Show(t,e)},_doModal:function(){if(jQuery(this._modalEl).remove(),this.showModal&&0!=this.visible){var t=document.documentElement,e=parseInt(Math.max(document.body.scrollWidth,t?t.scrollWidth:0)),i=parseInt(Math.max(document.body.scrollHeight,t?t.scrollHeight:0)),n=mini.getViewportBox(),s=n.height;s<i&&(s=i);var o=n.width;o<e&&(o=e),this._modalEl=mini.append(document.body,'<div class="mini-modal"></div>'),this._modalEl.style.height=s+"px",this._modalEl.style.width=o+"px",this._modalEl.style.zIndex=this._zIndex-1,mini.setStyle(this._modalEl,this.modalStyle)}},_doShim:function(){
//if (!mini.isIE || !mini_useShims) return;
if(mini_useShims){if(!this._shimEl){this._shimEl=mini.append(document.body,"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 0; height: 0; top: 0;left:0;scrolling:no;'></iframe>")}this._shimEl.style.display="none",this._doShimTimer&&(clearTimeout(this._doShimTimer),this._doShimTimer=null);var t=this;this._doShimTimer=setTimeout(function(){t._doShimTimer=null,function n(){this._shimEl.style.display="";var t=mini.getBox(this.el),e=this._shimEl.style;e.width=t.width+"px",e.height=t.height+"px",e.left=t.x+"px",e.top=t.y+"px";var i=jQuery(this.el).css("zIndex");isNaN(i)||(this._shimEl.style.zIndex=i-3)}.call(t)},20)}},_doShadow:function(){this.shadowEl||(this.shadowEl=mini.append(document.body,'<div class="mini-shadow"></div>')),this.shadowEl.style.display=this.showShadow?"":"none",this.shadowEl.style.display="none"},_measureSize:function(){this.el.style.display="";var t=mini.getBox(this.el);t.width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),t=mini.getBox(this.el)),t.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),t=mini.getBox(this.el)),t.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),t=mini.getBox(this.el)),t.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),t=mini.getBox(this.el))},_getWindowOffset:function(t){return[0,0]},showAtEl:function(t,e){if(t=mini.byId(t)){this.isRender()&&this.el.parentNode==document.body||this.render(document.body);var i={atEl:t,popupEl:this.el,xAlign:this.xAlign,yAlign:this.yAlign,xOffset:this.xOffset,yOffset:this.yOffset,popupCls:this.popupCls,alwaysView:this.alwaysView};mini.copyTo(i,e),mini.addClass(t,i.popupCls),t.popupCls=i.popupCls,this._popupEl=t,this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this.doLayout(),this._measureSize();var n=mini.getViewportBox(),s=mini.getBox(this.el),o=mini.getBox(t),r=i.xy,a=n.width/2-s.width/2,l=0;switch(r&&(a=r[0],l=r[1]),i.xAlign){case"outleft":a=o.x-s.width;break;case"left":a=o.x;break;case"center":a=o.x+o.width/2-s.width/2;break;case"right":a=o.right-s.width;break;case"outright":a=o.right}switch(i.yAlign){case"above":l=o.y-s.height;break;case"top":l=o.y;break;case"middle":l=o.y+o.height/2-s.height/2;break;case"bottom":l=o.bottom-s.height;break;case"below":l=o.bottom}a=parseInt(a),l=parseInt(l);var h=this._getWindowOffset(e);if(i.outYAlign||i.outXAlign){if("above"==i.outYAlign&&l+s.height>n.height&&(l=o.y-s.height),"below"==i.outYAlign&&l<0&&(l=o.bottom),"outleft"==i.outXAlign&&a+s.width>n.right){var d=o.x-n.x;n.right-o.right<d&&(a=o.x-s.width)}"right"==i.outXAlign&&a+s.width>n.right&&(a=o.right-s.width),i.alwaysView&&(l<0&&(l=0),l+s.height>n.height&&(l=n.height-s.height),a<0&&(a=0),a+s.width>n.right&&(a=n.right-s.width)),this._Show(a+h[0],l+h[1])}else this.showAtPos(a+i.xOffset+h[0],l+i.yOffset+h[1])}},_Show:function(t,e){this.el.style.display="",this.el.style.zIndex=this._zIndex=mini.getMaxZIndex(),mini.setX(this.el,t),mini.setY(this.el,e),this.setVisible(!0),"mouseout"==this.hideAction&&mini.on(document,"mousemove",this.__OnBodyMouseMove,this);this._doShadow(),this._doModal(),this._doShim(),mini.layoutIFrames(this.el),this.isPopup=!0,mini.on(document,"mousedown",this.__OnBodyMouseDown,this),mini.on(window,"resize",this.__OnWindowResize,this),this.fire("Open")},open:function(){this.show()},close:function(){this.hide()},hide:function(){this.el&&(this.popupEl&&mini.removeClass(this.popupEl,this.popupEl.popupCls),this._popupEl&&mini.removeClass(this._popupEl,this._popupEl.popupCls),this._popupEl=null,jQuery(this._modalEl).remove(),this.shadowEl&&(this.shadowEl.style.display="none"),this._shimEl&&(this._shimEl.style.display="none"),mini.un(document,"mousemove",this.__OnBodyMouseMove,this),mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this),this.setVisible(!1),this.isPopup=!1,this.fire("Close"))},setPopupEl:function(t){(t=mini.byId(t))&&(this._unbindPopupEl(),this.popupEl=t,this._bindPopupEl())},setPopupCls:function(t){this.popupCls=t},setShowAction:function(t){this.showAction=t},setHideAction:function(t){this.hideAction=t},setShowDelay:function(t){this.showDelay=t},setHideDelay:function(t){this.hideDelay=t},setXAlign:function(t){this.xAlign=t},setYAlign:function(t){this.yAlign=t},setxOffset:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.xOffset=t},setyOffset:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.yOffset=t},setShowModal:function(t){this.showModal=t},setShowShadow:function(t){this.showShadow=t},setMinWidth:function(t){isNaN(t)||(this.minWidth=t)},setMinHeight:function(t){isNaN(t)||(this.minHeight=t)},setMaxWidth:function(t){isNaN(t)||(this.maxWidth=t)},setMaxHeight:function(t){isNaN(t)||(this.maxHeight=t)},setAllowDrag:function(t){this.allowDrag=t,mini.removeClass(this.el,this._dragCls),t&&mini.addClass(this.el,this._dragCls)},setAllowResize:function(t){this.allowResize=t,mini.removeClass(this.el,this._resizeCls),t&&mini.addClass(this.el,this._resizeCls)},__OnLeftClick:function(t){if(!this._inAniming&&"leftclick"==this.showAction){var e=jQuery(this.popupEl).attr("allowPopup");"false"!=String(e)&&this.doShow(t)}},__OnRightClick:function(t){if(!this._inAniming&&"rightclick"==this.showAction){var e=jQuery(this.popupEl).attr("allowPopup");"false"!=String(e)&&(t.preventDefault(),this.doShow(t))}},__OnMouseOver:function(t){if(!this._inAniming&&"mouseover"==this.showAction){var e=jQuery(this.popupEl).attr("allowPopup");if("false"!=String(e)&&(clearTimeout(this._hideTimer),this._hideTimer=null,!this.isPopup)){var i=this;this._showTimer=setTimeout(function(){i.doShow(t)},this.showDelay)}}},__OnBodyMouseMove:function(t){"mouseout"==this.hideAction&&this._tryHide(t)},__OnBodyMouseDown:function(t){"outerclick"==this.hideAction&&this.isPopup&&(jQuery(t.target).closest(this.el)[0]||this.within(t)||this.popupEl&&mini.isAncestor(this.popupEl,t.target)||this.doHide(t))},_tryHide:function(t){if(mini.isAncestor(this.el,t.target)||this.popupEl&&mini.isAncestor(this.popupEl,t.target));else{if(clearTimeout(this._showTimer),this._showTimer=null,this._hideTimer)return;var e=this;this._hideTimer=setTimeout(function(){e.doHide(t)},this.hideDelay)}},__OnWindowResize:function(t){this.isDisplay()&&!mini.isIE6&&this._doModal()},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=mini.getChildControls(this),i=0,n=e.length;i<n;i++){if(e[i].within(t))return!0}return!1}},mini.copyTo(mini.Popup.prototype,mini.Popup_prototype),
//            ///if(location.href.indexOf("menubar.html") != -1) alert(123)
//            //if(location.href.indexOf("menubar") != -1) debugger
//                //if (location.href.indexOf("menubar.html") != -1) alert(123)
//                //if (location.href.indexOf("menubar.html") != -1) alert(222)
function(){if(hasOn){var i=mini.getTopWindow();if(i){function t(t,e){e==document||jQuery(document).trigger("mousedown")}function e(t){var e=i.jQuery;e&&e(i.document).trigger("topmousedown",[document])}jQuery(i.document).on("topmousedown",t),jQuery(document).on("mousedown",e),jQuery(window).on("unload",function(){jQuery(i.document).off("topmousedown",t),jQuery(document).off("mousedown",e)})}}}(),mini.Button=function(){mini.Button.superclass.constructor.apply(this,arguments)},mini.extend(mini.Button,mini.Control,{text:"",iconCls:"",iconStyle:"",plain:!1,checkOnClick:!1,checked:!1,groupName:"",img:"",_plainCls:"mini-button-plain",_hoverCls:"mini-button-hover",_pressedCls:"mini-button-pressed",_checkedCls:"mini-button-checked",_disabledCls:"mini-button-disabled",allowCls:"",_clearBorder:!1,set:function(t){return"string"==typeof t||(this._allowUpdate=t.text||t.iconStyle||t.iconCls||t.iconPosition,mini.Button.superclass.set.call(this,t),!1===this._allowUpdate&&(this._allowUpdate=!0,this.doUpdate())),this},uiCls:"mini-button",_create:function(){this.el=document.createElement("a"),this.el.className="mini-button mini-state-default mini-corner-all",this.el.hideFocus=!0,this.el.href="javascript:void(0)",this.doUpdate()},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this.el,"click",this.__OnClick,this)},this)},destroy:function(t){this.el&&(this.el.onclick=null,this.el.onmousedown=null),this.menu&&(this.menu.owner=null),this.menu=null,mini.Button.superclass.destroy.call(this,t)},doUpdate:function(){if(!1!==this._allowUpdate){var t="",e=this.text,i=this.iconStyle||this.iconCls||this.img;i&&e?t=" mini-button-icon-text ":i&&""===e?(t=" mini-button-icon-only ",e="&nbsp;"):""==e&&(e="&nbsp;");var n=this.iconStyle||"";!n&&this.img&&(n="background-image:url("+this.img+")");var s="";i&&(s='<span class="mini-button-icon mini-icon mini-iconfont '+this.iconCls+'" style="'+n+'"></span>');var o='<span class="mini-button-inner '+t+'">'+s+(e='<span class="mini-button-text">'+e+"</span>")+"</span>";this.allowCls&&(o=o+'<span class="mini-button-allow mini-icon '+this.allowCls+'"></span>'),this.el.innerHTML=o}},href:"",setHref:function(t){this.href=t,this.el.href=t;var e=this.el;setTimeout(function(){e.onclick=null},100)},getHref:function(){return this.href},target:"",setTarget:function(t){this.target=t,this.el.target=t},getTarget:function(){return this.target},setText:function(t){this.text!=t&&(this.text=t,this.doUpdate())},getText:function(){return this.text},setIconCls:function(t){this.iconCls=t,this.doUpdate()},getIconCls:function(){return this.iconCls},setIconStyle:function(t){this.iconStyle=t,this.doUpdate()},getIconStyle:function(){return this.iconStyle},setImg:function(t){this.img=t,this.doUpdate()},getImg:function(){return this.img},setIconPosition:function(t){this.iconPosition="left",this.doUpdate()},getIconPosition:function(){return this.iconPosition},setPlain:function(t){(this.plain=t)?this.addCls(this._plainCls):this.removeCls(this._plainCls)},getPlain:function(){return this.plain},setGroupName:function(t){this.groupName=t},getGroupName:function(){return this.groupName},setCheckOnClick:function(t){this.checkOnClick=t},getCheckOnClick:function(){return this.checkOnClick},setChecked:function(t){var e=this.checked!=t;(this.checked=t)?this.addCls(this._checkedCls):this.removeCls(this._checkedCls),e&&this.fire("CheckedChanged")},getChecked:function(){return this.checked},doClick:function(){this.__OnClick(null)},__OnClick:function(t){if(!this.href&&t&&t.preventDefault(),!this.readOnly&&0!=this.enabled){if(this.focus(),this.checkOnClick)if(this.groupName){var e=this.groupName,i=mini.findControls(function(t){if("button"==t.type&&t.groupName==e)return!0});if(0<i.length){for(var n=0,s=i.length;n<s;n++){var o=i[n];o!=this&&o.setChecked(!1)}this.setChecked(!0)}else this.setChecked(!this.checked)}else this.setChecked(!this.checked);this.fire("click",{htmlEvent:t})}},__OnMouseDown:function(t){this.isReadOnly()||(this.addCls(this._pressedCls),mini.on(document,"mouseup",this.__OnDocMouseUp,this))},__OnDocMouseUp:function(t){this.removeCls(this._pressedCls),mini.un(document,"mouseup",this.__OnDocMouseUp,this)},onClick:function(t,e){this.on("click",t,e)},getAttrs:function(t){var e=mini.Button.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["text","href","iconCls","iconStyle","iconPosition","groupName","menu","onclick","oncheckedchanged","target","img"]),mini._ParseBool(t,e,["plain","checkOnClick","checked"]),e}}),mini.regClass(mini.Button,"button"),mini.MenuButton=function(){mini.MenuButton.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuButton,mini.Button,{uiCls:"mini-menubutton",allowCls:"mini-button-menu",setMenu:function(t){if(mini.isArray(t)&&(t={type:"menu",items:t}),"string"==typeof t){if(!mini.byId(t))return;mini.parse(t),t=mini.get(t)}if(this.menu!==t){this.menu=mini.getAndCreate(t),this.menu.setPopupEl(this.el),this.menu.setPopupCls("mini-button-popup"),this.menu.setShowAction("leftclick"),this.menu.setHideAction("outerclick"),this.menu.setXAlign("left"),this.menu.setYAlign("below"),this.menu.hide(),(this.menu.owner=this).menu.addCls("mini-menu-open");var e=this;this.menu.on("BeforeOpen",function(t){e.split&&!jQuery(t.htmlEvent.target).closest(".mini-button-split")[0]&&(t.cancel=!0)})}},setEnabled:function(t){(this.enabled=t)?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),
//this.el.allowPopup = !!value;
jQuery(this.el).attr("allowPopup",!!t)}}),mini.regClass(mini.MenuButton,"menubutton"),mini.SplitButton=function(){mini.SplitButton.superclass.constructor.apply(this,arguments)},mini.extend(mini.SplitButton,mini.MenuButton,{split:!0,uiCls:"mini-splitbutton",allowCls:"mini-button-split",__OnClick:function(t){this.split&&jQuery(t.target).closest(".mini-button-split")[0]||(this.menu.hide(),mini.SplitButton.superclass.__OnClick.call(this,t))}}),mini.regClass(mini.SplitButton,"splitbutton"),mini.CheckBox=function(){mini.CheckBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.CheckBox,mini.Control,{formField:!0,_clearText:!1,text:"",checked:!1,defaultValue:!1,trueValue:!0,falseValue:!1,checkedCls:"mini-checkbox-checked",set:function(t){if("string"==typeof t)return this;return mini.isNull(t.trueValue)||(this.setTrueValue(t.trueValue),delete t.trueValue),mini.isNull(t.falseValue)||(this.setFalseValue(t.falseValue),delete t.falseValue),mini.CheckBox.superclass.set.call(this,t),this},uiCls:"mini-checkbox",_create:function(){var t=this.uid+"$check";this.el=document.createElement("span"),this.el.className="mini-checkbox",this.el.innerHTML='<input id="'+t+'" name="'+this.id+'" type="checkbox" class="mini-checkbox-check"><span class="mini-checkbox-icon mini-icon" tabIndex="0"></span><label for="'+t+'" onclick="return false;">'+this.text+"</label>",this._checkEl=this.el.firstChild,this._labelEl=this.el.lastChild},destroy:function(t){this._checkEl&&(this._checkEl.onmouseup=null,this._checkEl.onclick=null,this._checkEl=null),mini.CheckBox.superclass.destroy.call(this,t)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"click",this.__onClick,this);mini.on(this.el,"keyup",function(t){32==t.keyCode&&jQuery(t.target).click()}),this._checkEl.onmouseup=function(){return!1};var t=this;this._checkEl.onclick=function(){if(t.isReadOnly())return!1},this._checkEl.checked=this.checked},this)},setName:function(t){this.name=t,mini.setAttr(this._checkEl,"name",this.name)},setText:function(t){this.text!==t&&(this.text=t,this._labelEl.innerHTML=t)},getText:function(){return this.text},setChecked:function(t){t=!0===t||(String(t)==String(this.trueValue)||("true"==t||("True"==t||("1"===String(t)||"Y"==t)))),this.checked!==t&&(this.checked=!!t,this._checkEl.checked=this.checked,this.value=this.getValue());var e=jQuery(this.el);this.checked?e.addClass(this.checkedCls):e.removeClass(this.checkedCls)},getChecked:function(){return this.checked},setValue:function(t){this.checked!==t&&(this.setChecked(t),this.value=this.getValue())},getValue:function(){return String(1==this.checked?this.trueValue:this.falseValue)},getFormValue:function(){return this.getValue()},setTrueValue:function(t){this._checkEl.value=t,this.trueValue=t},getTrueValue:function(){return this.trueValue},setFalseValue:function(t){this.falseValue=t},getFalseValue:function(){return this.falseValue},__onClick:function(t){this.isReadOnly()||(this.setChecked(!this.checked),this.fire("checkedchanged",{checked:this.checked}),this.fire("valuechanged",{value:this.getValue()}),this.fire("click",t,this))},getAttrs:function(t){var e=mini.CheckBox.superclass.getAttrs.call(this,t),i=jQuery(t);e.text=t.innerHTML,mini._ParseString(t,e,["text","oncheckedchanged","onclick","onvaluechanged"]),mini._ParseBool(t,e,["enabled"]);var n=mini.getAttr(t,"checked");n&&(e.checked="true"==n||"checked"==n);var s=i.attr("trueValue");s&&(e.trueValue=s,s=parseInt(s),isNaN(s)||(e.trueValue=s));var o=i.attr("falseValue");return o&&(e.falseValue=o,o=parseInt(o),isNaN(o)||(e.falseValue=o)),e}}),mini.regClass(mini.CheckBox,"checkbox"),jQuery(function(){setTimeout(function(){for(var t=mini.getComponents(),e=0,i=t.length;e<i;e++){var n=t[e];if(n instanceof mini.TextBox){var s=n.getTextEl().value;n.value!==s&&(n.value=s)}}},300)}),mini.TextBox=function(){mini.TextBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.TextBox,mini.ValidatorBase,{name:"",formField:!0,selectOnFocus:!1,allowInput:!0,minWidth:10,minHeight:15,maxLength:5e3,emptyText:"",text:"",value:"",defaultValue:"",height:21,_emptyCls:"mini-textbox-empty",_focusCls:"mini-textbox-focus",_disabledCls:"mini-textbox-disabled",uiCls:"mini-textbox",_InputType:"text",_create:function(){var t='<input  type="'+this._InputType+'" class="mini-textbox-input" autocomplete="off"/>';"textarea"==this._InputType&&(t='<textarea  class="mini-textbox-input" autocomplete="off"/></textarea>'),t='<span class="mini-textbox-border mini-corner-all">'+t+"</span>",t+='<input type="hidden"/>',this.el=document.createElement("span"),this.el.className="mini-textbox",this.el.innerHTML=t,this._borderEl=this.el.firstChild,this._textEl=this._borderEl.firstChild,this._valueEl=this._borderEl.lastChild,this._doEmpty()},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this._textEl,"drop",this.__OnDropText,this),mini_onOne(this._textEl,"change",this.__OnInputTextChanged,this),mini_onOne(this._textEl,"focus",this.__OnFocus,this),mini_onOne(this.el,"mousedown",this.__OnMouseDown,this);var t=this.value;this.value=null,this.el&&this.setValue(t)},this),this.on("validation",this.__OnValidation,this)},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini.on(this._textEl,"blur",this.__OnBlur,this),mini.on(this._textEl,"keydown",this.__OnInputKeyDown,this),mini.on(this._textEl,"keyup",this.__OnInputKeyUp,this),mini.on(this._textEl,"keypress",this.__OnInputKeyPress,this),mini_onOne(this.el,"click",this.__OnClick,this))},destroy:function(t){if(this.el&&(this.el.onmousedown=null),this._textEl){var e=this._textEl;e._placeholder_label&&(e._placeholder_label.onmousedown=null,e._placeholder_label=null),e.onpropertychange=e.ondrop=e.onchange=e.onfocus=null,mini.clearEvent(e),this._textEl=null}this._valueEl&&(mini.clearEvent(this._valueEl),this._valueEl=null),mini.TextBox.superclass.destroy.call(this,t)},doLayout:function(){this._doLabelLayout&&this._labelLayout()},setHeight:function(t){parseFloat(t)==t&&(t+="px"),this.height=t,"textarea"==this._InputType&&(this.el.style.height=t,this.doLayout())},setName:function(t){this.name!=t&&(this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name))},setValue:function(t){null!==t&&t!==undefined||(t=""),(t=String(t)).length>this.maxLength&&(t=t.substring(0,this.maxLength)),
//if (this.value !== value) {
this.value=t,this._valueEl.value=this._textEl.value=t,this._doEmpty()},getValue:function(){return this.value},setText:function(t){mini.isNull(t)&&(t=""),this._textEl.value=t},getText:function(){return this._textEl.value},getFormValue:function(){var t=this.value;return null!==t&&t!==undefined||(t=""),String(t)},setAllowInput:function(t){this.allowInput!=t&&(this.allowInput=t,this.doUpdate())},getAllowInput:function(){return this.allowInput},_placeholdered:!1,_doEmpty:function(){this._textEl.placeholder=this.emptyText,this.emptyText&&mini._placeholder(this._textEl)},setEmptyText:function(t){this.emptyText!=t&&(this.emptyText=t,this._doEmpty())},getEmptyText:function(){return this.emptyText},setMaxLength:function(t){this.maxLength=t,mini.setAttr(this._textEl,"maxLength",t),"textarea"==this._InputType&&mini.isIE&&(mini.on(this._textEl,"keyup",this.__OnMaxLengthKeyUp,this),mini.on(this._textEl,"keypress",this.__OnMaxLengthKeyUp,this),mini.on(this._textEl,"paste",this.__OnPaste,this))},__OnPaste:function(t){var e=this;setTimeout(function(){var t=e._textEl.value;t.length>e.maxLength&&(e._textEl.value=t.substring(0,e.maxLength)),e.__OnInputTextChanged()},0)},__OnMaxLengthKeyUp:function(t){this._textEl.value.length>=this.maxLength&&(this.__OnPaste(t),t.preventDefault())},getMaxLength:function(){return this.maxLength},setReadOnly:function(t){this.readOnly!=t&&(this.readOnly=t,this.doUpdate())},setEnabled:function(t){this.enabled!=t&&(this.enabled=t,this.doUpdate())},doUpdate:function(){this.enabled?this.removeCls(this._disabledCls):this.addCls(this._disabledCls),this.isReadOnly()||0==this.allowInput?(this._textEl.readOnly=!0,mini.addClass(this.el,"mini-textbox-readOnly")):(this._textEl.readOnly=!1,mini.removeClass(this.el,"mini-textbox-readOnly")),this.required?this.addCls(this._requiredCls):this.removeCls(this._requiredCls),this.enabled?this._textEl.disabled=!1:this._textEl.disabled=!0},focus:function(){var i=this;setTimeout(function(){try{if(i._textEl.focus(),mini.isIE){var t=i._textEl.createTextRange();t.collapse(!1),t.select()}}catch(e){}},10)},blur:function(){try{this._textEl.blur()}catch(e){}},selectText:function(){var t=this;!function e(){try{t._textEl.select()}catch(ex){}}()},getTextEl:function(){return this._textEl},getInputText:function(){return this._textEl.value},setSelectOnFocus:function(t){this.selectOnFocus=t},getSelectOnFocus:function(t){return this.selectOnFocus},_errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl||(this._errorIconEl=mini.append(this.el,'<span class="mini-errorIcon"></span>')),this._errorIconEl},_RemoveErrorIcon:function(){if(this._errorIconEl){var t=this._errorIconEl;jQuery(t).remove()}this._errorIconEl=null},__OnClick:function(t){this.enabled&&this.fire("click",{htmlEvent:t})},__OnMouseDown:function(t){var e=this;"textarea"!=this._InputType&&(mini.isAncestor(this._textEl,t.target)?setTimeout(function(){try{e._textEl.focus()}catch(ex){}},1):setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e4,1e4)},1))},__OnInputTextChanged:function(t,e){var i=this.value;this._oldValue=i,this.setValue(this._textEl.value),i===this.getValue()&&!0!==e||this._OnValueChanged()},__OnDropText:function(t){var e=this;setTimeout(function(){e.__OnInputTextChanged(t)},0)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(27==t.keyCode||13==t.keyCode||9==t.keyCode)if("textarea"==this._InputType&&13==t.keyCode);else if(this.__OnInputTextChanged(null),this._textEl.blur(),this._textEl.focus(),13==t.keyCode){this.fire("enter",e)}27==t.keyCode&&t.preventDefault()},__OnInputKeyUp:function(t){if(this.validateOnInput){var e=this.value;this._oldValue=e,this.setValue(this._textEl.value),this._tryValidate()}this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},__OnFocus:function(t){if(this.doUpdate(),!this.isReadOnly()){if(this._focused=!0,this.addCls(this._focusCls),this._initInputEvents(),this.selectOnFocus){var e=this;setTimeout(function(){e.selectText()},1)}this.fire("focus",{htmlEvent:t})}},__OnBlur:function(t){this._focused=!1;var e=this;setTimeout(function(){0==e._focused&&e.removeCls(e._focusCls)},2),
//        if (!this._inputChangedTime || new Date() - this._inputChangedTime < 50) {
this.fire("blur",{htmlEvent:t}),this.validateOnLeave&&this.isEditable()&&this._tryValidate()},inputStyle:"",setInputStyle:function(t){this.inputStyle=t,mini.setStyle(this._textEl,t)},getAttrs:function(t){var e=mini.TextBox.superclass.getAttrs.call(this,t);jQuery(t);return mini._ParseString(t,e,["value","text","emptyText","inputStyle","onenter","onkeydown","onkeyup","onkeypress","onclick","maxLengthErrorText","minLengthErrorText","onfocus","onblur","vtype","emailErrorText","urlErrorText","floatErrorText","intErrorText","dateErrorText","minErrorText","maxErrorText","rangeLengthErrorText","rangeErrorText","rangeCharErrorText"]),mini._ParseBool(t,e,["allowInput","selectOnFocus"]),mini._ParseInt(t,e,["maxLength","minLength","minHeight","minWidth"]),e},vtype:"",setVtype:function(t){this.vtype=t},getVtype:function(){return this.vtype},__OnValidation:function(t){0!=t.isValid&&mini._ValidateVType(this.vtype,t.value,t,this)},setEmailErrorText:function(t){this.emailErrorText=t},getEmailErrorText:function(){return this.emailErrorText},setUrlErrorText:function(t){this.urlErrorText=t},getUrlErrorText:function(){return this.urlErrorText},setFloatErrorText:function(t){this.floatErrorText=t},getFloatErrorText:function(){return this.floatErrorText},setIntErrorText:function(t){this.intErrorText=t},getIntErrorText:function(){return this.intErrorText},setDateErrorText:function(t){this.dateErrorText=t},getDateErrorText:function(){return this.dateErrorText},setMaxLengthErrorText:function(t){this.maxLengthErrorText=t},getMaxLengthErrorText:function(){return this.maxLengthErrorText},setMinLengthErrorText:function(t){this.minLengthErrorText=t},getMinLengthErrorText:function(){return this.minLengthErrorText},setMaxErrorText:function(t){this.maxErrorText=t},getMaxErrorText:function(){return this.maxErrorText},setMinErrorText:function(t){this.minErrorText=t},getMinErrorText:function(){return this.minErrorText},setRangeLengthErrorText:function(t){this.rangeLengthErrorText=t},getRangeLengthErrorText:function(){return this.rangeLengthErrorText},setRangeCharErrorText:function(t){this.rangeCharErrorText=t},getRangeCharErrorText:function(){return this.rangeCharErrorText},setRangeErrorText:function(t){this.rangeErrorText=t},getRangeErrorText:function(){return this.rangeErrorText}}),mini.regClass(mini.TextBox,"textbox"),mini.Password=function(){mini.Password.superclass.constructor.apply(this,arguments)},mini.extend(mini.Password,mini.TextBox,{uiCls:"mini-password",_InputType:"password",getValue:function(){return this._textEl.value}}),mini.regClass(mini.Password,"password"),mini.TextArea=function(){mini.TextArea.superclass.constructor.apply(this,arguments)},mini.extend(mini.TextArea,mini.TextBox,{maxLength:1e7,height:"",minHeight:50,_InputType:"textarea",uiCls:"mini-textarea",doLayout:function(){if(this.canLayout()){mini.TextArea.superclass.doLayout.call(this);var t=mini.getHeight(this.el);mini.isIE6&&mini.setHeight(this._borderEl,t),(t-=2)<0&&(t=0),this._textEl.style.height=t+"px"}}}),mini.regClass(mini.TextArea,"textarea"),mini.ButtonEdit=function(){mini.ButtonEdit.superclass.constructor.apply(this,arguments);var t=this.isReadOnly();!t&&0!=this.allowInput||(this._textEl.readOnly=!0),0==this.enabled&&this.addCls(this._disabledCls),t&&this.addCls(this._readOnlyCls),this.required&&this.addCls(this._requiredCls)},mini.extend(mini.ButtonEdit,mini.ValidatorBase,{name:"",formField:!0,selectOnFocus:!1,showButton:!0,buttonToolTip:"",closeToolTip:"",showClose:!1,emptyText:"",defaultValue:"",defaultText:"",value:"",text:"",maxLength:1e3,minLength:0,height:21,inputAsValue:!0,allowInput:!0,_noInputCls:"mini-buttonedit-noInput",_readOnlyCls:"mini-buttonedit-readOnly",_disabledCls:"mini-buttonedit-disabled",_emptyCls:"mini-buttonedit-empty",_focusCls:"mini-buttonedit-focus",_buttonCls:"mini-buttonedit-button",_buttonHoverCls:"mini-buttonedit-button-hover",_buttonPressedCls:"mini-buttonedit-button-pressed",_closeCls:"mini-buttonedit-close",set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;return delete t.text,this._allowUpdate=!(0==t.enabled||0==t.allowInput||t.readOnly),mini.ButtonEdit.superclass.set.call(this,t),!1===this._allowUpdate&&(this._allowUpdate=!0,this.doUpdate()),mini.isNull(i)||this.setText(i),mini.isNull(e)||this.setValue(e),this},uiCls:"mini-buttonedit",setButtons:function(t){var e=this;jQuery(".mini-buttonedit-button:not(.mini-buttonedit-trigger)",this.el).remove(),e.buttons=t||[];var i,n="";for(var s=0,o=e.buttons.length;s<o;s++){var r=e.buttons[s];r.name||(r.name="button"+s),i=r,n+=e._createButtonHtml(i.name,i.iconCls,i.tooltip)}mini.append(e._buttonsEl,n),e._doInputLayout(!1)},getButtons:function(){return this.buttons||[]},getButtonByName:function(t){for(var e=this.getButtons(),i=0,n=e.length;i<n;i++){var s=e[i];if(s.name&&s.name==t)return s}return null},_createButtonHtml:function(t,e,i){return e=e||"",'<span title="'+(i=i||"")+'" name="'+(t=t||"")+'" class="mini-buttonedit-button mini-buttonedit-'+t+'" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-icon mini-icon mini-iconfont '+e+'"></span></span>'},_getButtonsHTML:function(){return'<span class="mini-buttonedit-buttons">'+('<span class="mini-buttonedit-close mini-icon" name="close"></span>'+this._getButtonHtml("trigger","",this.buttonToolTip))+"</span>"},_getButtonHtml:function(t,e,i){return this._createButtonHtml(t,e,i)},_create:function(){this.el=document.createElement("span"),this.el.className="mini-buttonedit";var t=this._getButtonsHTML();this.el.innerHTML='<span class="mini-buttonedit-border mini-corner-all"><input type="text" class="mini-buttonedit-input" autocomplete="off"/>'+t+'</span><input name="'+this.name+'" type="hidden"/>',this._borderEl=this.el.firstChild,this._textEl=this._borderEl.firstChild,this._valueEl=this.el.lastChild,this._buttonsEl=this._borderEl.lastChild,this._buttonEl=this._buttonsEl.lastChild,this._closeEl=this._buttonEl.previousSibling,this._doEmpty()},destroy:function(t){this._textEl&&(this._textEl.onchange=this._textEl.onfocus=null,mini.clearEvent(this._textEl),this._textEl=null),this._borderEl=this._buttonsEl=this._buttonEl=this._closeEl=this._valueEl=null,mini.ButtonEdit.superclass.destroy.call(this,t)},_deferSetText:!0,_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mousedown",this.__OnMouseDown,this),mini_onOne(this._textEl,"focus",this.__OnFocus,this),mini_onOne(this._textEl,"change",this.__OnInputTextChanged,this);var t=this.text;this.text=null,this.el&&this._deferSetText&&this.setText(t),mini.isIE&&mini.on(this._textEl,"input",this.__input,this)},this)},__input:function(){},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini.on(this.el,"click",this.__OnClick,this),mini.on(this._textEl,"blur",this.__OnBlur,this),mini.on(this._textEl,"keydown",this.__OnInputKeyDown,this),mini.on(this._textEl,"keyup",this.__OnInputKeyUp,this),mini.on(this._textEl,"keypress",this.__OnInputKeyPress,this))},_buttonWidth:20,_closeWidth:20,_doInputLayout:function(t){if(this._buttonEl.style.display=this.showButton?"inline-block":"none",this._buttonEl.title=this.buttonToolTip,this._closeEl&&(this._closeEl.style.display=this.showClose?"inline-block":"none",this._closeEl.title=this.closeToolTip),mini.isNull(mini.ButtonEdit._paddingOffset)){var e=mini.getPaddings(this._borderEl);mini.ButtonEdit._paddingOffset=e.left}var i=this._buttonsEl.offsetWidth,n=i+(0<i?0:mini.ButtonEdit._paddingOffset);this._noLayout=0==n,this._borderEl.style.paddingRight=n+"px",!1!==t&&this.doLayout()},doLayout:function(){this._noLayout&&this._doInputLayout(!1),this._doLabelLayout&&this._labelLayout()},setHeight:function(t){parseFloat(t)==t&&(t+="px"),this.height=t},focus:function(){try{this._textEl.focus();var t=this;setTimeout(function(){t._focused&&t._textEl.focus()},10)}catch(e){}},blur:function(){try{this._textEl.blur()}catch(e){}},selectText:function(){this._textEl.select()},getTextEl:function(){return this._textEl},setName:function(t){this.name=t,this._valueEl&&mini.setAttr(this._valueEl,"name",this.name)},setText:function(t){null!==t&&t!==undefined||(t="");this.text;this.text=t,this._textEl.value=t,this._doEmpty()},getText:function(){return this._textEl.value;
//return text != this.emptyText ? text : "";
},setValue:function(t){null!==t&&t!==undefined||(t="");this.value;this.value=t,this._valueEl.value=this.getFormValue()},getValue:function(){return this.value},getFormValue:function(){var t=this.value;return null!==t&&t!==undefined||(t=""),String(t)},_doEmpty:function(){this._textEl.placeholder=this.emptyText,this.emptyText&&mini._placeholder(this._textEl)},setEmptyText:function(t){this.emptyText!=t&&(this.emptyText=t,this._doEmpty())},getEmptyText:function(){return this.emptyText},setMaxLength:function(t){t=parseInt(t),isNaN(t)||(this.maxLength=t,this._textEl.maxLength=t)},getMaxLength:function(){return this.maxLength},setMinLength:function(t){t=parseInt(t),isNaN(t)||(this.minLength=t)},getMinLength:function(){return this.minLength},setEnabled:function(t){mini.ButtonEdit.superclass.setEnabled.call(this,t)},_doReadOnly:function(){var t=this.isReadOnly();t||0==this.allowInput?this._textEl.readOnly=!0:this._textEl.readOnly=!1,t?this.addCls(this._readOnlyCls):this.removeCls(this._readOnlyCls),this.allowInput?this.removeCls(this._noInputCls):this.addCls(this._noInputCls),this.enabled?this._textEl.disabled=!1:this._textEl.disabled=!0},setAllowInput:function(t){this.allowInput=t,this._doReadOnly()},getAllowInput:function(){return this.allowInput},setInputAsValue:function(t){this.inputAsValue=t},getInputAsValue:function(){return this.inputAsValue},autoClear:!1,setAutoClear:function(t){this.autoClear=t},getAutoClear:function(){return this.autoClear},setButtonToolTip:function(t){this.buttonToolTip=t},getButtonToolTip:function(){return this.buttonToolTip},_errorIconEl:null,getErrorIconEl:function(){return this._errorIconEl||(this._errorIconEl=mini.append(this.el,'<span class="mini-errorIcon"></span>')),this._errorIconEl},_RemoveErrorIcon:function(){if(this._errorIconEl){var t=this._errorIconEl;jQuery(t).remove()}this._errorIconEl=null},__OnClick:function(t){if(0!=this.enabled&&(this.fire("click",{htmlEvent:t}),!this.isReadOnly()&&mini.isAncestor(this._borderEl,t.target))){new Date;mini.isAncestor(this._buttonEl,t.target)&&this._OnButtonClick(t),mini.findParent(t.target,this._closeCls)&&(this.autoClear&&(this.value&&0!==this.value||""!==this.text)&&(this._oldValue=this.value,this.setValue(""),this.setText(""),this._OnValueChanged()),this.fire("closeclick",{htmlEvent:t})),this._handlerButtonElClick(t)}},_handlerButtonElClick:function(t){var e=mini.findParent(t.target,"mini-buttonedit-button");if(e&&e!=this._buttonEl&&e!=this._closeEl){var i=jQuery(e).attr("name"),n=this.getButtonByName(i),s={sender:this,button:n,htmlEvent:t};n.handler&&n.handler(s)}},__OnMouseDown:function(t){if(!this.isReadOnly()&&0!=this.enabled&&mini.isAncestor(this._borderEl,t.target)&&!mini.isAncestor(this._textEl,t.target)){this._clickTarget=t.target;var e=this;if(setTimeout(function(){e.focus(),mini.selectRange(e._textEl,1e3,1e3)},1),mini.isAncestor(this._buttonEl,t.target)){var i=mini.findParent(t.target,"mini-buttonedit-up"),n=mini.findParent(t.target,"mini-buttonedit-down");i?(mini.addClass(i,this._buttonPressedCls),this._OnButtonMouseDown(t,"up")):n?(mini.addClass(n,this._buttonPressedCls),this._OnButtonMouseDown(t,"down")):(mini.addClass(this._buttonEl,this._buttonPressedCls),this._OnButtonMouseDown(t))}mini.on(document,"mouseup",this.__OnDocMouseUp,this);var s=mini.findParent(t.target,"mini-buttonedit-button");s&&mini.addClass(s,this._buttonPressedCls)}},__OnDocMouseUp:function(t){this._clickTarget=null;var n=this;setTimeout(function(){for(var t=n._buttonEl.getElementsByTagName("*"),e=0,i=t.length;e<i;e++)mini.removeClass(t[e],n._buttonPressedCls);mini.removeClass(n._buttonEl,n._buttonPressedCls),mini.removeClass(n.el,n._pressedCls),jQuery(".mini-buttonedit-button",n._buttonsEl).removeClass(n._buttonPressedCls)},80),mini.un(document,"mouseup",this.__OnDocMouseUp,this)},__OnFocus:function(t){this.doUpdate(),this._initInputEvents(),this.isReadOnly()||(this._focused=!0,this.addCls(this._focusCls),this.selectOnFocus&&this.selectText(),this.fire("focus",{htmlEvent:t}))},__doFocusCls:function(){0==this._focused&&this.removeCls(this._focusCls)},__fireBlur:function(e){var i=this;setTimeout(function(){(function t(){0==i._focused&&(i.removeCls(i._focusCls),i.validateOnLeave&&i.isEditable()&&i._tryValidate(),this.fire("blur",{htmlEvent:e}))}).call(i)},2)},__OnBlur:function(t){var e=this;e._focused=!1,setTimeout(function(){e.__fireBlur(t)},10)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(27==t.keyCode||13==t.keyCode||9==t.keyCode){if(this.__OnInputTextChanged(null),13==t.keyCode){this.fire("enter",e)}}27==t.keyCode&&t.preventDefault()},__OnInputTextChanged:function(){var t=this._textEl.value;if(t!=this.text){var e=this.getValue();this._oldValue=e,this.setText(t),this.inputAsValue&&(this.setValue(t),e!==this.getFormValue()&&this._OnValueChanged())}},__OnInputKeyUp:function(t){this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},_OnButtonClick:function(t){var e={htmlEvent:t,cancel:!1};this.fire("beforebuttonclick",e),1!=e.cancel&&this.fire("buttonclick",e)},_OnButtonMouseDown:function(t,e){this.focus(),this.addCls(this._focusCls),this.fire("buttonmousedown",{htmlEvent:t,spinType:e})},onButtonClick:function(t,e){this.on("buttonclick",t,e)},onButtonMouseDown:function(t,e){this.on("buttonmousedown",t,e)},onTextChanged:function(t,e){this.on("textchanged",t,e)},textName:"",setTextName:function(t){this.textName=t,this._textEl&&mini.setAttr(this._textEl,"name",this.textName)},getTextName:function(){return this.textName},setSelectOnFocus:function(t){this.selectOnFocus=t},getSelectOnFocus:function(t){return this.selectOnFocus},setShowClose:function(t){this.showClose=t,this._doInputLayout()},getShowClose:function(t){return this.showClose},setShowButton:function(t){this.showButton=t,this._doInputLayout()},getShowButton:function(){return this.showButton},inputStyle:"",setInputStyle:function(t){this.inputStyle=t,mini.setStyle(this._textEl,t)},getAttrs:function(t){var e=mini.ButtonEdit.superclass.getAttrs.call(this,t);jQuery(t);mini._ParseString(t,e,["value","text","textName","emptyText","inputStyle","defaultText","onenter","onkeydown","onkeyup","onkeypress","onbuttonclick","onbuttonmousedown","ontextchanged","onfocus","onblur","oncloseclick","onclick","buttons","buttonToolTip"]),mini._ParseBool(t,e,["allowInput","inputAsValue","selectOnFocus","showClose","showButton","autoClear"]),mini._ParseInt(t,e,["maxLength","minLength"]);var i=e.buttons;return i&&(i=window.eval("("+i+")"),e.buttons=i||null),e}}),mini.regClass(mini.ButtonEdit,"buttonedit"),mini.PopupEdit=function(){mini.PopupEdit.superclass.constructor.apply(this,arguments),this._createPopup(),this.el.className+=" mini-popupedit"},mini.extend(mini.PopupEdit,mini.ButtonEdit,{uiCls:"mini-popupedit",popup:null,popupCls:"mini-buttonedit-popup",_hoverCls:"mini-buttonedit-hover",_pressedCls:"mini-buttonedit-pressed",_destroyPopup:!0,destroy:function(t){this.isShowPopup()&&this.hidePopup(),this.popup&&(this._destroyPopup&&this.popup.destroy(),this.popup=null),this._popupInner&&(this._popupInner.owner=null,this._popupInner=null),this.el&&(this.el.onmouseover=this.el.onmouseout=null),this._listbox=this.tree=null,mini.PopupEdit.superclass.destroy.call(this,t)},_initEvents:function(){mini.PopupEdit.superclass._initEvents.call(this),mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this)},this)},__OnBlur:function(t){this._focused=!1,this._clickTarget&&mini.isAncestor(this.el,this._clickTarget)||this.isShowPopup()||mini.PopupEdit.superclass.__OnBlur.call(this,t)},__OnMouseOver:function(t){if(!this.isReadOnly()&&!this.allowInput&&mini.findParent(t.target,"mini-buttonedit-border")){var e=mini.findParent(t.target,"mini-buttonedit-button");e&&e!=this._buttonEl||this.addCls(this._hoverCls)}},__OnMouseOut:function(t){this.isReadOnly()||this.allowInput||this.removeCls(this._hoverCls)},__OnMouseDown:function(t){this.isReadOnly()||(mini.PopupEdit.superclass.__OnMouseDown.call(this,t),0==this.allowInput&&mini.findParent(t.target,"mini-buttonedit-border")&&(mini.addClass(this.el,this._pressedCls),mini.on(document,"mouseup",this.__OnDocMouseUp,this)))},__OnInputKeyDown:function(t){if(this.fire("keydown",{htmlEvent:t}),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;9!=t.keyCode&&27!=t.keyCode?(13==t.keyCode&&this.fire("enter"),this.isShowPopup()&&(13!=t.keyCode&&27!=t.keyCode||t.stopPropagation())):this.hidePopup()},__OnInputTextChanged:function(t){this.isShowPopup()?this._textChanged=!0:(this._textChanged=!1,mini.PopupEdit.superclass.__OnInputTextChanged.call(this,t))},within:function(t){return!!mini.isAncestor(this.el,t.target)||!!this.popup.within(t)},popupWidth:"100%",popupMinWidth:50,popupMaxWidth:2e3,popupHeight:"",popupMinHeight:30,popupMaxHeight:2e3,showPopupOnClick:!1,setPopup:function(t){"string"==typeof t&&(mini.parse(t),t=mini.get(t));var e=mini.getAndCreate(t);e&&(e.setVisible(!1),(this._popupInner=e).owner=this,e.on("beforebuttonclick",this.__OnPopupButtonClick,this))},getPopup:function(){return this.popup||this._createPopup(),this.popup},_createPopup:function(){this.popup=new mini.Popup,this.popup.setShowAction("none"),this.popup.setHideAction("outerclick"),this.popup.setPopupEl(this.el),(this.popup.__parent=this).popup.el.setAttribute("attached","true"),this.popup.on("BeforeClose",this.__OnPopupBeforeClose,this),this.popup.on("close",this.__OnPopupClose,this),mini.on(this.popup.el,"keydown",this.__OnPopupKeyDown,this)},__OnPopupClose:function(t){},__OnPopupBeforeClose:function(t){this.within(t.htmlEvent)?t.cancel=!0:this._unDocumentMousewheel()},__OnPopupKeyDown:function(t){},showPopup:function(){var t={cancel:!1};if(!1!==this._firebeforeshowpopup&&(this.fire("beforeshowpopup",t),1==t.cancel))return!1;var e=this.getPopup();this._syncShowPopup(),e.on("Close",this.__OnPopupHide,this),this._onDocumentMousewheel(),this.fire("showpopup")},_unDocumentMousewheel:function(){mini.un(document,"mousewheel",this.__OnDocumentMousewheel,this),this._mousewheelXY=null},_onDocumentMousewheel:function(){this._unDocumentMousewheel(),this._mousewheelXY=mini.getXY(this.el),mini.on(document,"mousewheel",this.__OnDocumentMousewheel,this)},__OnDocumentMousewheel:function(t){var i=this;setTimeout(function n(){if(i.isShowPopup()){var t=i._mousewheelXY,e=mini.getXY(i.el);t[0]!=e[0]||t[1]!=e[1]?i.hidePopup():setTimeout(n,300)}},300)},_syncShowPopup:function(){var t=this.getPopup();this._popupInner&&this._popupInner.el.parentNode!=this.popup._contentEl&&(this.popup._contentEl.appendChild(this._popupInner.el),this._popupInner.setVisible(!0));var e=mini.getBox(this._borderEl),i=this.popupWidth;"100%"==this.popupWidth&&(i=e.width),t.show(-1e3,-1e3),t.setWidth(i);var n=parseInt(this.popupHeight);isNaN(n)?t.setHeight("auto"):t.setHeight(n),t.setMinWidth(this.popupMinWidth),t.setMinHeight(this.popupMinHeight),t.setMaxWidth(this.popupMaxWidth),t.setMaxHeight(this.popupMaxHeight);var s={xAlign:"left",yAlign:"below",outYAlign:"above",outXAlign:"right",popupCls:this.popupCls,alwaysView:this.alwaysView};this._doShowAtEl(this._borderEl,s)},_doShowAtEl:function(t,e){this.getPopup().showAtEl(t,e)},__OnPopupHide:function(t){this._textChanged&&(this._textChanged=!1,this.__OnInputTextChanged()),this.__doFocusCls(),this.fire("hidepopup")},hidePopup:function(){this.isShowPopup()&&(this.getPopup().close(),!1!==this._autoBlur&&this.blur())},isShowPopup:function(){return!(!this.popup||!this.popup.isDisplay())},alwaysView:!0,setAlwaysView:function(t){this.alwaysView=t},getAlwaysView:function(){return this.alwaysView},setPopupWidth:function(t){this.popupWidth=t},setPopupMaxWidth:function(t){this.popupMaxWidth=t},setPopupMinWidth:function(t){this.popupMinWidth=t},getPopupWidth:function(t){return this.popupWidth},getPopupMaxWidth:function(t){return this.popupMaxWidth},getPopupMinWidth:function(t){return this.popupMinWidth},setPopupHeight:function(t){this.popupHeight=t},setPopupMaxHeight:function(t){this.popupMaxHeight=t},setPopupMinHeight:function(t){this.popupMinHeight=t},getPopupHeight:function(t){return this.popupHeight},getPopupMaxHeight:function(t){return this.popupMaxHeight},getPopupMinHeight:function(t){return this.popupMinHeight},setShowPopupOnClick:function(t){this.showPopupOnClick=t},getShowPopupOnClick:function(t){return this.showPopupOnClick},__OnClick:function(t){if(0!=this.enabled&&(this.fire("click",{htmlEvent:t}),!this.isReadOnly())){if(mini.isAncestor(this._buttonEl,t.target)&&this._OnButtonClick(t),mini.findParent(t.target,this._closeCls))return this.isShowPopup()&&this.hidePopup(),this.autoClear&&(this.value&&0!==this.value||""!==this.text)&&(this.setValue(""),this.setText(""),this._OnValueChanged()),void this.fire("closeclick",{htmlEvent:t});if(0==this.allowInput||mini.isAncestor(this._buttonEl,t.target)||this.showPopupOnClick){var e=mini.findParent(t.target,"mini-buttonedit-button");if(e&&e!=this._buttonEl);else if(this.isShowPopup())this.hidePopup(),this.focus();else{var i=this;setTimeout(function(){i.showPopup()},1)}}this._handlerButtonElClick(t)}},__OnPopupButtonClick:function(t){"close"==t.name&&this.hidePopup(),t.cancel=!0},setText:function(t){null!==t&&t!==undefined||(t=""),t=mini.htmlDecode(t),
// var fire = this.text !== value;
this.text=t,this._textEl.value=t,this._doEmpty()},getAttrs:function(t){var e=mini.PopupEdit.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["popupWidth","popupHeight","popup","onshowpopup","onhidepopup","onbeforeshowpopup"]),mini._ParseInt(t,e,["popupMinWidth","popupMaxWidth","popupMinHeight","popupMaxHeight"]),mini._ParseBool(t,e,["showPopupOnClick","alwaysView"]),e}}),mini.regClass(mini.PopupEdit,"popupedit"),mini.ComboBox=function(){this.data=[],this.columns=[],mini.ComboBox.superclass.constructor.apply(this,arguments),this._initInput()},mini.extend(mini.ComboBox,mini.PopupEdit,{_initInput:function(){var t=this;isFirefox&&(this._textEl.oninput=function(){t._tryQuery()})},__input:function(){document.activeElement==this._textEl&&this._tryQuery()},text:"",value:"",valueField:"id",textField:"text",dataField:"",groupField:"group",delimiter:",",enableGroup:!1,multiSelect:!1,multiLabel:!1,data:[],url:"",valueInCheckOrder:!0,columns:[],allowInput:!1,valueFromSelect:!1,popupMaxHeight:200,setDelimiter:function(t){this.delimiter=t,this._listbox&&(this._listbox.delimiter=t)},getDelimiter:function(){return this.delimiter},autoFocusItem:!1,setAutoFocusItem:function(t){this.autoFocusItem=t},getAutoFocusItem:function(){return this.autoFocusItem},set:function(t){if("string"==typeof t)return this;var e=t.text;delete t.text;var i=t.value;delete t.value;var n=t.url;delete t.url;var s=t.data;return delete t.data,mini.ComboBox.superclass.set.call(this,t),mini.isNull(s)||(this.setData(s),t.data=s),mini.isNull(n)||(this.setUrl(n),t.url=n),mini.isNull(i)||(this.setValue(i),t.value=i),mini.isNull(e)||this.setText(e),this},uiCls:"mini-combobox",_createPopup:function(){mini.ComboBox.superclass._createPopup.call(this),this._listbox=new mini.ListBox,this.listbox=this._listbox,this._listbox.delimiter=this.delimiter,this._listbox.setBorderStyle("border:0;"),this._listbox.setStyle("width:100%;height:auto;"),this._listbox.setEnableGroup(this.enableGroup),this._listbox.setGroupField(this.groupField),this._listbox.render(this.popup._contentEl),this._listbox.on("beforeitemclick",this.__OnBeforeItemClick,this),this._listbox.on("itemclick",this.__OnItemClick,this),this._listbox.on("drawcell",this.__OnItemDrawCell,this);var e=this;this._listbox.on("beforeload",function(t){e.fire("beforeload",t)},this),this._listbox.on("preload",function(t){e.fire("preload",t)},this),this._listbox.on("load",function(t){e.data=t.data,e.fire("load",t)},this),this._listbox.on("loaderror",function(t){e.fire("loaderror",t)},this)},showPopup:function(){var t={cancel:!1};if(this.fire("beforeshowpopup",t),this._firebeforeshowpopup=!1,1!=t.cancel){this._listbox.setHeight("auto"),mini.ComboBox.superclass.showPopup.call(this);var e=this.popup.el.style.height;""==e||"auto"==e?this._listbox.setHeight("auto"):this._listbox.setHeight("100%");if(!this.multiSelect){var i=jQuery("table .mini-listbox-checkbox",this._listbox.el),n=i.css("display");i.css("display","table-cell"),i.css("display",n)}this._listbox.setValueInCheckOrder(this.valueInCheckOrder),this._listbox.setValue(this.value),this.autoFocusItem&&(""==this.value||mini.isNull(this.value))&&this._listbox._focusItem(0)}},changeOnSelectMethod:!1,isSelected:function(t){return this._listbox.isSelected(t)},_syncValueText:function(){var t=this._listbox.getSelecteds(),e=this._listbox.getValueAndText(t);this.setValue(e[0]),this.setText(e[1])},selectAll:function(){this._listbox.selectAll(),this._syncValueText()},deselectAll:function(){this._listbox.deselectAll(),this._syncValueText()},deselect:function(t){this._listbox.deselect(t),this._syncValueText()},select:function(t){this._listbox.deselectAll(),(t=this.getItem(t))&&(this._oldValue=this.getValue(),this._listbox.select(t),this.__OnItemClick({item:t},!1),this.changeOnSelectMethod&&this._OnValueChanged())},selects:function(t){if(t){var e=this._listbox.getValueAndText(t);this.setValue(e[0]),this._listbox.setValue(this.value)}},getItem:function(t){return"object"==typeof t?t:this.data[t]},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},load:function(t){"string"==typeof t?this.setUrl(t):this.setData(t)},_eval:function(t){return window.eval("("+t+")")},setData:function(t){"string"==typeof t&&(t=this._eval(t)),mini.isArray(t)||(t=[]),this._listbox.setData(t),this.data=this._listbox.data,this.doDataChange()},getData:function(){return this.data},clearOnLoad:!0,setClearOnLoad:function(t){this.clearOnLoad=t},getClearOnLoad:function(){return this.clearOnLoad},doDataChange:function(){var t=this._listbox.getValueAndText(this.value),e=t[0],i=t[1];""!==e||this.clearOnLoad||(e=this.value,i=this.text,this.value=null),this.text=this._textEl.value=i,this.setValue(e)},setUrl:function(t){this.getPopup(),this._listbox.setUrl(t),this.url=this._listbox.url,this.data=this._listbox.data,this.doDataChange()},getUrl:function(){return this.url},setValueField:function(t){this.valueField=t,this._listbox&&this._listbox.setValueField(t)},getValueField:function(){return this.valueField},setTextField:function(t){this._listbox&&this._listbox.setTextField(t),this.textField=t},getTextField:function(){return this.textField},pinyinField:"tag",setPinyinField:function(t){this.pinyinField=t},getPinyinField:function(){return this.pinyinField},setDisplayField:function(t){this.setTextField(t)},setDataField:function(t){this._listbox&&this._listbox.setDataField(t),this.dataField=t},getDataField:function(){return this.dataField},setEnableGroup:function(t){this._listbox.setEnableGroup(t),this.enableGroup=t},getEnableGroup:function(){return this.enableGroup},setGroupField:function(t){this._listbox.setGroupField(t),this.groupField=t},getGroupField:function(){return this.groupField},setValueInCheckOrder:function(t){this.valueInCheckOrder=t,this._listbox.valueInCheckOrder=t},getValueInCheckOrder:function(){return this.valueInCheckOrder},setValue:function(t){mini.isNull(t)&&(t="");
//if (this.value !== value) {
var e=this._listbox.getValueAndText(t),i=e[0],n=e[1];""!==n&&!mini.isNull(n)||(n=t),this.valueFromSelect&&(""===i||mini.isNull(i))&&(t=n=""),
//		if (!this.valueFromSelect && v == "") {
this.value=t,this._valueEl.value=this.value,this.text=this._textEl.value=n,this._doEmpty()},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t,this._listbox&&(this._listbox.setMultiSelect(t),this._listbox.setShowCheckBox(t)))},getMultiSelect:function(){return this.multiSelect},setMultiLabel:function(t){this.multiLabel!==!!t&&(this.multiLabel=!!t,this.multiLabel?(this._createLabel(),this.el.classList.add("mini-combobox-multilabel")):(this._destroyLabel(),this.el.classList.remove("mini-combobox-multilabel")))},getMultiLabel:function(){return this.multiLabel},setColumns:function(t){mini.isArray(t)||(t=[]),this.columns=t,this._listbox.setColumns(t)},getColumns:function(){return this.columns},showNullItem:!1,setShowNullItem:function(t){this.showNullItem!=t&&(this.showNullItem=t,this._listbox.setShowNullItem(t))},getShowNullItem:function(){return this.showNullItem},setNullItemText:function(t){this.nullItemText!=t&&(this.nullItemText=t,this._listbox.setNullItemText(t))},getNullItemText:function(){return this.nullItemText},setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},_OnValueChanged:function(){this.validateOnChanged&&this._tryValidate();var s=this;setTimeout(function(){!function n(){var t=s.getValue(),e=s.getSelecteds(),i=e[0];s.fire("valuechanged",{value:t,selecteds:e,selected:i,oldValue:s._oldValue})}()},50)},getSelecteds:function(){return this._listbox.findItems(this.value)},getSelected:function(){return this.getSelecteds()[0]},__OnItemDrawCell:function(t){this.fire("drawcell",t)},__OnBeforeItemClick:function(t){var e={item:t.item,cancel:!1};this.fire("beforeitemclick",e),e.cancel&&(t.cancel=!0)},__OnItemClick:function(t,e){var i={item:t.item,cancel:!1};if(!1===e||(this.fire("beforeitemclick",i),!i.cancel)){var n=this._listbox.getSelecteds(),s=this._listbox.getValueAndText(n),o=this.getValue();if(this.setValue(s[0]),this.setText(s[1]),this._oldValue=o,t&&!1!==e){if(o!=this.getValue()){var r=this;setTimeout(function(){r._OnValueChanged()},1)}this.multiSelect||this.hidePopup(),isMobile||this.focus(),this.fire("itemclick",{item:t.item})}}},__OnInputKeyDown:function(t,e){var i={htmlEvent:t};if(this.fire("keydown",i),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(!this.isReadOnly())switch(t.keyCode){case 27:t.preventDefault(),this.isShowPopup()&&t.stopPropagation(),this.hidePopup(),this.focus();break;case 13:if(this.isShowPopup()){t.preventDefault(),t.stopPropagation();var n=this._listbox.getFocusedIndex();if((a=this._listbox.getAt(n))&&!1!==a.enabled&&-1!=n){var s={item:a,cancel:!1};if(this.fire("beforeitemclick",s),0==s.cancel){this._oldValue=this.getValue(),this.multiSelect||(this._listbox.deselectAll(),this._listbox.select(a));var o=this._listbox.getSelecteds(),r=this._listbox.getValueAndText(o);this.setValue(r[0]),this.setText(r[1]),this._OnValueChanged()}}this.hidePopup(),this.focus()}else this.fire("enter",i);break;case 37:break;case 38:if(t.preventDefault(),-1==(n=this._listbox.getFocusedIndex()))if(n=0,!this.multiSelect)(a=this._listbox.findItems(this.value)[0])&&(n=this._listbox.indexOf(a));this.isShowPopup()&&(this.multiSelect||((n-=1)<0&&(n=0),this._listbox._focusItem(n,!0)));break;case 39:break;case 40:var a;if(t.preventDefault(),-1==(n=this._listbox.getFocusedIndex()))if(n=-1,!this.multiSelect)(a=this._listbox.findItems(this.value)[0])&&(n=this._listbox.indexOf(a));this.isShowPopup()?this.multiSelect||((n+=1)>this._listbox.getCount()-1&&(n=this._listbox.getCount()-1),this._listbox._focusItem(n,!0)):this.keyNavEnabled&&(this.showPopup(),this.multiSelect||this._listbox._focusItem(n,!0));break;default:0==this.allowInput||this._tryQuery(this._textEl.value)}}else this.isShowPopup()&&(this._autoBlur=!1,this.hidePopup(),delete this._autoBlur)},__OnInputKeyUp:function(t){this.fire("keyup",{htmlEvent:t})},__OnInputKeyPress:function(t){this.fire("keypress",{htmlEvent:t})},_tryQuery:function(e){var i=this;setTimeout(function(){var t=i._textEl.value;t!=e&&i._doQuery(t)},10)},_doQuery:function(t){if(this.autoFilter&&1!=this.multiSelect){var e=[];
//                if (text.indexOf(key) != -1) {
t=t.toUpperCase();for(var i=0,n=this.data.length;i<n;i++){var s=this.data[i],o=mini._getMap(this.textField,s),r=mini._getMap(this.pinyinField,s);o=o?String(o).toUpperCase():"",r=r?String(r).toUpperCase():"",-1==o.indexOf(t)&&-1==r.indexOf(t)||e.push(s)}if(this._listbox.setData(e),this._filtered=!0,""!==t||this.isShowPopup()){this.showPopup();var a=0;this._listbox.getShowNullItem()&&(a=1);this._listbox._focusItem(a,!0)}}},__OnPopupHide:function(t){(this.valueFromSelect||this._textChanged)&&(this._textChanged=!1,this.__OnInputTextChanged()),""==this._textEl.value&&this._listbox._blurItem(),this._filtered&&(this._filtered=!1,this._listbox.el&&this._listbox.setData(this.data)),this.__doFocusCls(),this.fire("hidepopup")},findItems:function(t){return this._listbox.findItems(t)},__OnInputTextChanged:function(t){if(this.isShowPopup())this._textChanged=!0;else if(this._textChanged=!1,this._oldValue=this.getValue(),0==this.multiSelect){for(var e=this._textEl.value,i=this.getData(),n=null,s=0,o=i.length;s<o;s++){var r=i[s],a=this.listbox.getItemText(r),l=this.listbox.getItemValue(r);if(a==e&&(mini.isNull(this.value)||""===this.value||this.value==l)){n=r;break}}if(n){this._listbox.setValue(n?n[this.valueField]:"");var h=this._listbox.getValue(),d=this._listbox.getValueAndText(h),u=this.getValue();this.setValue(h),this.setText(d[1])}else this.valueFromSelect?(this.setValue(""),this.setText("")):(this.setValue(e),this.setText(e));if(u!=this.getValue()){this._OnValueChanged()}}
//            if (this._textEl.value == "" && !this.value) {
//            //            if (this._textEl.value != vts[1]) {
//            //            if (_value != this.value) {
},setAjaxData:function(t){this.ajaxData=t,this._listbox.setAjaxData(t)},setAjaxType:function(t){this.ajaxType=t,this._listbox.setAjaxType(t)},setAjaxOptions:function(t){this.ajaxOptions=t,this._listbox.setAjaxOptions(t)},autoFilter:!0,setAutoFilter:function(t){this.autoFilter=t},getAutoFilter:function(){return this.autoFilter},getAttrs:function(t){var e=mini.ComboBox.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["url","data","textField","valueField","displayField","groupField","nullItemText","pinyinField","delimiter","ondrawcell","onbeforeload","onpreload","onload","onloaderror","onitemclick","onbeforeitemclick"]),mini._ParseBool(t,e,["multiSelect","showNullItem","valueFromSelect","valueInCheckOrder","clearOnLoad","autoFilter","autoFocusItem","enableGroup","multiLabel"]),e.displayField&&(e.textField=e.displayField);var i=e.valueField||this.valueField,n=e.textField||this.textField;if("select"==t.nodeName.toLowerCase()){for(var s=[],o=0,r=t.length;o<r;o++){var a=t.options[o],l={};l[n]=a.text,l[i]=a.value,s.push(l)}0<s.length&&(e.data=s)}else{var h=mini.getChildNodes(t);for(o=0,r=h.length;o<r;o++){var d=h[o],u=jQuery(d).attr("property");u&&("columns"==(u=u.toLowerCase())?e.columns=mini._ParseColumns(d):"data"==u&&(e.data=d.innerHTML))}}return e}}),mini.regClass(mini.ComboBox,"combobox"),mini.Calendar=function(){this.viewDate=new Date,this._selectedDates=[],mini.Calendar.superclass.constructor.apply(this,arguments)},mini.extend(mini.Calendar,mini.Control,{width:220,height:160,monthPicker:!1,_clearBorder:!1,viewDate:null,_selectedDate:"",_selectedDates:[],multiSelect:!1,firstDayOfWeek:epoint_local.Calendar.firstDayOfWeek,yesterdayText:epoint_local.Calendar.yesterdayText,todayText:epoint_local.Calendar.todayText,clearText:epoint_local.Calendar.clearText,okText:epoint_local.Calendar.okText,cancelText:epoint_local.Calendar.cancelText,daysShort:epoint_local.Calendar.daysShort.slice(),format:epoint_local.Calendar.format,timeFormat:epoint_local.Calendar.timeFormat,showTime:!1,currentTime:!0,rows:1,columns:1,headerCls:"",bodyCls:"",footerCls:"",_todayCls:"mini-calendar-today",_weekendCls:"mini-calendar-weekend",_otherMonthCls:"mini-calendar-othermonth",_selectedDateCls:"mini-calendar-selected",showHeader:!0,showFooter:!0,showWeekNumber:!1,showDaysHeader:!0,showMonthButtons:!0,showYearButtons:!0,showTodayButton:!0,showClearButton:!0,showOkButton:!1,showYesterdayButton:!1,isWeekend:function(t){var e=t.getDay();return 0==e||6==e},getFirstDateOfMonth:function(t){t=new Date(t.getFullYear(),t.getMonth(),1);return mini.getWeekStartDate(t,this.firstDayOfWeek)},getShortWeek:function(t){return this.daysShort[t]},uiCls:"mini-calendar",_create:function(){var t='<tr style="width:100%;"><td style="width:100%;"></td></tr>',e='<table class="mini-calendar" cellpadding="0" cellspacing="0">'+(t+='<tr ><td><div class="mini-calendar-footer"><span class="mini-calendar-footer-time" style="display:inline-block;"><input name="time" class="mini-timespinner mini-calendar-timespinner" format="'+this.timeFormat+'"/><span class="mini-calendar-footerSpace"></span></span><span class="mini-calendar-tadayButton mini-calendar-button mini-corner-all">'+this.todayText+'</span><span class="mini-calendar-footerSpace"></span><span class="mini-calendar-clearButton mini-calendar-button mini-corner-all">'+this.clearText+'</span><span class="mini-calendar-okButton mini-calendar-button mini-corner-all">'+this.okText+'</span><a href="#" class="mini-calendar-focus" style="position:absolute;left:-10px;top:-10px;width:0px;height:0px;outline:none" hideFocus></a></div></td></tr>')+"</table>",i=document.createElement("div");i.innerHTML=e,this.el=i.firstChild;this.el.getElementsByTagName("tr");var n=this.el.getElementsByTagName("td");this._innerEl=n[0],this._footerEl=mini.byClass("mini-calendar-footer",this.el),this.timeWrapEl=this._footerEl.childNodes[0],this.todayButtonEl=this._footerEl.childNodes[1],this.footerSpaceEl=this._footerEl.childNodes[2],this.closeButtonEl=this._footerEl.childNodes[3],this.okButtonEl=this._footerEl.childNodes[4],this._focusEl=this._footerEl.lastChild,this.yesterdayButtonEl=mini.after(this.todayButtonEl,'<span class="mini-calendar-tadayButton yesterday mini-calendar-button mini-corner-all">'+this.yesterdayText+"</span>"),mini.parse(this._footerEl),this.timeSpinner=mini.getbyName("time",this.el),this.doUpdate()},focus:function(){try{this._focusEl.focus()}catch(e){}},destroy:function(t){this.timeSpinner&&(this.timeSpinner.destroy(),this.timeSpinner=null),this._innerEl=this._footerEl=this.timeWrapEl=this.todayButtonEl=this.footerSpaceEl=this.closeButtonEl=null,this._focusEl=this.okButtonEl=this.yesterdayButtonEl=null,this.timeSpinner=null,mini.Calendar.superclass.destroy.call(this,t)},_initEvents:function(){this.timeSpinner&&this.timeSpinner.on("valuechanged",this.__OnTimeChanged,this),mini._BindEvents(function(){mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"keydown",this.__OnKeyDown,this)},this)},getDateEl:function(t){if(!t)return null;var e=this.uid+"$"+mini.clearTime(t).getTime();return document.getElementById(e)},within:function(t){return!!mini.isAncestor(this.el,t.target)||!(!this.menuEl||!mini.isAncestor(this.menuEl,t.target))},setShowHeader:function(t){this.showHeader=t,this.doUpdate()},getShowHeader:function(){return this.showHeader},setShowFooter:function(t){this.showFooter=t,this.doUpdate()},getShowFooter:function(){return this.showFooter},setShowWeekNumber:function(t){this.showWeekNumber=t,this.doUpdate()},getShowWeekNumber:function(){return this.showWeekNumber},setShowDaysHeader:function(t){this.showDaysHeader=t,this.doUpdate()},getShowDaysHeader:function(){return this.showDaysHeader},setShowMonthButtons:function(t){this.showMonthButtons=t,this.doUpdate()},getShowMonthButtons:function(){return this.showMonthButtons},setShowYearButtons:function(t){this.showYearButtons=t,this.doUpdate()},getShowYearButtons:function(){return this.showYearButtons},setShowTodayButton:function(t){this.showTodayButton=t,this.todayButtonEl.style.display=this.showTodayButton?"":"none",this.doUpdate()},getShowTodayButton:function(){return this.showTodayButton},setShowYesterdayButton:function(t){this.showYesterdayButton=t,this.yesterdayButtonEl.style.display=this.showYesterdayButton?"":"none",this.doUpdate()},getShowYesterdayButton:function(){return this.showYesterdayButton},setShowClearButton:function(t){this.showClearButton=t,this.closeButtonEl.style.display=this.showClearButton?"":"none",this.doUpdate()},getShowClearButton:function(){return this.showClearButton},setShowOkButton:function(t){this.showOkButton=t,this.okButtonEl.style.display=this.showOkButton?"":"none",this.doUpdate()},getShowOkButton:function(){return this.showOkButton},setViewDate:function(t){t=(t=mini.parseDate(t))||new Date,mini.isDate(t)&&(t=new Date(t.getTime())),this.viewDate=t,this.doUpdate()},getViewDate:function(){return this.viewDate},setSelectedDate:function(t){var e;t=mini.parseDate(t),t=mini.isDate(t)?new Date(t.getTime()):"",(e=this.getDateEl(this._selectedDate))&&mini.removeClass(e,this._selectedDateCls),this._selectedDate=t,this._selectedDate&&(this._selectedDate=mini.cloneDate(this._selectedDate)),(e=this.getDateEl(this._selectedDate))&&mini.addClass(e,this._selectedDateCls),this.fire("datechanged")},setSelectedDates:function(t){mini.isArray(t)||(t=[]),this._selectedDates=t,this.doUpdate()},getSelectedDate:function(){return this._selectedDate?this._selectedDate:""},setTime:function(t){this.timeSpinner.setValue(t)},getTime:function(){return this.timeSpinner.getFormValue()},setValue:function(t){this.setSelectedDate(t),t=t||new Date,this.setTime(t)},getValue:function(){var t=this._selectedDate;if(t&&(t=mini.clearTime(t),this.showTime)){var e=this.timeSpinner.getValue();e&&(t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(e.getSeconds()))}return t||""},getFormValue:function(){var t=this.getValue();return t?mini.formatDate(t,"yyyy-MM-dd HH:mm:ss"):""},isSelectedDate:function(t){return!(!t||!this._selectedDate)&&mini.clearTime(t).getTime()==mini.clearTime(this._selectedDate).getTime()},setMultiSelect:function(t){this.multiSelect=t,this.doUpdate()},getMultiSelect:function(){return this.multiSelect},setRows:function(t){isNaN(t)||(t<1&&(t=1),this.rows=t,this.doUpdate())},getRows:function(){return this.rows},setColumns:function(t){isNaN(t)||(t<1&&(t=1),this.columns=t,this.doUpdate())},getColumns:function(){return this.columns},setShowTime:function(t){this.showTime!=t&&(this.showTime=t,this.timeWrapEl.style.display=this.showTime?"":"none",jQuery(this._footerEl).toggleClass("mini-calendar-hastime",this.showTime),this.doLayout())},getShowTime:function(){return this.showTime},setTimeFormat:function(t){this.timeFormat!=t&&(this.timeSpinner.setFormat(t),this.timeFormat=this.timeSpinner.format)},getTimeFormat:function(){return this.timeFormat},doLayout:function(){if(this.canLayout()){this.timeWrapEl.style.display=this.showTime?"":"none",this.todayButtonEl.style.display=this.showTodayButton?"":"none",this.closeButtonEl.style.display=this.showClearButton?"":"none",this.yesterdayButtonEl.style.display=this.showYesterdayButton?"":"none",this.okButtonEl.style.display=this.showOkButton?"":"none",this.footerSpaceEl.style.display=this.showClearButton&&this.showTodayButton?"":"none",this._footerEl.style.display=this.showFooter?"":"none";var t=this._innerEl.firstChild;this.isAutoHeight()?t.parentNode.style.height="":(t.parentNode.style.height="100px",h=jQuery(this.el).height(),h-=jQuery(this._footerEl).outerHeight(),t.parentNode.style.height=h+"px"),mini.layout(this._footerEl),this.monthPicker&&this._tryShowMenu()}},doUpdate:function(){if(this._allowUpdate){for(var t=new Date(this.viewDate.getTime()),e=(1==this.rows&&this.columns,100/this.rows),i='<table class="mini-calendar-views" border="0" cellpadding="0" cellspacing="0">',n=0,s=this.rows;n<s;n++){i+="<tr >";for(var o=0,r=this.columns;o<r;o++)i+='<td style="height:'+e+'%">',i+=this._CreateView(t,n,o),i+="</td>",t=new Date(t.getFullYear(),t.getMonth()+1,1);i+="</tr>"}i+="</table>",this._innerEl.innerHTML=i;var a=this.el;setTimeout(function(){mini.repaint(a)},100),this.doLayout()}},_CreateView:function(t,e,i){var n=t.getMonth(),s=this.getFirstDateOfMonth(t),o=new Date(s.getTime()),r=mini.clearTime(new Date).getTime(),a=(this.value&&mini.clearTime(this.value).getTime(),1<this.rows||1<this.columns),l="";if(l+='<table class="mini-calendar-view" border="0" cellpadding="0" cellspacing="0">',this.showHeader&&(l+='<tr ><td colSpan="10" class="mini-calendar-header"><div class="mini-calendar-headerInner">',0==e&&0==i&&(l+='<div class="mini-calendar-prev mini-icon">',this.showYearButtons&&(l+='<span class="mini-calendar-yearPrev mini-icon"></span>'),this.showMonthButtons&&(l+='<span class="mini-calendar-monthPrev mini-icon"></span>'),l+="</div>"),0==e&&i==this.columns-1&&(l+='<div class="mini-calendar-next mini-icon">',this.showMonthButtons&&(l+='<span class="mini-calendar-monthNext mini-icon"></span>'),this.showYearButtons&&(l+='<span class="mini-calendar-yearNext mini-icon"></span>'),l+="</div>"),l+='<span class="mini-calendar-title">'+mini.formatDate(t,this.format),l+="</div></td></tr>"),this.showDaysHeader){l+='<tr class="mini-calendar-daysheader"><td class="mini-calendar-space"></td>',this.showWeekNumber&&(l+='<td sclass="mini-calendar-weeknumber"></td>');for(var h=(c=this.firstDayOfWeek)+7;c<h;c++){l+='<td yAlign="middle">',l+=this.getShortWeek(c),l+="</td>",s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1)}l+='<td class="mini-calendar-space"></td></tr>'}s=o;for(var d=0;d<=5;d++){if(l+='<tr class="mini-calendar-days"><td class="mini-calendar-space"></td>',this.showWeekNumber){var u=mini.getWeek(s.getFullYear(),s.getMonth()+1,s.getDate());1==String(u).length&&(u="0"+u),l+='<td class="mini-calendar-weeknumber" yAlign="middle">'+u+"</td>"}var c;for(h=(c=this.firstDayOfWeek)+7;c<h;c++){var m=this.isWeekend(s),f=mini.clearTime(s).getTime(),p=f==r,g=this.isSelectedDate(s);n!=s.getMonth()&&a&&(f=-1);var _=this._OnDrawDate(s);l+='<td yAlign="middle" id="',l+=this.uid+"$"+f,l+='" class="mini-calendar-date ',m&&(l+=" mini-calendar-weekend "),0==_.allowSelect&&(l+=" mini-calendar-disabled "),n!=s.getMonth()&&a||(g&&(l+=" "+this._selectedDateCls+" "),p&&(l+=" mini-calendar-today ")),n!=s.getMonth()&&(l+=" mini-calendar-othermonth "),_.dateCls&&(l+=" "+_.dateCls),l+='" style="',_.dateStyle&&(l+=_.dateStyle),l+='">',n!=s.getMonth()&&a||(l+=_.dateHtml),l+="</td>",s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1)}l+='<td class="mini-calendar-space"></td></tr>'}return l+='<tr class="mini-calendar-bottom" colSpan="10"><td ></td></tr>',l+="</table>"},_OnDrawDate:function(t){var e={date:t,dateCls:"",dateStyle:"",dateHtml:t.getDate(),allowSelect:!0};return this.fire("drawdate",e),e},_OnDateClick:function(t,e){var i={date:t,action:e};this.fire("dateclick",i),this._OnValueChanged(),this.hideMenu()},menuEl:null,menuYear:null,menuSelectMonth:null,menuSelectYear:null,_tryShowMenu:function(){if(!this.menuEl){var t=this;setTimeout(function(){t.showMenu()},1)}},showMenu:function(){this.hideMenu(),this.menuYear=10*parseInt(this.viewDate.getFullYear()/10),this._menuselectMonth=this.viewDate.getMonth(),this._menuselectYear=this.viewDate.getFullYear();this.menuEl=mini.append(document.body,'<div class="mini-calendar-menu"></div>'),this.updateMenu(this.viewDate);var t=this.getBox();"0px"==this.el.style.borderWidth&&(this.menuEl.style.border="0"),mini.setBox(this.menuEl,t),mini.on(this.menuEl,"click",this.__OnMenuClick,this),mini.on(this.menuEl,"dblclick",this.__OnMenuDblClick,this),mini.on(document,"mousedown",this.__OnBodyMenuMouseDown,this)},hideMenu:function(){this.menuEl&&(mini.un(this.menuEl,"click",this.__OnMenuClick,this),mini.un(document,"mousedown",this.__OnBodyMenuMouseDown,this),jQuery(this.menuEl).remove(),this.menuEl=null)},updateMenu:function(){if(this.menuEl){for(var t='<div class="mini-calendar-menu-months">',e=0,i=12;e<i;e++){var n=mini.getShortMonth(e),s="";this._menuselectMonth==e&&(s="mini-calendar-menu-selected"),t+='<a id="'+e+'" class="mini-calendar-menu-month '+s+'" href="javascript:void(0);" hideFocus onclick="return false">'+n+"</a>"}t+='<div style="clear:both;"></div></div>',t+='<div class="mini-calendar-menu-years">';for(e=this.menuYear,i=this.menuYear+10;e<i;e++){n=e,s="";this._menuselectYear==e&&(s="mini-calendar-menu-selected"),t+='<a id="'+e+'" class="mini-calendar-menu-year '+s+'" href="javascript:void(0);" hideFocus onclick="return false">'+n+"</a>"}t+='<div class="mini-calendar-menu-prevYear mini-icon"></div><div class="mini-calendar-menu-nextYear mini-icon"></div><div style="clear:both;"></div></div>',t+='<div class="mini-calendar-footer"><span class="mini-calendar-okButton mini-calendar-button mini-corner-all">'+this.okText+'</span><span class="mini-calendar-footerSpace"></span><span class="mini-calendar-cancelButton mini-calendar-button mini-corner-all">'+this.cancelText+'</span></div><div style="clear:both;"></div>',this.menuEl.innerHTML=t}},__OnMenuClick:function(t){var e=this,i=t.target,n="mini-calendar-menu-month",s="mini-calendar-menu-year",o="mini-calendar-menu-selected";function r(){setTimeout(function(){e.updateMenu()},30)}var a=mini.findParent(i,n),l=mini.findParent(i,s);a?(this._menuselectMonth=parseInt(a.id),jQuery("."+n,e.menuEl).removeClass(o),jQuery(i).parent().find("#"+this._menuselectMonth).addClass(o)):l?(this._menuselectYear=parseInt(l.id),jQuery("."+s,e.menuEl).removeClass(o),jQuery(i).parent().find("#"+this._menuselectYear).addClass(o)):mini.findParent(i,"mini-calendar-menu-prevYear")?(this.menuYear=this.menuYear-1,this.menuYear=10*parseInt(this.menuYear/10),r()):mini.findParent(i,"mini-calendar-menu-nextYear")?(this.menuYear=this.menuYear+11,this.menuYear=10*parseInt(this.menuYear/10),r()):mini.findParent(i,"mini-calendar-okButton")?this.__getMonthYear():mini.findParent(i,"mini-calendar-cancelButton")&&(this.monthPicker?this._OnDateClick(null,"cancel"):this.hideMenu())},__OnMenuDblClick:function(t){var e=mini.findParent(t.target,"mini-calendar-menu-year"),i=mini.findParent(t.target,"mini-calendar-menu-month"),n=mini.findParent(t.target,"mini-calendar-date ");(e||i||n)&&(this.monthPicker&&!i&&!e||this.__getMonthYear())},__getMonthYear:function(){var t=new Date(this._menuselectYear,this._menuselectMonth,1);this.monthPicker?(this.setViewDate(t),this.setSelectedDate(t),this._OnDateClick(t)):(this.setViewDate(t),this.hideMenu())},__OnBodyMenuMouseDown:function(t){mini.findParent(t.target,"mini-calendar-menu")||mini.findParent(t.target,"mini-monthpicker")||
//if (!this.monthPicker) {
this.hideMenu()},__OnClick:function(t){var e=this.viewDate;if(0!=this.enabled){var i=t.target,n=mini.findParent(t.target,"mini-calendar-title");if(mini.findParent(i,"mini-calendar-monthNext"))e.setDate(1),e.setMonth(e.getMonth()+1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-yearNext"))e.setDate(1),e.setFullYear(e.getFullYear()+1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-monthPrev"))e.setMonth(e.getMonth()-1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-yearPrev"))e.setFullYear(e.getFullYear()-1),this.setViewDate(e);else if(mini.findParent(i,"mini-calendar-tadayButton")){var s=!!mini.findParent(i,"yesterday"),o=new Date;if(s&&o.setDate(o.getDate()-1),this.setViewDate(o),this.setSelectedDate(o),this.currentTime){var r=new Date;this.setTime(r)}this._OnDateClick(o,"today")}else mini.findParent(i,"mini-calendar-clearButton")?(this.setSelectedDate(null),this.setTime(null),this._OnDateClick(null,"clear")):mini.findParent(i,"mini-calendar-okButton")?this._OnDateClick(null,"ok"):n&&this.showMenu();var a=mini.findParent(t.target,"mini-calendar-date");if(a&&!mini.hasClass(a,"mini-calendar-disabled")){var l=a.id.split("$"),h=parseInt(l[l.length-1]);if(-1==h)return;var d=new Date(h);this._OnDateClick(d)}}},__OnMouseDown:function(t){if(0!=this.enabled){var e=mini.findParent(t.target,"mini-calendar-date");if(e&&!mini.hasClass(e,"mini-calendar-disabled")){var i=e.id.split("$"),n=parseInt(i[i.length-1]);if(-1==n)return;var s=new Date(n);this.setSelectedDate(s)}}},__OnTimeChanged:function(t){this.fire("timechanged"),this._OnValueChanged()},__OnKeyDown:function(t){if(0!=this.enabled){var e=this.getSelectedDate();switch(e=e||new Date(this.viewDate.getTime()),t.keyCode){case 27:break;case 13:return void(e&&this._OnDateClick(e));case 37:e=mini.addDate(e,-1,"D");break;case 38:e=mini.addDate(e,-7,"D");break;case 39:e=mini.addDate(e,1,"D");break;case 40:e=mini.addDate(e,7,"D")}e.getMonth()!=this.viewDate.getMonth()&&(this.setViewDate(mini.cloneDate(e)),this.focus());var i=this.getDateEl(e);i&&mini.hasClass(i,"mini-calendar-disabled")||(this.setSelectedDate(e),37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode||t.preventDefault())}},_OnValueChanged:function(){this.fire("valuechanged")},getAttrs:function(t){var e=mini.Calendar.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["viewDate","rows","columns","ondateclick","ondrawdate","ondatechanged","timeFormat","ontimechanged","onvaluechanged"]),mini._ParseBool(t,e,["multiSelect","showHeader","showFooter","showWeekNumber","showDaysHeader","showMonthButtons","showYearButtons","showTodayButton","showClearButton","showYesterdayButton","showTime","showOkButton"]),e}}),mini.regClass(mini.Calendar,"calendar"),mini.ListBox=function(){mini.ListBox.superclass.constructor.apply(this,arguments)},mini.extend(mini.ListBox,mini.ListControl,{formField:!0,groupField:"group",enableGroup:!1,columns:null,columnWidth:80,showNullItem:!1,nullItemText:"",showEmpty:!1,emptyText:"",showCheckBox:!1,showAllCheckBox:!0,multiSelect:!1,_itemCls:"mini-listbox-item",_itemHoverCls:"mini-listbox-item-hover",_itemSelectedCls:"mini-listbox-item-selected",uiCls:"mini-listbox",_create:function(){this.el=document.createElement("div"),this.el.className="mini-listbox",this.el.innerHTML='<div class="mini-listbox-border"><div class="mini-listbox-header"></div><div class="mini-listbox-view"></div><input type="hidden"/></div><div class="mini-errorIcon"></div>',this._borderEl=this.el.firstChild,this._headerEl=this._borderEl.firstChild,this._viewEl=this._borderEl.childNodes[1],this._valueEl=this._borderEl.childNodes[2],this._errorIconEl=this.el.lastChild,this._scrollViewEl=this._viewEl,this._viewEl.innerHTML='<div class="mini-grid-rows-content"></div>',this._contentEl=this._viewEl.firstChild},_initEvents:function(){mini.ListBox.superclass._initEvents.call(this),mini._BindEvents(function(){mini_onOne(this._viewEl,"scroll",this.__OnScroll,this)},this)},destroy:function(t){this._viewEl&&(this._viewEl.onscroll=null,mini.clearEvent(this._viewEl),this._viewEl=null),this._borderEl=this._headerEl=this._viewEl=this._valueEl=this._errorIconEl=this._scrollViewEl=this._contentEl=null,mini.ListBox.superclass.destroy.call(this,t)},setColumns:function(t){mini.isArray(t)||(t=[]),this.columns=t;for(var e=0,i=this.columns.length;e<i;e++){var n=this.columns[e];if(n.type){mini.isNull(n.header)||"function"==typeof n.header||""==n.header.trim()&&delete n.header;var s=mini._getColumn(n.type);if(s){var o=mini.copyTo({},n);mini.copyTo(n,s),mini.copyTo(n,o)}}var r=parseInt(n.width);mini.isNumber(r)&&String(r)==n.width&&(n.width=r+"px"),mini.isNull(n.width)&&(n.width=this.columnWidth+"px")}this.doUpdate()},isVisibleColumn:function(t){return 0!=(t=this.getColumn(t)).visible},getColumn:function(t){var e=typeof t;if("number"==e)return this.columns[t];if("object"==e)return t;for(var i=0,n=this.columns.length;i<n;i++){var s=this.columns[i];if(s.name==t)return s}return null},hideColumn:function(t){(t=this.getColumn(t))&&(t.visible=!1,this.doUpdate())},showColumn:function(t){(t=this.getColumn(t))&&(t.visible=!0,this.doUpdate())},getColumns:function(){return this.columns},doUpdate:function(){var v=this;if(!1!==this._allowUpdate){var y=this.columns&&0<this.columns.length;y?mini.addClass(this.el,"mini-listbox-showColumns"):mini.removeClass(this.el,"mini-listbox-showColumns"),this._headerEl.style.display=y?"":"none";var i=[];if(y){i[i.length]='<table class="mini-listbox-headerInner" cellspacing="0" cellpadding="0"><tr>';var t=this.uid+"$ck$all";this.showCheckBox&&(i[i.length]='<td class="mini-listbox-checkbox"><input type="checkbox" id="'+t+'"></td>');for(var e=0,n=this.columns.length;e<n;e++){var s=this.columns[e];if(!1!==s.visible){var o=s.header;mini.isNull(o)&&(o="&nbsp;");var r=s.width;mini.isNumber(r)&&(r+="px"),i[i.length]='<td class="',s.headerCls&&(i[i.length]=s.headerCls),i[i.length]='" style="',s.headerStyle&&(i[i.length]=s.headerStyle+";"),r&&(i[i.length]="width:"+r+";"),s.headerAlign&&(i[i.length]="text-align:"+s.headerAlign+";"),i[i.length]='">',i[i.length]=o,i[i.length]="</td>"}}i[i.length]="</tr></table>"}this._headerEl.innerHTML=i.join("");i=[];var a=this.data;if(this.showEmpty&&0==a.length)i[i.length]='<table class="mini-listbox-items" cellspacing="0" cellpadding="0">',i[i.length]='<tr><td colspan="20">'+this.emptyText+"</td></tr>",i[i.length]="</table>";else{this._doNullItem();var l=[];if(this.enableGroup&&!y){var h={},d=[],u=0;this.showNullItem&&(u=1,i.push('<table class="mini-listbox-items" cellspacing="0" cellpadding="0">'),g(i,[{index:0,record:a[0]}]),i.push("</table>"));for(var c=a.length;u<c;u++){var m=a[u],f=m[this.groupField];f?h[f]?h[f].push({index:u,record:m}):(h[f]=[{index:u,record:m}],d.push(h[f])):l.push({index:u,record:m})}d.forEach(function(t){var e=t[0].record[v.groupField];i.push('<div class="mini-listbox-group-title">'+e+"</div>"),i.push('<table class="mini-listbox-items mini-listbox-group" cellspacing="0" cellpadding="0">'),g(i,t,e),i.push("</table>")})}else l=a.map(function(t,e){return{index:e,record:t}});0<l.length&&(i.push('<table class="mini-listbox-items" cellspacing="0" cellpadding="0">'),g(i,l),i.push("</table>"))}var p=i.join("");this._viewEl.firstChild.innerHTML=p,this._doSelects(),this.doLayout()}function g(t,e,i){for(var n=0,s=e.length;n<s;n++){var o,r,a=e[n].record,l=e[n].index,h=" ",d=" ";t[t.length]='<tr id="',t[t.length]=v._createItemId(l),t[t.length]='" index="',t[t.length]=l,!(t[t.length]='" class="mini-listbox-item ')===a.enabled&&(t[t.length]=" mini-disabled "),o=t.length,t[t.length]=h,t[t.length]='" style="',r=t.length,t[t.length]=d,t[t.length]='">';var u=v._createCheckId(l),c=(v.name,v.getItemValue(a),"");if(!1===a.enabled&&(c="disabled"),i&&(t[t.length]='<td class="mini-listbox-placeholder"></td>'),v.showCheckBox&&(!0===a.__NullItem?t[t.length]='<td class="mini-listbox-checkbox"></td>':t[t.length]='<td class="mini-listbox-checkbox"><input '+c+' id="'+u+'" type="checkbox" ></td>'),y)for(var m=0,f=v.columns.length;m<f;m++){var p=v.columns[m];if(!1!==p.visible){var g=v._OnDrawCell(a,l,p),_=p.width;"number"==typeof _&&(_+="px"),t[t.length]='<td class="',g.cellCls&&(t[t.length]=g.cellCls),t[t.length]='" style="',g.cellStyle&&(t[t.length]=g.cellStyle+";"),_&&(t[t.length]="width:"+_+";"),p.align&&(t[t.length]="text-align:"+p.align+";"),t[t.length]='">',t[t.length]=g.cellHtml,t[t.length]="</td>",g.rowCls&&(h=g.rowCls),g.rowStyle&&(d=g.rowStyle)}}else{g=v._OnDrawCell(a,l,null);t[t.length]='<td class="',g.cellCls&&(t[t.length]=g.cellCls),t[t.length]='" style="',g.cellStyle&&(t[t.length]=g.cellStyle),t[t.length]='">',t[t.length]=g.cellHtml,t[t.length]="</td>",g.rowCls&&(h=g.rowCls),g.rowStyle&&(d=g.rowStyle)}t[o]=h,t[r]=d,t[t.length]="</tr>"}}},doLayout:function(t){
//if (!this.canLayout()) return;
this.columns&&0<this.columns.length?mini.addClass(this.el,"mini-listbox-showcolumns"):mini.removeClass(this.el,"mini-listbox-showcolumns"),this.showCheckBox?mini.removeClass(this.el,"mini-listbox-hideCheckBox"):mini.addClass(this.el,"mini-listbox-hideCheckBox");var e=this.uid+"$ck$all",i=document.getElementById(e);i&&(i.style.display=this.showAllCheckBox?"":"none");var n=this._viewEl;this.isAutoHeight()&&(n.style.height="auto");var s=this.getHeight(!0),o=l=mini.getWidth(this._borderEl,!0);
//        if (!autoHeight) {
if(mini.isIE6||(n.style.width=l+"px"),(s-=mini.getHeight(this._headerEl))<0&&(s=0),n.style.height=s+"px",isIE){var r=this._headerEl.firstChild,a=this._viewEl.firstChild.firstChild;if(this._viewEl.offsetHeight>=this._viewEl.scrollHeight)a&&(a.style.width="100%"),r&&(r.style.width="100%");else{var l=parseInt(a.parentNode.offsetWidth)+"px";r&&(r.style.width=l)}}this._viewEl.offsetHeight<this._viewEl.scrollHeight?((l=o-(jQuery(this._viewEl).innerWidth()-jQuery(this._contentEl).width()))<0&&(l=0),this._headerEl.style.width=l+"px"):this._headerEl.style.width="100%"},setShowCheckBox:function(t){this.showCheckBox=t,this.doUpdate()},getShowCheckBox:function(){return this.showCheckBox},setShowAllCheckBox:function(t){this.showAllCheckBox=t,this.doLayout()},getShowAllCheckBox:function(){return this.showAllCheckBox},setShowNullItem:function(t){this.showNullItem!=t&&(this.showNullItem=t,this._doNullItem(),this.doUpdate())},getShowNullItem:function(){return this.showNullItem},setNullItemText:function(t){this.nullItemText!=t&&(this.nullItemText=t,this._doNullItem(),this.doUpdate())},getNullItemText:function(){return this.nullItemText},setGroupField:function(t){this.groupField=t},getGroupField:function(){return this.groupField},setEnableGroup:function(t){this.enableGroup=!!t,this.doUpdate()},getEnableGroup:function(){return this.enableGroup},_doNullItem:function(){for(var t=0,e=this.data.length;t<e;t++){if((i=this.data[t]).__NullItem){this.data.removeAt(t);break}}var i;this.showNullItem&&((i={__NullItem:!0})[this.textField]="",i[this.valueField]="",this.data.insert(0,i))},
//        if (!mini.isArray(items) || !mini.isNumber(index)) return;
_OnDrawCell:function(t,e,i){var n=i?mini._getMap(i.field,t):this.getItemText(t),s={sender:this,index:e,rowIndex:e,record:t,item:t,column:i,field:i?i.field:null,value:n,cellHtml:n,rowCls:null,cellCls:i&&i.cellCls||"",rowStyle:null,cellStyle:i&&i.cellStyle||""};if(this.columns&&0<this.columns.length||0==e&&this.showNullItem&&(s.cellHtml=this.nullItemText),1==s.autoEscape&&(s.cellHtml=mini.htmlEncode(s.cellHtml)),i){i.dateFormat&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(n,i.dateFormat):s.cellHtml=n);var o=i.renderer;o&&(fn="function"==typeof o?o:window[o],fn&&(s.cellHtml=fn.call(i,s)))}return this.fire("drawcell",s),null!==s.cellHtml&&s.cellHtml!==undefined&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s},__OnScroll:function(t){this._headerEl.scrollLeft=this._viewEl.scrollLeft},__OnClick:function(t){var e=this.uid+"$ck$all";if(t.target.id!=e)this._fireEvent(t,"Click");else{var i=document.getElementById(e);if(i){var n=i.checked,s=this.getValue();this._oldValue=s,n?this.selectAll():this.deselectAll(),this._OnSelectionChanged(),s!=this.getValue()&&(this._OnValueChanged(),this.fire("itemclick",{htmlEvent:t}))}}},setValue:function(t){mini.ListBox.superclass.setValue.call(this,t),this._doCheckState()},_doCheckState:function(){var t=this.uid+"$ck$all",e=jQuery(document.getElementById(t));this._isSelectedAll()&&0!=this.getSelecteds().length?e.prop?e.prop("checked",!0):e.attr("checked",!0):e.prop?e.prop("checked",!1):e.attr("checked",!1)},_OnValueChanged:function(t){mini.ListBox.superclass._OnValueChanged.call(this),this._doCheckState()},getAttrs:function(t){var e=mini.ListBox.superclass.getAttrs.call(this,t);if(mini._ParseString(t,e,["nullItemText","ondrawcell","groupField"]),mini._ParseBool(t,e,["showCheckBox","showAllCheckBox","showNullItem","enableGroup"]),"select"!=t.nodeName.toLowerCase())for(var i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],r=jQuery(o).attr("property");r&&("columns"==(r=r.toLowerCase())?e.columns=mini._ParseColumns(o):"data"==r&&(e.data=o.innerHTML))}return e}}),mini.regClass(mini.ListBox,"listbox"),mini.CheckBoxList=function(){mini.CheckBoxList.superclass.constructor.apply(this,arguments)},mini.extend(mini.CheckBoxList,mini.ListControl,{formField:!0,_labelFieldCls:"mini-labelfield-checkboxlist",multiSelect:!0,repeatItems:0,repeatLayout:"none",repeatDirection:"horizontal",_itemCls:"mini-checkboxlist-item",_itemHoverCls:"mini-checkboxlist-item-hover",_itemSelectedCls:"mini-checkboxlist-item-selected",_tableCls:"mini-checkboxlist-table",_tdCls:"mini-checkboxlist-td",_checkType:"checkbox",uiCls:"mini-checkboxlist",_create:function(){var t=this.el=document.createElement("div");this.el.className=this.uiCls,this.el.innerHTML='<table cellpadding="0" border="0" cellspacing="0" style="display:table;"><tr><td><div class="mini-list-inner"></div><div class="mini-errorIcon"></div><input type="hidden" /></td></tr></table>',this.cellEl=t.getElementsByTagName("td")[0],this._innerEl=this.cellEl.firstChild,this._valueEl=this.cellEl.lastChild,this._errorIconEl=this.cellEl.childNodes[1],this._borderEl=this.el.firstChild;mini.on(this.el,"keyup",function(t){32==t.keyCode&&$(t.target).click()})},_getRepeatTable:function(){var t=[];if(0<this.repeatItems)if("horizontal"==this.repeatDirection){for(var e=[],i=0,n=this.data.length;i<n;i++){var s=this.data[i];e.length==this.repeatItems&&(t.push(e),e=[]),e.push(s)}t.push(e)}else{for(i=0,n=this.repeatItems>this.data.length?this.data.length:this.repeatItems;i<n;i++)t.push([]);for(i=0,n=this.data.length;i<n;i++){s=this.data[i];t[i%this.repeatItems].push(s)}}else t=[this.data.clone()];return t},doUpdate:function(){for(var t=this.data,e="",i=0,n=t.length;i<n;i++){(r=t[i])._i=i}if("flow"==this.repeatLayout)for(i=0,n=(a=this._getRepeatTable()).length;i<n;i++){for(var s=0,o=(l=a[i]).length;s<o;s++){var r=l[s];e+=this._createItemHtml(r,r._i)}i!=n-1&&(e+="<br/>")}else if("table"==this.repeatLayout){var a=this._getRepeatTable();e+='<table class="'+this._tableCls+'" cellpadding="0" cellspacing="1">';for(i=0,n=a.length;i<n;i++){var l;e+="<tr>";for(s=0,o=(l=a[i]).length;s<o;s++){r=l[s];e+='<td class="'+this._tdCls+'">',e+=this._createItemHtml(r,r._i),e+="</td>"}e+="</tr>"}e+="</table>"}else for(i=0,n=t.length;i<n;i++){r=t[i];e+=this._createItemHtml(r,i)}this._innerEl.innerHTML=e;for(i=0,n=t.length;i<n;i++){delete(r=t[i])._i}},_createItemHtml:function(t,e){var i=this._OnDrawItem(t,e),n=this._createItemId(e),s=this._createCheckId(e),o=this.getItemValue(t),r="",a='<div id="'+n+'" index="'+e+'" class="'+this._itemCls+" ";!1===t.enabled&&(a+=" mini-disabled ",r="disabled");return'onmousedown="this._checked = this.checked;" onclick="this.checked = this._checked"',a+=i.itemCls+'" style="'+i.itemStyle+'"><span tabIndex="0" class="mini-list-icon mini-icon"></span><input style="display:none;" onmousedown="this._checked = this.checked;" onclick="this.checked = this._checked" '+r+' value="'+o+'" id="'+s+'" type="'+this._checkType+'" /><label for="'+s+'" onclick="return false;">',a+=i.itemHtml+"</label></div>"},_OnDrawItem:function(t,e){var i={index:e,item:t,itemHtml:this.getItemText(t),itemCls:"",itemStyle:""};return this.fire("drawitem",i),null!==i.itemHtml&&i.itemHtml!==undefined||(i.itemHtml=""),i},setRepeatItems:function(t){t=parseInt(t),isNaN(t)&&(t=0),this.repeatItems!=t&&(this.repeatItems=t,this.doUpdate())},getRepeatItems:function(){return this.repeatItems},setRepeatLayout:function(t){"flow"!=t&&"table"!=t&&(t="none"),this.repeatLayout!=t&&(this.repeatLayout=t,this.doUpdate())},getRepeatLayout:function(){return this.repeatLayout},setRepeatDirection:function(t){"vertical"!=t&&(t="horizontal"),this.repeatDirection!=t&&(this.repeatDirection=t,this.doUpdate())},getRepeatDirection:function(){return this.repeatDirection},getAttrs:function(t){var e=mini.CheckBoxList.superclass.getAttrs.call(this,t),i=jQuery(t);mini._ParseString(t,e,["ondrawitem"]);var n=parseInt(i.attr("repeatItems"));isNaN(n)||(e.repeatItems=n);var s=i.attr("repeatLayout");s&&(e.repeatLayout=s);var o=i.attr("repeatDirection");return o&&(e.repeatDirection=o),e}}),mini.regClass(mini.CheckBoxList,"checkboxlist"),mini.RadioButtonList=function(){mini.RadioButtonList.superclass.constructor.apply(this,arguments)},mini.extend(mini.RadioButtonList,mini.CheckBoxList,{multiSelect:!1,_itemCls:"mini-radiobuttonlist-item",_itemHoverCls:"mini-radiobuttonlist-item-hover",_itemSelectedCls:"mini-radiobuttonlist-item-selected",_tableCls:"mini-radiobuttonlist-table",_tdCls:"mini-radiobuttonlist-td",_checkType:"radio",uiCls:"mini-radiobuttonlist"}),mini.regClass(mini.RadioButtonList,"radiobuttonlist"),mini.TimeSpinner=function(){mini.TimeSpinner.superclass.constructor.apply(this,arguments),this.setValue("00:00:00")},mini.extend(mini.TimeSpinner,mini.ButtonEdit,{value:null,format:"H:mm:ss",uiCls:"mini-timespinner",_getButtonHtml:function(){return'<span class="mini-buttonedit-button" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-up"><span class="mini-icon"></span></span><span class="mini-buttonedit-down"><span class="mini-icon"></span></span></span>'},_initEvents:function(){mini.TimeSpinner.superclass._initEvents.call(this),mini._BindEvents(function(){this.on("buttonmousedown",this.__OnButtonMouseDown,this),mini.on(this.el,"mousewheel",this.__OnMousewheel,this),mini.on(this._textEl,"keydown",this.__OnKeyDown,this)},this)},setFormat:function(t){if("string"==typeof t){this.format!=t&&(this.format=t,this.text=this._textEl.value=this.getFormattedValue())}},getFormat:function(){return this.format},setValue:function(t){t=(t=mini.parseTime(t,this.format))||null,mini.isDate(t)&&(t=new Date(t.getTime())),
//if (mini.formatDate(this.value, "H:mm:ss") != mini.formatDate(value, "H:mm:ss")) {
this.value=t,this.text=this._textEl.value=this.getFormattedValue(),this._valueEl.value=this.getFormValue()},getValue:function(){return null==this.value?null:new Date(this.value.getTime())},getFormValue:function(){return this.value?mini.formatDate(this.value,this.format):""},getFormattedValue:function(){return this.value?mini.formatDate(this.value,this.format):""},_ChangeValue:function(t,e){var i=this.getValue();if(i)switch(e){case"hours":var n=i.getHours()+t;23<n&&(n=23),n<0&&(n=0),i.setHours(n);break;case"minutes":var s=i.getMinutes()+t;59<s&&(s=59),s<0&&(s=0),i.setMinutes(s);break;case"seconds":var o=i.getSeconds()+t;59<o&&(o=59),o<0&&(o=0),i.setSeconds(o)}else i="00:00:00";this.setValue(i)},_SpinTimer:null,_StartSpin:function(e,i,n){this._StopSpin(),this._ChangeValue(e,this._timeType);var s=this,o=n,r=new Date;this._SpinTimer=setInterval(function(){s._ChangeValue(e,s._timeType),0==--n&&50<i&&s._StartSpin(e,i-100,o+3);var t=new Date;500<t-r&&s._StopSpin(),r=t},i),mini.on(document,"mouseup",this._OnDocumentMouseUp,this)},_StopSpin:function(){clearInterval(this._SpinTimer),this._SpinTimer=null},__OnButtonMouseDown:function(t){this._DownValue=this.getFormValue(),this._timeType="hours","up"==t.spinType?this._StartSpin(1,230,2):this._StartSpin(-1,230,2)},_OnDocumentMouseUp:function(t){this._StopSpin(),mini.un(document,"mouseup",this._OnDocumentMouseUp,this),this._DownValue!=this.getFormValue()&&this._OnValueChanged()},__OnInputTextChanged:function(t){var e=this.getFormValue();this.setValue(this._textEl.value),e!=this.getFormValue()&&this._OnValueChanged()},getAttrs:function(t){var e=mini.TimeSpinner.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["format"]),e}}),mini.regClass(mini.TimeSpinner,"timespinner"),mini.Lookup=function(){this.data=[],mini.Lookup.superclass.constructor.apply(this,arguments),mini.on(this._textEl,"mouseup",this.__OnMouseUp,this),this.on("showpopup",this.__OnShowPopup,this)},mini.extend(mini.Lookup,mini.PopupEdit,{allowInput:!0,valueField:"id",textField:"text",delimiter:",",setDelimiter:function(t){this.delimiter=t},getDelimiter:function(){return this.delimiter},multiSelect:!1,data:[],grid:null,_destroyPopup:!1,uiCls:"mini-lookup",destroy:function(t){this.grid&&(this.grid.un("rowclick",this.__OnGridRowClickChanged,this),this.grid.un("load",this.__OnGridLoad,this),this.grid.un("checkall",this.__OnGridRowClickChanged,this),this.grid=null),mini.Lookup.superclass.destroy.call(this,t)},setMultiSelect:function(t){this.multiSelect=t,this.grid&&this.grid.setMultiSelect(t)},setGrid:function(t){"string"==typeof t&&(mini.parse(t),t=mini.get(t)),this.grid=mini.getAndCreate(t),this.grid&&(this.grid.setMultiSelect(this.multiSelect),this.grid.setCheckSelectOnLoad(!1),this.grid.on("rowclick",this.__OnGridRowClickChanged,this),this.grid.on("load",this.__OnGridLoad,this),this.grid.on("checkall",this.__OnGridRowClickChanged,this))},getGrid:function(){return this.grid},setValueField:function(t){this.valueField=t},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},deselectAll:function(){this.data=[],this.setValue(""),this.setText(""),this.grid&&this.grid.deselectAll()},getItemValue:function(t){return String(t[this.valueField])},getItemText:function(t){var e=t[this.textField];return mini.isNull(e)?"":String(e)},getValueAndText:function(t){mini.isNull(t)&&(t=[]);for(var e=[],i=[],n=0,s=t.length;n<s;n++){var o=t[n];o&&(e.push(this.getItemValue(o)),i.push(this.getItemText(o)))}return[e.join(this.delimiter),i.join(this.delimiter)]},_createData:function(){this.value=mini.isNull(this.value)?"":String(this.value),this.text=mini.isNull(this.text)?"":String(this.text);
//        if (typeof this.value != "string") this.value = "";
//        if (typeof this.text != "string") this.text = "";
var t=[],e=this.value.split(this.delimiter),i=this.text.split(this.delimiter),n=e.length;if(this.value)for(var s=0,o=n;s<o;s++){var r={},a=e[s],l=i[s];r[this.valueField]=a||"",r[this.textField]=l||"",t.push(r)}this.data=t},_getValueMaps:function(t){for(var e={},i=0,n=t.length;i<n;i++){var s=t[i];e[s[this.valueField]]=s}return e},setValue:function(t){mini.Lookup.superclass.setValue.call(this,t),this._createData()},setText:function(t){mini.Lookup.superclass.setText.call(this,t),this._createData()},__OnGridRowClickChanged:function(t){var s=this.grid,e=this._getValueMaps(s.getList()),i=this._getValueMaps(s.getSelecteds()),n=this._getValueMaps(this.data);0==this.multiSelect&&(n={},this.data=[]);var o={};for(var r in n){var a=n[r];e[r]&&(i[r]||(o[r]=a))}for(var l=this.data.length-1;0<=l;l--){o[r=(a=this.data[l])[this.valueField]]&&this.data.removeAt(l)}
//            if (!vs[id]) this.data.push(o);
var h=[];for(var r in i){a=i[r];n[r]||h.push(a)}h.sort(function(t,e){var i=s.indexOf(t),n=s.indexOf(e);return i<n?-1:i==n?0:1}),this.data.addRange(h);var d=this.getValueAndText(this.data);this.setValue(d[0]),this.setText(d[1]),this._OnValueChanged()},__OnGridLoad:function(t){this.__OnShowPopup(t)},__OnShowPopup:function(t){for(var e=String(this.value).split(this.delimiter),i={},n=0,s=e.length;n<s;n++){i[e[n]]=1}var o=this.grid.getData(),r=[];for(n=0,s=o.length;n<s;n++){var a=o[n];i[a[this.valueField]]&&r.push(a)}this.grid.selects(r)},doUpdate:function(){mini.Lookup.superclass.doUpdate.call(this),this._textEl.readOnly=!0,this.el.style.cursor="default"},__OnInputKeyDown:function(t){mini.Lookup.superclass.__OnInputKeyDown.call(this,t),t.keyCode},__OnMouseUp:function(t){if(!this.isReadOnly()){var e=mini.getSelectRange(this._textEl),i=e[0];e[1],this._findTextIndex(i)}},_findTextIndex:function(t){var e=-1;if(""==this.text)return e;for(var i=String(this.text).split(this.delimiter),n=0,s=0,o=i.length;s<o;s++){var r=i[s];if(n<t&&t<=n+r.length){e=s;break}n=n+r.length+1}return e},getAttrs:function(t){var e=mini.Lookup.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["grid","valueField","textField","delimiter"]),mini._ParseBool(t,e,["multiSelect"]),e}}),mini.regClass(mini.Lookup,"lookup"),mini.TextBoxList=function(t){mini.TextBoxList.superclass.constructor.call(this,null),this.data=[],this.selecteds=[],this.doUpdate(),t&&mini.applyTo.call(this,t)},mini.extend(mini.TextBoxList,mini.ValidatorBase,{formField:!0,remote:!0,value:"",text:"",valueField:"id",textField:"text",selecteds:null,data:null,url:"",delay:150,allowInput:!0,editIndex:0,_focusCls:"mini-textboxlist-focus",_itemHoverClass:"mini-textboxlist-item-hover",_itemSelectedClass:"mini-textboxlist-item-selected",_closeHoverClass:"mini-textboxlist-close-hover",textName:"",setTextName:function(t){this.textName=t},getTextName:function(){return this.textName},getData:function(){return this.data},setData:function(t){this.data=t},getRemote:function(){return this.remote},setRemote:function(t){this.remote=t},uiCls:"mini-textboxlist",_create:function(){var t=document.createElement("div");t.innerHTML='<table class="mini-textboxlist mini-corner-all" cellpadding="0" cellspacing="0"><tr ><td class="mini-textboxlist-border mini-corner-all"><ul></ul><a href="#"></a><input type="hidden"/></td></tr></table>',this.el=t.firstChild;var e=this.el.getElementsByTagName("td")[0];this.ulEl=e.firstChild,this._valueEl=e.lastChild,this.focusEl=e.childNodes[1]},destroy:function(t){this.isShowPopup&&this.hidePopup(),this._inputEl&&(mini.clearEvent(this._inputEl),this._inputEl.onkeyup=null,this._inputEl.onfocus=null,this._inputEl.onblur=null),mini.un(document,"mousedown",this.__OnDocMouseDown,this),mini.TextBoxList.superclass.destroy.call(this,t)},_initEvents:function(){mini.TextBoxList.superclass._initEvents.call(this),mini.on(this.el,"mousemove",this.__OnMouseMove,this),mini.on(this.el,"mouseout",this.__OnMouseOut,this),mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"keydown",this.__OnKeyDown,this),mini.on(document,"mousedown",this.__OnDocMouseDown,this)},__OnDocMouseDown:function(t){if(!this.isReadOnly()){this.isShowPopup&&(mini.isAncestor(this.popup.el,t.target)||this.hidePopup());var e=this;this._focused&&0==this.within(t)&&(clearInterval(this._ValueChangeTimer),this.select(null,!1),setTimeout(function(){e.showInput(!1)},100),this.removeCls(this._focusCls),this._focused=!1)}},errorIconEl:null,getErrorIconEl:function(){if(!this._errorIconEl){var t=this.el.rows[0].insertCell(1);t.style.cssText="width:18px;vertical-align:top;",t.innerHTML='<div class="mini-errorIcon"></div>',this._errorIconEl=t.firstChild}return this._errorIconEl},_RemoveErrorIcon:function(){this._errorIconEl&&jQuery(this._errorIconEl.parentNode).remove(),this._errorIconEl=null},doLayout:function(){0!=this.canLayout()&&(mini.TextBoxList.superclass.doLayout.call(this),this.doReadOnly())},doReadOnly:function(){this.isReadOnly()||0==this.allowInput?this._inputEl.readOnly=!0:this._inputEl.readOnly=!1},doUpdate:function(){this._ValueChangeTimer&&clearInterval(this._ValueChangeTimer),this._inputEl&&mini.un(this._inputEl,"keydown",this.__OnInputKeyDown,this);for(var t=[],e=this.uid,i=0,n=this.selecteds.length;i<n;i++){var s=this.selecteds[i],o=e+"$text$"+i,r=mini._getMap(this.textField,s);mini.isNull(r)&&(r=""),t[t.length]='<li id="'+o+'" class="mini-textboxlist-item">',t[t.length]=r,t[t.length]='<span class="mini-textboxlist-close"></span></li>'}var a=e+"$input";t[t.length]='<li id="'+a+'" class="mini-textboxlist-inputLi"><input class="mini-textboxlist-input" type="text" autocomplete="off"></li>',this.ulEl.innerHTML=t.join(""),this.editIndex=this.selecteds.length,this.editIndex<0&&(this.editIndex=0),this.inputLi=this.ulEl.lastChild,this._inputEl=this.inputLi.firstChild,this._inputEl.placeholder=this.placeholder,mini.on(this._inputEl,"keydown",this.__OnInputKeyDown,this);var l=this;this._inputEl.onkeyup=function(){l._syncInputSize()},l._ValueChangeTimer=null,l._LastInputText=l._inputEl.value,this._inputEl.onfocus=function(){l._LastInputText=l._inputEl.value,l._ValueChangeTimer=setInterval(function(){if(!l._focused)return clearInterval(l._ValueChangeTimer),void(l._ValueChangeTimer=null);l._LastInputText!=l._inputEl.value&&(l._startQuery(),l._LastInputText=l._inputEl.value)},10),l.addCls(l._focusCls),l._focused=!0,l.fire("focus")},this._inputEl.onblur=function(){clearInterval(l._ValueChangeTimer),l._ValueChangeTimer=null,l.fire("blur"),l.validateOnLeave&&l.isEditable()&&l._tryValidate()},this.doReadOnly()},getItemByEvent:function(t){var e=mini.findParent(t.target,"mini-textboxlist-item");if(e){var i=e.id.split("$"),n=i[i.length-1];return this.selecteds[n]}},getItem:function(t){return"number"==typeof t?this.selecteds[t]:"object"==typeof t?t:void 0},getItemEl:function(t){var e=this.selecteds.indexOf(t),i=this.uid+"$text$"+e;return document.getElementById(i)},hoverItem:function(t,e){if(!this.isReadOnly()&&0!=this.enabled){this.blurItem();var i=this.getItemEl(t);mini.addClass(i,this._itemHoverClass),e&&mini.hasClass(e.target,"mini-textboxlist-close")&&mini.addClass(e.target,this._closeHoverClass)}},blurItem:function(){for(var t=0,e=this.selecteds.length;t<e;t++){var i=this.selecteds[t],n=this.getItemEl(i);n&&(mini.removeClass(n,this._itemHoverClass),mini.removeClass(n.lastChild,this._closeHoverClass))}},showInput:function(t){this.select(null),mini.isNumber(t)?this.editIndex=t:this.editIndex=this.selecteds.length,this.editIndex<0&&(this.editIndex=0),this.editIndex>this.selecteds.length&&(this.editIndex=this.selecteds.length);var i=this.inputLi;if(i.style.display="block",mini.isNumber(t)&&t<this.selecteds.length){var n=this.selecteds[t],s=this.getItemEl(n);jQuery(s).before(i)}else this.ulEl.appendChild(i);return!1!==t?setTimeout(function(){try{i.firstChild.focus(),mini.selectRange(i.firstChild,100)}catch(e){}},10):(this.lastInputText="",this._inputEl.value=""),i},select:function(t){if(t=this.getItem(t),this._selected){var e=this.getItemEl(this._selected);mini.removeClass(e,this._itemSelectedClass)}if(this._selected=t,this._selected){e=this.getItemEl(this._selected);mini.addClass(e,this._itemSelectedClass)}if(this._selected){this.focusEl.focus();var i=this;setTimeout(function(){try{i.focusEl.focus()}catch(ex){}},50)}this._selected&&(this.addCls(this._focusCls),this._focused=!0)},_doInsertInputValue:function(){var t=this.getInputText(),e={};e[this.textField]=t,e[this.valueField]=t;var i=this.editIndex;this.insertItem(i,e)},_doInsertSelectValue:function(){if(0!=this._listbox.getData().length){var t=this._listbox.getSelected(),e=this.editIndex;t&&(t=mini.clone(t),this.insertItem(e,t))}},insertItem:function(t,e){this.selecteds.insert(t,e);var i=this.getText(),n=this.getValue();this.setValue(n,!1),this.setText(i,!1),this._createSelecteds(),this.doUpdate(),this.showInput(t+1),this._OnValueChanged()},removeItem:function(t){if(t){var e=this.getItemEl(t);mini.removeNode(e),this.selecteds.remove(t);var i=this.getText(),n=this.getValue();this.setValue(n,!1),this.setText(i,!1),this._OnValueChanged()}},_createSelecteds:function(){var t=(this.text?this.text:"").split(","),e=(this.value?this.value:"").split(",");""==e[0]&&(e=[]);for(var i=e.length,n=0,s=this.selecteds.length=i;n<s;n++){var o=this.selecteds[n];o||(o={},this.selecteds[n]=o);
//if (!o._id) o._id = this.itemID++;
var r=mini.isNull(t[n])?"":t[n],a=mini.isNull(e[n])?"":e[n];mini._setMap(this.textField,r,o),mini._setMap(this.valueField,a,o)}this.value=this.getValue(),this.text=this.getText()},getInputText:function(){return this._inputEl?this._inputEl.value:""},getText:function(){for(var t=[],e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e],s=mini._getMap(this.textField,n);mini.isNull(s)&&(s=""),s=s.replace(",","，"),t.push(s)}return t.join(",")},getValue:function(){for(var t=[],e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e],s=mini._getMap(this.valueField,n);t.push(s)}return t.join(",")},getFormValue:function(){var t=this.value;return null!==t&&t!==undefined||(t=""),String(t)},setName:function(t){this.name!=t&&(this.name=t,this._valueEl.name=t)},setValue:function(t){mini.isNull(t)&&(t=""),this.value!=t&&(this.value=t,this._valueEl.value=t,this._createSelecteds(),this.doUpdate())},setText:function(t){mini.isNull(t)&&(t=""),this.text!==t&&(this.text=t,this._createSelecteds(),this.doUpdate())},setValueField:function(t){this.valueField=t,this._createSelecteds()},getValueField:function(){return this.valueField},setTextField:function(t){this.textField=t,this._createSelecteds()},getTextField:function(){return this.textField},setAllowInput:function(t){this.allowInput=t,this.doLayout()},getAllowInput:function(){return this.allowInput},setUrl:function(t){this.url=t},getUrl:function(){return this.url},setPopupHeight:function(t){this.popupHeight=t},getPopupHeight:function(){return this.popupHeight},setPopupMinHeight:function(t){this.popupMinHeight=t},getPopupMinHeight:function(){return this.popupMinHeight},setPopupMaxHeight:function(t){this.popupMaxHeight=t},getPopupMaxHeight:function(){return this.popupMaxHeight},valueFromSelect:!0,setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},doQuery:function(){this._startQuery(!0)},_syncInputSize:function(){if(0!=this.isDisplay()){var t=this.getInputText(),e=mini.measureText(this._inputEl,t),i=20<e.width?e.width+4:20,n=mini.getWidth(this.el,!0);n-15<i&&(i=n-15),this._inputEl.style.width=i+"px"}},inputMode:!1,setIputMode:function(t){this.inputMode=t},getIputMode:function(){return this.inputMode},_startQuery:function(t){var e=this;this.inputMode||(setTimeout(function(){e._syncInputSize()},1),this.showPopup("loading"),this._stopQuery(),this._loading=!0,this.delayTimer=setTimeout(function(){e._inputEl.value;
//if (oldText === true || text != oldText) {
e._doQuery()},this.delay))},ajaxDataType:"text",ajaxContentType:"application/x-www-form-urlencoded; charset=UTF-8",_getSelectedMap:function(){for(var t={},e=0,i=this.selecteds.length;e<i;e++){var n=this.selecteds[e];t[n[this.valueField]]=n[this.textField]}return t},_getFilterLocalData:function(t){var e=[],i=this._getSelectedMap();t=(t||"").toLowerCase();for(var n=0,s=this.data.length;n<s;n++){var o=this.data[n];if(!i[o[this.valueField]]){var r=o[this.textField];t&&-1==String(r).toLowerCase().indexOf(t)||e.push(o)}}return e},_doQuery:function(){if(0!=this.isDisplay()){var t=this.getInputText(),o=this;if(!o.remote){var e=this._getFilterLocalData(t);return o._listbox.setData(e),o.showPopup(),o._listbox._focusItem(0,!0),void(o._loading=!1)}this._listbox.getData();var i={value:this.getValue(),text:this.getText()};i[this.searchField]=t;var n=this.url,s="function"==typeof n?n:window[n];if("function"==typeof s&&(n=s(this)),n){var r="post";n&&(-1==n.indexOf(".txt")&&-1==n.indexOf(".json")||(r="get"));var a={url:n,async:!0,params:i,data:i,type:this.ajaxType?this.ajaxType:r,cache:!1,cancel:!1};if(jQuery.extend(!0,a,this.ajaxOptions),this.fire("beforeload",a),!a.cancel){var l=this;mini.copyTo(a,{success:function(t,e,i){delete a.params;var n={text:t,result:null,sender:l,options:a,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(ex){if(1==mini_debugger)throw new Error("textboxlist json is error")}mini.isArray(s)&&(s={data:s}),
//                if (mini.isNumber(data.error) && data.error != 0) {
l.dataField&&(s.data=mini._getMap(l.dataField,s)),s.data||(s.data=[]),o._listbox.setData(s.data),o.showPopup(),o._listbox._focusItem(0,!0),o.fire("load",{data:s.data,result:s}),o._loading=!1,o._selectOnLoad&&(o.__doSelectValue(),o._selectOnLoad=null)},error:function(t,e,i){o.showPopup("error")}}),o._ajaxer=mini.ajax(a)}}}},_stopQuery:function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this._ajaxer&&this._ajaxer.abort(),this._loading=!1},within:function(t){return!!mini.isAncestor(this.el,t.target)||!!(this.showPopup&&this.popup&&this.popup.within(t))},placeholder:"",setPlaceholder:function(t){this.placeholder=t},getPlaceholder:function(t){return this.placeholder},emptyText:"No Result",setEmptyText:function(t){this.popupEmptyText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.emptyText=t},getEmptyText:function(t){return this.emptyText},loadingText:"Loading...",setLoadingText:function(t){this.popupLoadingText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.loadingText=t},getLoadingText:function(t){return this.loadingText},errorText:"Error",setErrorText:function(t){this.popupEmptyText="<span class='mini-textboxlist-popup-noresult'>"+t+"</span>",this.errorText=t},getErrorText:function(t){return this.errorText},popupLoadingText:"<span class='mini-textboxlist-popup-loading'>Loading...</span>",popupErrorText:"<span class='mini-textboxlist-popup-error'>Error</span>",popupEmptyText:"<span class='mini-textboxlist-popup-noresult'>No Result</span>",isShowPopup:!1,popupHeight:"",popupMinHeight:30,popupMaxHeight:150,_createPopup:function(){return this.popup||(this.popup=new mini.ListBox,this.popup.addCls("mini-textboxlist-popup"),this.popup.setStyle("position:absolute;left:0;top:0;"),this.popup.showEmpty=!0,this.popup.setValueField(this.valueField),this.popup.setTextField(this.textField),this.popup.render(document.body),this.popup.on("itemclick",function(t){this.hidePopup(),this._doInsertSelectValue()},this)),this._listbox=this.popup,this.popup},showPopup:function(t){if(0!=this.isDisplay()){this.isShowPopup=!0;var e=this._createPopup();e.el.style.zIndex=mini.getMaxZIndex();var i=this._listbox;i.emptyText=this.popupEmptyText,"loading"==t?(i.emptyText=this.popupLoadingText,this._listbox.setData([])):"error"==t&&(i.emptyText=this.popupLoadingText,this._listbox.setData([])),this._listbox.doUpdate();var n=this.getBox(),s=n.x,o=n.y+n.height;this.popup.el.style.display="block",mini.setXY(e.el,-1e3,-1e3),this.popup.setWidth(n.width),this.popup.setHeight(this.popupHeight),this.popup.getHeight()<this.popupMinHeight&&this.popup.setHeight(this.popupMinHeight),this.popup.getHeight()>this.popupMaxHeight&&this.popup.setHeight(this.popupMaxHeight),mini.setXY(e.el,s,o)}},hidePopup:function(){this.isShowPopup=!1,this.popup&&(this.popup.el.style.display="none")},__OnMouseMove:function(t){if(0!=this.enabled){var e=this.getItemByEvent(t);e?this.hoverItem(e,t):this.blurItem()}},__OnMouseOut:function(t){this.blurItem()},__OnClick:function(t){if(!this.isReadOnly()&&0!=this.enabled&&0!=this.enabled){var e=this.getItemByEvent(t);e?(this.focusEl.focus(),this.select(e),t&&mini.hasClass(t.target,"mini-textboxlist-close")&&(this.removeItem(e),this.fire("removeitem",{item:e}))):mini.findParent(t.target,"mini-textboxlist-input")||this.showInput()}},__OnKeyDown:function(t){if(this.isReadOnly()||0==this.allowInput)return!1;var e=this.selecteds.indexOf(this._selected),i=this;function n(){var t=i.selecteds[e];i.removeItem(t),t=(t=i.selecteds[e])||i.selecteds[e-1],i.select(t),t||i.showInput()}switch(t.keyCode){case 8:t.preventDefault(),n();break;case 37:case 38:this.select(null),this.showInput(e);break;case 39:case 40:e+=1,this.select(null),this.showInput(e);break;case 46:n()}},__doSelectValue:function(){var t=this._listbox.getFocusedItem();if(t)this._listbox.setSelected(t),this.lastInputText=this.text,this.hidePopup(),this._doInsertSelectValue();else if(!this.valueFromSelect){this.getInputText().trim()&&this._doInsertInputValue();
//            if (!item && !this.valueFromSelect) {
//                if (value != "") {
}},__OnInputKeyDown:function(t){if(this._selectOnLoad=null,this.isReadOnly()||0==this.allowInput)return!1;if((13!=t.keyCode||this.isShowPopup)&&(t.stopPropagation(),!this.isReadOnly()&&0!=this.allowInput)){var e=mini.getSelectRange(this._inputEl),i=e[0],n=e[1],s=this._inputEl.value.length,o=i==n&&0==i,r=i==n&&n==s;if(!this.isReadOnly()&&0!=this.allowInput||t.preventDefault(),9!=t.keyCode){if(16!=t.keyCode&&17!=t.keyCode&&18!=t.keyCode)switch(t.keyCode){case 13:if(this.inputMode)return void(this.getInputText().trim()&&this._doInsertInputValue());if(this.isShowPopup){if(t.preventDefault(),this._loading)return void(this._selectOnLoad=!0);if((l=this._listbox.getFocusedItem())&&!1===l.enabled)return;this.__doSelectValue()}break;case 27:t.preventDefault(),this.hidePopup();break;case 8:o&&t.preventDefault();case 37:if(o)if(this.isShowPopup)this.hidePopup();else if(0<this.editIndex)(a=this.editIndex-1)<0&&(a=0),a>=this.selecteds.length&&(a=this.selecteds.length-1),this.showInput(!1),this.select(a);break;case 39:if(r)if(this.isShowPopup)this.hidePopup();else if(this.editIndex<=this.selecteds.length-1){var a=this.editIndex;this.showInput(!1),this.select(a)}break;case 38:if(t.preventDefault(),this.isShowPopup){a=-1;(l=this._listbox.getFocusedItem())&&(a=this._listbox.indexOf(l)),--a<0&&(a=0),this._listbox._focusItem(a,!0)}break;case 40:if(t.preventDefault(),this.isShowPopup){var l;a=-1;(l=this._listbox.getFocusedItem())&&(a=this._listbox.indexOf(l)),++a<0&&(a=0),a>=this._listbox.getCount()&&(a=this._listbox.getCount()-1),this._listbox._focusItem(a,!0)}else this._startQuery(!0)}}else this.hidePopup()}},focus:function(){try{this._inputEl.focus()}catch(e){}},blur:function(){try{this._inputEl.blur()}catch(e){}},searchField:"key",setSearchField:function(t){this.searchField=t},getSearchField:function(){return this.searchField},getAttrs:function(t){var e=mini.TextBox.superclass.getAttrs.call(this,t);jQuery(t);return mini._ParseString(t,e,["value","text","valueField","textField","url","popupHeight","textName","onfocus","onbeforeload","onload","searchField","emptyText","loadingText","errorText","onblur","onremoveitem","placeholder"]),mini._ParseBool(t,e,["allowInput","valueFromSelect","remote","inputMode"]),mini._ParseInt(t,e,["popupMinHeight","popupMaxHeight"]),e}}),mini.regClass(mini.TextBoxList,"textboxlist"),mini.AutoComplete=function(){mini.AutoComplete.superclass.constructor.apply(this,arguments);var t=this;t._ValueChangeTimer=null,this._textEl.onfocus=function(){t._LastInputText=t._textEl.value,t._ValueChangeTimer=setInterval(function(){t._LastInputText!=t._textEl.value&&(t._tryQuery(),t._LastInputText=t._textEl.value,""==t._textEl.value&&""!=t.value&&(t.setValue(""),t._OnValueChanged()))},10)},this._textEl.onblur=function(){clearInterval(t._ValueChangeTimer),t.isShowPopup()||t._LastInputText!=t._textEl.value&&""==t._textEl.value&&""!=t.value&&(t.setValue(""),t._OnValueChanged())},this._buttonEl.style.display="none",this._doInputLayout()},mini.extend(mini.AutoComplete,mini.ComboBox,{remote:!0,url:"",allowInput:!0,delay:150,showButton:!1,searchField:"key",minChars:0,_buttonWidth:0,uiCls:"mini-autocomplete",_initInput:function(){var t=this;isFirefox&&(this._textEl.oninput=function(){t.enterQuery||t._tryQuery()})},getRemote:function(){return this.remote},setRemote:function(t){this.remote=t},setUrl:function(t){this.url=t,this.remote||mini.AutoComplete.superclass.setUrl.call(this,t)},setValue:function(t){mini.isNull(t)&&(t=""),this.value!=t&&(this.value=t,this._valueEl.value=this.value),this.__oldText=""},setText:function(t){mini.isNull(t)&&(t=""),this.text!=t&&(this.text=t,this._LastInputText=t),this._textEl.value=this.text},setMinChars:function(t){this.minChars=t},getMinChars:function(){return this.minChars},setSearchField:function(t){this.searchField=t},getSearchField:function(){return this.searchField},popupEmptyText:epoint_local.AutoComplete.popupEmptyText,setPopupEmptyText:function(t){this.popupEmptyText=t},getPopupEmptyText:function(t){return this.popupEmptyText},loadingText:epoint_local.AutoComplete.loadingText,setLoadingText:function(t){this.loadingText=t},getLoadingText:function(t){return this.loadingText},errorText:epoint_local.AutoComplete.errorText,setErrorText:function(t){this.errorText=t},getErrorText:function(t){return this.errorText},getPopupEmptyHtml:function(){return"<span class='mini-textboxlist-popup-noresult'>"+this.popupEmptyText+"</span>"},getPopupLoadingHtml:function(){return"<span class='mini-textboxlist-popup-loading'>"+this.loadingText+"</span>"},getPopupErrorHtml:function(){return"<span class='mini-textboxlist-popup-error'>"+this.errorText+"</span>"},showPopup:function(t){this.getPopup();var e=this._listbox;e.showEmpty=!0,e.emptyText=this.getPopupEmptyHtml(),"loading"==t?(e.emptyText=this.getPopupLoadingHtml(),this._listbox.setData([])):"error"==t&&(e.emptyText=this.getPopupErrorHtml(),this._listbox.setData([])),this._listbox.doUpdate(),mini.AutoComplete.superclass.showPopup.call(this)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(16!=t.keyCode&&17!=t.keyCode&&18!=t.keyCode&&!this.isReadOnly())switch(t.keyCode){case 27:this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 13:var i=!0;if((!this.isShowPopup()||0==this._listbox.getData().length)&&this.enterQuery){i=!1;var n=this._textEl.value;this._enterSearchText==n&&this.loading||(this._enterSearchText=n,this._tryQuery(n))}if(this.isShowPopup()){if(t.preventDefault(),t.stopPropagation(),!0!==this._requestSearch)if(-1!=(a=this._listbox.getFocusedIndex())){var s=this._listbox.getAt(a),o=this._listbox.getValueAndText([s]),r=o[0];this.setText(o[1]),this.setValue(r),this._OnValueChanged()}}else this.fire("enter",e);i&&(this.hidePopup(),this.focus());break;case 37:break;case 38:if(-1==(a=this._listbox.getFocusedIndex()))if(a=0,!this.multiSelect)(s=this._listbox.findItems(this.value)[0])&&(a=this._listbox.indexOf(s));this.isShowPopup()&&(this.multiSelect||((a-=1)<0&&(a=0),this._listbox._focusItem(a,!0)));break;case 39:break;case 40:var a=this._listbox.getFocusedIndex();this.isShowPopup()?this.multiSelect||((a+=1)>this._listbox.getCount()-1&&(a=this._listbox.getCount()-1),this._listbox._focusItem(a,!0)):this._tryQuery(this._textEl.value);break;default:1==this.enterQuery?(this.hidePopup(),this.focus()):this._keydownQuery()}}else this.hidePopup()},delay:200,_keydownQuery:function(){var e=this;e._requestSearch=!0,e.remote||(e._requestSearch=!1),e._keydownTimer&&(clearTimeout(e._keydownTimer),e._keydownTimer=null),e._keydownTimer=setTimeout(function(){var t=e._textEl.value;t!=e.__oldText&&(e._tryQuery(t),e.__oldText=t)},e.delay)},enterQuery:!1,doQuery:function(){this._tryQuery()},_tryQuery:function(t){var e=this;this._queryTimer&&(clearTimeout(this._queryTimer),this._queryTimer=null),this._queryTimer=setTimeout(function(){var t=e._textEl.value;
//if (text != oldText) {
e._doQuery(t)},this.delay),!1!==e._tryHide()&&this.showPopup("loading")},_tryHide:function(){if(mini.getActiveElement()!=this._textEl&&mini.hasClass(this.el,"mini-buttonedit-focus"))return this.hidePopup(),!1},blur:function(){var t=this;mini.AutoComplete.superclass.blur.apply(this),t._ajaxer&&(t._ajaxer.abort(),t._ajaxer=null),t._doloadTimer&&(clearTimeout(t._doloadTimer),t._doloadTimer=null),t._queryTimer&&(clearTimeout(t._queryTimer),t._queryTimer=null),t._keydownTimer&&(clearTimeout(t._keydownTimer),t._keydownTimer=null),t.isShowPopup()&&t.hidePopup()},_doQuery:function(t){var o=this;if(mini.getActiveElement()==o._textEl)if(this.remote){
//if (!this.url) return;
this._ajaxer&&this._ajaxer.abort();var e=this.url,i="post";e&&(-1==e.indexOf(".txt")&&-1==e.indexOf(".json")||(i="get"));var n={};n[this.searchField]=t;var r={url:e,async:!0,params:n,data:n,type:this.ajaxType?this.ajaxType:i,cache:!1,cancel:!1};jQuery.extend(!0,r,this.ajaxOptions),this.fire("beforeload",r);o=this;if(r.cancel){var s=r.result||[];a(s,s)}else o.loading=!0,mini.copyTo(r,{success:function(t,e,i){delete r.params;var n={text:t,result:null,sender:o,options:r,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(ex){if(1==mini_debugger)throw new Error("autocomplete json is error")}mini.isArray(s)&&(s={data:s}),
//                if (mini.isNumber(result.error) && result.error != 0) {
o.dataField&&(s.data=mini._getMap(o.dataField,s)),s.data||(s.data=[]),a(s.data,s)},error:function(t,e,i){
//                if (textStatus != "abort") {
},complete:function(){o.loading=!1,o._requestSearch=!1,o._ajaxer=null}}),this._ajaxer=mini.ajax(r)}else mini.AutoComplete.superclass._doQuery.apply(this,arguments);else o.hidePopup();function a(t,e){o._focused&&!1!==o._tryHide()&&(o._doloadTimer&&(clearTimeout(o._doloadTimer),o._doloadTimer=null),o._doloadTimer=setTimeout(function(){o._doloadTimer=null,o._tryHide()},100),o._listbox.setData(t),o.showPopup(),o._listbox._focusItem(0,!0),o.data=t,o.fire("load",{data:t,result:e}))}},setEnterQuery:function(t){this.enterQuery=t},getEnterQuery:function(){return this.enterQuery},getAttrs:function(t){var e=mini.AutoComplete.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["searchField","popupEmptyText","loadingText","errorText"]),mini._ParseInt(t,e,["delay"]),mini._ParseBool(t,e,["enterQuery","remote"]),e}}),mini.regClass(mini.AutoComplete,"autocomplete"),mini.ToolTip=function(){mini.ToolTip.superclass.constructor.apply(this,arguments)},mini.extend(mini.ToolTip,mini.Control,{selector:"[title]",placement:"bottom",trigger:"hover focus",delay:200,uiCls:"mini-tooltip",_create:function(){this.el=jQuery('<div class="mini-tooltip"><div class="mini-tooltip-arrow"></div><div class="mini-tooltip-inner mini-corner-all"></div></div>')[0],this.$element=jQuery(this.el),this.$element.appendTo(document.body)},_initEvents:function(){},_bindTooltip:function(){var t=jQuery(document),e=this.selector,i="tooltip";t.unbind("."+i,this);for(var n=this.trigger.split(" "),s=n.length;s--;){var o=n[s];if("click"==o)t.on("click."+i,e,jQuery.proxy(this._toggle,this));else if("manual"!=o){var r="hover"==o?"mouseenter":"focus",a="hover"==o?"mouseleave":"blur";t.on(r+"."+i,e,jQuery.proxy(this._enter,this)),t.on(a+"."+i,e,jQuery.proxy(this._leave,this))}}},setSelector:function(t){this.selector=t,this._bindTooltip()},getSelector:function(){return this.selector},setPlacement:function(t){this.placement=t},getPlacement:function(){return this.placement},setTrigger:function(t){this.trigger=t,this._bindTooltip()},getTrigger:function(){return this.trigger},openTimer:null,_enter:function(t){var e=this,i=t.currentTarget;this.getContent(i),clearTimeout(this.openTimer),this.openTimer=setTimeout(function(){e.openTimer=null,e.open(i)},e.delay)},_leave:function(t){clearTimeout(this.openTimer),this.close()},_toggle:function(t){"none"==this._getTip().css("display")?this.enter(t):this.leave(t)},open:function(t){t=jQuery(t)[0]||this.target,jQuery(t);var e=this.getContent(t),i={element:t,content:e,cancel:!e};if(this.fire("beforeopen",i),!i.cancel){this.$element.show(),this._target=t;try{this.setContent(i.content)}catch(ex){}this.fire("open",{element:t})}},close:function(){this._target=null,this.$element.hide()},showLoading:function(){this.setContent('<div class="mini-tooltip-loading"></div>')},setContent:function(t){this.$element.children(".mini-tooltip-inner").html(t||"&nbsp;"),this.applyPlacement()},getContent:function(t){var e=t.title;return e&&jQuery(t).attr("data-tooltip",e).attr("title",""),e=e||jQuery(t).attr("data-tooltip")},applyPlacement:function(){if(this._target&&"none"!=this.$element.css("display")){var t=this._target,e=jQuery(t).attr("data-placement")||this.placement,i=this.$element;if(t&&i[0]){i.show().css({left:"-2000px",top:"-2000px"});var n=mini.getBox(t),s=mini.getViewportBox(),o=n.top-s.top,r=s.bottom-n.bottom;u(e);var a=mini.getBox(i[0]),l=mini.getCalculatedOffset(e,n,a.width,a.height);if("left"==e||"right"==e||"top"==e||"bottom"==e||"bottomleft"==e&&r<o&&l.top+a.height>s.bottom&&(e="topleft"),u(e),l=mini.getCalculatedOffset(e,n,a.width,a.height),"right"==e||"left"==e){var h=jQuery(i).children(".mini-tooltip-arrow");function d(){var t=n.top+n.height/2-h.height()/2-l.top;h.css("top",t)}h.css("top","");s=mini.getViewportBox();l.top<s.y?(l.top=s.y,d()):l.top+a.height>s.bottom&&(l.top=s.bottom-a.height,d())}!function c(t){i.offset(t)}(l)}}function u(t){i.removeClass("mini-tooltip-left mini-tooltip-top mini-tooltip-right mini-tooltip-bottom mini-tooltip-bottomleft mini-tooltip-topleft mini-tooltip-bottomright mini-tooltip-topright").addClass("mini-tooltip-"+t)}},getAttrs:function(t){var e=mini.ToolTip.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["selector","placement","onbeforeopen","onopen","onclose"]),e}}),mini.regClass(mini.ToolTip,"tooltip"),mini.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:"bottomleft"==t?{top:e.top+e.height,left:e.left}:"bottomright"==t?{top:e.top+e.height,left:e.left+e.width-i}:"topleft"==t?{top:e.top-n,left:e.left}:"topright"==t?{top:e.top-n,left:e.left+e.width-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},mini.ProgressBar=function(){mini.ProgressBar.superclass.constructor.apply(this,arguments)},mini.extend(mini.ProgressBar,mini.Control,{formField:!0,uiCls:"mini-progressbar",showText:!1,textAlign:"right",text:"",format:"{0}%",value:0,state:"loading",set:function(t){if("string"==typeof t)return this;var e=t.value;return delete t.value,mini.ProgressBar.superclass.set.call(this,t),mini.isNull(e)||this.setValue(e),this},_create:function(){this.el=document.createElement("div"),this.el.className="mini-progressbar";this.el.innerHTML='<div class="mini-progressbar-border"><div class="mini-progressbar-bar"><div class="mini-progressbar-bar-current"></div></div><div class="mini-progressbar-text"></div><div class="mini-progressbar-state action-icon" style="display:none""></div></div>',this._borderEl=this.el.firstChild,this._barEl=this._borderEl.firstChild.firstChild,this._textEl=jQuery(this._borderEl).find(".mini-progressbar-text")[0],this._stateEl=this._borderEl.lastChild,this.el.setAttribute("mini-text-align",this.textAlign)},setText:function(t){this.text=t,this._textEl.innerHTML=t},setShowText:function(t){this.showText=t,this._textEl.style.display=t?"":"none"},getShowText:function(){return this.showText},setTextAlign:function(t){this.textAlign=t,this._textEl.style.textAlign=t,this.el.setAttribute("mini-text-align",this.textAlign)},getTextAlign:function(){return this.textAlign},setValue:function(t){t=parseFloat(t),isNaN(t)&&(t=0),t<0&&(t=0),100<t&&(t=100),this.value=t,this._barEl.style.width=t+"%";var e=String.format(this.format,t);this.setText(e)},getValue:function(){return this.value},setState:function(t){~["success","error","loading"].indexOf(t)&&(this.removeCls("mini-progress-"+this.state),this.addCls("mini-progress-"+t),"success"===t||"error"===t?(this._textEl.style.display="none",jQuery(this._stateEl).removeClass("icon-successfill icon-errorfill").addClass("icon-"+t+"fill").show()):(this._textEl.style.display="",this._stateEl.style.display="none"))},getState:function(){return this.state},getAttrs:function(t){var e=mini.ProgressBar.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["text","format","textAlign","state"]),mini._ParseBool(t,e,["showText"]),e}}),mini.regClass(mini.ProgressBar,"progressbar"),mini.Form=function(t){if(this.el=mini.byId(t),!this.el)throw new Error("form element not null");mini.Form.superclass.constructor.apply(this,arguments)},mini.extend(mini.Form,mini.Component,{el:null,getFields:function(){return this.el?mini.findControls(function(t){return!(!t.el||1!=t.formField)&&!!mini.isAncestor(this.el,t.el)},this):[]},getFieldsMap:function(){for(var t=this.getFields(),e={},i=0,n=t.length;i<n;i++){var s=t[i];s.name&&(e[s.name]=s)}return e},getField:function(t){return this.el?mini.getbyName(t,this.el):null},getData:function(t,e){mini.isNull(e)&&(e=!0);for(var i=t?"getFormValue":"getValue",n=this.getFields(),s={},o=0,r=n.length;o<r;o++){var a=n[o],l=a[i];l&&(a.name&&(1==e?mini._setMap(a.name,l.call(a),s):s[a.name]=l.call(a)),a.textName&&a.getText&&(1==e?mini._setMap(a.textName,a.getText(),s):s[a.textName]=a.getText()))}return s},setData:function(t,e,i){mini.isNull(i)&&(i=!0),"object"!=typeof t&&(t={});var n=this.getFieldsMap();for(var s in n){var o=n[s];if(o){if(o.setValue){var r=t[s];if(1==i&&(r=mini._getMap(s,t)),r===undefined&&!1===e)continue;null===r&&(r=""),o.setValue(r)}if(o.setText&&o.textName){var a=t[o.textName];1==i&&(a=mini._getMap(o.textName,t)),mini.isNull(a)&&(a=""),o.setText(a)}}}},reset:function(){for(var t=this.getFields(),e=0,i=t.length;e<i;e++){var n=t[e];if(n.setValue){if(n.setText&&!1!==n._clearText){var s=n.defaultText;mini.isNull(s)&&(s=""),n.setText(s)}n.setValue(n.defaultValue),n.clear&&n.clear()}}this.setIsValid(!0)},clear:function(){for(var t=this.getFields(),e=0,i=t.length;e<i;e++){var n=t[e];n.setValue&&(n.setText&&!1!==n._clearText&&n.setText(""),n.setValue(""),n.clear&&n.clear())}this.setIsValid(!0)},getValidateFields:function(t){for(var e=[],i=this.getFields(),n=0,s=i.length;n<s;n++){var o=i[n];o.validate&&o.isDisplay&&(!o.isDisplay(function(t){if(mini.hasClass(t,"mini-tabs-body"))return!0})&&!o.forceValidate||(o.enabled||t||o.forceValidate)&&e.push(o))}return e},validate:function(t,e){for(var i=this.getValidateFields(e),n=0,s=i.length;n<s;n++){if(0==i[n].validate()&&!1===t)break}return this.isValid()},isValid:function(){for(var t=this.getValidateFields(),e=0,i=t.length;e<i;e++){if(0==t[e].isValid())return!1}return!0},setIsValid:function(t){for(var e=this.getFields(),i=0,n=e.length;i<n;i++){var s=e[i];s.setIsValid&&s.setIsValid(t)}},getErrorTexts:function(){for(var t=[],e=this.getErrors(),i=0,n=e.length;i<n;i++){var s=e[i];t.push(s.errorText)}return t},getErrors:function(){for(var t=[],e=this.getFields(),i=0,n=e.length;i<n;i++){var s=e[i];s.isValid&&0==s.isValid()&&t.push(s)}return t},mask:function(t){"string"==typeof t&&(t={html:t}),(t=t||{}).el=this.el,t.cls||(t.cls=this._maskCls),mini.mask(t)},unmask:function(){mini.unmask(this.el)},_maskCls:"mini-mask-loading",loadingMsg:epoint_local.loadingMsg,loading:function(t){this.mask(t||this.loadingMsg)},__OnValueChanged:function(t){this._changed=!0},_changed:!1,setChanged:function(t){this._changed=t;for(var e=this.getFields(),i=0,n=e.length;i<n;i++){e[i].on("valuechanged",this.__OnValueChanged,this)}},isChanged:function(){return this._changed},setEnabled:function(t){for(var e=this.getFields(),i=0,n=e.length;i<n;i++){e[i].setEnabled(t)}}}),mini.Fit=function(){mini.Fit.superclass.constructor.apply(this,arguments)},mini.extend(mini.Fit,mini.Container,{style:"",_clearBorder:!1,uiCls:"mini-fit",_create:function(){this.el=document.createElement("div"),this.el.className="mini-fit",this._bodyEl=this.el},_initEvents:function(){},isFixedSize:function(){return!1},doLayout:function(){if(this.canLayout()){var t=this.el.parentNode,i=mini.getChildNodes(t);t==document.body&&(this.el.style.height="0px");for(var n=mini.getHeight(t,!0),s=0,o=i.length;s<o;s++){var r=(u=i[s]).tagName?u.tagName.toLowerCase():"";if(u!=this.el&&"style"!=r&&"script"!=r&&"hidden"!=u.type){var a=jQuery(u).css("position");if("absolute"!=a&&"fixed"!=a)n=n-mini.getHeight(u)-(l=mini.getMargins(u)).top-l.bottom}}var l,h=mini.getBorders(this.el),d=mini.getPaddings(this.el);n=n-(l=mini.getMargins(this.el)).top-l.bottom,jQuery.boxModel&&(n=n-d.top-d.bottom-h.top-h.bottom),n<0&&(n=0),this.el.style.height=n+"px";try{i=mini.getChildNodes(this.el);for(s=0,o=i.length;s<o;s++){var u=i[s];mini.layout(u)}}catch(e){}}},set_bodyParent:function(t){if(t){for(var i=this._bodyEl,n=t;n.firstChild;)try{i.appendChild(n.firstChild)}catch(e){}this.doLayout()}},getAttrs:function(t){var e=mini.Fit.superclass.getAttrs.call(this,t);return e._bodyParent=t,e}}),mini.regClass(mini.Fit,"fit"),mini.Panel=function(){this._initButtons(),mini.Panel.superclass.constructor.apply(this,arguments),this.url&&this.setUrl(this.url),this._contentEl=this._bodyEl,this._doVisibleEls(),this._Resizer=new mini._Resizer(this),this._doTools()},mini.extend(mini.Panel,mini.Container,{width:250,title:"",iconCls:"",iconStyle:"",allowResize:!1,url:"",refreshOnExpand:!1,maskOnLoad:!0,collapseOnTitleClick:!1,showCollapseButton:!1,showCloseButton:!1,closeAction:"display",showHeader:!0,showToolbar:!1,showFooter:!1,headerCls:"",headerStyle:"",bodyCls:"",bodyStyle:"",footerCls:"",footerStyle:"",toolbarCls:"",toolbarStyle:"",minWidth:180,minHeight:100,maxWidth:5e3,maxHeight:3e3,set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i=t.toolbar;delete t.toolbar;var n=t.footer;delete t.footer;var s=t.url;delete t.url;var o=t.buttons;return delete t.buttons,mini.Panel.superclass.set.call(this,t),o&&this.setButtons(o),i&&this.setToolbar(i),n&&this.setFooter(n),s&&this.setUrl(s),this._allowLayout=e,this.doLayout(),this},uiCls:"mini-panel",_create:function(){this.el=document.createElement("div"),this.el.className="mini-panel",this.el.tabIndex=0;this.el.innerHTML='<div class="mini-panel-border"><div class="mini-panel-header" ><div class="mini-panel-header-inner" ><span class="mini-panel-icon mini-icon mini-iconfont"></span><div class="mini-panel-title" ></div><div class="mini-tools" ></div></div></div><div class="mini-panel-viewport"><div class="mini-panel-toolbar"></div><div class="mini-panel-body" ></div><div class="mini-panel-footer"></div><div class="mini-resizer-trigger"></div></div></div>',this.el.hideFocus=!0,this._borderEl=this.el.firstChild,this._headerEl=this._borderEl.firstChild,this._viewportEl=this._borderEl.lastChild,this._toolbarEl=mini.byClass("mini-panel-toolbar",this.el),this._bodyEl=mini.byClass("mini-panel-body",this.el),this._footerEl=mini.byClass("mini-panel-footer",this.el),this._resizeGridEl=mini.byClass("mini-resizer-trigger",this.el);mini.byClass("mini-panel-header-inner",this.el);this._iconEl=mini.byClass("mini-panel-icon",this.el),this._titleEl=mini.byClass("mini-panel-title",this.el),this._toolsEl=mini.byClass("mini-tools",this.el),mini.setStyle(this._bodyEl,this.bodyStyle),this._doTitle()},destroy:function(t){this._doRemoveIFrame(),this._iframeEl=null,this._viewportEl=this._borderEl=this._bodyEl=this._footerEl=this._toolbarEl=null,this._toolsEl=this._titleEl=this._iconEl=this._resizeGridEl=null,mini.Panel.superclass.destroy.call(this,t)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"click",this.__OnClick,this)},this)},_doVisibleEls:function(){this._headerEl.style.display=this.showHeader?"":"none",this._toolbarEl.style.display=this.showToolbar?"":"none",this._footerEl.style.display=this.showFooter?"":"none"},_setBodyWidth:!0,doLayout:function(){if(this.canLayout()){var t=this.isAutoHeight(),e=(this.isAutoWidth(),parseInt(jQuery(this.el).css("max-height")));if(t&&e)this._viewportEl.style.height="auto",this._bodyEl.style.height="auto",e<this.el.firstChild.offsetHeight&&(t=!1);this._autoHeight=t;var i=this.getWidth(!0);if(mini.isIE6&&mini.setWidth(this._bodyEl,i),t)this._viewportEl.style.height="auto",this._bodyEl.style.height="auto";else{var n=this.getViewportHeight();mini.setHeight(this._viewportEl,n);var s=this.getBodyHeight(!1);mini.setHeight(this._bodyEl,s)}mini.layout(this._borderEl),this._resizeGridEl&&mini.repaint(this._resizeGridEl),this._resizeGridEl.style.display=this.allowResize?"":"none",this.fire("layout")}},deferLayout:function(t){if(t=t||10,!this._layoutTimer){var e=this;this._layoutTimer=setTimeout(function(){e._layoutTimer=null,e.doLayout()},t)}},_stopLayout:function(){clearTimeout(this._layoutTimer),this._layoutTimer=null},getViewportWidth:function(t){return this.getWidth(!0)},getViewportHeight:function(t){var e=this.getHeight(!0)-this.getHeaderHeight();if(t){var i=mini.getPaddings(this._viewportEl),n=mini.getBorders(this._viewportEl),s=mini.getMargins(this._viewportEl);jQuery.boxModel&&(e=e-i.top-i.bottom-n.top-n.bottom),e=e-s.top-s.bottom}return e},getBodyHeight:function(t){var e=(e=this.getViewportHeight(!0))-this.getToolbarHeight()-this.getFooterHeight();if(t){var i=mini.getPaddings(this._bodyEl),n=mini.getBorders(this._bodyEl),s=mini.getMargins(this._bodyEl);jQuery.boxModel&&(e=e-i.top-i.bottom-n.top-n.bottom),e=e-s.top-s.bottom}return e<0&&(e=0),e},getHeaderHeight:function(){return this.showHeader?jQuery(this._headerEl).outerHeight():0},getToolbarHeight:function(){return this.showToolbar?jQuery(this._toolbarEl).outerHeight():0},getFooterHeight:function(){return this.showFooter?jQuery(this._footerEl).outerHeight():0},setHeaderStyle:function(t){this.headerStyle=t,mini.setStyle(this._headerEl,t),this.doLayout()},getHeaderStyle:function(){return this.headerStyle},setBodyStyle:function(t){this.bodyStyle=t,mini.setStyle(this._bodyEl,t),this.doLayout()},getBodyStyle:function(){return this.bodyStyle},setToolbarStyle:function(t){this.toolbarStyle=t,mini.setStyle(this._toolbarEl,t),this.doLayout()},getToolbarStyle:function(){return this.toolbarStyle},setFooterStyle:function(t){this.footerStyle=t,mini.setStyle(this._footerEl,t),this.doLayout()},getFooterStyle:function(){return this.footerStyle},setHeaderCls:function(t){jQuery(this._headerEl).removeClass(this.headerCls),jQuery(this._headerEl).addClass(t),this.headerCls=t,this.doLayout()},getHeaderCls:function(){return this.headerCls},setBodyCls:function(t){jQuery(this._bodyEl).removeClass(this.bodyCls),jQuery(this._bodyEl).addClass(t),this.bodyCls=t,this.doLayout()},getBodyCls:function(){return this.bodyCls},setToolbarCls:function(t){jQuery(this._toolbarEl).removeClass(this.toolbarCls),jQuery(this._toolbarEl).addClass(t),this.toolbarCls=t,this.doLayout()},getToolbarCls:function(){return this.toolbarCls},setFooterCls:function(t){jQuery(this._footerEl).removeClass(this.footerCls),jQuery(this._footerEl).addClass(t),this.footerCls=t,this.doLayout()},getFooterCls:function(){return this.footerCls},_doTitle:function(){var t=""==this.title?"&nbsp":this.title;this._titleEl.innerHTML=t,this._iconEl.style.display=this.iconCls||this.iconStyle?"inline":"none",this._iconEl.className="mini-panel-icon mini-icon mini-iconfont "+this.iconCls,mini.setStyle(this._iconEl,this.iconStyle)},setTitle:function(t){this.title=t,this._doTitle()},getTitle:function(){return this.title},setIconCls:function(t){this.iconCls=t,this._doTitle()},getIconCls:function(){return this.iconCls},setIconStyle:function(t){this.iconStyle=t,this._doTitle()},getIconStyle:function(){return this.iconStyle},_doTools:function(){for(var t="",e=0,i=this.buttons.length;e<i;e++){var n=this.buttons[e];n.html?t+=n.html:t+='<span id="'+e+'" class="mini-icon mini-iconfont fa '+n.cls+" "+(n.enabled?"":"mini-disabled")+'" style="'+n.style+";"+(n.visible?"":"display:none;")+'"></span>'}this._toolsEl.innerHTML=t},setShowCloseButton:function(t){this.showCloseButton=t;var e=this.getButton("close");e&&(e.visible=t,this._doTools())},getShowCloseButton:function(){return this.showCloseButton},setCloseAction:function(t){this.closeAction=t},getCloseAction:function(){return this.closeAction},setShowCollapseButton:function(t){this.showCollapseButton=t;var e=this.getButton("collapse");e&&(e.visible=t,this._doTools())},getShowCollapseButton:function(){return this.showCollapseButton},setShowHeader:function(t){this.showHeader=t,this._doVisibleEls(),this.deferLayout()},getShowHeader:function(){return this.showHeader},setShowToolbar:function(t){this.showToolbar=t,this._doVisibleEls(),this.deferLayout()},getShowToolbar:function(){return this.showToolbar},setShowFooter:function(t){this.showFooter=t,this._doVisibleEls(),this.deferLayout()},getShowFooter:function(){return this.showFooter},__OnClick:function(t){if(mini.isAncestor(this._headerEl,t.target))if(mini.findParent(t.target,"mini-tools")){var e=this.getButton(parseInt(t.target.id));e&&this._OnButtonClick(e,t)}else this.collapseOnTitleClick&&this.toggle()},_OnButtonClick:function(t,e){var i={button:t,index:this.buttons.indexOf(t),name:t.name.toLowerCase(),htmlEvent:e,cancel:!1};this.fire("beforebuttonclick",i);var n=!0;try{"close"==i.name&&"destroy"==this.closeAction&&this._iframeEl&&this._iframeEl.contentWindow&&(n=this._iframeEl.contentWindow.CloseWindow?this._iframeEl.contentWindow.CloseWindow("close"):this._iframeEl.contentWindow.CloseOwnerWindow?this._iframeEl.contentWindow.CloseOwnerWindow("close"):this._CloseOwnerWindow("close"))}catch(ex){n=this._CloseOwnerWindow("close")}return!1===n&&(i.cancel=!0),1==i.cancel||(this.fire("buttonclick",i),"close"==i.name&&("destroy"==this.closeAction?(this.__HideAction="close",this.destroy()):this.hide()),"collapse"==i.name&&(this.toggle(),this.refreshOnExpand&&this.expanded&&this.url&&this.reload())),i},onButtonClick:function(t,e){this.on("buttonclick",t,e)},_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);var e=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(e)},createButton:function(t){return mini.copyTo({name:"",cls:"",style:"",visible:!0,enabled:!0,html:""},t)},setButtons:function(t){"string"==typeof t&&(t=t.split(" ")),mini.isArray(t)||(t=[]);for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];if("string"==typeof s){if(!(s=s.trim()))continue;s={name:s,cls:"mini-tools-"+s,html:""}}s=this.createButton(s),e.push(s)}this.buttons=e,this._doTools()},getButtons:function(){return this.buttons},addButton:function(t,e){"string"==typeof t&&(t={iconCls:t}),t=this.createButton(t),"number"!=typeof e&&(e=this.buttons.length),this.buttons.insert(e,t),this._doTools()},updateButton:function(t,e){var i=this.getButton(t);i&&(mini.copyTo(i,e),this._doTools())},removeButton:function(t){var e=this.getButton(t);e&&(this.buttons.remove(e),this._doTools())},getButton:function(t){if("number"==typeof t)return this.buttons[t];for(var e=0,i=this.buttons.length;e<i;e++){var n=this.buttons[e];if(n.name==t)return n}},setBody:function(t){__mini_setControls(t,this._bodyEl,this)},set_bodyParent:function(t){},setToolbar:function(t){__mini_setControls(t,this._toolbarEl,this)},setFooter:function(t){__mini_setControls(t,this._footerEl,this)},getHeaderEl:function(){return this._headerEl},getToolbarEl:function(){return this._toolbarEl},getBodyEl:function(){return this._bodyEl},getFooterEl:function(){return this._footerEl},getIFrameEl:function(t){return this._iframeEl},clearTimeStamp:!1,setClearTimeStamp:function(t){this.clearTimeStamp=t},getClearTimeStamp:function(){return this.clearTimeStamp},_getMaskWrapEl:function(){return this._bodyEl},_doRemoveIFrame:function(t){if(this._iframeEl){var e=this._iframeEl;if(e._ondestroy&&e._ondestroy(),e.onload=function(){},jQuery(e).unbind("load"),e.src="",mini.isIE)try{e.contentWindow.document.write(""),e.contentWindow.document.close()}catch(ex){}try{this._iframeEl.parentNode.removeChild(this._iframeEl),this._iframeEl.removeNode(!0)}catch(ex){}}!(this._iframeEl=null)===t&&mini.removeChilds(this._bodyEl)},_deferLoadingTime:80,_doLoad:function(){if(this.url){this._doRemoveIFrame(!0);var s=new Date,o=this;this.loadedUrl=this.url,this.maskOnLoad&&this.loading(),jQuery(this._bodyEl).css("overflow","hidden"),o._CloseOwnerWindow=r;var t=mini.createIFrame(this.url,function(t,e){if(!o.destroyed){var i=s-new Date+o._deferLoadingTime;i<0&&(i=0),setTimeout(function(){o.unmask()},i);try{o._iframeEl.contentWindow.Owner=o.Owner,o._iframeEl.contentWindow.CloseOwnerWindow=r}catch(n){}if(e||o.loadOnRefresh){o.__onLoad&&o.__onLoad();var n={iframe:o._iframeEl};o.fire("load",n)}}},this.clearTimeStamp);this._bodyEl.appendChild(t),this._iframeEl=t}function r(t){o.__HideAction=t;var e=!0;try{o.__onDestroy&&(e=o.__onDestroy(t))}catch(ex){console.error(ex)}if(!1===e)return!1;var i={iframe:o._iframeEl,action:t};o.fire("unload",i),setTimeout(function(){o.destroy()},10)}},load:function(t,e,i){this.setUrl(t,e,i)},reload:function(){this.setUrl(this.url)},setUrl:function(t,e,i){this.url=t,this.__onLoad=e,this.__onDestroy=i,this.expanded&&t&&this._doLoad()},getUrl:function(){return this.url},setRefreshOnExpand:function(t){this.refreshOnExpand=t},getRefreshOnExpand:function(){return this.refreshOnExpand},setMaskOnLoad:function(t){this.maskOnLoad=t},getMaskOnLoad:function(t){return this.maskOnLoad},setAllowResize:function(t){this.allowResize!=t&&(this.allowResize=t,this.doLayout())},getAllowResize:function(){return this.allowResize},setLoadOnRefresh:function(t){this.loadOnRefresh=t},getLoadOnRefresh:function(t){return this.loadOnRefresh},expanded:!0,setExpanded:function(t){this.expanded!=t&&(this.expanded=t,this.expanded?this.expand():this.collapse())},getExpanded:function(){return this.expanded},toggle:function(){this.expanded?this.collapse():this.expand()},collapse:function(){this.expanded=!1,"max"!=this.state&&(this._height=this.el.style.height),this.el.style.height="auto",this._viewportEl.style.display="none",mini.addClass(this.el,"mini-panel-collapse"),this.doLayout()},expand:function(){this.expanded=!0,this._height&&(this.el.style.height=this._height),this._viewportEl.style.display="block","max"!=this.state&&delete this._height,mini.removeClass(this.el,"mini-panel-collapse"),this._expandLoad(),this.doLayout()},_expandLoad:function(){this.url&&this.url!=this.loadedUrl&&this._doLoad()},
//            if (this.url && this.url != this.loadedUrl) {
setCollapseOnTitleClick:function(t){this.collapseOnTitleClick=t,mini.removeClass(this.el,"mini-panel-titleclick"),t&&mini.addClass(this.el,"mini-panel-titleclick")},getCollapseOnTitleClick:function(){return this.collapseOnTitleClick},getAttrs:function(t){var e=mini.Panel.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["title","iconCls","iconStyle","headerCls","headerStyle","bodyCls","bodyStyle","footerCls","footerStyle","toolbarCls","toolbarStyle","footer","toolbar","url","closeAction","loadingMsg","onbeforebuttonclick","onbuttonclick","onload","buttons"]),mini._ParseBool(t,e,["allowResize","showCloseButton","showHeader","showToolbar","showFooter","loadOnRefresh","showCollapseButton","refreshOnExpand","maskOnLoad","expanded","collapseOnTitleClick","clearTimeStamp"]);for(var i=mini.getChildNodes(t,!0),n=i.length-1;0<=n;n--){var s=i[n],o=mini.getAttr(s,"property");o&&("toolbar"==(o=o.toLowerCase())?e.toolbar=s:"footer"==o&&(e.footer=s))}return e.body=i,e}}),mini.regClass(mini.Panel,"panel"),
//        if (!this._resizeDragger) {
mini.Window=function(){mini.Window.superclass.constructor.apply(this,arguments),this.addCls("mini-window"),this.setVisible(!1),this.setAllowDrag(this.allowDrag),this.setAllowResize(this.allowResize)},mini.extend(mini.Window,mini.Panel,{x:0,y:0,state:"restore",_dragCls:"mini-window-drag",_resizeCls:"mini-window-resize",allowDrag:!0,showCloseButton:!0,showMaxButton:!1,showMinButton:!1,showCollapseButton:!1,showModal:!0,minWidth:150,minHeight:80,maxWidth:2e3,maxHeight:2e3,uiCls:"mini-window",_create:function(){if(mini.Window.superclass._create.call(this),this.el.className+=" mini-corner-all",this.el.firstChild.className+=" mini-corner-all",mini.isIE&&mini_useShims){mini.append(this.el,"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 100%; height: 100%; top: 0;left:0;scrolling:no;'></iframe>")}},_initButtons:function(){this.buttons=[];var t=this.createButton({name:"collapse",cls:"mini-tools-collapse",visible:this.showCollapseButton});this.buttons.push(t);var e=this.createButton({name:"min",cls:"mini-tools-min",visible:this.showMinButton});this.buttons.push(e);var i=this.createButton({name:"max",cls:"mini-tools-max",visible:this.showMaxButton});this.buttons.push(i);var n=this.createButton({name:"close",cls:"mini-tools-close",visible:this.showCloseButton});this.buttons.push(n)},_initEvents:function(){mini.Window.superclass._initEvents.call(this),mini._BindEvents(function(){mini.on(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this),mini.on(this.el,"mousedown",this.__OnWindowMouseDown,this)},this)},doLayout:function(){if(this.canLayout()){if("max"==this.state){var t=this.getParentBox();this.el.style.left="0px",this.el.style.top="0px",mini.setSize(this.el,t.width,t.height)}mini.Window.superclass.doLayout.call(this),this.allowDrag&&mini.addClass(this.el,this._dragCls),"max"==this.state&&(this._resizeGridEl.style.display="none",mini.removeClass(this.el,this._dragCls)),this._doModal()}},_doModal:function(){if(this.el){var t=this.showModal&&this.isDisplay()&&this.visible;if(this._modalEl||0!=this.showModal){if(!this._modalEl){var e="__modal"+this._id,i=mini_useShims?"<iframe frameborder='0' style='position: absolute; z-index: -1; width: 100%; height: 100%; top: 0;left:0;scrolling:no;'></iframe>":"";this._modalEl=mini.append(document.body,'<div id="'+e+'" class="mini-modal mini-widget-content" style="display:none">'+i+"</div>")}t?(this._modalEl.style.display="block",this._modalEl.style.zIndex=this._zIndex-1):this._modalEl.style.display="none"}else this._modalEl&&mini.removeNode(this._modalEl)}else this._modalEl&&mini.removeNode(this._modalEl)},getParentBox:function(){var t=mini.getViewportBox(),e=this._containerEl||document.body;return e!=document.body&&(t=mini.getBox(e)),t},setShowModal:function(t){this.showModal=t},getShowModal:function(){return this.showModal},setMinWidth:function(t){isNaN(t)||(this.minWidth=t)},getMinWidth:function(){return this.minWidth},setMinHeight:function(t){isNaN(t)||(this.minHeight=t)},getMinHeight:function(){return this.minHeight},setMaxWidth:function(t){isNaN(t)||(this.maxWidth=t)},getMaxWidth:function(){return this.maxWidth},setMaxHeight:function(t){isNaN(t)||(this.maxHeight=t)},getMaxHeight:function(){return this.maxHeight},setAllowDrag:function(t){this.allowDrag=t,mini.removeClass(this.el,this._dragCls),t&&mini.addClass(this.el,this._dragCls)},getAllowDrag:function(){return this.allowDrag},setShowMaxButton:function(t){this.showMaxButton=t;var e=this.getButton("max");e&&(e.visible=t,this._doTools())},getShowMaxButton:function(){return this.showMaxButton},setShowMinButton:function(t){this.showMinButton=t;var e=this.getButton("min");e&&(e.visible=t,this._doTools())},getShowMinButton:function(){return this.showMinButton},max:function(){this.state="max",this.addCls("mini-window-max"),this.show();var t=this.getButton("max");t&&(t.cls="mini-tools-restore",this._doTools())},restore:function(){this.removeCls("mini-window-max"),this.state="restore",this.show(this.x,this.y);var t=this.getButton("max");t&&(t.cls="mini-tools-max",this._doTools())},showInBody:!0,setShowInBody:function(t){this.showInBody=t},getShowInBody:function(){return this.showInBody},containerEl:null,showAtPos:function(t,e,i){this.show(t,e,i)},show:function(t,i,n){this._allowLayout=!1;var s=this._containerEl||document.body;if((!this.isRender()||this.el.parentNode!=s&&this.showInBody)&&this.render(s),this.el.style.zIndex=this._zIndex=mini.getMaxZIndex(),this._doShow(t,i),this._allowLayout=!0,this.setVisible(!0),"max"!=this.state){var o=this.getBox();this.x=o.x,this.y=o.y}try{document.body.focus()}catch(e){}},hide:function(){this.setVisible(!1),this._doModal()},getWidth:function(t){this._headerEl.style.width="50px";var e=mini.getWidth(this.el);if(this._headerEl.style.width="auto",t&&this._borderEl){var i=mini.getBorders(this._borderEl);e=e-i.left-i.right}return e},getBox:function(){this._headerEl.style.width="50px",this.el.style.display="";var t=mini.getWidth(this.el);this._headerEl.style.width="auto";var e=mini.getBox(this.el);return e.width=t,e.right=e.x+t,e},_measureSize:function(){this.el.style.display="";var t=this.getBox();t.width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),t=this.getBox()),this.expanded&&t.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),t=this.getBox()),t.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),t=this.getBox()),this.expanded&&t.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),t=this.getBox())},_doShow:function(t,e){var i=this.getParentBox();if("max"==this.state){if(!this._width){var n=this.getBox();this._width=n.width,this.expanded&&(this._height=n.height),this.x=n.x,this.y=n.y}this.el.style.left="-10000px",this.el.style.top="-10000px"}else{mini.isNull(t)&&(t="center"),mini.isNull(e)&&(e="middle"),this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this._width&&(this.setWidth(this._width),this.setHeight(this._height),delete this._width,delete this._height),this._measureSize();n=this.getBox();"left"==t&&(t=0),"center"==t&&(t=i.width/2-n.width/2),"right"==t&&(t=i.width-n.width),"top"==e&&(e=0),"middle"==e&&(e=i.y+i.height/2-n.height/2),"bottom"==e&&(e=i.height-n.height),t+n.width>i.right&&(t=i.right-n.width),e+n.height>i.bottom&&(e=i.bottom-n.height),t<0&&(t=0),e<0&&(e=0),this.el.style.display="",mini.setX(this.el,t),mini.setY(this.el,e)}this.doLayout()},_OnButtonClick:function(t,e){var i=mini.Window.superclass._OnButtonClick.call(this,t,e);return 1==i.cancel||"max"==i.name&&("max"==this.state?this.restore():this.max()),i},__OnWindowResize:function(t){"max"==this.state&&this.doLayout(),mini.isIE6||this._doModal()},enableDragProxy:!0,setEnableDragProxy:function(t){this.enableDragProxy=t},getEnableDragProxy:function(t){return this.enableDragProxy},allowCrossBottom:!0,setAllowCrossBottom:function(t){this.allowCrossBottom=t},getAllowCrossBottom:function(){return this.allowCrossBottom},xxx:0,__OnWindowMouseDown:function(t){var a=this;
//if (e.button != mini.MouseButton.Left) return;
if("max"!=this.state&&this.allowDrag&&mini.isAncestor(this._headerEl,t.target)&&!mini.findParent(t.target,"mini-tools")){a=this;this.el&&(this.el.style.zIndex=this._zIndex=mini.getMaxZIndex());var l=this.getBox();new mini.Drag({capture:!1,onStart:function(){a._maskProxy=mini.append(document.body,'<div class="mini-resizer-mask" style=""></div>'),a.enableDragProxy?(a._dragProxy=mini.append(document.body,'<div class="mini-drag-proxy"></div>'),a.el.style.left="-2000px",a.el.style.top="-2000px"):a._dragProxy=a.el;var t=mini.append(document.body,'<div class="mini-resizer-mask"></div>');setTimeout(function(){mini.removeNode(t)},300)},onMove:function(t){var e=t.now[0]-t.init[0],i=t.now[1]-t.init[1];e=l.x+e,i=l.y+i;var n=a.getParentBox(),s=e+l.width,o=i+l.height;s>n.width&&(e=n.width-l.width),a.allowCrossBottom||o>n.height&&(i=n.height-l.height),e<0&&(e=0),i<0&&(i=0);var r={x:a.x=e,y:a.y=i,width:l.width,height:l.height};mini.setBox(a._dragProxy,r),this.moved=!0},onStop:function(){if(a.el&&(a.el.style.display="block",this.moved)){var t=mini.getBox(a._dragProxy);mini.setBox(a.el,t)}jQuery(a._maskProxy).remove(),a._maskProxy=null,a.enableDragProxy&&jQuery(a._dragProxy).remove(),a._dragProxy=null,a.fire("moveend")}}).start(t)}},destroy:function(t){mini.un(window,"resize",this.__OnWindowResize,this),this._modalEl&&(jQuery(this._modalEl).remove(),this._modalEl=null),this.shadowEl&&(jQuery(this.shadowEl).remove(),this.shadowEl=null);var e="__modal"+this._id;jQuery("[id='"+e+"']").remove(),mini.Window.superclass.destroy.call(this,t)},getAttrs:function(t){var e=mini.Window.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["modalStyle","onmoveend"]),mini._ParseBool(t,e,["showModal","showShadow","allowDrag","allowResize","showMaxButton","showMinButton","showInBody","enableDragProxy","allowCrossBottom"]),mini._ParseInt(t,e,["minWidth","minHeight","maxWidth","maxHeight"]),e},showAtEl:function(t,e){if(t=mini.byId(t)){this.isRender()&&this.el.parentNode==document.body||this.render(document.body);var i={xAlign:this.xAlign,yAlign:this.yAlign,xOffset:0,yOffset:0,popupCls:this.popupCls};mini.copyTo(i,e),this._popupEl=t,this.el.style.position="absolute",this.el.style.left="-2000px",this.el.style.top="-2000px",this.el.style.display="",this.doLayout(),this._measureSize();var n=mini.getViewportBox(),s=this.getBox(),o=mini.getBox(t),r=i.xy,a=n.width/2-s.width/2,l=0;switch(r&&(a=r[0],l=r[1]),i.xAlign){case"outleft":a=o.x-s.width;break;case"left":a=o.x;break;case"center":a=o.x+o.width/2-s.width/2;break;case"right":a=o.right-s.width;break;case"outright":a=o.right}switch(i.yAlign){case"above":l=o.y-s.height;break;case"top":l=o.y;break;case"middle":l=o.y+o.height/2-s.height/2;break;case"bottom":l=o.bottom-s.height;break;case"below":l=o.bottom}if(a=parseInt(a),l=parseInt(l),i.outYAlign||i.outXAlign){if("above"==i.outYAlign&&l+s.height>n.bottom){var h=o.y-n.y;n.bottom-o.bottom<h&&(l=o.y-s.height)}if("outleft"==i.outXAlign&&a+s.width>n.right){var d=o.x-n.x;n.right-o.right<d&&(a=o.x-s.width)}"right"==i.outXAlign&&a+s.width>n.right&&(a=o.right-s.width),this._Show(a,l)}else this.showAtPos(a+i.xOffset,l+i.yOffset)}}}),mini.regClass(mini.Window,"window"),mini.MessageBox=jQuery.extend(!0,{},epoint_local.MessageBox,{autoFocus:!0,show:function(t){(t=mini.copyTo({width:"auto",height:"auto",showModal:!0,timeout:0,minWidth:150,maxWidth:800,minHeight:50,maxHeight:350,showHeader:!0,title:"",titleIcon:"",iconCls:"",iconStyle:"",message:"",html:"",spaceStyle:"margin-right:15px",showCloseButton:!0,buttons:null,buttonWidth:58,callback:null},t)).message=String(t.message);var i=t.callback,n=new mini.Window;n.addCls("mini-messagebox"),n.setBodyStyle("overflow:hidden"),n.setShowModal(t.showModal),n.setTitle(t.title||""),n.setIconCls(t.titleIcon),n.setShowHeader(t.showHeader),n.setShowCloseButton(t.showCloseButton);var e=n.uid+"$table",s=n.uid+"$content",o='<table class="mini-messagebox-table" id="'+e+'" style="" cellspacing="0" cellpadding="0"><tr><td>'+('<div class="'+t.iconCls+'" style="'+t.iconStyle+'"></div>')+'</td><td id="'+s+'" class="mini-messagebox-content-text">'+(t.message||"")+"</td></tr></table>";n._bodyEl.innerHTML='<div class="mini-messagebox-content"></div><div class="mini-messagebox-buttons"></div>';var r=n._bodyEl.firstChild;t.html?"string"==typeof t.html?r.innerHTML=t.html:mini.isElement(t.html)&&r.appendChild(t.html):r.innerHTML=o,n._Buttons=[];var a=n._bodyEl.lastChild;if(t.buttons&&0<t.buttons.length)for(var l=0,h=t.buttons.length;l<h;l++){var d=t.buttons[l],u=mini.MessageBox.buttonText[d];u=u||d;var c=new mini.Button;c.setText(u),c.setWidth(t.buttonWidth),c.render(a),c.action=d,c.on("click",function(t){var e=t.sender;i&&!1===i(e.action)||mini.MessageBox.hide(n)}),l!=h-1&&c.setStyle(t.spaceStyle),n._Buttons.push(c)}else a.style.display="none";n.setMinWidth(t.minWidth),n.setMinHeight(t.minHeight),n.setMaxWidth(t.maxWidth),n.setMaxHeight(t.maxHeight),n.setWidth(t.width),n.setHeight(t.height),n.show(t.x,t.y,{animType:t.animType});var m=n.getWidth();n.setWidth(m);var f=n.getHeight();n.setHeight(f);var p=document.getElementById(e);p&&(p.style.width="100%");var g=document.getElementById(s);if(g&&(g.style.width="100%"),mini.MessageBox.autoFocus){var _=n._Buttons[0];_?_.focus():n.focus()}return n.on("beforebuttonclick",function(t){i&&i("close"),t.cancel=!0,mini.MessageBox.hide(n)}),mini.on(n.el,"keydown",function(t){27==t.keyCode&&(i&&i("close"),mini.MessageBox.hide(n))}),t.timeout&&setTimeout(function(){mini.MessageBox.hide(n.uid)},t.timeout),n.uid},hide:function(t){if(t){var e="object"==typeof t?t:mini.getbyUID(t);if(e){for(var i=0,n=e._Buttons.length;i<n;i++){e._Buttons[i].destroy()}e._Buttons=null,e.destroy()}}},alert:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.alertTitle,buttons:["ok"],message:t,iconCls:"mini-messagebox-warning",callback:i})},confirm:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.confirmTitle,buttons:["ok","cancel"],message:t,iconCls:"mini-messagebox-question",callback:i})},prompt:function(t,e,i,n,s){var o="prompt$"+(new Date).getTime(),r=t||mini.MessageBox.promptMessage;r=n?r+'<br/><textarea id="'+o+'" style="width:200px;height:60px;margin-top:3px;"></textarea>':r+'<br/><input id="'+o+'" type="text" style="width:200px;margin-top:3px;"/>';var a=mini.MessageBox.show({title:e||mini.MessageBox.promptTitle,buttons:["ok","cancel"],width:250,html:'<div style="padding:5px;padding-left:10px;">'+r+"</div>",callback:function(t){var e=document.getElementById(o);if(i)return i(t,e.value)}}),l=document.getElementById(o);return l.focus(),null==s&&(s=""),l.value=s,a},loading:function(t,e){return mini.MessageBox.show({minHeight:50,title:e,showCloseButton:!1,message:t,iconCls:"mini-messagebox-waiting"})},showTips:function(t){jQuery;var e='<div class="mini-tips '+("mini-tips-"+(t=jQuery.extend({content:"",state:"",x:"center",y:"top",offset:[10,10],fixed:!0,timeout:2e3},t)).state)+'">'+t.content+"</div>",i=jQuery(e).appendTo(document.body);t.el=i[0],t.timeoutHandler=function(){i.slideUp(),setTimeout(function(){i.remove()},2e3)},mini.showAt(t),i.hide().slideDown()}}),mini.alert=mini.MessageBox.alert,mini.confirm=mini.MessageBox.confirm,mini.prompt=mini.MessageBox.prompt,mini.loading=mini.MessageBox.loading,mini.showMessageBox=mini.MessageBox.show,mini.hideMessageBox=mini.MessageBox.hide,mini.showTips=mini.MessageBox.showTips,mini.Tabs=function(){this._initTabs(),mini.Tabs.superclass.constructor.apply(this,arguments)},mini.extend(mini.Tabs,mini.Control,{activeIndex:-1,tabAlign:"left",tabPosition:"top",showBody:!0,showHeader:!0,nameField:"name",titleField:"title",urlField:"url",url:"",maskOnLoad:!0,plain:!0,bodyStyle:"",_tabHoverCls:"mini-tab-hover",_tabActiveCls:"mini-tab-active",loadingMsg:epoint_local.loadingMsg,set:function(t){if("string"==typeof t)return this;var e=this._allowLayout;this._allowLayout=!1;var i=t.activeIndex;delete t.activeIndex;var n=t.url;return delete t.url,mini.Tabs.superclass.set.call(this,t),n&&this.setUrl(n),mini.isNumber(i)&&this.setActiveIndex(i),this._allowLayout=e,this.doLayout(),this},uiCls:"mini-tabs",_create:function(){this.el=document.createElement("div"),this.el.className="mini-tabs";this.el.innerHTML='<table class="mini-tabs-table" cellspacing="0" cellpadding="0"><tr style="width:100%;"><td></td><td style="text-align:left;vertical-align:top;width:100%;"><div class="mini-tabs-bodys"></div></td><td></td></tr></table>',this._tableEl=this.el.firstChild;var t=this.el.getElementsByTagName("td");this._td1El=t[0],this._td2El=t[1],this._td3El=t[2],this._bodyEl=this._td2El.firstChild,this._borderEl=this._bodyEl,this.doUpdate()},destroy:function(t){if(this.tabs)for(var e=0,i=this.tabs.length;e<i;e++){this.tabs[e]._iframeEl=null}this._tableEl=this._td1El=this._td2El=this._td3El=null,this._bodyEl=this._borderEl=this.headerEl=null,this.tabs=null,mini.Tabs.superclass.destroy.call(this,t)},_doClearElement:function(){mini.removeClass(this._td1El,"mini-tabs-header"),mini.removeClass(this._td3El,"mini-tabs-header"),this._td1El.innerHTML="",this._td3El.innerHTML="",mini.removeChilds(this._td2El,this._bodyEl)},_initEvents:function(){mini._BindEvents(function(){mini.on(this.el,"mousedown",this.__OnMouseDown,this),mini.on(this.el,"click",this.__OnClick,this),mini.on(this.el,"mouseover",this.__OnMouseOver,this),mini.on(this.el,"mouseout",this.__OnMouseOut,this),mini.on(this.el,"dblclick",this.__OnDblClick,this)},this)},_initTabs:function(){this.tabs=[]},_TabID:1,createTab:function(t){var e=mini.copyTo({_id:this._TabID++,name:"",title:"",newLine:!1,tooltip:"",iconCls:"",iconStyle:"",headerCls:"",headerStyle:"",bodyCls:"",bodyStyle:"",visible:!0,enabled:!0,showCloseButton:!1,active:!1,url:"",loaded:!1,refreshOnClick:!1},t);return t&&(e=t=mini.copyTo(t,e)),e},_doLoad:function(){var t=mini._getResult(this.url,null,null,null,null,this.dataField);this.dataField&&!mini.isArray(t)&&(t=mini._getMap(this.dataField,t)),t=t||[],this.setTabs(t),this.fire("load")},load:function(t){"string"==typeof t?this.setUrl(t):this.setTabs(t)},setUrl:function(t){this.url=t,this._doLoad()},getUrl:function(){return this.url},setNameField:function(t){this.nameField=t},getNameField:function(){return this.nameField},setTitleField:function(t){this.titleField=t},getTitleField:function(){return this.titleField},setUrlField:function(t){this.urlField=t},getUrlField:function(){return this.urlField},buttonsAlign:"right",setButtonsAlign:function(t){this.buttonsAlign=t},getButtonsAlign:function(){return this.buttonsAlign},setButtons:function(t){if(this._buttons=mini.byId(t),this._buttons){var e=mini.byClass("mini-tabs-buttons",this.el);e&&(e.appendChild(this._buttons),mini.parse(e),this.doLayout())}},setTabControls:function(t,e){if(t=this.getTab(t)){var i=this.getTabBodyEl(t);__mini_setControls(e,i,this)}},setTabs:function(t){if(mini.isArray(t)){this.beginUpdate(),this.removeAll();for(var e=0,i=t.length;e<i;e++){var n=t[e];n.title=mini._getMap(this.titleField,n),n.url=mini._getMap(this.urlField,n),n.name=mini._getMap(this.nameField,n)}for(e=0,i=t.length;e<i;e++)this.addTab(t[e]);this.setActiveIndex(0),this.endUpdate()}},getTabs:function(){return this.tabs},removeAll:function(t){var e=this.getActiveTab();mini.isNull(t)&&(t=[]),mini.isArray(t)||(t=[t]);for(var i=t.length-1;0<=i;i--){var n=this.getTab(t[i]);n?t[i]=n:t.removeAt(i)}var s=this.tabs;for(i=s.length-1;0<=i;i--){var o=s[i];-1==t.indexOf(o)&&this.removeTab(o)}var r=t[0];e!=this.getActiveTab()&&r&&this.activeTab(r)},addTab:function(t,e){"string"==typeof t&&(t={title:t}),(t=this.createTab(t)).name||(t.name="");var i=this.getActiveTab();"number"!=typeof e&&(e=this.tabs.length),this.tabs.insert(e,t),i&&(this.activeIndex=this.tabs.indexOf(i));var n='<div id="'+this._createTabBodyId(t)+'" class="mini-tabs-body '+t.bodyCls+'" style="'+t.bodyStyle+';display:none;"></div>';mini.append(this._bodyEl,n);var s=this.getTabBodyEl(t),o=t.body;if(delete t.body,o){mini.isArray(o)||(o=[o]);for(var r=0,a=o.length;r<a;r++)mini.append(s,o[r])}if(t.bodyParent)for(var l=t.bodyParent;l.firstChild;)8==l.firstChild.nodeType?l.removeChild(l.firstChild):s.appendChild(l.firstChild);return delete t.bodyParent,t.controls&&(this.setTabControls(t,t.controls),delete t.controls),this.doUpdate(),t},removeTab:function(t){if((t=this.getTab(t))&&-1!=this.tabs.indexOf(t)){var e=this.getActiveTab(),i=t==e,n=this._OnTabDestroy(t);this.tabs.remove(t),this._doRemoveIFrame(t);var s=this.getTabBodyEl(t);if(s&&this._bodyEl.removeChild(s),n&&i){for(var o=this.activeIndex;0<=o;o--){if((t=this.getTab(o))&&t.enabled&&t.visible){this.activeIndex=o;break}}this.doUpdate(),this.setActiveIndex(this.activeIndex),this.fire("activechanged")}else this.activeIndex=this.tabs.indexOf(e),this.doUpdate();return t}},moveTab:function(t,e){if(t=this.getTab(t)){var i=this.tabs[e];if(i!=t)this.tabs.remove(t),-1==(e=this.tabs.indexOf(i))?this.tabs.add(t):this.tabs.insert(e,t),this.doUpdate()}},updateTab:function(t,e){if(t=this.getTab(t)){if(mini.copyTo(t,e),!t.visible&&this.tabs.indexOf(t)==this.activeIndex){for(var i=-1,n=this.activeIndex+1,s=this.tabs.length;n<s;n++){if(this.tabs[n].visible){i=n;break}}this.setActiveIndex(i)}this.doUpdate()}},_getMaskWrapEl:function(){return this._bodyEl},_doRemoveIFrame:function(t,e){if(t._iframeEl&&t._iframeEl.parentNode){var i=t._iframeEl;if(i.onload=function(){},jQuery(i).unbind("load"),i.src="",mini.isIE)try{i.contentWindow.document.write(""),i.contentWindow.document.close()}catch(ex){}t._iframeEl._ondestroy&&t._iframeEl._ondestroy();try{i.parentNode.removeChild(i),i.removeNode(!0)}catch(ex){}}if(t._iframeEl=null,!(t.loadedUrl=null)===e){var n=this.getTabBodyEl(t);if(n)for(var s=mini.getChildNodes(n,!0),o=0,r=s.length;o<r;o++){var a=s[o];a&&a.parentNode&&a.parentNode.removeChild(a)}}},_deferLoadingTime:180,_cancelLoadTabs:function(t){for(var e=this.tabs,i=0,n=e.length;i<n;i++){var s=e[i];s!=t&&s._loading&&s._iframeEl&&(s._loading=!1,this._doRemoveIFrame(s,!0))}t&&t==this.getActiveTab()&&t._loading||(this._loading=!1,this.unmask())},_doLoadTab:function(s){if(s&&s==this.getActiveTab()){var t=this.getTabBodyEl(s);if(t){this._cancelLoadTabs(),this._doRemoveIFrame(s,!0),this._loading=!0,s._loading=!0,this.unmask(),this.maskOnLoad&&this.loading();var o=new Date,r=this;r.isLoading=!0;var e=mini.createIFrame(s.url,function(t,e){try{s._iframeEl.contentWindow.Owner=window,s._iframeEl.contentWindow.CloseOwnerWindow=function(t){s.removeAction=t;var e=!0;if(s.ondestroy&&("string"==typeof s.ondestroy&&(s.ondestroy=window[s.ondestroy]),s.ondestroy)){var i=r._getTabEvent(s);i.action=t,e=s.ondestroy.call(r,i)}if(!1===e)return!1;setTimeout(function(){r.removeTab(s)},10)}}catch(n){}if(1==s._loading){var i=o-new Date+r._deferLoadingTime;if(s._loading=!1,s.loadedUrl=s.url,i<0&&(i=0),setTimeout(function(){r.unmask(),r.doLayout(),r.isLoading=!1},i),e){var n={sender:r,tab:s,index:r.tabs.indexOf(s),name:s.name,iframe:s._iframeEl};s.onload&&("string"==typeof s.onload&&(s.onload=window[s.onload]),s.onload&&s.onload.call(r,n))}r.getActiveTab()==s&&r.fire("tabload",n)}},this.clearTimeStamp,s.method,s.params);setTimeout(function(){s._iframeEl==e&&t.appendChild(e)},1),s._iframeEl=e}}},_getTabEvent:function(t){return{sender:this,tab:t,index:this.tabs.indexOf(t),name:t.name,iframe:t._iframeEl,autoActive:!0}},_OnTabDestroy:function(t){var e=this._getTabEvent(t);return this.fire("tabdestroy",e),e.autoActive},loadTab:function(t,e,i,n){if(t&&(e=(e=this.getTab(e))||this.getActiveTab())){var s=this.getTabBodyEl(e);s&&mini.addClass(s,"mini-tabs-hideOverflow"),e.url=t,delete e.loadedUrl,i&&(e.onload=i),n&&(e.ondestroy=n);var o=this;clearTimeout(this._loadTabTimer),this._loadTabTimer=null,this._loadTabTimer=setTimeout(function(){o._doLoadTab(e)},1)}},reloadTab:function(t){(t=(t=this.getTab(t))||this.getActiveTab())&&this.loadTab(t.url,t)},getTabRows:function(){for(var t=[],e=[],i=0,n=this.tabs.length;i<n;i++){var s=this.tabs[i];0!=i&&s.newLine&&(t.push(e),e=[]),e.push(s)}return t.push(e),t},doUpdate:function(){if(!1!==this._allowUpdate){this._buttons&&this._buttons.parentNode&&this._buttons.parentNode.removeChild(this._buttons),mini.removeClass(this.el,"mini-tabs-position-left"),mini.removeClass(this.el,"mini-tabs-position-top"),mini.removeClass(this.el,"mini-tabs-position-right"),mini.removeClass(this.el,"mini-tabs-position-bottom"),"bottom"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-bottom"),this._doUpdateBottom()):"right"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-right"),this._doUpdateRight()):"left"==this.tabPosition?(mini.addClass(this.el,"mini-tabs-position-left"),this._doUpdateLeft()):(mini.addClass(this.el,"mini-tabs-position-top"),this._doUpdateTop());var t=this._headerEl,e="mini-tabs-header-";mini.removeClass(t,e+"left"),mini.removeClass(t,e+"top"),mini.removeClass(t,e+"right"),mini.removeClass(t,e+"bottom"),mini.addClass(t,e+this.tabPosition);t=this._bodyEl,e="mini-tabs-body-";if(mini.removeClass(t,e+"left"),mini.removeClass(t,e+"top"),mini.removeClass(t,e+"right"),mini.removeClass(t,e+"bottom"),mini.addClass(t,e+this.tabPosition),this._buttons)(t=mini.byClass("mini-tabs-buttons",this.el))&&(t.appendChild(this._buttons),mini.parse(t));this.doLayout(),this.setActiveIndex(this.activeIndex,!1)}},_handleIFrameOverflow:function(){var t=this.getTabBodyEl(this.activeIndex);if(t){mini.removeClass(t,"mini-tabs-hideOverflow");var e=mini.getChildNodes(t)[0];e&&e.tagName&&"IFRAME"==e.tagName.toUpperCase()&&mini.addClass(t,"mini-tabs-hideOverflow")}},doLayout:function(){var t=this._headerEl,e=this._bodyEl,i=this.tabPosition;if(this.canLayout()){t.style.display=this.showHeader?"":"none",this._handleIFrameOverflow();var n=this.isAutoHeight(),s=w=this.getHeight(!0),o=B=this.getWidth();this.showBody?e.style.display="":e.style.display="none";var r=this.el.firstChild;if(this.plain?mini.addClass(r,"mini-tabs-plain"):mini.removeClass(r,"mini-tabs-plain"),!n&&this.showBody){var a=jQuery(t).outerHeight(),l=jQuery(t).outerWidth();if("top"!=i&&"bottom"!=i||(a=jQuery(t.parentNode).outerHeight(),a-=1),"left"==i||"right"==i?B-=l:w-=a,margin=mini.getMargins(e),(w=w-margin.top-margin.bottom)<0&&(w=0),(B=B-margin.left-margin.right)<0&&(B=0),e.style.width=B+"px",e.style.height=w+"px","left"==i||"right"==i){for(var h=(T=(m=t.getElementsByTagName("tr")[0]).childNodes)[0].getElementsByTagName("tr"),d=last=all=0,u=0,c=h.length;u<c;u++){var m=h[u],f=jQuery(m).outerHeight();all+=f,0==u&&(d=f),u==c-1&&(last=f)}switch(this.tabAlign){case"center":var p=parseInt((s-(all-d-last))/2);for(u=0,c=T.length;u<c;u++){T[u].firstChild.style.height=s+"px";var g=(h=(b=T[u].firstChild).getElementsByTagName("tr"))[0],_=h[h.length-1];g.style.height=p+"px",_.style.height=p+"px"}break;case"right":for(u=0,c=T.length;u<c;u++){m=(h=(b=T[u].firstChild).getElementsByTagName("tr"))[0];0<=(v=s-(all-d))&&(m.style.height=v+"px")}break;case"fit":for(u=0,c=T.length;u<c;u++)T[u].firstChild.style.height=s+"px";break;default:for(u=0,c=T.length;u<c;u++){var v;m=(h=(b=T[u].firstChild).getElementsByTagName("tr"))[h.length-1];0<=(v=s-(all-last))&&(m.style.height=v+"px")}}}}else e.style.width="auto",e.style.height="auto";var y=this.getTabBodyEl(this.activeIndex);if(y)if(!n&&this.showBody){var w=mini.getHeight(e,!0);if(jQuery.boxModel){var x=mini.getPaddings(y),C=mini.getBorders(y);w=w-x.top-x.bottom-C.top-C.bottom}y.style.height=w+"px"}else y.style.height="auto";switch(i){case"bottom":for(u=0,c=(S=t.childNodes).length;u<c;u++){var b=S[u];mini.removeClass(b,"mini-tabs-header2"),1<c&&0!=u&&mini.addClass(b,"mini-tabs-header2")}break;case"left":for(u=0,c=(T=t.firstChild.rows[0].cells).length;u<c;u++){var E=T[u];mini.removeClass(E,"mini-tabs-header2"),1<c&&0==u&&mini.addClass(E,"mini-tabs-header2")}break;case"right":var T;for(u=0,c=(T=t.firstChild.rows[0].cells).length;u<c;u++){E=T[u];mini.removeClass(E,"mini-tabs-header2"),1<c&&0!=u&&mini.addClass(E,"mini-tabs-header2")}break;default:var S;for(u=0,c=(S=t.childNodes).length;u<c;u++){b=S[u];mini.removeClass(b,"mini-tabs-header2"),1<c&&0==u&&mini.addClass(b,"mini-tabs-header2")}}mini.removeClass(this.el,"mini-tabs-scroll");E=mini.byClass("mini-tabs-lastSpace",this.el);var k=mini.byClass("mini-tabs-buttons",this.el),I=t.parentNode;I.style.paddingRight="0px",this._navEl&&(this._navEl.style.display="none"),this._leftNavEl&&(this._leftNavEl.style.display="none"),k&&(k.style.display="none");var F="right"==this.buttonsAlign;if(F||(k.style.right="auto",k.style.left="0"),mini.setWidth(I,o),!("top"!=i&&"bottom"!=i||"left"!=this.tabAlign&&"right"!=this.tabAlign)){t.style.width="auto",k.style.display="block";var D=o,L=t.firstChild.offsetWidth-E.offsetWidth,M=k.firstChild?k.offsetWidth:0;if(D<L+M){this._navEl.style.display="block";var O=this._navEl.offsetWidth,N=0;this.showNavMenu&&(this._headerMenuEl.style.display="inline-block",N=this._headerMenuEl.offsetWidth,this._headerMenuEl.style.right=M+"px",this._headerMenu||this._createHeaderMenu());var P=0;"side"==this.arrowPosition&&(this._leftNavEl.style.display="block",P=this._leftNavEl.offsetWidth,t.style.left=P+"px"),this._navEl.style.right=(F?M:0)+N+"px";var B=D-M-O-P-N;mini.setWidth(t,B)}else t.style.left="0px";t.style.marginLeft=(F?0:M)+"px"}this._scrollToTab(this.activeIndex),this._doScrollButton(),mini.layout(e);var A=this.getActiveTab();if(A&&A.repaint&&y){B=y.style.width;y.style.width="0px",setTimeout(function(){y.style.width=B},1)}this.fire("layout")}},_getTabBy_Id:function(t){for(var e=0,i=this.tabs.length;e<i;e++){var n=this.tabs[e];if(n._id==t)return n}},_createHeaderMenu:function(){this._headerMenu=new mini.Menu,this._headerMenu.setIdField("_id"),this._headerMenu.setTextField("title"),this._headerMenu.setPopupEl(this._headerMenuEl),this._headerMenu.setShowAction("leftclick"),this._headerMenu.setHideAction("outerclick"),this._headerMenu.setXAlign("left"),this._headerMenu.setYAlign("below"),mini.addClass(this._headerMenu.el,"mini-menu-open"),this._headerMenu.on("itemclick",this._doMenuSelectTab,this),this._headerMenu.hide(),this._headerMenu.owner=this._headerMenuEl},_setHeaderMenuItems:function(){for(var t=this.getTabs(),e=[],i=0,n=t.length;i<n;i++){var s=t[i];e.push({id:s._id,text:s[this.titleField]})}this._headerMenu.setItems(e)},_doMenuSelectTab:function(t){var e=t.item,i=this._getTabBy_Id(e.id);this.activeTab(i)},setTabAlign:function(t){this.tabAlign=t,this.doUpdate()},setTabPosition:function(t){this.tabPosition=t,this.doUpdate()},allowClickWrap:!0,setAllowClickWrap:function(t){this.allowClickWrap=t},getAllowClickWrap:function(){return this.allowClickWrap},getTab:function(t){if("object"==typeof t)return t;if("number"==typeof t)return this.tabs[t];for(var e=0,i=this.tabs.length;e<i;e++){var n=this.tabs[e];if(n.name==t)return n}},getHeaderEl:function(){return this._headerEl},getBodyEl:function(){return this._bodyEl},getTabEl:function(t){var e=this.getTab(t);if(!e)return null;for(var i=this._createTabId(e),n=this.el.getElementsByTagName("*"),s=0,o=n.length;s<o;s++){var r=n[s];if(r.id==i)return r}return null},getTabBodyEl:function(t){var e=this.getTab(t);if(!e)return null;for(var i=this._createTabBodyId(e),n=this._bodyEl.childNodes,s=0,o=n.length;s<o;s++){var r=n[s];if(r.id==i)return r}return null},getTabIFrameEl:function(t){var e=this.getTab(t);return e?e._iframeEl:null},_createTabId:function(t){return this.uid+"$"+t._id},_createTabBodyId:function(t){return this.uid+"$body$"+t._id},_doScrollButton:function(){if("top"==this.tabPosition||"bottom"==this.tabPosition){mini.removeClass(this._leftButtonEl,"mini-disabled"),mini.removeClass(this._rightButtonEl,"mini-disabled"),0==this._headerEl.scrollLeft&&mini.addClass(this._leftButtonEl,"mini-disabled");var t=this.getTabEl(this.tabs.length-1);if(t){var e=mini.getBox(t),i=mini.getBox(this._headerEl);e.right<=i.right&&mini.addClass(this._rightButtonEl,"mini-disabled")}}},setActiveIndex:function(t,e){var i,n=this.getTab(t),s=n!=(a=this.getTab(this.activeIndex));if((i=this.getTabBodyEl(this.activeIndex))&&(i.style.display="none"),this.activeIndex=n?this.tabs.indexOf(n):-1,(i=this.getTabBodyEl(this.activeIndex))&&(i.style.display=""),(i=this.getTabEl(a))&&mini.removeClass(i,this._tabActiveCls),(i=this.getTabEl(n))&&mini.addClass(i,this._tabActiveCls),i&&s){if("bottom"==this.tabPosition)(r=mini.findParent(i,"mini-tabs-header"))&&jQuery(this._headerEl).prepend(r);else if("left"==this.tabPosition){(o=mini.findParent(i,"mini-tabs-header").parentNode)&&o.parentNode.appendChild(o)}else if("right"==this.tabPosition){var o;(o=mini.findParent(i,"mini-tabs-header").parentNode)&&jQuery(o.parentNode).prepend(o)}else{var r;(r=mini.findParent(i,"mini-tabs-header"))&&this.allowClickWrap&&this._headerEl.appendChild(r)}this._headerEl.scrollLeft;var a,l=!!(a=this.getTab(this.activeIndex))&&!a._layouted;(this.isAutoHeight()||l)&&(a&&(a._layouted=!0),this.doLayout(),a&&(a._layouted=!1)),1<this.getTabRows().length||(this._scrollToTab(this.activeIndex),this._doScrollButton());for(var h=0,d=this.tabs.length;h<d;h++){var u=this.getTabEl(this.tabs[h]);u&&mini.removeClass(u,this._tabHoverCls)}}var c=this;if(s){var m={tab:n,index:this.tabs.indexOf(n),name:n?n.name:""};setTimeout(function(){c.fire("ActiveChanged",m)},1)}this._cancelLoadTabs(n),!1===e||n&&n.url&&!n.loadedUrl&&(c=this).loadTab(n.url,n);if(n&&mini.isChrome){var f=this.getTabIFrameEl(n);f&&(f.style.position="relative",f.style.left="1px",f.offsetWidth,f.style.left="0px")}if(c.canLayout())try{mini.layoutIFrames(c.el)}catch(m){}},_scrollToTab:function(t){var e=this._headerEl.scrollLeft;if("top"==this.tabPosition||"bottom"==this.tabPosition){this._headerEl.scrollLeft=e;var i=this.getTabEl(t);if(i){var n=mini.getBox(i),s=mini.getBox(this._headerEl);n.x<s.x?this._headerEl.scrollLeft-=s.x-n.x:n.right>s.right&&(this._headerEl.scrollLeft+=n.right-s.right)}}},getActiveIndex:function(){return this.activeIndex},activeTab:function(t){this.setActiveIndex(t)},getActiveTab:function(){return this.getTab(this.activeIndex)},getActiveIndex:function(){return this.activeIndex},_tryActiveTab:function(t){if(t=this.getTab(t)){var e=this.tabs.indexOf(t);if(this.activeIndex!=e){var i={tab:t,index:e,name:t.name,cancel:!1};this.fire("BeforeActiveChanged",i),0==i.cancel&&this.activeTab(t)}}},setShowHeader:function(t){this.showHeader!=t&&(this.showHeader=t,this.doLayout())},getShowHeader:function(){return this.showHeader},setShowBody:function(t){this.showBody!=t&&(this.showBody=t,this.doLayout())},getShowBody:function(){return this.showBody},setBodyStyle:function(t){this.bodyStyle=t,mini.setStyle(this._bodyEl,t),this.doLayout()},getBodyStyle:function(){return this.bodyStyle},setMaskOnLoad:function(t){this.maskOnLoad=t},getMaskOnLoad:function(){return this.maskOnLoad},setPlain:function(t){this.plain=t,this.doLayout()},getPlain:function(){return this.plain},arrowPosition:"right",setArrowPosition:function(t){this.arrowPosition=t},getArrowPosition:function(){return this.arrowPosition},showNavMenu:!1,setShowNavMenu:function(t){this.showNavMenu=t},getShowNavMenu:function(){return this.showNavMenu},clearTimeStamp:!1,setClearTimeStamp:function(t){this.clearTimeStamp=t},getClearTimeStamp:function(){return this.clearTimeStamp},getTabByEvent:function(t){return this._getTabByEvent(t)},_getTabByEvent:function(t){var e=mini.findParent(t.target,"mini-tab");if(!e)return null;if(e.id.split("$")[0]!=this.uid)return null;var i=parseInt(jQuery(e).attr("index"));return this.getTab(i)},__OnDblClick:function(t){var e=this._getTabByEvent(t);if(e){t={tab:e};this.fire("tabdblclick",t)}},__OnClick:function(e){var i=this._getTabByEvent(e);if(i){var n=!!mini.findParent(e.target,"mini-tab-close");if((n||i!=this.getActiveTab()||i.refreshOnClick)&&i.enabled){var s=this;setTimeout(function(){if(n)s._OnCloseButtonClick(i,e);else{var t=i.loadedUrl;s._tryActiveTab(i),i.refreshOnClick&&i.url==t&&s.reloadTab(i)}},10)}}},hoverTab:null,__OnMouseOver:function(t){var e=this._getTabByEvent(t);if(e&&e.enabled){var i=this.getTabEl(e);mini.addClass(i,this._tabHoverCls),this.hoverTab=e}},__OnMouseOut:function(t){if(this.hoverTab){var e=this.getTabEl(this.hoverTab);mini.removeClass(e,this._tabHoverCls)}this.hoverTab=null},__OnMouseDown:function(t){if(clearInterval(this._scrollTimer),"top"==this.tabPosition||"bottom"==this.tabPosition){var e=this,i=0,n=10;t.target==this._leftButtonEl?this._scrollTimer=setInterval(function(){e._headerEl.scrollLeft-=n,5<++i&&(n=18),10<i&&(n=25),e._doScrollButton()},25):t.target==this._rightButtonEl?this._scrollTimer=setInterval(function(){e._headerEl.scrollLeft+=n,5<++i&&(n=18),10<i&&(n=25),e._doScrollButton()},25):t.target==this._headerMenuEl&&this._setHeaderMenuItems(),mini.on(document,"mouseup",this.__OnDocMouseUp,this)}},__OnDocMouseUp:function(t){clearInterval(this._scrollTimer),this._scrollTimer=null,mini.un(document,"mouseup",this.__OnDocMouseUp,this)},_doUpdateTop:function(){this.tabPosition;var t="";t+='<div class="mini-tabs-scrollCt">',"side"==this.arrowPosition?(t+='<div class="mini-tabs-leftnav"><a class="mini-tabs-leftButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>',t+='<div class="mini-tabs-nav"><a class="mini-tabs-rightButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>'):t+='<div class="mini-tabs-nav"><a class="mini-tabs-leftButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a><a class="mini-tabs-rightButton mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a></div>',this.showNavMenu&&(t+='<a class="mini-tabs-tabmenu mini-icon" href="javascript:void(0)" hideFocus onclick="return false"></a>'),t+='<div class="mini-tabs-buttons" a=1 style="'+("right"==this.buttonsAlign?"":"right:auto;left:0;")+'"></div>',t+='<div class="mini-tabs-headers">';for(var e=this.getTabRows(),i=0,n=e.length;i<n;i++){var s=e[i],o="";t+='<table class="mini-tabs-header" cellspacing="0" cellpadding="0"><tr><td class="mini-tabs-space mini-tabs-firstSpace"><div></div></td>';for(var r=0,a=s.length;r<a;r++){var l=s[r],h=this._createTabId(l);if(l.visible){var d=this.tabs.indexOf(l);o=l.headerCls||"";if(0==l.enabled&&(o+=" mini-disabled"),t+='<td title="'+l.tooltip+'" id="'+h+'" index="'+d+'"  class="mini-tab mini-corner-all '+o+'" style="'+l.headerStyle+'">',(l.iconCls||l.iconStyle)&&(t+='<span class="mini-tab-icon mini-iconfont '+l.iconCls+'" style="'+l.iconStyle+'"></span>'),t+='<span class="mini-tab-text">'+l.title+"</span>",l.showCloseButton){var u="";l.enabled&&(u="onmouseover=\"mini.addClass(this, 'mini-tab-close-hover')\" onmouseout=\"mini.removeClass(this, 'mini-tab-close-hover')\""),t+='<span class="mini-tab-close mini-icon" '+u+" ></span>"}t+="</td>",r!=a-1&&(t+='<td class="mini-tabs-space2"><div></div></td>')}}t+='<td class="mini-tabs-space mini-tabs-lastSpace" ><div></div></td></tr></table>'}t+="</div>",t+="</div>",this._doClearElement(),mini.prepend(this._td2El,t);var c=this._td2El;switch(this._headerEl=c.firstChild.lastChild,"side"==this.arrowPosition?(this._leftNavEl=c.firstChild.firstChild,this._navEl=this._headerEl.parentNode.children[1],this._leftButtonEl=this._leftNavEl.firstChild,this._rightButtonEl=this._navEl.firstChild,this.showNavMenu&&(this._headerMenuEl=this._headerEl.parentNode.children[2])):(this._navEl=this._headerEl.parentNode.firstChild,this._leftButtonEl=this._navEl.firstChild,this._rightButtonEl=this._navEl.childNodes[1],this.showNavMenu&&(this._headerMenuEl=this._headerEl.parentNode.children[1])),this.showNavMenu&&this._headerMenu&&this._headerMenu.setPopupEl(this._headerMenuEl),this.tabAlign){case"center":for(r=0,a=(m=this._headerEl.childNodes).length;r<a;r++){(f=m[r].getElementsByTagName("td"))[0].style.width="50%",f[f.length-1].style.width="50%"}break;case"right":for(r=0,a=(m=this._headerEl.childNodes).length;r<a;r++){(f=m[r].getElementsByTagName("td"))[0].style.width="100%"}break;case"fit":break;default:var m;for(r=0,a=(m=this._headerEl.childNodes).length;r<a;r++){var f;(f=m[r].getElementsByTagName("td"))[f.length-1].style.width="100%"}}},_doUpdateBottom:function(){this._doUpdateTop();var t=this._td2El;mini.append(t,t.firstChild),this._headerEl=t.lastChild.lastChild},_doUpdateLeft:function(){for(var t='<table cellspacing="0" cellpadding="0"><tr>',e=this.getTabRows(),i=0,n=e.length;i<n;i++){var s=e[i],o="";1<n&&i!=n-1&&(o="mini-tabs-header2"),t+='<td class="'+o+'"><table class="mini-tabs-header" cellspacing="0" cellpadding="0">',t+='<tr ><td class="mini-tabs-space mini-tabs-firstSpace" ><div></div></td></tr>';for(var r=0,a=s.length;r<a;r++){var l=s[r],h=this._createTabId(l);if(l.visible){var d=this.tabs.indexOf(l);o=l.headerCls||"";if(0==l.enabled&&(o+=" mini-disabled"),t+='<tr><td id="'+h+'" index="'+d+'"  class="mini-tab '+o+'" style="'+l.headerStyle+'">',(l.iconCls||l.iconStyle)&&(t+='<span class="mini-tab-icon mini-iconfont '+l.iconCls+'" style="'+l.iconStyle+'"></span>'),t+='<span class="mini-tab-text">'+l.title+"</span>",l.showCloseButton){var u="";l.enabled&&(u="onmouseover=\"mini.addClass(this, 'mini-tab-close-hover')\" onmouseout=\"mini.removeClass(this, 'mini-tab-close-hover')\""),t+='<span class="mini-tab-close mini-icon" '+u+"></span>"}t+="</td></tr>",r!=a-1&&(t+='<tr><td class="mini-tabs-space2"><div></div></td></tr>')}}t+='<tr ><td class="mini-tabs-space mini-tabs-lastSpace" ><div></div></td></tr>',t+="</table></td>"}t+="</tr ></table>",this._doClearElement(),mini.addClass(this._td1El,"mini-tabs-header"),mini.append(this._td1El,t),this._headerEl=this._td1El},_doUpdateRight:function(){this._doUpdateLeft(),mini.removeClass(this._td1El,"mini-tabs-header"),mini.removeClass(this._td3El,"mini-tabs-header"),mini.append(this._td3El,this._td1El.firstChild),this._headerEl=this._td3El},_OnCloseButtonClick:function(t,e){var i={tab:t,index:this.tabs.indexOf(t),name:t.name.toLowerCase(),htmlEvent:e,cancel:!1};if(this.fire("beforecloseclick",i),1!=i.cancel){try{if(t._iframeEl&&t._iframeEl.contentWindow){var n=!0;t._iframeEl.contentWindow.CloseWindow?n=t._iframeEl.contentWindow.CloseWindow("close"):t._iframeEl.contentWindow.CloseOwnerWindow&&(n=t._iframeEl.contentWindow.CloseOwnerWindow("close")),!1===n&&(i.cancel=!0)}}catch(ex){}1!=i.cancel&&(t.removeAction="close",this.removeTab(t),this.fire("closeclick",i))}},onBeforeCloseClick:function(t,e){this.on("beforecloseclick",t,e)},onCloseClick:function(t,e){this.on("closeclick",t,e)},onActiveChanged:function(t,e){this.on("activechanged",t,e)},getAttrs:function(t){var e=mini.Tabs.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["tabAlign","tabPosition","bodyStyle","onactivechanged","onbeforeactivechanged","url","ontabload","ontabdestroy","onbeforecloseclick","oncloseclick","ontabdblclick","titleField","urlField","nameField","loadingMsg","buttons","arrowPosition","buttonsAlign"]),mini._ParseBool(t,e,["allowAnim","showBody","showHeader","maskOnLoad","plain","allowClickWrap","showNavMenu","clearTimeStamp"]),mini._ParseInt(t,e,["activeIndex"]);for(var i=[],n=mini.getChildNodes(t),s=0,o=n.length;s<o;s++){var r=n[s],a={};i.push(a),a.style=r.style.cssText,mini._ParseString(r,a,["name","title","url","cls","iconCls","iconStyle","headerCls","headerStyle","bodyCls","bodyStyle","onload","ondestroy","data-options","tooltip"]),mini._ParseBool(r,a,["newLine","visible","enabled","showCloseButton","refreshOnClick"]),a.bodyParent=r;var l=a["data-options"];(l=l&&window.eval("("+l+")"))&&mini.copyTo(a,l)}return e.tabs=i,e}}),mini.regClass(mini.Tabs,"tabs"),mini.Menu=function(){this.items=[],mini.Menu.superclass.constructor.apply(this,arguments)},mini.extend(mini.Menu,mini.Control),mini.copyTo(mini.Menu.prototype,mini.Popup_prototype);var mini_Popup_prototype_hide=mini.Popup_prototype.hide;mini.copyTo(mini.Menu.prototype,{height:"auto",width:"auto",minWidth:140,vertical:!0,allowSelectItem:!1,_selectedItem:null,_itemSelectedCls:"mini-menuitem-selected",textField:"text",resultAsTree:!1,idField:"id",parentField:"pid",itemsField:"children",iconClsField:"iconCls",showNavArrow:!0,imgPath:"",overflow:!1,_clearBorder:!1,showAction:"none",hideAction:"outerclick",menuAlign:"",setMenuAlign:function(t){this.menuAlign=t},getMenuAlign:function(){return this.menuAlign},getbyName:function(t){for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];if(n.name==t)return n;if(n.menu){var s=n.menu.getbyName(t);if(s)return s}}return null},set:function(t){if("string"==typeof t)return this;var e=t.url;return delete t.url,t.imgPath&&this.setImgPath(t.imgPath),delete t.imgPath,this.ownerItem=t.ownerItem,delete t.ownerItem,mini.Menu.superclass.set.call(this,t),e&&this.setUrl(e),this},uiCls:"mini-menu",_create:function(){this.el=document.createElement("div"),this.el.className="mini-menu",this.el.innerHTML='<div class="mini-menu-border"><a class="mini-menu-topArrow mini-icon" href="#" onclick="return false"></a><div class="mini-menu-inner"></div><a class="mini-menu-bottomArrow mini-icon" href="#" onclick="return false"></a></div>',this._borderEl=this.el.firstChild,this._topArrowEl=this._borderEl.childNodes[0],this._bottomArrowEl=this._borderEl.childNodes[2],this._innerEl=this._borderEl.childNodes[1],this._innerEl.innerHTML='<div class="mini-menu-float"></div><div class="mini-menu-toolbar"></div><div style="clear:both;max-height: 1px;"></div>',this._contentEl=this._innerEl.firstChild,this._toolbarEl=this._innerEl.childNodes[1],0==this.isVertical()&&mini.addClass(this.el,"mini-menu-horizontal")},destroy:function(t){if(this.items)for(var e=0,i=this.items.length;e<i;e++)this.items[e].destroy();this._topArrowEl&&(this._topArrowEl.onmousedown=this._bottomArrowEl.onmousedown=null),this._popupEl=this.popupEl=this._borderEl=this._innerEl=this._contentEl=this._toolbarEl=null,this._topArrowEl=this._bottomArrowEl=null,this.owner=null,this.window=null,mini.un(document,"mousedown",this.__OnBodyMouseDown,this),mini.un(window,"resize",this.__OnWindowResize,this),mini.Menu.superclass.destroy.call(this,t)},_disableContextMenu:!1,_initEvents:function(){mini._BindEvents(function(){mini.on(document,"mousedown",this.__OnBodyMouseDown,this),mini_onOne(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this),this._disableContextMenu&&mini_onOne(this.el,"contextmenu",function(t){t.preventDefault()},this),mini_onOne(this._topArrowEl,"mousedown",this.__OnTopMouseDown,this),mini_onOne(this._bottomArrowEl,"mousedown",this.__OnBottomMouseDown,this)},this)},within:function(t){if(mini.isAncestor(this.el,t.target))return!0;for(var e=0,i=this.items.length;e<i;e++){if(this.items[e].within(t))return!0}return!1},
//        if (!this._clearEl) {
setVertical:function(t){(this.vertical=t)?mini.removeClass(this.el,"mini-menu-horizontal"):mini.addClass(this.el,"mini-menu-horizontal")},getVertical:function(){return this.vertical},isVertical:function(){return this.vertical},show:function(){this.setVisible(!0)},hide:function(){this.hideItems(),mini_Popup_prototype_hide.call(this)},hideItems:function(){for(var t=0,e=this.items.length;t<e;t++){this.items[t].hideMenu()}},showItemMenu:function(t){for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];n==t?n.showMenu():n.hideMenu()}},hasShowItemMenu:function(){for(var t=0,e=this.items.length;t<e;t++){var i=this.items[t];if(i&&i.menu&&i.menu.isPopup)return!0}return!1},setData:function(t){mini.isArray(t)||(t=[]),this.setItems(t)},getData:function(){return this.getItems()},setItems:function(t){mini.isArray(t)||(t=[]),this.removeAll();for(var e=0,i=t.length;e<i;e++)this.addItem(t[e]);this.adaptItemsGap()},adaptItemsGap:function(){this.items.some(function(t){return!!t.iconCls})?this.removeCls("mini-menu-icon-none"):this.addCls("mini-menu-icon-none")},getItems:function(){return this.items},_itemType:"menuitem",addItem:function(t){if("-"!=t&&"|"!=t&&"separator"!=t.type)mini.isControl(t)||mini.getClass(t.type)||(t.type=this._itemType),t.ownerMenu=this,t=mini.getAndCreate(t),this.items.push(t),this._contentEl.appendChild(t.el),(t.ownerMenu=this).fire("itemschanged");else{var e=t.id?'id="'+t.id+'"':"";mini.append(this._contentEl,"<span "+e+' name="'+(t.name||"")+'" class="mini-separator"></span>')}},removeItem:function(t){(t=mini.get(t))&&(this.items.remove(t),this._contentEl.removeChild(t.el),this.fire("itemschanged"))},removeItemAt:function(t){var e=this.items[t];this.removeItem(e)},removeAll:function(){for(var t=this.items.clone(),e=t.length-1;0<=e;e--)this.removeItem(t[e]);this._contentEl.innerHTML=""},getGroupItems:function(t){if(!t)return[];for(var e=[],i=0,n=this.items.length;i<n;i++){var s=this.items[i];s.groupName==t&&e.push(s)}return e},getItem:function(t){if("number"==typeof t)return this.items[t];if("string"!=typeof t)return t&&-1!=this.items.indexOf(t)?t:null;for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];if(n.id==t)return n}return null},setAllowSelectItem:function(t){this.allowSelectItem=t},getAllowSelectItem:function(){return this.allowSelectItem},setSelectedItem:function(t){t=this.getItem(t),this._OnItemSelect(t)},getSelectedItem:function(t){return this._selectedItem},setShowNavArrow:function(t){this.showNavArrow=t},getShowNavArrow:function(){return this.showNavArrow},setTextField:function(t){this.textField=t},getTextField:function(){return this.textField},setResultAsTree:function(t){this.resultAsTree=t},getResultAsTree:function(){return this.resultAsTree},setIdField:function(t){this.idField=t},getIdField:function(){return this.idField},setParentField:function(t){this.parentField=t},getParentField:function(){return this.parentField},setIconClsField:function(t){this.iconClsField=t},getIconClsField:function(){return this.iconClsField},setOverflow:function(t){(this.overflow=t)?mini.addClass(this.el,"mini-menu-overflow"):mini.removeClass(this.el,"mini-menu-overflow")},getOverflow:function(){return this.overflow},doLayout:function(){if(this.canLayout()){var t=this._innerEl,e=this._topArrowEl,i=this._bottomArrowEl;if(this.isAutoHeight())this._borderEl.style.height="auto",this._contentEl.style.height="auto";else{var n=mini.getHeight(this.el,!0);if(mini.setHeight(this._borderEl,n),e.style.display=i.style.display="none",this._contentEl.style.height="auto",this.showNavArrow&&this._borderEl.scrollHeight>this._borderEl.clientHeight+2){e.style.display=i.style.display="block";var s=(n=mini.getHeight(this._borderEl,!0))-mini.getHeight(e)-mini.getHeight(i);s<0&&(s=0),mini.setHeight(this._contentEl,s);var o=mini.getWidth(this._borderEl,!0);mini.setWidth(e,o),mini.setWidth(i,o)}else this._contentEl.style.height="auto"}this.overflow&&(e.style.display=i.style.display="none",t.style.marginLeft=t.style.marginRight="0px",this._getScrollWidth()>this._innerEl.offsetWidth?(e.style.display=i.style.display="block",t.style.marginLeft=t.style.marginRight="15px"):t.scrollLeft=0)}},_measureSize:function(){if("auto"==this.height){this.el.style.height="auto",this._borderEl.style.height="auto",this._contentEl.style.height="auto",this._topArrowEl.style.display=this._bottomArrowEl.style.display="none";var t=mini.getViewportBox(),e=mini.getBox(this.el);this.maxHeight=t.height-2,this.ownerItem&&(this.maxHeight=t.height-2)}this.el.style.display="",(e=mini.getBox(this.el)).width>this.maxWidth&&(mini.setWidth(this.el,this.maxWidth),e=mini.getBox(this.el)),e.height>this.maxHeight&&(mini.setHeight(this.el,this.maxHeight),e=mini.getBox(this.el)),e.width<this.minWidth&&(mini.setWidth(this.el,this.minWidth),e=mini.getBox(this.el)),e.height<this.minHeight&&(mini.setHeight(this.el,this.minHeight),e=mini.getBox(this.el))},url:"",_doLoad:function(){var t=mini._getResult(this.url,null,null,null,null,this.dataField);this.dataField&&!mini.isArray(t)&&(t=mini._getMap(this.dataField,t)),t=t||[],0==this.resultAsTree&&(t=mini.arrayToTree(t,this.itemsField,this.idField,this.parentField));for(var e=mini.treeToArray(t,this.itemsField,this.idField,this.parentField),i=0,n=e.length;i<n;i++){var s=e[i];s.text=mini._getMap(this.textField,s),s.iconCls=mini._getMap(this.iconClsField,s),mini.isNull(s.text)&&(s.text="")}new Date;this.setItems(t),this.fire("load")},loadList:function(t,e,i){if(t){e=e||this.idField,i=i||this.parentField;for(var n=0,s=t.length;n<s;n++){var o=t[n];o.text=mini._getMap(this.textField,o),o.iconCls=mini._getMap(this.iconClsField,o),mini.isNull(o.text)&&(o.text="")}var r=mini.arrayToTree(t,this.itemsField,e,i);this.load(r)}},load:function(t){"string"==typeof t?this.setUrl(t):this.setItems(t)},setUrl:function(t){this.url=t,this._doLoad()},getUrl:function(){return this.url},hideOnClick:!0,setHideOnClick:function(t){this.hideOnClick=t},getHideOnClick:function(){return this.hideOnClick},hideOnClick:!0,setImgPath:function(t){this.imgPath=t},getImgPath:function(){return this.imgPath},_OnItemClick:function(t,e){var i={item:t,isLeaf:!t.menu,htmlEvent:e};this.hideOnClick&&(this.isPopup?this.hide():i.isLeaf&&this.hideItems()),this.allowSelectItem&&this._selectedItem!=t&&this.setSelectedItem(t),this.fire("itemclick",i),this.ownerItem},_OnItemSelect:function(t){this._selectedItem&&this._selectedItem.removeCls(this._itemSelectedCls),this._selectedItem=t,this._selectedItem&&this._selectedItem.addCls(this._itemSelectedCls);var e={item:this._selectedItem,isLeaf:!!this._selectedItem&&!this._selectedItem.menu};this.fire("itemselect",e)},onItemClick:function(t,e){this.on("itemclick",t,e)},onItemSelect:function(t,e){this.on("itemselect",t,e)},__OnTopMouseDown:function(t){this._startScrollMove(-20)},__OnBottomMouseDown:function(t){this._startScrollMove(20)},_getScrollWidth:function(){var t=0,e=jQuery(".mini-menuitem",this.el).first()[0],i=jQuery(".mini-menuitem",this.el).last()[0];if(e&&i){var n=mini.getBox(e);t=mini.getBox(i).right-n.left}return t},_getMaxScrollLeft:function(){return parseInt(this._getScrollWidth()-this._innerEl.offsetWidth+6)},_startScrollMove:function(e){clearInterval(this._scrollTimer);var t=function(){clearInterval(n._scrollTimer),mini.un(document,"mouseup",t)};mini.on(document,"mouseup",t);var i=this._getMaxScrollLeft(),n=this;this._scrollTimer=setInterval(function(){if(0==n.isVertical()){var t=n._innerEl.scrollLeft;i<(t+=e)&&(t=i),n._innerEl.scrollLeft=t}else n._contentEl.scrollTop+=e},50)},setToolbar:function(t){__mini_setControls(t,this._toolbarEl,this),this._toolbarEl.style.display="block"},parseItems:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];if("separator"!=s.className){var o=mini.getChildNodes(s),r=o[0],a=o[1];h=new mini.MenuItem;if(a){mini.applyTo.call(h,r),h.render(document.body);var l=new mini.Menu;mini.applyTo.call(l,a),h.setMenu(l),l.render(document.body),e.add(h)}else mini.applyTo.call(h,s),e.add(h)}else{var h={type:"separator",id:s.id,name:s.name};e.add(h)}}return e.clone()},getAttrs:function(t){var e=mini.Menu.superclass.getAttrs.call(this,t),i=jQuery(t);mini._ParseString(t,e,["popupEl","popupCls","showAction","hideAction","xAlign","yAlign","modalStyle","onbeforeopen","open","onbeforeclose","onclose","url","onitemclick","onitemselect","textField","idField","parentField","toolbar","imgPath","iconClsField","menuAlign"]),mini._ParseInt(t,e,["minWidth"]),mini._ParseBool(t,e,["resultAsTree","hideOnClick","showNavArrow","showShadow","overflow"]);for(var n=(r=mini.getChildNodes(t)).length-1;0<=n;n--){var s=r[n],o=jQuery(s).attr("property");o&&"toolbar"==(o=o.toLowerCase())&&(e.toolbar=s).parentNode.removeChild(s)}var r=mini.getChildNodes(t),a=this.parseItems(r);0<a.length&&(e.items=a);var l=i.attr("vertical");l&&(e.vertical="true"==l);var h=i.attr("allowSelectItem");return h&&(e.allowSelectItem="true"==h),e}}),mini.regClass(mini.Menu,"menu"),mini.MenuBar=function(){mini.MenuBar.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuBar,mini.Menu,{uiCls:"mini-menubar",vertical:!1,setVertical:function(t){this.vertical=!1}}),mini.regClass(mini.MenuBar,"menubar"),mini.ContextMenu=function(){mini.ContextMenu.superclass.constructor.apply(this,arguments)},mini.extend(mini.ContextMenu,mini.Menu,{uiCls:"mini-contextmenu",vertical:!0,visible:!1,_disableContextMenu:!0,setVertical:function(t){this.vertical=!0}}),mini.regClass(mini.ContextMenu,"contextmenu"),mini.MenuItem=function(){mini.MenuItem.superclass.constructor.apply(this,arguments)},mini.extend(mini.MenuItem,mini.Control,{text:"",iconCls:"",iconStyle:"",iconPosition:"left",img:"",showIcon:!0,showAllow:!0,checked:!1,checkOnClick:!1,groupName:"",_hoverCls:"mini-menuitem-hover",_pressedCls:"mini-menuitem-pressed",_checkedCls:"mini-menuitem-checked",_clearBorder:!1,menu:null,set:function(t){return"string"==typeof t||(this.ownerMenu=t.ownerMenu,delete t.ownerMenu,mini.MenuItem.superclass.set.call(this,t)),this},uiCls:"mini-menuitem",_create:function(){this.el=document.createElement("div");this.el.className="mini-menuitem",this.el.innerHTML='<div class="mini-menuitem-inner"><span class="mini-menuitem-icon mini-icon mini-iconfont"></span><div class="mini-menuitem-text"></div><span class="mini-menuitem-allow mini-icon"></span></div>',this._innerEl=this.el.firstChild,this._iconEl=this._innerEl.firstChild,this._textEl=this._innerEl.childNodes[1],this.allowEl=this._innerEl.lastChild},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this.el,"mouseover",this.__OnMouseOver,this)},this)},_inputEventsInited:!1,_initInputEvents:function(){this._inputEventsInited||(this._inputEventsInited=!0,mini_onOne(this.el,"click",this.__OnClick,this),mini_onOne(this.el,"mouseup",this.__OnMouseUp,this),mini_onOne(this.el,"mouseout",this.__OnMouseOut,this))},destroy:function(t){this.menu&&this.menu.destroy(),this.menu=this._innerEl=this._iconEl=this._textEl=this.allowEl=null,mini.MenuItem.superclass.destroy.call(this,t)},within:function(t){return!!mini.isAncestor(this.el,t.target)||!(!this.menu||!this.menu.within(t))},_getIconImg:function(){return this.img&&this.getTopMenu()?this.getTopMenu().imgPath+this.img:this.img},_doUpdateIcon:function(){var t=this._getIconImg(),e=!!(this.iconStyle||this.iconCls||this.checkOnClick||t);if(this._iconEl){if(mini.setStyle(this._iconEl,this.iconStyle),mini.addClass(this._iconEl,this.iconCls),t&&!this.checked){var i="background-image:url("+t+")";mini.setStyle(this._iconEl,i)}this.checked&&jQuery(this._iconEl).css({"background-image":""}),this._iconEl.style.display=e?"inline-block":"none"}"top"==this.iconPosition?mini.addClass(this.el,"mini-menuitem-icontop"):mini.removeClass(this.el,"mini-menuitem-icontop")},_hasChildMenu:function(){return this.menu&&0<this.menu.items.length},doUpdate:function(){this._textEl&&(this._textEl.innerHTML=this.text),this._doUpdateIcon(),this.checked?(this.iconCls="icon-check",this._doUpdateIcon(),mini.addClass(this.el,this._checkedCls)):(this.iconCls="",this._doUpdateIcon(),mini.removeClass(this.el,this._checkedCls)),this.allowEl&&(this._hasChildMenu()?this.allowEl.style.display="inline-block":this.allowEl.style.display="none")},setText:function(t){this.text=t,this._textEl&&(this._textEl.innerHTML=this.text)},getText:function(){return this.text},setIconCls:function(t){mini.removeClass(this._iconEl,this.iconCls),this.iconCls=t,this._doUpdateIcon()},getIconCls:function(){return this.iconCls},setImg:function(t){this.img=t,this._doUpdateIcon()},getImg:function(){return this.img},setIconStyle:function(t){this.iconStyle=t,this._doUpdateIcon()},getIconStyle:function(){return this.iconStyle},setIconPosition:function(t){this.iconPosition=t,this._doUpdateIcon()},getIconPosition:function(){return this.iconPosition},setCheckOnClick:function(t){(this.checkOnClick=t)?mini.addClass(this.el,"mini-menuitem-showcheck"):mini.removeClass(this.el,"mini-menuitem-showcheck"),this.doUpdate()},getCheckOnClick:function(){return this.checkOnClick},setChecked:function(t){this.checked!=t&&(this.checked=t,this.doUpdate(),this.fire("checkedchanged"))},getChecked:function(){return this.checked},setGroupName:function(t){this.groupName!=t&&(this.groupName=t)},getGroupName:function(){return this.groupName},setChildren:function(t){this.setMenu(t)},setMenu:function(t){mini.isArray(t)&&(t={type:"menu",items:t}),this.menu!==t&&((t.ownerItem=this).menu=mini.getAndCreate(t),this.menu.hide(),(this.menu.ownerItem=this).doUpdate(),this.menu.on("itemschanged",this.__OnItemsChanged,this))},getMenu:function(){return this.menu},showMenu:function(){if(this.menu&&0==this.menu.isDisplay()){this.menu.setHideAction("outerclick");var t={xAlign:"outright",yAlign:"top",outXAlign:"outleft",outYAlign:"below",popupCls:"mini-menu-popup",alwaysView:!0};this.ownerMenu&&0==this.ownerMenu.vertical&&(t.xAlign=this.ownerMenu.menuAlign||"left",t.yAlign="below",t.outXAlign="right"),this.menu.showAtEl(this.el,t),this.menu.addCls("mini-menu-open")}},hideMenu:function(){this.menu&&this.menu.hide()},hide:function(){this.hideMenu(),this.setVisible(!1)},__OnItemsChanged:function(t){this.doUpdate()},getTopMenu:function(){return this.ownerMenu?this.ownerMenu.ownerItem?this.ownerMenu.ownerItem.getTopMenu():this.ownerMenu:null},__OnClick:function(t){if(!this.isReadOnly()){if(this.checkOnClick)if(this.ownerMenu&&this.groupName){var e=this.ownerMenu.getGroupItems(this.groupName);if(0<e.length){if(0==this.checked){for(var i=0,n=e.length;i<n;i++){var s=e[i];s!=this&&s.setChecked(!1)}this.setChecked(!0)}}else this.setChecked(!this.checked)}else this.setChecked(!this.checked);this.fire("click");var o=this.getTopMenu();o&&o._OnItemClick(this,t)}},__OnMouseUp:function(t){if(!this.isReadOnly()&&this.ownerMenu){var e=this;setTimeout(function(){e.isDisplay()&&e.ownerMenu.showItemMenu(e)},1)}},__OnMouseOver:function(t){this.isReadOnly()||(this._initInputEvents(),mini.addClass(this.el,this._hoverCls),this.el.title=this.text,this._textEl.scrollWidth>this._textEl.clientWidth?this.el.title=this.text:this.el.title="",this.ownerMenu&&(1==this.ownerMenu.isVertical()?this.ownerMenu.showItemMenu(this):this.ownerMenu.hasShowItemMenu()&&this.ownerMenu.showItemMenu(this)))},__OnMouseOut:function(t){mini.removeClass(this.el,this._hoverCls)},onClick:function(t,e){this.on("click",t,e)},onCheckedChanged:function(t,e){this.on("checkedchanged",t,e)},getAttrs:function(t){var e=mini.MenuItem.superclass.getAttrs.call(this,t);jQuery(t);return e.text=t.innerHTML,mini._ParseString(t,e,["text","iconCls","iconStyle","iconPosition","groupName","onclick","oncheckedchanged"]),mini._ParseBool(t,e,["checkOnClick","checked"]),e}}),mini.regClass(mini.MenuItem,"menuitem"),mini.Separator=function(){mini.Separator.superclass.constructor.apply(this,arguments)},mini.extend(mini.Separator,mini.Control,{_clearBorder:!1,uiCls:"mini-separator",_create:function(){this.el=document.createElement("span"),this.el.className="mini-separator"}}),mini.regClass(mini.Separator,"separator"),mini.Pager=function(){mini.Pager.superclass.constructor.apply(this,arguments)},mini.extend(mini.Pager,mini.Control,{pageIndex:0,pageSize:10,totalCount:0,totalPage:0,showPageIndex:!0,showPageSize:!0,showTotalCount:!0,showPageInfo:!0,showReloadButton:!0,_clearBorder:!1,showButtonText:!1,showButtonIcon:!0,sizeText:"",firstText:epoint_local.Pager.firstText,prevText:epoint_local.Pager.prevText,nextText:epoint_local.Pager.nextText,lastText:epoint_local.Pager.lastText,reloadText:epoint_local.Pager.reloadText,pageInfoText:epoint_local.Pager.pageInfoText,sizeList:[10,20,50,100],set:function(t){if("string"==typeof t)return this;var e=t.pageIndex;return delete t.pageIndex,mini.Pager.superclass.set.call(this,t),mini.isNull(e)||this.setPageIndex(e),this},uiCls:"mini-pager",_create:function(){this.el=document.createElement("div"),this.el.className="mini-pager";var t='<div class="mini-pager-left"><table cellspacing="0" cellpadding="0" border="0"><tr><td></td><td></td></tr></table></div><div class="mini-pager-right"></div>';(isIE6||isIE7)&&(t+='<div class="mini-clearfix"></div>',mini.addClass(this.el,"mini-clearfix")),this.el.innerHTML=t,this._leftEl=this.el.childNodes[0],this._rightEl=this.el.childNodes[1];var e=this._leftEl.getElementsByTagName("td");this._barEl=e[0],this._barEl2=e[1],this.sizeEl=mini.append(this._barEl,'<span class="mini-pager-size"></span>'),this.sizeTextEl=mini.before(this.sizeEl,'<span class="mini-pager-sizetext"></span>'),this.sizeCombo=new mini.ComboBox,this.pageSizeWidth&&this.sizeCombo.setWidth(this.pageSizeWidth),this.sizeCombo.render(this.sizeEl),mini.append(this.sizeEl,'<span class="separator"></span>'),this.firstButton=new mini.Button,this.firstButton.addCls("mini-pager-firstbutton"),this.firstButton.render(this._barEl),this.prevButton=new mini.Button,this.prevButton.addCls("mini-pager-prevbutton"),this.prevButton.render(this._barEl),this.indexEl=document.createElement("span"),this.indexEl.className="mini-pager-index",this.indexEl.innerHTML='<input type="text" class="mini-pager-num"/><span class="mini-pager-pages">/ 0</span>',this._barEl.appendChild(this.indexEl),this.numInput=this.indexEl.firstChild,this.pagesLabel=this.indexEl.lastChild,this.nextButton=new mini.Button,this.nextButton.addCls("mini-pager-nextbutton"),this.nextButton.render(this._barEl),this.lastButton=new mini.Button,this.lastButton.addCls("mini-pager-lastbutton"),this.lastButton.render(this._barEl),mini.append(this._barEl,'<span class="separator"></span>'),this.reloadButton=new mini.Button,this.reloadButton.render(this._barEl),this.firstButton.setPlain(!0),this.prevButton.setPlain(!0),this.nextButton.setPlain(!0),this.lastButton.setPlain(!0),this.reloadButton.setPlain(!0),this.buttonsEl=mini.append(this._barEl2,'<div class="mini-page-buttons"></div>'),this.update()},destroy:function(t){this.pageSelect&&(mini.clearEvent(this.pageSelect),this.pageSelect=null),this.numInput&&(mini.clearEvent(this.numInput),this.numInput=null),this.sizeEl=this.sizeTextEl=this._barEl=this._barEl2=this._leftEl=this._rightEl=this.indexEl=this.buttonsEl=null,mini.Pager.superclass.destroy.call(this,t)},setButtons:function(t){__mini_setControls(t,this.buttonsEl,this)},getButtonsEl:function(){return this.buttonsEl},_initEvents:function(){function e(){if(!i){i=!0;var t=parseInt(this.numInput.value);isNaN(t)?this.update():this._OnPageChanged(t-1),setTimeout(function(){i=!1},100)}}mini.Pager.superclass._initEvents.call(this),this.firstButton.on("click",function(t){this._OnPageChanged(0)},this),this.prevButton.on("click",function(t){this._OnPageChanged(this.pageIndex-1)},this),this.nextButton.on("click",function(t){this._OnPageChanged(this.pageIndex+1)},this),this.lastButton.on("click",function(t){this._OnPageChanged(this.totalPage)},this),this.reloadButton.on("click",function(t){this._OnPageChanged()},this);var i=!1;mini.on(this.numInput,"change",function(t){e.call(this)},this),mini.on(this.numInput,"keydown",function(t){13==t.keyCode&&(e.call(this),t.stopPropagation())},this),this.sizeCombo.on("valuechanged",this.__OnPageSelectChanged,this)},doLayout:function(){this.canLayout()&&(mini.layout(this._leftEl),mini.layout(this._rightEl))},setPageIndex:function(t){isNaN(t)||(this.pageIndex=t,this.update())},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){isNaN(t)||(this.pageSize=t,this.update())},getPageSize:function(){return this.pageSize},setTotalCount:function(t){t=parseInt(t),isNaN(t)||(this.totalCount=t,this.update())},getTotalCount:function(){return this.totalCount},setSizeList:function(t){mini.isArray(t)&&(this.sizeList=t,this.update())},getSizeList:function(){return this.sizeList},pageSizeWidth:null,setPageSizeWidth:function(t){t=parseInt(t),isNaN(t)||this.pageSizeWidth!=t&&(this.pageSizeWidth=t,this.sizeCombo.setWidth(t))},getPageSizeWidth:function(){return this.pageSizeWidth},setShowPageSize:function(t){this.showPageSize=t,this.update()},getShowPageSize:function(){return this.showPageSize},setShowPageIndex:function(t){this.showPageIndex=t,this.update()},getShowPageIndex:function(){return this.showPageIndex},setShowTotalCount:function(t){this.showTotalCount=t,this.update()},getShowTotalCount:function(){return this.showTotalCount},setShowPageInfo:function(t){this.showPageInfo=t,this.update()},getShowPageInfo:function(){return this.showPageInfo},setShowReloadButton:function(t){this.showReloadButton=t,this.update()},getShowReloadButton:function(){return this.showReloadButton},setShowButtonText:function(t){this.showButtonText=t,this.update()},getShowButtonText:function(){return this.showButtonText},setShowButtonIcon:function(t){this.showButtonIcon=t,this.update()},getShowButtonIcon:function(){return this.showButtonIcon},getTotalPage:function(){return this.totalPage},update:function(t,e,i){mini.isNumber(t)&&(this.pageIndex=parseInt(t)),mini.isNumber(e)&&(this.pageSize=parseInt(e)),mini.isNumber(i)&&(this.totalCount=parseInt(i)),this.totalPage=parseInt(this.totalCount/this.pageSize)+1,(this.totalPage-1)*this.pageSize==this.totalCount&&(this.totalPage-=1),0==this.totalCount&&(this.totalPage=0),0<=this.totalCount&&this.pageIndex>this.totalPage-1&&(this.pageIndex=this.totalPage-1),this.pageIndex<=0&&(this.pageIndex=0),this.totalPage<=0&&(this.totalPage=0),this.firstButton.enable(),this.prevButton.enable(),this.nextButton.enable(),this.lastButton.enable(),0==this.pageIndex&&(this.firstButton.disable(),this.prevButton.disable()),this.pageIndex>=this.totalPage-1&&(this.nextButton.disable(),this.lastButton.disable());var n=-1<this.pageIndex?this.pageIndex+1:0;0==this.totalCount&&(n=0),this.numInput.value=n,this.pagesLabel.innerHTML="/ "+this.totalPage;var s=this.sizeList.clone();-1==s.indexOf(this.pageSize)&&(s.push(this.pageSize),s=s.sort(function(t,e){return e<t}));for(var o=[],r=0,a=s.length;r<a;r++){var l=s[r],h={};h.text=l,h.id=l,o.push(h)}this.sizeCombo.setData(o),this.sizeCombo.setValue(this.pageSize),this.sizeTextEl.innerHTML=this.sizeText,this.sizeTextEl.style.display=this.sizeText?"":"none";var d=this.firstText,u=this.prevText,c=this.nextText,m=this.lastText,f=this.reloadText;0==this.showButtonText&&(d=u=c=m=f=""),this.firstButton.setText(d),this.prevButton.setText(u),this.nextButton.setText(c),this.lastButton.setText(m),this.reloadButton.setText(f);d=this.firstText,u=this.prevText,c=this.nextText,m=this.lastText;this.showButtonText&&(this.firstButton.setTooltip(d),this.prevButton.setTooltip(u),this.nextButton.setTooltip(c),this.lastButton.setTooltip(m),this.reloadButton.setTooltip(f)),this.firstButton.setIconCls(this.showButtonIcon?"mini-pager-first":""),this.prevButton.setIconCls(this.showButtonIcon?"mini-pager-prev":""),this.nextButton.setIconCls(this.showButtonIcon?"mini-pager-next":""),this.lastButton.setIconCls(this.showButtonIcon?"mini-pager-last":""),this.reloadButton.setIconCls(this.showButtonIcon?"mini-pager-reload":""),this.reloadButton.setVisible(this.showReloadButton);var p=this.reloadButton.el.previousSibling;p&&(p.style.display=this.showReloadButton?"":"none"),this._rightEl.innerHTML=String.format(this.pageInfoText,this.pageSize,this.totalCount),this.indexEl.style.display=this.showPageIndex?"":"none",this.sizeEl.style.display=this.showPageSize?"":"none",this._rightEl.style.display=this.showPageInfo?"":"none",this.firstButton.setVisible(0<=this.totalCount),this.lastButton.setVisible(0<=this.totalCount),this.totalCount<0&&(this.firstButton.enable(),this.nextButton.enable(),0==this.pageIndex&&this.firstButton.disable())},__OnPageSelectChanged:function(t){var e=parseInt(this.sizeCombo.getValue());this._OnPageChanged(0,e)},_OnPageChanged:function(t,e){var i={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};0<=this.totalCount&&i.pageIndex>this.totalPage-1&&(i.pageIndex=this.totalPage-1),i.pageIndex<0&&(i.pageIndex=0),this.fire("beforepagechanged",i),1!=i.cancel&&(this.fire("pagechanged",i),this.update(i.pageIndex,i.pageSize))},onPageChanged:function(t,e){this.on("pagechanged",t,e)},getAttrs:function(t){var e=mini.Pager.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onpagechanged","sizeList","onbeforepagechanged","buttons","sizeText"]),mini._ParseBool(t,e,["showPageIndex","showPageSize","showTotalCount","showPageInfo","showReloadButton","showButtonText","showButtonIcon"]),mini._ParseInt(t,e,["pageIndex","pageSize","totalCount","pageSizeWidth"]),"string"==typeof e.sizeList&&(e.sizeList=window.eval(e.sizeList)),e.buttons&&(e.buttons=mini.byId(e.buttons)),e}}),mini.regClass(mini.Pager,"pager"),mini.DataBinding=function(){this._bindFields=[],this._bindForms=[],mini.DataBinding.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataBinding,mini.Component,{bindField:function(t,e,i,n,s){if(t=mini.get(t),e=mini.get(e),t&&e&&i){var o={control:t,source:e,field:i,convert:s,mode:n};this._bindFields.push(o),e.on("currentchanged",this.__OnCurrentChanged,this),t.on("valuechanged",this.__OnValueChanged,this)}},bindForm:function(t,e,i,n){if(t=mini.byId(t),e=mini.get(e),t&&e)for(var s=(t=new mini.Form(t)).getFields(),o=0,r=s.length;o<r;o++){var a=s[o];this.bindField(a,e,a.getName(),i,n)}},__OnCurrentChanged:function(t){if(!this._doSetting){this._doSetting=!0,this._currentRecord=t.record;for(var e=t.sender,i=t.record,n=0,s=this._bindFields.length;n<s;n++){var o=this._bindFields[n];if(o.source==e){var r=o.control,a=o.field;if(r.setValue)if(i){var l=mini._getMap(a,i);r.setValue(l)}else r.setValue("");r.setText&&r.textName&&(i?r.setText(i[r.textName]):r.setText(""))}}var h=this;setTimeout(function(){h._doSetting=!1},10)}},__OnValueChanged:function(t){if(!this._doSetting){this._doSetting=!0;for(var e=t.sender,i=e.getValue(),n=0,s=this._bindFields.length;n<s;n++){var o=this._bindFields[n];if(o.control==e&&!1!==o.mode){var r=o.source,a=this._currentRecord;if(a){var l={};l[o.field]=i,e.getText&&e.textName&&(l[e.textName]=e.getText()),r.updateRow(a,l)}}}var h=this;setTimeout(function(){h._doSetting=!1},10)}}}),mini.regClass(mini.DataBinding,"databinding"),mini.DataSet=function(){this._sources={},this._data={},this._links=[],this._originals={},mini.DataSet.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataSet,mini.Component,{add:function(t,e){t&&e&&(this._sources[t]=e,this._data[t]=[],e._set_autoCreateNewID(!0),e._set_originalIdField(e.getIdField()),e._set_clearOriginals(!1),e.on("addrow",this.__OnRowChanged,this),e.on("updaterow",this.__OnRowChanged,this),e.on("deleterow",this.__OnRowChanged,this),e.on("removerow",this.__OnRowChanged,this),e.on("preload",this.__OnDataPreLoad,this),e.on("selectionchanged",this.__OnDataSelectionChanged,this))},addLink:function(t,e,i){if(t&&e&&i&&this._sources[t]&&this._sources[e]){var n={parentName:t,childName:e,parentField:i};this._links.push(n)}},clearData:function(){for(var t in this._data={},this._originals={},this._sources)this._data=[]},getData:function(){return this._data},_getNameByListControl:function(t){for(var e in this._sources){if(this._sources[e]==t)return e}},_getRecord:function(t,e,i){var n=this._data[t];if(!n)return!1;for(var s=0,o=n.length;s<o;s++){var r=n[s];if(r[i]==e[i])return r}return null},__OnRowChanged:function(t){var e=t.type,i=t.record,n=this._getNameByListControl(t.sender),s=this._getRecord(n,i,t.sender.getIdField()),o=this._data[n];s&&(o=this._data[n]).remove(s);if("removerow"==e&&"added"==i._state||"beforeremove"==e&&"added"==i._state||o.push(i),
//            if (!oldRow) {
this._originals[n]=t.sender._get_originals(),"added"==i._state){var r=this._getParentSource(t.sender);if(r){var a=r.getSelected();a?i._parentId=a[r.getIdField()]:o.remove(i)}}},__OnDataPreLoad:function(t){for(var e=t.sender,i=this._getNameByListControl(e),n=t.sender.getIdField(),s=this._data[i],o={},r=0,a=s.length;r<a;r++){o[(f=s[r])[n]]=f}var l=this._originals[i];l&&e._set_originals(l);var h=t.data||[];for(r=0,a=h.length;r<a;r++){(p=o[(f=h[r])[n]])&&(delete p._uid,mini.copyTo(f,p))}var d=this._getParentSource(e);if(e.getPageIndex&&0==e.getPageIndex()){var u=[];for(r=0,a=s.length;r<a;r++){if("added"==(f=s[r])._state)if(d){var c=d.getSelected();c&&c[d.getIdField()]==f._parentId&&u.push(f)}else u.push(f)}u.reverse(),h.insertRange(0,u)}var m=[];for(r=h.length-1;0<=r;r--){var f,p;(p=o[(f=h[r])[n]])&&"removed"==p._state&&(h.removeAt(r),m.push(p))}},_getParentSource:function(t){for(var e=this._getNameByListControl(t),i=0,n=this._links.length;i<n;i++){var s=this._links[i];if(s.childName==e)return this._sources[s.parentName]}},_getLinks:function(t){for(var e=this._getNameByListControl(t),i=[],n=0,s=this._links.length;n<s;n++){var o=this._links[n];o.parentName==e&&i.push(o)}return i},__OnDataSelectionChanged:function(t){for(var e=t.sender,i=e.getSelected(),n=this._getLinks(e),s=0,o=n.length;s<o;s++){var r=n[s],a=this._sources[r.childName];if(i){var l={};l[r.parentField]=i[e.getIdField()],a.load(l)}else a.loadData([])}}}),mini.regClass(mini.DataSet,"dataset"),"undefined"==typeof mini_doload&&(mini_doload=function(t){}),mini.DataSource=function(){mini.DataSource.superclass.constructor.apply(this,arguments),this._init()},mini.extend(mini.DataSource,mini.Component,{idField:"id",textField:"text",loaded:!1,destroy:function(){this.source=[],this.dataview=[],this.visibleRows=null,this.list=null,this._ids={},this._removeds=[],this._clearOriginals&&(this._originals={}),this._errors={},this._selected=null,this._selecteds=[],this._idSelecteds={},this._filterInfo=null,this._sortInfo=null,this.root={_id:-1,_level:-1},this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null,mini.DataSource.superclass.destroy.call(this)},_originalIdField:"_id",_clearOriginals:!0,_autoCreateNewID:!1,_init:function(){this.source=[],this.dataview=[],this.visibleRows=null,this.list=null,this._ids={},this._removeds=[],this._clearOriginals&&(this._originals={}),this._errors={},this._selected=null,this._selecteds=[],this._idSelecteds={},this.__changeCount=0},getSource:function(){return this.source},getList:function(){return this.source.clone()},getDataView:function(){return this.dataview.clone()},getVisibleRows:function(){return this.visibleRows||(this.visibleRows=this.getDataView().clone()),this.visibleRows},setData:function(t){this.loadData(t)},loadData:function(t){return mini.isArray(t)||(t=[]),this._init(),this._doLoadData(t),this._dataChanged("loaddata"),this.fire("loaddata"),!0},_doLoadData:function(t){this.source=t,this.dataview=t;for(var e=this.source,i=this._ids,n=0,s=e.length;n<s;n++){var o=e[n];
//if (!record._id) record._id = mini.DataSource.RecordId++;
o._id=mini.DataSource.RecordId++,(i[o._id]=o)._uid=o._id}},clearData:function(){this._init(),this._dataChanged(),this.fire("cleardata")},clear:function(){this.clearData()},updateRecord:function(t,e,i){if(!mini.isNull(t)){var n=mini._getMap,s=mini._setMap;if(this.fire("beforeupdate",{record:t}),"string"==typeof e){var o=n(e,t);if(mini.isEquals(o,i))return!1;this.beginChange(),s(e,i,t),this._setModified(t,e,o),this.endChange()}else{for(var r in this.beginChange(),e){o=n(r,t),i=e[r];mini.isEquals(o,i)||(s(r,i,t),this._setModified(t,r,o))}this.endChange("update")}this.fire("update",{record:t})}},deleteRecord:function(t){this._setDeleted(t),this._dataChanged(),this.fire("delete",{record:t})},getby_id:function(t){return t="object"==typeof t?t._id:t,this._ids[t]},getbyId:function(t){if("number"==typeof t)return this.getAt(t);if("object"==typeof t){if(this.getby_id(t))return t;t=t[this.idField]}
//!!!
t=String(t);var e=this.ids;if(!e){e=this.ids={};for(var i=this.getList(),n=0,s=i.length;n<s;n++){var o=i[n],r=o[this.idField];mini.isNull(r)||(e[r]=o)}}return e[t]},
//            var _id = !mini.isNull(o[this.idField]) ? String(o[this.idField]) : null;
getsByIds:function(t){mini.isNull(t)&&(t=""),t=String(t);for(var e=[],i=String(t).split(","),n=0,s=i.length;n<s;n++){var o=this.getbyId(i[n]);o&&e.push(o)}return e},getRecord:function(t){return"object"==typeof t?t:this.getRow(t)},getRow:function(t){var e=typeof t;return"string"==e?this.getbyId(t):"number"==e?this.getAt(t):"object"==e?t:void 0},delimiter:",",getValueAndText:function(t,e){mini.isNull(t)&&(t=[]),e=e||this.delimiter,"string"==typeof t||"number"==typeof t?t=this.getsByIds(t):mini.isArray(t)||(t=[t]);for(var i=[],n=[],s=0,o=t.length;s<o;s++){var r=t[s];r&&(i.push(this.getItemValue(r)),n.push(this.getItemText(r)))}return[i.join(e),n.join(e)]},getItemValue:function(t){if(!t)return"";var e=mini._getMap(this.idField,t);return mini.isNull(e)?"":String(e)},getItemText:function(t){if(!t)return"";var e=mini._getMap(this.textField,t);return mini.isNull(e)?"":String(e)},isModified:function(t,e){var i=this._originals[t[this._originalIdField]];return!!i&&(!mini.isNull(e)&&i.hasOwnProperty(e))},hasRecord:function(t){return!!this.getby_id(t)},findRecords:function(t,e){for(var i="function"==typeof t,n=t,s=e||this,o=this.source,r=[],a=0,l=o.length;a<l;a++){var h=o[a];if(i){var d=n.call(s,h);if(1==d&&(r[r.length]=h),1===d)break}else h[t]==e&&(r[r.length]=h)}return r},findRecord:function(t,e){return this.findRecords(t,e)[0]},each:function(t,e){var i=this.getDataView().clone();e=e||this,mini.forEach(i,t,e)},getCount:function(){return this.getDataView().length},setIdField:function(t){this.idField=t},setTextField:function(t){this.textField=t},__changeCount:0,beginChange:function(){this.__changeCount++},endChange:function(t,e){this.__changeCount--,this.__changeCount<0&&(this.__changeCount=0),(!1!==e&&0==this.__changeCount||1==e)&&(this.__changeCount=0,this._dataChanged(t))},_dataChanged:function(t){this.ids=null,//!!!
this.visibleRows=null,this.list=null,0==this.__changeCount&&this.fire("datachanged")},_setAdded:function(t){t._id=mini.DataSource.RecordId++,this._autoCreateNewID&&!t[this.idField]&&(t[this.idField]=mini.UUID()),t._uid=t._id,
//if (!record._id) record._id = mini.DataSource.RecordId++;
t._state="added",this._ids[t._id]=t,delete this._originals[t[this._originalIdField]]},_setModified:function(t,e,i){if("added"!=t._state&&"deleted"!=t._state&&"removed"!=t._state){t._state="modified";var n=this._getOriginal(t);n.hasOwnProperty(e)||(n[e]=i)}},_setDeleted:function(t){"added"!=t._state&&"deleted"!=t._state&&"removed"!=t._state&&(t._state="deleted")},_setRemoved:function(t){delete this._ids[t._id],"added"!=t._state&&"removed"!=t._state&&(t._state="removed",delete this._originals[t[this._originalIdField]],this._removeds.push(t))},_getOriginal:function(t){var e=t[this._originalIdField],i=this._originals[e];return i=i||(this._originals[e]={})},_selected:null,_selecteds:[],_idSelecteds:null,multiSelect:!1,isSelected:function(t){return!!t&&("string"!=typeof t&&(t=t._id),!!this._idSelecteds[t])},setSelected:function(t){t=this.getby_id(t),this.getSelected()!=t&&((this._selected=t)?this.select(t):this.deselect(this.getSelected()),this._OnCurrentChanged(t))},getSelected:function(){return this.isSelected(this._selected)?this._selected:this._selecteds[0]},setCurrent:function(t){this.setSelected(t)},getCurrent:function(){return this.getSelected()},getSelecteds:function(){return this._selecteds.clone()},select:function(t,e){mini.isNull(t)||this.selects([t],e)},deselect:function(t,e){mini.isNull(t)||this.deselects([t],e)},selectAll:function(t){this.selects(this.getList(),t)},deselectAll:function(t){this.deselects(this.getSelecteds(),t)},_fireSelect:function(t,e){var i={record:t,cancel:!1};return this.fire(e,i),!i.cancel},selects:function(t,e){if(mini.isArray(t)){t=t.clone(),0==this.multiSelect&&(this.deselects(this.getSelecteds()),0<t.length&&(t.length=1),this._selecteds=[],this._idSelecteds={});for(var i=[],n=0,s=t.length;n<s;n++){var o=this.getbyId(t[n]);if(o&&!this.isSelected(o)){if(!1!==e&&!this._fireSelect(o,"beforeselect"))continue;this._selecteds.push(o),this._idSelecteds[o._id]=o,i.push(o),!1!==e&&this.fire("select",{record:o})}}this._OnSelectionChanged(t,!0,i,e)}},deselects:function(t,e){if(mini.isArray(t)){for(var i=[],n=(t=t.clone()).length-1;0<=n;n--){if((r=this.getbyId(t[n]))&&this.isSelected(r)){if(!1!==e&&!this._fireSelect(r,"beforedeselect"))continue;delete this._idSelecteds[r._id],i.push(r)}}this._selecteds=[];var s=this._idSelecteds;for(var n in s){var o=s[n];o._id&&this._selecteds.push(o)}for(n=t.length-1;0<=n;n--){var r;(r=this.getbyId(t[n]))&&!1!==e&&this.fire("deselect",{record:r})}this._OnSelectionChanged(t,!1,i,e)}},_OnSelectionChanged:function(t,e,i,n){var s={fireEvent:n,records:t,select:e,selected:this.getSelected(),selecteds:this.getSelecteds(),_records:i};this.fire("SelectionChanged",s);var o=this._current,r=this.getCurrent();o!=r&&(this._current=r,this._OnCurrentChanged(r))},_OnCurrentChanged:function(e){this._currentTimer&&clearTimeout(this._currentTimer);var i=this;this._currentTimer=setTimeout(function(){i._currentTimer=null;var t={record:e};i.fire("CurrentChanged",t)},30)},_checkSelecteds:function(){for(var t=this._selecteds.length-1;0<=t;t--){var e=this._selecteds[t];this.getby_id(e._id)||(this._selecteds.removeAt(t),delete this._idSelecteds[e._id])}this._selected&&null==this.getby_id(this._selected._id)&&(this._selected=null)},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t)},getMultiSelect:function(){return this.multiSelect},selectPrev:function(){var t=this.getSelected();if(t){var e=this.indexOf(t);t=this.getAt(e-1)}else t=this.getAt(0);t&&(this.deselectAll(),this.select(t),this.setCurrent(t))},selectNext:function(){var t=this.getSelected();if(t){var e=this.indexOf(t);t=this.getAt(e+1)}else t=this.getAt(0);t&&(this.deselectAll(),this.select(t),this.setCurrent(t))},selectFirst:function(){var t=this.getAt(0);t&&(this.deselectAll(),this.select(t),this.setCurrent(t))},selectLast:function(){var t=this.getVisibleRows(),e=this.getAt(t.length-1);e&&(this.deselectAll(),this.select(e),this.setCurrent(e))},getSelectedsId:function(t){var e=this.getSelecteds();return this.getValueAndText(e,t)[0]},getSelectedsText:function(t){var e=this.getSelecteds();return this.getValueAndText(e,t)[1]},_filterInfo:null,_sortInfo:null,filter:function(t,e){"function"==typeof t&&(e=e||this,this._filterInfo=[t,e],this._doFilter(),this._doSort(),this._dataChanged(),this.fire("filter"))},clearFilter:function(){this._filterInfo&&(this._filterInfo=null,this._doFilter(),this._doSort(),this._dataChanged(),this.fire("filter"))},sort:function(t,e,i){"function"==typeof t&&(e=e||this,this._sortInfo=[t,e,i],this._doSort(),this._dataChanged(),this.fire("sort"))},clearSort:function(){if(this._sortInfo=null,this.sortField=this.sortOrder="",this._doFilter(),this._dataChanged(),"server"==this.sortMode){var t=this.getLoadParams();t.sortField="",t.sortOrder="",this.load(t)}this.fire("filter")},_sortMulti:function(t){},_doClientSortField:function(t,e,i){
//        if (!dataType) {
var n=this._getSortFnByField(t,i);if(n){var s="desc"==e;this.sort(n,this,s)}},_getSortFnByField:function(a,l){if(!a)return null;var h=mini.sortTypes[l];return h=h||mini.sortTypes.string,function d(t,e){var i=mini._getMap(a,t),n=mini._getMap(a,e),s=mini.isNull(i)||""===i,o=mini.isNull(n)||""===n;if(s)return 0;if(o)return 1;if("chinese"==l)return i.localeCompare(n,"zh");var r=h(i);return h(n)<r?1:0}},ajaxOptions:null,autoLoad:!1,url:"",pageSize:10,pageIndex:0,totalCount:0,totalPage:0,sortField:"",sortOrder:"",loadParams:null,getLoadParams:function(){return this.loadParams||{}},sortMode:"server",pageIndexField:"pageIndex",pageSizeField:"pageSize",sortFieldField:"sortField",sortOrderField:"sortOrder",totalField:"total",dataField:"data",startField:"",limitField:"",errorField:"error",errorMsgField:"errorMsg",stackTraceField:"stackTrace",load:function(t,e,i,n){if("string"!=typeof t)if(this._loadTimer&&clearTimeout(this._loadTimer),this.loadParams=t||{},mini.isNumber(this.loadParams.pageIndex)||(this.loadParams.pageIndex=0),this._xhr&&this._xhr.abort(),this.ajaxAsync&&mini_ajaxAsyncInvoke){var s=this;this._loadTimer=setTimeout(function(){s._doLoadAjax(s.loadParams,e,i,n),s._loadTimer=null},1)}else this._doLoadAjax(this.loadParams,e,i,n);else this.setUrl(t)},reload:function(t,e,i){this.load(this.loadParams,t,e,i)},gotoPage:function(t,e){var i=this.loadParams||{};mini.isNumber(t)&&(i.pageIndex=t),mini.isNumber(e)&&(i.pageSize=e),this.load(i)},sortBy:function(t,e){if(this.sortField=t,this.sortOrder="asc"==e?"asc":"desc","server"==this.sortMode){var i=this.getLoadParams();i.sortField=t,i.sortOrder=e,i.pageIndex=this.pageIndex,this.load(i)}},setSortField:function(t){this.sortField=t,"server"==this.sortMode&&(this.getLoadParams().sortField=t)},setSortOrder:function(t){this.sortOrder=t,"server"==this.sortMode&&(this.getLoadParams().sortOrder=t)},checkSelectOnLoad:!0,selectOnLoad:!1,ajaxData:null,ajaxAsync:!0,ajaxType:"",_doLoadAjax:function(p,g,_,n,v){p=p||{},mini.isNull(p.pageIndex)&&(p.pageIndex=this.pageIndex),mini.isNull(p.pageSize)&&(p.pageSize=this.pageSize),p.sortField&&(this.sortField=p.sortField),p.sortOrder&&(this.sortOrder=p.sortOrder),p.sortField=this.sortField,p.sortOrder=this.sortOrder,this.loadParams=p;var y=this._evalUrl(),t=this._evalType(y),e=mini._evalAjaxData(this.ajaxData,this);jQuery.extend(!0,p,e);var w={url:y,async:this.ajaxAsync,type:t,data:p,params:p,cache:!1,cancel:!1};if(jQuery.extend(!0,w,this.ajaxOptions),this._OnBeforeLoad(w),1==w.cancel)return p.pageIndex=this.getPageIndex(),void(p.pageSize=this.getPageSize());w.data!=w.params&&w.params!=p&&(w.data=w.params),w.url!=y&&w.type==t&&(w.type=this._evalType(w.url));var i={};i[this.pageIndexField]=p.pageIndex,i[this.pageSizeField]=p.pageSize,p.sortField&&(i[this.sortFieldField]=p.sortField),p.sortOrder&&(i[this.sortOrderField]=p.sortOrder),this.startField&&this.limitField&&(i[this.startField]=p.pageIndex*p.pageSize,i[this.limitField]=p.pageSize),jQuery.extend(!0,p,i),jQuery.extend(!0,w.data,i),"client"==this.sortMode&&(p[this.sortFieldField]="",p[this.sortOrderField]="");var s=this.getSelected();this._currentSelectValue=s?s[this.idField]:null,mini.isNumber(this._currentSelectValue)&&(this._currentSelectValue=String(this._currentSelectValue));for(var o=this.getSelecteds(),r=[],a=0,l=o.length;a<l;a++){var h=o[a][this.idField];mini.isNull(h)||(h=String(h)),r.push(h)}this._selectedValue=0==r.length?null:r,mini.isNumber(this._selectedValue)&&(this._selectedValue=String(this._selectedValue));var x=this;x._resultObject=null;var C=w.async;mini.copyTo(w,{success:function(t,e,i){t&&"null"!=t||(t="{ total: 0, data: [] }"),delete w.params;var n={text:t,result:null,sender:x,options:w,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(r){1==mini_debugger&&alert(y+"\n json is error.")}if(s&&!mini.isArray(s))s.total=parseInt(mini._getMap(x.totalField,s)),s.data=mini._getMap(x.dataField,s);else if(null==s)s={data:[],total:0};else if(mini.isArray(s)){var o={};o.data=s,o.total=s.length,s=o}s.data||(s.data=[]),s.total||(s.total=0),x._resultObject=s,mini.isArray(s.data)||(s.data=[s.data]);var r={xhr:i,text:t,textStatus:e,result:s,total:s.total,data:s.data.clone(),pageIndex:p[x.pageIndexField],pageSize:p[x.pageSizeField]},a=mini._getMap(x.errorField,s),l=mini._getMap(x.errorMsgField,s),h=mini._getMap(x.stackTraceField,s);if(mini.isNumber(a)&&0!=a||!1===a)r.textStatus="servererror",r.errorCode=a,r.stackTrace=h||"",r.errorMsg=l||"",1==mini_debugger&&alert(y+"\n"+r.textStatus+"\n"+r.errorMsg+"\n"+r.stackTrace),x.fire("loaderror",r),_&&_.call(x,r);else{if(0<r.pageIndex&&0==r.data.length)return void x.gotoPage(r.pageIndex-1);if(v)v(r);else{x.pageIndex=r.pageIndex,x.pageSize=r.pageSize,x.setTotalCount(r.total),x._OnPreLoad(r),x.loaded=!0;new Date;if(x.setData(r.data),x._selectedValue&&x.checkSelectOnLoad){var d=[],u=x._selectedValue;if(0<u.length){for(var c=0,m=u.length;c<m;c++){var f=x.getbyId(u[c]);f&&d.push(f)}d.length&&x.selects(d),x._selected=x.getbyId(x._currentSelectValue)}}null==x.getSelected()&&x.selectOnLoad&&0<x.getDataView().length&&x.select(0),x.fire("load",r),g&&(C?setTimeout(function(){g.call(x,r)},20):g.call(x,r))}}},error:function(t,e,i){if("abort"!=e){var n={xhr:t,text:t.responseText,textStatus:e};n.errorMsg=t.responseText,n.errorCode=t.status,1==mini_debugger&&alert(y+"\n"+n.errorCode+"\n"+n.errorMsg),x.fire("loaderror",n),_&&_.call(x,n)}},complete:function(t,e){var i={xhr:t,text:t.responseText,textStatus:e};x.fire("loadcomplete",i),n&&n.call(x,i),x._xhr=null}}),this._xhr,this._xhr=mini.ajax(w)},_OnBeforeLoad:function(t){this.fire("beforeload",t)},_OnPreLoad:function(t){this.fire("preload",t)},_evalUrl:function(){var t=this.url;if("function"==typeof t)t=t();else{try{t=window.eval(t)}catch(ex){t=this.url}t=t||this.url}return t},_evalType:function(t){var e=this.ajaxType;return e||(e="post",t&&-1==t.indexOf(".txt")&&-1==t.indexOf(".json")||(e="get")),e},setSortMode:function(t){this.sortMode=t},getSortMode:function(){return this.sortMode},setAjaxOptions:function(t){this.ajaxOptions=t},getAjaxOptions:function(){return this.ajaxOptions},setAutoLoad:function(t){this.autoLoad=t},getAutoLoad:function(){return this.autoLoad},setUrl:function(t){this.url=t,this.autoLoad&&this.load()},getUrl:function(){return this.url},setPageIndex:function(t){this.pageIndex=t;var e=this.loadParams||{};mini.isNumber(t)&&(e.pageIndex=t),this.fire("pageinfochanged")},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){this.pageSize=t;var e=this.loadParams||{};mini.isNumber(t)&&(e.pageSize=t),this.fire("pageinfochanged")},getPageSize:function(){return this.pageSize},setTotalCount:function(t){this.totalCount=parseInt(t),this.fire("pageinfochanged")},getTotalCount:function(){return this.totalCount},getTotalPage:function(){return this.totalPage},setCheckSelectOnLoad:function(t){this.checkSelectOnLoad=t},getCheckSelectOnLoad:function(){return this.checkSelectOnLoad},setSelectOnLoad:function(t){this.selectOnLoad=t},getSelectOnLoad:function(){return this.selectOnLoad}}),mini.DataSource.RecordId=1,mini.DataTable=function(){mini.DataTable.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataTable,mini.DataSource,{_init:function(){mini.DataTable.superclass._init.call(this),this._filterInfo=null,this._sortInfo=null},add:function(t){return this.insert(this.source.length,t)},addRange:function(t){this.insertRange(this.source.length,t)},insert:function(t,e){if(!e)return null;if(!mini.isNumber(t)){var i=this.getRecord(t);t=i?this.indexOf(i):this.dataview.length}var n={index:t,record:e};this.fire("beforeadd",n);var s=this.dataview[t];if(s?this.dataview.insert(t,e):this.dataview.add(e),this.dataview!=this.source)if(s){var o=this.source.indexOf(s);this.source.insert(o,e)}else this.source.add(e);this._setAdded(e),this._dataChanged(),this.fire("add",n)},insertRange:function(t,e){if(mini.isArray(e)){mini.isNumber(t)||(t=this.dataview.length),this.beginChange();for(var i=0,n=(e=e.clone()).length;i<n;i++){var s=e[i];this.insert(t+i,s)}this.endChange()}},remove:function(t,e){var i=this.indexOf(t);return this.removeAt(i,e)},removeAt:function(t,e){var i=this.getAt(t);if(!i)return null;var n={record:i};this.fire("beforeremove",n);var s=this.isSelected(i);if(this.source.remove(i),this.dataview!==this.source&&this.dataview.removeAt(t),this._setRemoved(i),this._checkSelecteds(),this._dataChanged(),this.fire("remove",n),s&&e){var o=this.getAt(t);o=o||this.getAt(t-1),this.deselectAll(),this.select(o)}},removeRange:function(t,e){if(mini.isArray(t)){this.beginChange();for(var i=0,n=(t=t.clone()).length;i<n;i++){var s=t[i];this.remove(s,e)}this._dataChanged(),this.endChange()}},move:function(t,e){if(t&&mini.isNumber(e)&&!(e<0)){var i=e===this.dataview.length;if(mini.isArray(t)){this.beginChange();var n=t,s=this.getAt(e),o=this;mini.sort(n,function(t,e){return o.indexOf(t)>o.indexOf(e)},this);for(var r=0,a=n.length;r<a;r++){var l=n[r],h=this.indexOf(s);this.move(l,i?this.dataview.length:h)}this.endChange()}else{var d={index:e,record:t};this.fire("beforemove",d);var u,c=this.dataview[e];if(this.dataview.remove(t),-1!=(u=this.dataview.indexOf(c))&&(e=u),c?this.dataview.insert(e,t):this.dataview.add(t),this.dataview!=this.source)this.source.remove(t),-1!=(u=this.source.indexOf(c))&&(e=u),c?this.source.insert(e,t):this.source.add(t);this._dataChanged(),this.fire("move",d)}}},indexOf:function(t){return this.getVisibleRows().indexOf(t)},getAt:function(t){return this.getVisibleRows()[t]},getRange:function(t,e){if(e<t){var i=t;t=e,e=i}for(var n=[],s=t,o=e;s<=o;s++){var r=this.dataview[s];n.push(r)}return n},selectRange:function(t,e){if(mini.isNumber(t)||(t=this.indexOf(t)),mini.isNumber(e)||(e=this.indexOf(e)),!mini.isNull(t)&&!mini.isNull(e)){var i=this.getRange(t,e);this.selects(i)}},toArray:function(){return this.source.clone()},isChanged:function(){return 0<this.getChanges().length},getChanges:function(t,e){var i=[];"removed"!=t&&null!=t||i.addRange(this._removeds.clone());for(var n=0,s=this.source.length;n<s;n++){var o=this.source[n];o._state&&(o._state!=t&&null!=t||(i[i.length]=o))}var r=i;if(e)for(n=0,s=r.length;n<s;n++){var a=r[n];if("modified"==a._state){var l={};for(var h in l._state=a._state,l[this.idField]=a[this.idField],a){this.isModified(a,h)&&(l[h]=a[h])}r[n]=l}}var d=this;return mini.sort(i,function(t,e){var i=d.indexOf(t),n=d.indexOf(e);return n<i?1:i<n?-1:0}),i},accept:function(){this.beginChange();for(var t=0,e=this.source.length;t<e;t++){var i=this.source[t];this.acceptRecord(i)}this._removeds=[],this._originals={},this.endChange()},reject:function(){this.beginChange();for(var t=this.source.clone(),e=0,i=t.length;e<i;e++){var n=t[e];this.rejectRecord(n)}this._removeds=[],this._originals={},this.endChange()},acceptRecord:function(t){t._state&&(delete this._originals[t[this._originalIdField]],"deleted"==t._state?this.remove(t):(delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged()),this.fire("update",{record:t}))},rejectRecord:function(t){if(t._state)if("added"==t._state)this.remove(t);else if("modified"==t._state||"deleted"==t._state){var e=this._getOriginal(t);for(var i in e){var n=e[i];mini._setMap(i,n,t)}delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})}},_doFilter:function(){if(this._filterInfo){for(var t=this._filterInfo[0],e=this._filterInfo[1],i=[],n=this.source,s=0,o=n.length;s<o;s++){var r=n[s];!1!==t.call(e,r,s,this)&&i.push(r)}this.dataview=i}else this.dataview=this.source},_doSort:function(){if(this._sortInfo){var t=this._sortInfo[0],e=this._sortInfo[1],i=this._sortInfo[2],n=this.getDataView().clone();mini.sort(n,t,e),i&&n.reverse(),this.dataview=n}}}),mini.regClass(mini.DataTable,"datatable"),mini.DataTree=function(){mini.DataTree.superclass.constructor.apply(this,arguments)},mini.extend(mini.DataTree,mini.DataSource,{isTree:!0,expandOnLoad:!1,idField:"id",parentField:"pid",nodesField:"children",checkedField:"checked",resultAsTree:!1,dataField:"",checkModel:"cascade",autoCheckParent:!1,onlyLeafCheckable:!1,setExpandOnLoad:function(t){this.expandOnLoad=t},getExpandOnLoad:function(){return this.expandOnLoad},setParentField:function(t){this.parentField=t},setNodesField:function(t){if(this.nodesField!=t){var e=this.root[this.nodesField];this.nodesField=t,this._doLoadData(e)}},setResultAsTree:function(t){this.resultAsTree=t},setCheckRecursive:function(t){this.checkModel=t?"cascade":"multiple"},getCheckRecursive:function(){return"cascade"==this.checkModel},setShowFolderCheckBox:function(t){this.onlyLeafCheckable=!t},getShowFolderCheckBox:function(){return!this.onlyLeafCheckable},_doExpandOnLoad:function(t){var r=this.nodesField,a=this.expandOnLoad;!function l(t,e){for(var i=0,n=t.length;i<n;i++){var s=t[i];mini.isNull(s.expanded)&&(!0===a||mini.isNumber(a)&&e<=a?s.expanded=!0:s.expanded=!1);var o=s[r];o&&l(o,e+1)}}(t,0)},_OnBeforeLoad:function(t){var e=this._loadingNode||this.root;t.node=e,this._isNodeLoading()&&(t.async=!0,t.isRoot=t.node==this.root,t.isRoot||(t.data[this.idField]=this.getItemValue(t.node))),this.fire("beforeload",t)},_OnPreLoad:function(t){0==this.resultAsTree&&(t.data=mini.arrayToTree(t.data,this.nodesField,this.idField,this.parentField)),this.fire("preload",t)},_init:function(){mini.DataTree.superclass._init.call(this),this.root={_id:-1,_level:-1},this.source=this.root[this.nodesField]=[],this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null,this._ids[this.root._id]=this.root},_doLoadData:function(t){t=t||[],this._doExpandOnLoad(t),this.source=this.root[this.nodesField]=t,this.viewNodes=null,this.dataview=null,this.visibleRows=null,this.list=null;new Date;var e=mini.treeToArray(t,this.nodesField);(h=this._ids)[this.root._id]=this.root;for(var i=mini.DataSource.RecordId,n=0,s=e.length;n<s;n++){
//if (!node._id) node._id = mini.DataSource.RecordId++;
(r=e[n])._id=i++,(h[r._id]=r)._uid=r._id}mini.DataSource.RecordId=i;var o=this.checkedField;e=mini.treeToArray(t,this.nodesField,"_id","_pid",this.root._id);this.list=e;var r,a,l,h=this._ids;for(n=0,s=e.length;n<s;n++)a=h[(r=e[n])._pid],r._level=a._level+1,r._state&&delete r._state,(l=r[o])&&(r.checked=l,r.checked&&(r.checked="false"!=r.checked));this._doUpdateLoadedCheckedNodes()},_setAdded:function(t){var e=this.getParentNode(t);t._id=mini.DataSource.RecordId++,this._autoCreateNewID&&!t[this.idField]&&(t[this.idField]=mini.UUID()),t._uid=t._id,
//if (!node._id) node._id = mini.DataSource.RecordId++;
t._pid=e._id,e[this.idField]&&(t[this.parentField]=e[this.idField]),t._level=e._level+1,t._state="added",this._ids[t._id]=t,delete this._originals[t[this._originalIdField]]},_createNodes:function(t){var e=t[this.nodesField];return e=e||(t[this.nodesField]=[]),this.viewNodes&&!this.viewNodes[t._id]&&(this.viewNodes[t._id]=[]),e},addNode:function(t,e){if(t)return this.insertNode(t,-1,e)},addNodes:function(t,e,i){if(mini.isArray(t)){mini.isNull(i)&&(i="add");for(var n=0,s=t.length;n<s;n++){var o=t[n];this.insertNode(o,i,e)}}},insertNodes:function(t,e,i){if(mini.isNumber(e)&&mini.isArray(t)){i=i||this.root,this.beginChange();var n=this._createNodes(i);(e<0||e>n.length)&&(e=n.length);for(var s=0,o=(t=t.clone()).length;s<o;s++)this.insertNode(t[s],e+s,i);return this.endChange(),t}},removeNode:function(t){var e=this.getParentNode(t);if(e){var i=this.indexOfNode(t);return this.removeNodeAt(i,e)}},removeNodes:function(t){if(mini.isArray(t)){this.beginChange();for(var e=0,i=(t=t.clone()).length;e<i;e++)this.removeNode(t[e]);this.endChange()}},moveNodes:function(t,e,i){if(t&&0!=t.length&&e&&i){this.beginChange();var n=this;mini.sort(t,function(t,e){return n.indexOf(t)>n.indexOf(e)},this);for(var s=0,o=t.length;s<o;s++){var r=t[s];this.moveNode(r,e,i),0!=s&&(e=r,i="after")}this.endChange()}},moveNode:function(t,e,i){if(t&&e&&!mini.isNull(i)){if(this.viewNodes){var n=e;if("before"==(a=i))n=this.getParentNode(e),a=this.indexOfNode(e);else if("after"==a)n=this.getParentNode(e),a=this.indexOfNode(e)+1;else if("add"==a||"append"==a)n[this.nodesField]||(n[this.nodesField]=[]),a=n[this.nodesField].length;else if(!mini.isNumber(a))return;if(this.isAncestor(t,n))return!1;s=(s=this.viewNodes[n._id])||(this.viewNodes[n._id]=[]);var s=this.getChildNodes(n);(a<0||a>s.length)&&(a=s.length);var o={};s.insert(a,o);var r=this.getParentNode(t);this.getChildNodes(r).remove(t),a=s.indexOf(o),s[a]=t}n=e;var a=i;s=this._createNodes(n);if("before"==a)n=this.getParentNode(e),a=(s=this._createNodes(n)).indexOf(e);else if("after"==a)n=this.getParentNode(e),a=(s=this._createNodes(n)).indexOf(e)+1;else if("add"==a||"append"==a)a=s.length;else if(!mini.isNumber(a))return;if(this.isAncestor(t,n))return!1;(a<0||a>s.length)&&(a=s.length);o={};s.insert(a,o),(r=this.getParentNode(t))[this.nodesField].remove(t),a=s.indexOf(o),s[a]=t,this._updateParentAndLevel(t,n),this._dataChanged();var l={oldParentNode:r,parentNode:n,index:a,node:t};this.fire("movenode",l)}},insertNode:function(t,e,i){if(t){if(i||(i=this.root,e="add"),!mini.isNumber(e)){switch(e){case"before":e=this.indexOfNode(i),i=this.getParentNode(i),t=this.insertNode(t,e,i);break;case"after":e=this.indexOfNode(i),i=this.getParentNode(i),t=this.insertNode(t,e+1,i);break;case"append":case"add":t=this.addNode(t,i)}return t}var n=this._createNodes(i),s=this.getChildNodes(i);if((e<0||e>s.length)&&(e=s.length),s.insert(e,t),this.viewNodes){var o=s[e-1];if(o){var r=n.indexOf(o);n.insert(r+1,t)}else n.insert(0,t)}t._pid=i._id,this._setAdded(t);var a=this,l=t[this.nodesField];if(l){!function d(t,e){for(var i=0,n=t.length;i<n;i++){var s=t[i];s._pid=e._id,a._setAdded(s),s[a.nodesField]&&d(s[a.nodesField])}}(l,t)}this._dataChanged();var h={parentNode:i,index:e,node:t};return this.fire("addnode",h),t}},removeNodeAt:function(t,e){e=e||this.root;var i=this.getChildNodes(e),n=i[t];if(!n)return null;i.removeAt(t),this.viewNodes&&e[this.nodesField].remove(n);this._setRemoved(n),this.cascadeChild(n,function(t,e,i){this._setRemoved(t)},this),this._checkSelecteds(),this._dataChanged();var s={parentNode:e,index:t,node:n};return this.fire("removenode",s),n},bubbleParent:function(t,e,i){i=i||this,t&&e.call(this,t);var n=this.getParentNode(t);n&&n!=this.root&&this.bubbleParent(n,e,i)},cascadeChild:function(t,e,i){if(e){t=t||this.root;var n=this.getChildNodes(t);if(n)for(var s=0,o=(n=n.clone()).length;s<o;s++){var r=n[s];if(!1===e.call(i||this,r,s,t))return;this.cascadeChild(r,e,i)}}},eachChild:function(t,e,i){if(e&&t){var n=t[this.nodesField];if(n)for(var s=n.clone(),o=0,r=s.length;o<r;o++){var a=s[o];if(!1===e.call(i||this,a,o,t))break}}},collapse:function(t,e){if(t=this.getNode(t)){this.beginChange(),t.expanded=!1,e&&this.eachChild(t,function(t){null!=t[this.nodesField]&&this.collapse(t,e)},this),this.endChange("collapse");var i={node:t};this.fire("collapse",i)}},expand:function(t,e){if(t=this.getNode(t)){this.beginChange(),t.expanded=!0,e&&this.eachChild(t,function(t){null!=t[this.nodesField]&&this.expand(t,e)},this),this.endChange("expand");var i={node:t};this.fire("expand",i)}},toggle:function(t){this.isExpandedNode(t)?this.collapse(t):this.expand(t)},expandNode:function(t){this.expand(t)},collapseNode:function(t){this.collapse(t)},collapseAll:function(){this.collapse(this.root,!0)},expandAll:function(){this.expand(this.root,!0)},collapseLevel:function(i,n){this.beginChange(),this.each(function(t){var e=this.getLevel(t);i==e&&this.collapse(t,n)},this),this.endChange()},expandLevel:function(i,n){this.beginChange(),this.each(function(t){var e=this.getLevel(t);i==e&&this.expand(t,n)},this),this.endChange()},expandPath:function(t){if(t=this.getNode(t))for(var e=this.getAncestors(t),i=0,n=e.length;i<n;i++)this.expandNode(e[i])},collapsePath:function(t){if(t=this.getNode(t))for(var e=this.getAncestors(t),i=0,n=e.length;i<n;i++)this.collapseNode(e[i])},isAncestor:function(t,e){if(t==e)return!0;if(!t||!e)return!1;if(t==this.getRootNode())return!0;for(var i=this.getAncestors(e),n=0,s=i.length;n<s;n++)if(i[n]==t)return!0;return!1},getAncestors:function(t){for(var e=[];;){var i=this.getParentNode(t);if(!i||i==this.root)break;t=e[e.length]=i}return e.reverse(),e},getNode:function(t){return"object"==typeof t?t:this.getRecord(t)},getRootNode:function(){return this.root},getParentNode:function(t){return t?this.getby_id(t._pid):null},getAllChildNodes:function(t,e){return this.getChildNodes(t,!0,e)},getChildNodes:function(t,e,i){var n=(t=(t=this.getNode(t))||this.getRootNode())[this.nodesField];if(this.viewNodes&&!1!==i&&(n=this.viewNodes[t._id]),!0===e&&n){for(var s=[],o=0,r=n.length;o<r;o++){var a=n[o];s[s.length]=a;var l=this.getChildNodes(a,e,i);l&&0<l.length&&s.addRange(l)}n=s}return n||[]},getChildNodeAt:function(t,e){var i=this.getChildNodes(e);return i?i[t]:null},hasChildNodes:function(t){return 0<this.getChildNodes(t).length},getLevel:function(t){return t._level},_is_true:function(t){return"true"==String(t)||1===t||"Y"===t||"y"===t},_is_false:function(t){return"false"==String(t)||0===t||"N"===t||"n"===t},leafField:"isLeaf",isLeafNode:function(t){return this.isLeaf(t)},isLeaf:function(t){if(!t)return!1;var e=t[this.leafField];return!(!t||this._is_false(e))&&!(0<this.getChildNodes(t,!1,!1).length)},hasChildren:function(t){var e=this.getChildNodes(t);return!!(e&&0<e.length)},isFirstNode:function(t){if(t==this.root)return!0;var e=this.getParentNode(t);return!!e&&this.getFirstNode(e)==t},isLastNode:function(t){if(t==this.root)return!0;var e=this.getParentNode(t);return!!e&&this.getLastNode(e)==t},isCheckedNode:function(t){return!0===t.checked},isExpandedNode:function(t){return 1==t.expanded||1==t.expanded||mini.isNull(t.expanded)},isEnabledNode:function(t){return!1!==t.enabled},isVisibleNode:function(t){if(0==t.visible)return!1;var e=this._ids[t._pid];return!e||e==this.root||!1!==e.expanded&&this.isVisibleNode(e)},getNextNode:function(t){var e=this.getby_id(t._pid);if(!e)return null;var i=this.indexOfNode(t);return this.getChildNodes(e)[i+1]},getPrevNode:function(t){var e=this.getby_id(t._pid);if(!e)return null;var i=this.indexOfNode(t);return this.getChildNodes(e)[i-1]},getFirstNode:function(t){return this.getChildNodes(t)[0]},getLastNode:function(t){var e=this.getChildNodes(t);return e[e.length-1]},indexOfNode:function(t){var e=this.getby_id(t._pid);return e?this.getChildNodes(e).indexOf(t):-1},indexOfList:function(t){return this.getList().indexOf(t)},getAt:function(t){return this.getVisibleRows()[t]},indexOf:function(t){return this.getVisibleRows().indexOf(t)},getRange:function(t,e){if(e<t){var i=t;t=e,e=i}for(var n=this.getChildNodes(this.root,!0),s=[],o=t,r=e;o<=r;o++){var a=n[o];a&&s.push(a)}return s},selectRange:function(t,e){var i=this.getChildNodes(this.root,!0);if(mini.isNumber(t)||(t=i.indexOf(t)),mini.isNumber(e)||(e=i.indexOf(e)),!mini.isNull(t)&&!mini.isNull(e)){var n=this.getRange(t,e);this.selects(n)}},findRecords:function(t,e){var i=this.toArray(),n="function"==typeof t,s=t,o=e||this,r=[];mini.isNull(e)||(e=String(e));for(var a=0,l=i.length;a<l;a++){var h=i[a];if(n){var d=s.call(o,h);if(1==d&&(r[r.length]=h),1===d)break}else if(-1!=e.indexOf(","))for(var u=e.split(","),c=0,m=u.length;c<m;c++){var f=u[c];h[t]==f&&(r[r.length]=h)}else h[t]==e&&(r[r.length]=h)}return r},_dataChangedCount:0,_dataChanged:function(t){this._dataChangedCount++,"update"!=t&&(this.ids=null,//!!!
this.dataview=null,this.visibleRows=null,"collapse"==t||"expand"==t||"loaddata"==t||(this.list=null)),0==this.__changeCount&&this.fire("datachanged")},_createDataView:function(){return this.viewNodes?this.getChildNodes(this.root,!0):this.getList()},
//		var data = !this.viewNodes ? this.getList() : this.getChildNodes(this.root, true);	  //this.getListView()
_createVisibleRows:function(){var n,s,o=[],e=this.nodesField,i=this.viewNodes,r=!!i;function a(t){return r?i[t._id]:t[e]}return function l(t){for(var e=0,i=t.length;e<i;e++)n=t[e],!1===(o[o.length]=n).expanded||(s=a(n))&&l(s)}(a(this.root)),o;
//		var data = !this.viewNodes ? this.getList() : this.getChildNodes(this.root, true);   //this.getListView()
},getList:function(){return this.list||(this.list=mini.treeToList(this.source,this.nodesField)),this.list},getDataView:function(){return this.dataview||(this.dataview=this._createDataView()),this.dataview},getVisibleRows:function(){return this.visibleRows||(this.visibleRows=this._createVisibleRows()),this.visibleRows},_doFilter:function(){if(this._filterInfo){var l=this._filterInfo[0],h=this._filterInfo[1],d=this.viewNodes={},u=this.nodesField;!function c(t){var e=t[u];if(!e)return!1;for(var i=t._id,n=d[i]=[],s=0,o=e.length;s<o;s++){var r=e[s],a=c(r);!0!==l.call(h,r,s,this)&&!a||n.push(r)}return 0<n.length}(this.root)}else this.viewNodes=null},_doSort:function(){if(this._filterInfo||this._sortInfo){if(this._sortInfo){var s=this._sortInfo[0],o=this._sortInfo[1],r=this._sortInfo[2],a=this.nodesField;if(!this.viewNodes){var l=this.viewNodes={};l[this.root._id]=this.root[a].clone(),this.cascadeChild(this.root,function(t,e,i){var n=t[a];n&&(l[t._id]=n.clone())})}var h=this;!function d(t){var e=h.getChildNodes(t);mini.sort(e,s,o),r&&e.reverse();for(var i=0,n=e.length;i<n;i++)d(e[i])}(this.root)}}else this.viewNodes=null},toArray:function(){return this._array&&this._dataChangedCount==this._dataChangedCount2||(this._dataChangedCount2=this._dataChangedCount,this._array=this.getChildNodes(this.root,!0,!1)),this._array},toTree:function(){return this.root[this.nodesField]},isChanged:function(){return 0<this.getChanges().length},getChanges:function(t,e){var i=[];"removed"!=t&&null!=t||i.addRange(this._removeds.clone());for(var n=this.getAllChildNodes(this.root,!1),s=0,o=n.length;s<o;s++){var r=n[s];null!=r._state&&""!=r._state&&(r._state!=t&&null!=t||(i[i.length]=r))}var a=i;if(e)for(s=0,o=a.length;s<o;s++){var l=a[s];if("modified"==l._state){var h={};for(var d in h._state=l._state,h[this.idField]=l[this.idField],l){this.isModified(l,d)&&(h[d]=l[d])}a[s]=h}}return i},accept:function(t){t=t||this.root,this.beginChange(),this.cascadeChild(this.root,function(t){this.acceptRecord(t)},this),this._removeds=[],this._originals={},this.endChange()},reject:function(t){this.beginChange(),this.cascadeChild(this.root,function(t){this.rejectRecord(t)},this),this._removeds=[],this._originals={},this.endChange()},acceptRecord:function(t){t._state&&(delete this._originals[t[this._originalIdField]],"deleted"==t._state?this.removeNode(t):(delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})))},rejectRecord:function(t){if(t._state)if("added"==t._state)this.removeNode(t);else if("modified"==t._state||"deleted"==t._state){var e=this._getOriginal(t);mini.copyTo(t,e),delete t._state,delete this._originals[t[this._originalIdField]],this._dataChanged(),this.fire("update",{record:t})}},upGrade:function(t){var e=this.getParentNode(t);if(e==this.root||t==this.root)return!1;for(var i=e[this.nodesField],n=i.indexOf(t),s=t[this.nodesField]?t[this.nodesField].length:0,o=i.length-1;n<=o;o--){var r=i[o];i.removeAt(o),r!=t&&(t[this.nodesField]||(t[this.nodesField]=[]),t[this.nodesField].insert(s,r))}var a=this.getParentNode(e),l=a[this.nodesField];n=l.indexOf(e);l.insert(n+1,t),this._updateParentAndLevel(t,a),this._doFilter(),this._dataChanged()},downGrade:function(t){if(this.isFirstNode(t))return!1;var e=this.getParentNode(t)[this.nodesField],i=e.indexOf(t),n=e[i-1];e.removeAt(i),n[this.nodesField]||(n[this.nodesField]=[]),n[this.nodesField].add(t),this._updateParentAndLevel(t,n),this._doFilter(),this._dataChanged()},_updateParentAndLevel:function(t,e){var n=this;t._pid=e._id,t._level=e._level+1,t[n.parentField]=e[n.idField],t[n.parentField]||(t[n.parentField]=e._id),this.cascadeChild(t,function(t,e,i){t._pid=i._id,t._level=i._level+1,t[n.parentField]=i[n.idField]},this),this._setModified(t)},setCheckModel:function(t){this.checkModel=t},getCheckModel:function(){return this.checkModel},setOnlyLeafCheckable:function(t){this.onlyLeafCheckable=t},getOnlyLeafCheckable:function(){return this.onlyLeafCheckable},setAutoCheckParent:function(t){this.autoCheckParent=t},getAutoCheckParent:function(){return this.autoCheckParent},_doUpdateLoadedCheckedNodes:function(){for(var t=this.getList(),e=0,i=t.length;e<i;e++){var n=t[e];1==n.checked&&(0!=this.autoCheckParent&&this.hasChildNodes(n)||this._doUpdateNodeCheckState(n))}},_doUpdateNodeCheckState:function(t){if(t){var e=this.isChecked(t);if(("cascade"==this.checkModel||this.autoCheckParent)&&(this.cascadeChild(t,function(t){this.doCheckNodes(t,e)},this),!this.autoCheckParent)){(u=this.getAncestors(t)).reverse();for(var i=0,n=u.length;i<n;i++){for(var s=u[i],o=this.getChildNodes(s),r=!0,a=0,l=o.length;a<l;a++){var h=o[a];this.isCheckedNode(h)||(r=!1)}r?this.doCheckNodes(s,!0):this.doCheckNodes(s,!1),this.fire("checkchanged",{nodes:[s],_nodes:[s]})}}var d=this;if(this.autoCheckParent){var u;(u=this.getAncestors(t)).reverse();for(i=0,n=u.length;i<n;i++){(s=u[i]).checked=c(s),this.fire("checkchanged",{nodes:[s],_nodes:[s]})}}}function c(t){for(var e=d.getChildNodes(t),i=0,n=e.length;i<n;i++){var s=e[i];if(d.isCheckedNode(s))return!0}return!1}},doCheckNodes:function(t,e,i){if(t){"string"==typeof t&&(t=t.split(",")),mini.isArray(t)||(t=[t]),t=t.clone();var n=[];e=!1!==e,!0===i&&"single"==this.checkModel&&this.uncheckAllNodes();for(var s=t.length-1;0<=s;s--){var o=this.getRecord(t[s]);!o||e&&!0===o.checked||!e&&!0!==o.checked?o&&(
//if(!checked 
!0===i&&this._doUpdateNodeCheckState(o),e||this.isLeaf(o)||n.push(o)):(o.checked=e,n.push(o),!0===i&&this._doUpdateNodeCheckState(o))}var r=this;setTimeout(function(){r.fire("_checkchanged",{nodes:t,_nodes:n,checked:e})},1)}},checkNode:function(t,e){this.doCheckNodes([t],!0,!1!==e)},uncheckNode:function(t,e){this.doCheckNodes([t],!1,!1!==e)},checkNodes:function(t,e){mini.isArray(t)||(t=[]),this.doCheckNodes(t,!0,!1!==e)},uncheckNodes:function(t,e){mini.isArray(t)||(t=[]),this.doCheckNodes(t,!1,!1!==e)},checkAllNodes:function(){var t=this.getList();this.doCheckNodes(t,!0,!1)},uncheckAllNodes:function(){var t=this.getList();this.doCheckNodes(t,!1,!1)},doGetCheckedNodes:function(t,e){!1===e&&(e="leaf");for(var i=[],n={},s=0,o=t.length;s<o;s++){var r=t[s],a=this.isLeafNode(r);if(!0===e){n[r._id]||(n[r._id]=r,i.push(r));for(var l=this.getAncestors(r),h=0,d=l.length;h<d;h++){var u=l[h];n[u._id]||(n[u._id]=u,i.push(u))}}else"parent"===e?a||n[r._id]||(n[r._id]=r,i.push(r)):"leaf"===e?a&&(n[r._id]||(n[r._id]=r,i.push(r))):n[r._id]||(n[r._id]=r,i.push(r))}return i},getCheckedNodes:function(t){var e=[];return this.cascadeChild(this.root,function(t){1==t.checked&&e.push(t)}),e=this.doGetCheckedNodes(e,t)},
//                    if (!maps[node._id]) {
//                        if (!maps[anode._id]) {
//                    if (!isLeaf) {
//                        if (!maps[node._id]) {
//                        if (!maps[node._id]) {
//                    if (!maps[node._id]) {
getCheckedNodesId:function(t,e){var i=this.getCheckedNodes(t);return this.getValueAndText(i,e)[0]},getCheckedNodesText:function(t,e){var i=this.getCheckedNodes(t);return this.getValueAndText(i,e)[1]},isChecked:function(t){return(t=this.getRecord(t))?!0===t.checked||1===t.checked:null},getCheckState:function(t){if(!(t=this.getRecord(t)))return null;if(!0===t.checked)return"checked";if(!t[this.nodesField])return"unchecked";if(t.indeterminate)return"indeterminate";for(var e=this.getChildNodes(t,!0),i=0,n=e.length;i<n;i++){if(!0===(t=e[i]).checked)return"indeterminate"}return"unchecked"},getUnCheckableNodes:function(){var e=[];return this.cascadeChild(this.root,function(t){0==this.getCheckable(t)&&e.push(t)},this),e},setCheckable:function(t,e){if(t){mini.isArray(t)||(t=[t]),e=!!e;for(var i=(t=t.clone()).length-1;0<=i;i--){var n=this.getRecord(t[i]);n&&(n.checkable=checked)}}},getCheckable:function(t){return!!(t=this.getRecord(t))&&(!0===t.checkable||!1!==t.checkable&&(!!this.isLeafNode(t)||!this.onlyLeafCheckable))},showNodeCheckbox:function(t,e){},reload:function(t,e,i){this._loadingNode=null,this.load(this.loadParams,t,e,i)},_isNodeLoading:function(){return!!this._loadingNode},loadNode:function(r,a){var t={node:this._loadingNode=r};this.fire("beforeloadnode",t);var e=new Date,l=this;l._doLoadAjax(l.loadParams,null,null,null,function(o){var t=new Date-e;t<60&&(t=60-t),setTimeout(function(){o.node=r,l._OnPreLoad(o),l._loadingNode=null,l.loadParams&&delete l.loadParams[l.idField];var t=r[l.nodesField];l.removeNodes(t);var e=o.data;if(e&&0<e.length){l.collapse(r),l.addNodes(e,r);for(var i=l.getAllChildNodes(r),n=0,s=i.length;n<s;n++){delete i[n]._state}!1!==a?l.expand(r,!0):l.collapse(r,!0)}else delete r[l.leafField],l.expand(r,!0);l.fire("loadnode",o),l.fire("load",o)},t)},!0)}}),mini.regClass(mini.DataTree,"datatree"),mini._DataTableApplys={idField:"id",textField:"text",setAjaxData:function(t){this._dataSource.ajaxData=t},getby_id:function(t){return this._dataSource.getby_id(t)},getValueAndText:function(t,e){return this._dataSource.getValueAndText(t,e)},setIdField:function(t){this._dataSource.setIdField(t),this.idField=t},getIdField:function(){return this._dataSource.idField},setTextField:function(t){this._dataSource.setTextField(t),this.textField=t},getTextField:function(){return this._dataSource.textField},getLoadParams:function(){return this._dataSource.loadParams},clearData:function(){this._dataSource.clearData()},loadData:function(t){this._dataSource.loadData(t)},setData:function(t){this._dataSource.loadData(t)},getData:function(){return this._dataSource.getSource().clone()},getList:function(){return this._dataSource.getList()},getDataView:function(){return this._dataSource.getDataView()},getVisibleRows:function(){return this._useEmptyView?[]:this._dataSource.getVisibleRows()},toArray:function(){return this._dataSource.toArray()},getRecord:function(t){return"object"==typeof t?t:this._dataSource.getRecord(t)},getRow:function(t){return"object"==typeof t?t:this._dataSource.getRow(t)},getRange:function(t,e){if(!mini.isNull(t)&&!mini.isNull(e))return this._dataSource.getRange(t,e)},getAt:function(t){return this._dataSource.getAt(t)},indexOf:function(t){return this._dataSource.indexOf(t)},getRowByUID:function(t){return this._dataSource.getby_id(t)},getRowByUid:function(t){return this.getRowByUID(t)},getRowById:function(t){return this._dataSource.getbyId(t)},clearRows:function(){this._dataSource.clearData()},updateRow:function(t,e,i){this._dataSource.updateRecord(t,e,i)},addRow:function(t,e){var i=this._dataSource.insert(e,t);return this.validateOnAdd&&this.validateRow(t),i},removeRow:function(t,e){return this._dataSource.remove(t,e)},removeRows:function(t,e){return this._dataSource.removeRange(t,e)},removeSelected:function(){var t=this.getSelected();t&&this.removeRow(t,!0)},removeRowAt:function(t,e){return this._dataSource.removeAt(t,e)},moveRow:function(t,e){this._dataSource.move(t,e)},addRows:function(t,e){return this._dataSource.insertRange(e,t)},findRows:function(t,e){return this._dataSource.findRecords(t,e)},findRow:function(t,e){return this._dataSource.findRecord(t,e)},
//        if (select !== false) {
multiSelect:!1,setMultiSelect:function(t){this._dataSource.setMultiSelect(t),this.multiSelect=t},getMultiSelect:function(){return this._dataSource.getMultiSelect()},setCurrent:function(t){this._dataSource.setCurrent(t)},getCurrent:function(){return this._dataSource.getCurrent()},isSelected:function(t){return this._dataSource.isSelected(t)},setSelected:function(t){this._dataSource.setSelected(t)},getSelected:function(){return this._dataSource.getSelected()},getSelecteds:function(){return this._dataSource.getSelecteds()},select:function(t,e){this._dataSource.select(t,e)},selects:function(t,e){this._dataSource.selects(t,e)},deselect:function(t,e){this._dataSource.deselect(t,e)},deselects:function(t,e){this._dataSource.deselects(t,e)},selectAll:function(t){this._dataSource.selectAll(t)},deselectAll:function(t){this._dataSource.deselectAll(t)},clearSelect:function(t){this.deselectAll(t)},selectPrev:function(){this._dataSource.selectPrev()},selectNext:function(){this._dataSource.selectNext()},selectFirst:function(){this._dataSource.selectFirst()},selectLast:function(){this._dataSource.selectLast()},selectRange:function(t,e){this._dataSource.selectRange(t,e)},filter:function(t,e){this._dataSource.filter(t,e)},clearFilter:function(){this._dataSource.clearFilter()},sort:function(t,e,i){this._dataSource.sort(t,e,i)},clearSort:function(){this._dataSource.clearSort()},findItems:function(t,e,i){return this._dataSource.findRecords(i,e,i)},getResultObject:function(){return this._dataSource._resultObject||{}},isChanged:function(){return this._dataSource.isChanged()},getChanges:function(t,e){return this._dataSource.getChanges(t,e)},accept:function(){this._dataSource.accept()},reject:function(){this._dataSource.reject()},acceptRecord:function(t){this._dataSource.acceptRecord(t)},rejectRecord:function(t){this._dataSource.rejectRecord(t)}},mini._DataTreeApplys={addRow:null,removeRow:null,removeRows:null,removeRowAt:null,moveRow:null,setExpandOnLoad:function(t){this._dataSource.setExpandOnLoad(t)},getExpandOnLoad:function(){return this._dataSource.getExpandOnLoad()},isSelectedNode:function(t){return t=this.getNode(t),this.getSelectedNode()===t},selectNode:function(t,e){t?this._dataSource.select(t,e):this._dataSource.deselect(this.getSelectedNode(),e)},getSelectedNode:function(){return this.getSelected()},getSelectedNodes:function(){return this.getSelecteds()},updateNode:function(t,e,i){this._dataSource.updateRecord(t,e,i)},addNode:function(t,e,i){return this._dataSource.insertNode(t,e,i)},removeNodeAt:function(t,e){return this._dataSource.removeNodeAt(t,e)},removeNode:function(t){return this._dataSource.removeNode(t)},moveNode:function(t,e,i){this._dataSource.moveNode(t,e,i)},addNodes:function(t,e,i){return this._dataSource.addNodes(t,e,i)},insertNodes:function(t,e,i){return this._dataSource.insertNodes(e,t,i)},moveNodes:function(t,e,i){this._dataSource.moveNodes(t,e,i)},removeNodes:function(t){return this._dataSource.removeNodes(t)},expandOnLoad:!1,checkRecursive:!0,autoCheckParent:!1,showFolderCheckBox:!0,idField:"id",textField:"text",parentField:"pid",nodesField:"children",checkedField:"checked",leafField:"isLeaf",resultAsTree:!1,setShowFolderCheckBox:function(t){this._dataSource.setShowFolderCheckBox(t),this.doUpdate&&this.doUpdate(),this.showFolderCheckBox=t},getShowFolderCheckBox:function(){return this._dataSource.getShowFolderCheckBox()},setCheckRecursive:function(t){this._dataSource.setCheckRecursive(t),this.checkRecursive=t},getCheckRecursive:function(){return this._dataSource.getCheckRecursive()},setResultAsTree:function(t){this._dataSource.setResultAsTree(t)},getResultAsTree:function(t){return this._dataSource.resultAsTree},setParentField:function(t){this._dataSource.setParentField(t),this.parentField=t},getParentField:function(){return this._dataSource.parentField},setLeafField:function(t){this._dataSource.leafField=t,this.leafField=t},getLeafField:function(){return this._dataSource.leafField},setNodesField:function(t){this._dataSource.setNodesField(t),this.nodesField=t},getNodesField:function(){return this._dataSource.nodesField},setCheckedField:function(t){this._dataSource.checkedField=t,this.checkedField=t},getCheckedField:function(){return this.checkedField},findNodes:function(t,e){return this._dataSource.findRecords(t,e)},getLevel:function(t){return this._dataSource.getLevel(t)},isVisibleNode:function(t){return this._dataSource.isVisibleNode(t)},isEnabledNode:function(t){return this._dataSource.isEnabledNode(t)},isExpandedNode:function(t){return this._dataSource.isExpandedNode(t)},isCheckedNode:function(t){return this._dataSource.isCheckedNode(t)},isLeaf:function(t){return this._dataSource.isLeafNode(t)},hasChildren:function(t){return this._dataSource.hasChildren(t)},isAncestor:function(t,e){return this._dataSource.isAncestor(t,e)},getNode:function(t){return this._dataSource.getRecord(t)},getRootNode:function(){return this._dataSource.getRootNode()},getParentNode:function(t){return this._dataSource.getParentNode.apply(this._dataSource,arguments)},getAncestors:function(t){return this._dataSource.getAncestors(t)},getAllChildNodes:function(t){return this._dataSource.getAllChildNodes.apply(this._dataSource,arguments)},getChildNodes:function(t,e){return this._dataSource.getChildNodes.apply(this._dataSource,arguments)},getChildNodeAt:function(t,e){return this._dataSource.getChildNodeAt.apply(this._dataSource,arguments)},indexOfNode:function(t){return this._dataSource.indexOfNode.apply(this._dataSource,arguments)},hasChildNodes:function(t){return this._dataSource.hasChildNodes.apply(this._dataSource,arguments)},isFirstNode:function(t){return this._dataSource.isFirstNode.apply(this._dataSource,arguments)},isLastNode:function(t){return this._dataSource.isLastNode.apply(this._dataSource,arguments)},getNextNode:function(t){return this._dataSource.getNextNode.apply(this._dataSource,arguments)},getPrevNode:function(t){return this._dataSource.getPrevNode.apply(this._dataSource,arguments)},getFirstNode:function(t){return this._dataSource.getFirstNode.apply(this._dataSource,arguments)},getLastNode:function(t){return this._dataSource.getLastNode.apply(this._dataSource,arguments)},toggleNode:function(t){this._dataSource.toggle(t)},collapseNode:function(t,e){this._dataSource.collapse(t,e)},expandNode:function(t,e){this._dataSource.expand(t,e)},collapseAll:function(){this.useAnimation=!1,this._dataSource.collapseAll(),this.useAnimation=!0},expandAll:function(){this.useAnimation=!1,this._dataSource.expandAll(),this.useAnimation=!0},expandLevel:function(t){this.useAnimation=!1,this._dataSource.expandLevel(t),this.useAnimation=!0},collapseLevel:function(t){this.useAnimation=!1,this._dataSource.collapseLevel(t),this.useAnimation=!0},expandPath:function(t){this.useAnimation=!1,this._dataSource.expandPath(t),this.useAnimation=!0},collapsePath:function(t){this.useAnimation=!1,this._dataSource.collapsePath(t),this.useAnimation=!0},loadNode:function(t,e){this._dataSource.loadNode(t,e)},setCheckModel:function(t){this._dataSource.setCheckModel(t)},getCheckModel:function(){return this._dataSource.getCheckModel()},setOnlyLeafCheckable:function(t){this._dataSource.setOnlyLeafCheckable(t)},getOnlyLeafCheckable:function(){return this._dataSource.getOnlyLeafCheckable()},setAutoCheckParent:function(t){this._dataSource.setAutoCheckParent(t)},getAutoCheckParent:function(){return this._dataSource.getAutoCheckParent()},checkNode:function(t,e){this._dataSource.checkNode(t,e)},uncheckNode:function(t,e){this._dataSource.uncheckNode(t,e)},checkNodes:function(t,e){this._dataSource.checkNodes(t,e)},uncheckNodes:function(t,e){this._dataSource.uncheckNodes(t,e)},checkAllNodes:function(){this._dataSource.checkAllNodes()},uncheckAllNodes:function(){this._dataSource.uncheckAllNodes()},getCheckedNodes:function(){return this._dataSource.getCheckedNodes.apply(this._dataSource,arguments)},getCheckedNodesId:function(){return this._dataSource.getCheckedNodesId.apply(this._dataSource,arguments)},getCheckedNodesText:function(){return this._dataSource.getCheckedNodesText.apply(this._dataSource,arguments)},getNodesByValue:function(t){mini.isNull(t)&&(t=""),t=String(t);for(var e=[],i=String(t).split(","),n=0,s=i.length;n<s;n++){var o=this.getNode(i[n]);o&&e.push(o)}return e},isChecked:function(t){return this._dataSource.isChecked.apply(this._dataSource,arguments)},getCheckState:function(t){return this._dataSource.getCheckState.apply(this._dataSource,arguments)},setCheckable:function(t,e){this._dataSource.setCheckable.apply(this._dataSource,arguments)},getCheckable:function(t){return this._dataSource.getCheckable.apply(this._dataSource,arguments)},bubbleParent:function(t,e,i){this._dataSource.bubbleParent.apply(this._dataSource,arguments)},cascadeChild:function(t,e,i){this._dataSource.cascadeChild.apply(this._dataSource,arguments)},eachChild:function(t,e,i){this._dataSource.eachChild.apply(this._dataSource,arguments)}},mini.ColumnModel=function(t){this.owner=t,mini.ColumnModel.superclass.constructor.apply(this,arguments),this._init()},mini.ColumnModel_ColumnID=1,mini.extend(mini.ColumnModel,mini.Component,{_defaultColumnWidth:100,_init:function(){this.columns=[],this._columnsRow=[],this._visibleColumnsRow=[],this._bottomColumns=[],this._visibleColumns=[],this._idColumns={},this._nameColumns={},this._fieldColumns={}},getColumns:function(){return this.columns},getAllColumns:function(){var t=[];for(var e in this._idColumns){var i=this._idColumns[e];t.push(i)}return t},getColumnsRow:function(){return this._columnsRow},getVisibleColumnsRow:function(){return this._visibleColumnsRow},getBottomColumns:function(){return this._bottomColumns},getVisibleColumns:function(){return this._visibleColumns},_getBottomColumnsByColumn:function(t){t=this.getColumn(t);for(var e=this._bottomColumns,i=[],n=0,s=e.length;n<s;n++){var o=e[n];this.isAncestorColumn(t,o)&&i.push(o)}return i},_getVisibleColumnsByColumn:function(t){t=this.getColumn(t);for(var e=this._visibleColumns,i=[],n=0,s=e.length;n<s;n++){var o=e[n];this.isAncestorColumn(t,o)&&i.push(o)}return i},setColumns:function(t){mini.isArray(t)||(t=[]),this._init(),this.columns=t,this._columnsChanged()},_columnsChanged:function(){this._updateColumnsView(),this.fire("columnschanged")},columnDefaults:{allowCellWrap:!1},_updateColumnsView:function(){var r=this._maxColumnLevel=0;this.eachColumns(this,function l(t,e,i){if(t.type){mini.isNull(t.header)||"function"==typeof t.header||""==t.header.trim()&&delete t.header;var n=mini._getColumn(t.type);if(n){var s=mini.copyTo({},t);mini.copyTo(t,n),mini.copyTo(t,s)}}t._id||(t._id=mini.ColumnModel_ColumnID++),t._pid=i==this?-1:i._id,(this._idColumns[t._id]=t).name&&(this._nameColumns[t.name]=t),t._level=r,r+=1,this.eachColumns(t,l,this),r-=1,t._level>this._maxColumnLevel&&(this._maxColumnLevel=t._level);var o=parseInt(t.width);mini.isNumber(o)&&String(o)==t.width&&(t.width=o+"px"),mini.isNull(t.width)&&(t.width=this._defaultColumnWidth+"px"),String(t.width).indexOf("px")&&(t.pxWidth=parseInt(t.width)),t.visible=!1!==t.visible,t.allowResize=!1!==t.allowResize,t.allowMove=!1!==t.allowMove,t.allowSort=!0===t.allowSort,t.allowDrag=!!t.allowDrag,t.readOnly=!!t.readOnly,
//column.autoEscape = column.autoEscape !== false;
t.autoEscape=!!t.autoEscape,t.enabled=!1!==t.enabled,t.showCellTip=!1!==t.showCellTip,t.valueFromSelect=!1!==t.valueFromSelect,t.vtype=t.vtype||"",null==t.allowCellWrap&&(t.allowCellWrap=this.columnDefaults.allowCellWrap),"string"==typeof t.filter&&(t.filter=window.eval("("+t.filter+")")),t.filter&&!t.filter.el&&(t.filter=mini.create(t.filter)),"function"==typeof t.init&&1!=t.inited&&t.init(this.owner),t.inited=!0,t._gridUID=this.owner.uid,t._rowIdField=this.owner._rowIdField},this),this._createColumnsRow();var e=0,i=this._visibleColumns=[],n=this._bottomColumns=[];this.cascadeColumns(this,function(t){t.columns&&0!=t.columns.length||(n.push(t),this.isVisibleColumn(t)&&(i.push(t),t._index=e++))},this),this._fieldColumns={};for(var t=this.getAllColumns(),s=0,o=t.length;s<o;s++){var a=t[s];a.field&&!this._fieldColumns[a.field]&&(this._fieldColumns[a.field]=a)}this._createFrozenColSpan()},_frozenStartColumn:-1,_frozenEndColumn:-1,_frozenRightStartColumn:-1,_frozenRightEndColumn:-1,isFrozen:function(){return 0<=this._frozenStartColumn&&this._frozenEndColumn>=this._frozenStartColumn},isFrozenRight:function(){return 0<=this._frozenRightStartColumn&&this._frozenRightEndColumn>=this._frozenRightStartColumn},isFrozenColumn:function(t){if(!this.isFrozen())return!1;if(!(t=this.getColumn(t)))return!1;var e=this.getVisibleColumns().indexOf(t);return this._frozenStartColumn<=e&&e<=this._frozenEndColumn},isFrozenRightColumn:function(t){if(!this.isFrozenRight())return!1;if(!(t=this.getColumn(t)))return!1;var e=this.getVisibleColumns().indexOf(t);return this._frozenRightStartColumn<=e&&e<=this._frozenRightEndColumn},frozen:function(t,e){t=this.getColumn(t),e=this.getColumn(e);var i=this.getVisibleColumns();this._frozenStartColumn=i.indexOf(t),this._frozenEndColumn=i.indexOf(e),t&&e&&this._columnsChanged()},frozenRight:function(t,e){t=this.getColumn(t),e=this.getColumn(e);var i=this.getVisibleColumns();this._frozenRightStartColumn=i.indexOf(t),this._frozenRightEndColumn=i.indexOf(e),t&&e&&this._columnsChanged()},unFrozen:function(){this._frozenStartColumn=-1,this._frozenEndColumn=-1,this._frozenRightStartColumn=-1,this._frozenRightEndColumn=-1,this._columnsChanged()},setFrozenStartColumn:function(t){this.frozen(t,this._frozenEndColumn)},setFrozenEndColumn:function(t){this.frozen(this._frozenStartColumn,t)},setFrozenRightStartColumn:function(t){this.frozenRight(t,this._frozenRightEndColumn)},setFrozenRightEndColumn:function(t){this.frozenRight(this._frozenRightStartColumn,t)},getFrozenColumns:function(){for(var t=[],e=this.isFrozen(),i=0,n=this._visibleColumns.length;i<n;i++)e&&this._frozenStartColumn<=i&&i<=this._frozenEndColumn&&t.push(this._visibleColumns[i]);return t},getFrozenRightColumns:function(){for(var t=[],e=this.isFrozenRight(),i=0,n=this._visibleColumns.length;i<n;i++)e&&this._frozenRightStartColumn<=i&&i<=this._frozenRightEndColumn&&t.push(this._visibleColumns[i]);return t},getUnFrozenColumns:function(){for(var t=[],e=this.isFrozen(),i=this.isFrozenRight(),n=0,s=this._visibleColumns.length;n<s;n++)e||i?e&&i?this._frozenEndColumn<n&&n<this._frozenRightStartColumn&&t.push(this._visibleColumns[n]):e&&!i?this._frozenEndColumn<n&&t.push(this._visibleColumns[n]):!e&&i&&n<this._frozenRightStartColumn&&t.push(this._visibleColumns[n]):t.push(this._visibleColumns[n]);return t},getFrozenColumnsRow:function(){return this.isFrozen()?this._columnsRow1:[]},getFrozenRightColumnsRow:function(){return this.isFrozenRight()?this._columnsRow3:[]},getUnFrozenColumnsRow:function(){return this.isFrozen()||this.isFrozenRight()?this._columnsRow2:this.getVisibleColumnsRow()},_createFrozenColSpan:function(){var a=this,o=this.getVisibleColumns(),r=this._frozenStartColumn,l=this._frozenEndColumn,h=this._frozenRightStartColumn,d=this._frozenRightEndColumn,u=this.isFrozen(),c=this.isFrozenRight();function m(t,e){if(a.isBottomColumn(t)){var i=o.indexOf(t);if(0==e&&i<r)return!0;if(1==e&&r<=i&&i<=l)return!0;if(2==e){if(u&&c)return l<i&&i<h;if(!u&&!c)return!0;if(u&&!c)return l<i;if(!u&&c)return i<h}if(3==e&&h<=i&&i<=d)return!0;if(4==e&&d<i&&-1!=d)return!0}else for(var n=a._getVisibleColumnsByColumn(t),s=0;s<5;s++)if(e==s)return n.some(function(t){return t["viewIndex"+s]||m(t,s)});return!1}function t(t,e){for(var i=mini.treeToList(t.columns,"columns"),n=0,s=0,o=i.length;s<o;s++){var r=i[s];0!=a.isVisibleColumn(r)&&0!=m(r,e)&&(r.columns&&0!=r.columns.length||(n+=1))}return n}for(var e=mini.treeToList(this.columns,"columns"),i=0,n=e.length;i<n;i++){var s=e[i];delete s.colspan0,delete s.colspan1,delete s.colspan2,delete s.colspan3,delete s.colspan4,delete s.viewIndex0,delete s.viewIndex1,delete s.viewIndex2,delete s.viewIndex3,delete s.viewIndex4,(this.isFrozen()||this.isFrozenRight())&&(s.columns&&0<s.columns.length?(s.colspan0=t(s,0),s.colspan1=t(s,1),s.colspan2=t(s,2),s.colspan3=t(s,3),s.colspan4=t(s,4)):(s.colspan0=1,s.colspan1=1,s.colspan2=1,s.colspan3=1,s.colspan4=1),m(s,0)&&(s.viewIndex0=!0),m(s,1)&&(s.viewIndex1=!0),m(s,2)&&(s.viewIndex2=!0),m(s,3)&&(s.viewIndex3=!0),m(s,4)&&(s.viewIndex4=!0))}this._getMaxColumnLevel();this._columnsRow1=[],this._columnsRow2=[],this._columnsRow3=[];for(i=0,n=this._visibleColumnsRow.length;i<n;i++){var f=this._visibleColumnsRow[i],p=[],g=[],_=[];this._columnsRow1.push(p),this._columnsRow2.push(g),this._columnsRow3.push(_);for(var v=0,y=f.length;v<y;v++){var w=f[v];w.viewIndex1&&p.push(w),w.viewIndex2&&g.push(w),w.viewIndex3&&_.push(w)}}},_createColumnsRow:function(){for(var t=this._getMaxColumnLevel(),e=[],i=[],n=0,s=t;n<=s;n++)e.push([]),i.push([]);var r=this;function o(t){for(var e=mini.treeToList(t.columns,"columns"),i=0,n=0,s=e.length;n<s;n++){var o=e[n];0!=r.isVisibleColumn(o)&&(o.columns&&0!=o.columns.length||(i+=1))}return i}var a=mini.treeToList(this.columns,"columns");for(n=0,s=a.length;n<s;n++){var l=a[n],h=e[l._level],d=i[l._level];delete l.rowspan,delete l.colspan,l.columns&&0<l.columns.length&&(l.colspan=o(l)),(!l.columns||0==l.columns.length)&&l._level<t&&(l.rowspan=t-l._level+1),h.push(l),this.isVisibleColumn(l)&&d.push(l)}this._columnsRow=e,this._visibleColumnsRow=i},_getMaxColumnLevel:function(){return this._maxColumnLevel},cascadeColumns:function(t,e,i){if(e){var n=t.columns;if(n)for(var s=0,o=(n=n.clone()).length;s<o;s++){var r=n[s];if(!1===e.call(i||this,r,s,t))return;this.cascadeColumns(r,e,i)}}},eachColumns:function(t,e,i){var n=t.columns;if(n)for(var s=n.clone(),o=0,r=s.length;o<r;o++){var a=s[o];if(!1===e.call(i,a,o,t))break}},getColumn:function(t){var e=typeof t;return"number"==e?this._bottomColumns[t]:"object"==e?t:this._nameColumns[t]},getColumnByField:function(t){return t?this._fieldColumns[t]:null},_getColumnById:function(t){return this._idColumns[t]},_getDataTypeByField:function(t){for(var e="string",i=this.getBottomColumns(),n=0,s=i.length;n<s;n++){var o=i[n];if(o.field==t){o.sortType?e=o.sortType.toLowerCase():o.dataType&&(e=o.dataType.toLowerCase());break}}
//        if(!sortType 
return e},getParentColumn:function(t){var e=(t=this.getColumn(t))._pid;return-1==e?this:this._idColumns[e]},getAncestorColumns:function(t){for(var e=[t];;){var i=this.getParentColumn(t);if(!i||i==this)break;t=e[e.length]=i}return e.reverse(),e},isAncestorColumn:function(t,e){if(t==e)return!0;if(!t||!e)return!1;for(var i=this.getAncestorColumns(e),n=0,s=i.length;n<s;n++)if(i[n]==t)return!0;return!1},isVisibleColumn:function(t){if(0==(t=this.getColumn(t)).visible)return!1;for(var e=this.getAncestorColumns(t),i=0,n=e.length;i<n;i++)if(0==e[i].visible)return!1;var s=t.columns;if(s){var o=!0;for(i=0,n=s.length;i<n;i++){var r=s[i];if(this.isVisibleColumn(r)){o=!1;break}}if(o)return!1}return!0},isBottomColumn:function(t){return!((t=this.getColumn(t)).columns&&0<t.columns.length)},updateColumn:function(t,e){(t=this.getColumn(t))&&(mini.copyTo(t,e),this._columnsChanged())},moveColumn:function(t,e,i){if(t=this.getColumn(t),e=this.getColumn(e),t&&e&&i&&t!=e&&!this.isAncestorColumn(t,e)){var n=this.getParentColumn(t);n&&n.columns.remove(t);var s=e,o=i;if("before"==o)o=(s=this.getParentColumn(e)).columns.indexOf(e);else if("after"==o)o=(s=this.getParentColumn(e)).columns.indexOf(e)+1;else if("add"==o||"append"==o)s.columns||(s.columns=[]),o=s.columns.length;else if(!mini.isNumber(o))return;s.columns.insert(o,t),this._columnsChanged()}},addColumn:function(t){t&&(delete t._id,this._columnsChanged())},removeColumn:function(){this._columnsChanged()}}),mini.GridView=function(){if(this._createTime=new Date,this._createColumnModel(),this._bindColumnModel(),this.data=[],this._createSource(),this._bindSource(),this._initData(),mini.GridView.superclass.constructor.apply(this,arguments),this._doUpdateFilterRow(),this._doUpdateSummaryRow(),this.doUpdate(),mini.isNull(this._paddingTop)){if(mini.isNull(mini.GridView._paddingTop)){var t=jQuery('<div class="mini-grid-cell-inner" style="position:absolute;left:-1000px;top:-1000px;"></div>').appendTo("body"),e=mini.getPaddings(t);mini.GridView._paddingTop=e.top,mini.GridView._paddingBottom=e.bottom}this._paddingTop=mini.GridView._paddingTop,this._paddingBottom=mini.GridView._paddingBottom}this._rowClsHash={}},mini.extend(mini.GridView,mini.Panel,{_displayStyle:"block",_rowIdField:"_id",width:"100%",showSortIcon:!1,showColumns:!0,showFilterRow:!1,showSummaryRow:!1,summaryRows:1,showPager:!1,allowCellWrap:!1,allowHeaderWrap:!1,showModified:!0,showNewRow:!0,showEmptyText:!1,emptyText:"No data returned.",showHGridLines:!0,showVGridLines:!0,_rowCls:"mini-grid-row",_cellCls:"mini-grid-cell",_headerCellCls:"mini-grid-headerCell",_rowSelectedCls:"mini-grid-row-selected",_rowHoverCls:"mini-grid-row-hover",_cellSelectedCls:"mini-grid-cell-selected",defaultRowHeight:51,fixedRowHeight:!1,isFixedRowHeight:function(){return this.fixedRowHeight},fitColumns:!0,isFitColumns:function(){return this.fitColumns},allowAlternating:!1,_alternatingCls:"mini-grid-row-alt",getAllowAlternating:function(){return this.allowAlternating},setAllowAlternating:function(t){this.allowAlternating=t,this.doUpdate()},showGroupSummary:!1,getShowGroupSummary:function(){return this.showGroupSummary},setShowGroupSummary:function(t){this.showGroupSummary=t},summaryPosition:"bottom",getSummaryPosition:function(){return this.summaryPosition},setSummaryPosition:function(t){this.summaryPosition=t,"top"==this.summaryPosition&&(mini.before(this._rowsEl,this._summaryEl),mini.before(this._summaryViewEl,this._summaryLockEl)),jQuery(this.el).toggleClass("mini-grid-summary-top","top"==t)},uiCls:"mini-gridview",_create:function(){mini.GridView.superclass._create.call(this);var t=this.el;mini.addClass(t,"mini-grid"),mini.addClass(this._borderEl,"mini-grid-border"),mini.addClass(this._viewportEl,"mini-grid-viewport");this._columnsEl=mini.after(this._toolbarEl,'<div class="mini-grid-columns"><div class="mini-grid-columns-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._filterEl=mini.after(this._columnsEl,'<div class="mini-grid-filterRow"><div class="mini-grid-filterRow-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._rowsEl=this._bodyEl,mini.addClass(this._rowsEl,"mini-grid-rows"),this._summaryEl=mini.after(this._rowsEl,'<div class="mini-grid-summaryRow"><div class="mini-grid-summaryRow-view"></div><div class="mini-grid-scrollHeaderCell"></div></div>'),this._bottomPagerEl=mini.after(this._summaryEl,'<div class="mini-grid-pager"></div>'),this._columnsViewEl=this._columnsEl.childNodes[0],this._rowsViewEl=mini.append(this._rowsEl,'<div class="mini-grid-rows-view"><div class="mini-grid-rows-content"></div></div>'),this._rowsViewContentEl=this._rowsViewEl.firstChild,this._filterViewEl=this._filterEl.childNodes[0],this._summaryViewEl=this._summaryEl.childNodes[0];this._focusEl=mini.append(this._borderEl,'<a href="#" class="mini-grid-focus" style="position:absolute;left:0px;top:0px;width:0px;height:0px;outline:none;" hideFocus onclick="return false" ></a>');var e=this;mini.on(this._filterViewEl,"scroll",function(t){0<e._filterViewEl.scrollLeft&&(e._filterViewEl.scrollLeft=0)})},destroy:function(t){if(this._dataSource&&(this._dataSource.destroy(),this._dataSource=null),this._columnModel&&(this._columnModel.destroy(),this._columnModel=null),this._pagers){for(var e=this._pagers.clone(),i=0,n=e.length;i<n;i++)e[i].destroy(t);this._pagers=null}this._viewportEl&&mini.clearEvent(this._viewportEl),this._rowsViewEl&&mini.clearEvent(this._rowsViewEl),this._rowsEl&&mini.clearEvent(this._rowsEl),this._vscrollEl&&mini.clearEvent(this._vscrollEl),this._headerEl&&mini.clearEvent(this._headerEl),this._columnsEl&&(jQuery(this._columnsEl).unbind("mouseenter"),jQuery(this._columnsEl).unbind("mouseleave")),this._columnsEl=this._rowsEl=this._filterEl=this._summaryEl=this._bottomPagerEl=null,this._columnsViewEl=this._topRightCellEl=this._rowsViewEl=this._rowsViewContentEl=null,this._filterViewEl=this._summaryViewEl=this._focusEl=null,this._viewportEl=this._vscrollEl=this._bottomPager=null,mini.GridView.superclass.destroy.call(this,t)},_initEvents:function(){mini.GridView.superclass._initEvents.call(this),this._bindScrollEvent()},_bindScrollEvent:function(){var t=this;this.isFrozenRight()?(t._rowsViewEl.style.overflowX="auto",t._rowsViewEl.style.overflowY="hidden",t._rowsLockContentEl.style.padding="0px",t._rowsRightLockContentEl.style.padding="0px",this._showVs?t._rowsRightLockEl.style.overflow="hidden":(t._rowsRightLockEl.style.overflowX="hidden",t._rowsRightLockEl.style.overflowY="auto")):this._showVs?(t._rowsViewEl.style.overflowX="auto",t._rowsViewEl.style.overflowY="hidden"):t._rowsViewEl.style.overflow="auto",this._unbindScrollEvent(),this._scrollBindTimer=setTimeout(function(){t.isFrozenRight()&&mini.on(t._rowsRightLockEl,"scroll",t.__OnRowViewScroll,t),mini.on(t._rowsViewEl,"scroll",t.__OnRowViewScroll,t)},100)},_unbindScrollEvent:function(){this._scrollBindTimer&&(clearTimeout(this._scrollBindTimer),this._scrollBindTimer=null),this.isFrozenRight()?mini.un(this._rowsRightLockEl,"scroll",this.__OnRowViewScroll,this):mini.un(this._rowsViewEl,"scroll",this.__OnRowViewScroll,this)},_syncScrollOffset:function(t,e){this._unbindScrollEvent(),null!=t&&(this._rowsViewEl.scrollLeft=t),null!=e&&(this._rowsViewEl.scrollTop=e,this._vscrollEl),this._bindScrollEvent()},_sizeChanged:function(){mini.GridView.superclass._sizeChanged.call(this);var t=this.isAutoHeight();mini.isIE&&(t?mini.addClass(this._rowsViewEl,"mini-grid-hidden-y"):mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y"))},_setBodyWidth:!1,doLayoutCardView:function(){var t=this._rowsViewEl.scrollHeight>this._rowsViewEl.clientHeight+1,e=this._columnsViewEl.firstChild,i=t?mini.getScrollOffset():0;e.parentNode.style.paddingRight=i+"px",e.style.width="100%"},doLayout:function(){if(this.canLayout())if(mini.GridView.superclass.doLayout.call(this),this._stopLayout(),"cardview"!=this.viewType){var t=this._autoHeight;mini.isIE&&(t?mini.addClass(this._rowsViewEl,"mini-grid-hidden-y"):mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y"));var e=this.isFitColumns(),i=this.isFrozenRight(),n=this._columnsViewEl.firstChild,s=this._rowsViewContentEl.firstChild,o=this._filterViewEl.firstChild,r=this._summaryViewEl.firstChild,a=o.offsetHeight,l=this._rowsViewEl.scrollHeight>this._rowsViewEl.clientHeight+1,h=this._rowsViewContentEl.parentNode.offsetWidth-(l?mini.getScrollOffset():0);c.call(this,n),c.call(this,o),c.call(this,r);var d=s.parentNode.parentNode;e&&(s.style.width="100%",d.style.width="auto"),this._syncScroll();var u=this;setTimeout(function(){mini.layout(u._filterEl),mini.layout(u._summaryEl)},10),mini.isIE10&&(setTimeout(function(){u.isFitColumns()?(n.style.width="auto",n.offsetWidth,n.style.width="100%"):n.style.width="0px"},0),mini.repaint(s)),this._filterViewEl.style.height=a+"px",o.style.width=this.isFitColumns()?h+"px":""}else this.doLayoutCardView();function c(t){e?mini.isSafari||mini.isIE6?t.style.width=h+"px":l?(t.style.width="100%",t.parentNode.style.width="auto",o!=t&&(t.parentNode.style.paddingRight=i?"0px":mini.getScrollOffset()+"px"),mini.isIE8&&mini.removeClass(this._rowsViewEl,"mini-grid-hidden-y")):(t.style.width="100%",t.parentNode.style.width="auto",t.parentNode.style.paddingRight="0px",mini.isIE8&&mini.addClass(this._rowsViewEl,"mini-grid-hidden-y")):(t.style.width="0px",mini.isSafari||mini.isChrome||mini.isIE6||(t.parentNode.style.width="100%",t.parentNode.style.paddingRight="0px"))}},setBody:function(){},_createTopRowHTML:function(t,e,i){var n="";mini.isIE?mini.isIE6||mini.isIE7||!mini.boxModel?n+='<tr class="datagrid-columns-width-tr" style="display:none;height:0px;">':n+='<tr class="datagrid-columns-width-tr" style="height:0px;">':mini.isChrome&&i&&0==i.length?n+='<tr class="datagrid-columns-width-tr" style="height:1px;">':n+='<tr class="datagrid-columns-width-tr" style="height:0px;">',!1!==this._userEmptyTd&&(n+='<td style="height:0px;width:0;"></td>');for(var s=0,o=t.length;s<o;s++){var r=t[s],a=r.width;if(n+='<td id="'+r._id+'" ',"100%"===r.width&&(n+='class="datagrid-autowidth-column" data-min-width="'+(r.minWidth?r.minWidth:"100")+'"'),n+='style="padding:0;border:0;margin:0;height:0px;',r.width){a=r.width;if(/px$/.test(r.width)){var l=parseInt(r.width,10)/100;l&&(a+=";width:"+l+"rem")}n+="width:"+a}r.minWidth&&(n+=";min-width:"+r.minWidth+"px"),n+='" ></td>'}return n+='<td style="width:0px;"></td>',n+="</tr>"},_createColumnsHTML:function(t,e,i){i=i||this.getVisibleColumns();var n=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];n.push(this._createTopRowHTML(i));for(var s=this.getSortField(),o=this.getSortOrder(),r=0,a=t.length;r<a;r++){var l=t[r];n[n.length]="<tr>",n[n.length]='<td style="width:0;"></td>';for(var h=0,d=l.length;h<d;h++){var u=l[h],c=u.sortField||u.field,m=this._createHeaderText(u,e),f=this._createHeaderCellId(u,e),p="";s&&s==c&&(p="asc"==o?"mini-grid-asc":"mini-grid-desc");var g="";0==this.allowHeaderWrap&&(g=" mini-grid-headerCell-nowrap "),n[n.length]='<td id="',n[n.length]=f,n[n.length]='" class="mini-grid-headerCell '+p+" "+(u.headerCls||"")+" ",u.columns&&0<u.columns.length||(n[n.length]=" mini-grid-bottomCell "),h==d-1&&(n[n.length]=" mini-grid-rightCell "),n[n.length]='" style="',u.headerStyle&&(n[n.length]=u.headerStyle+";"),u.headerAlign&&(n[n.length]="text-align:"+u.headerAlign+";"),n[n.length]='" ',u.rowspan&&(n[n.length]='rowspan="'+u.rowspan+'" '),this._createColumnColSpan(u,n,e),n[n.length]='><div class="mini-grid-headerCell-outer"><div class="mini-grid-headerCell-inner '+g+'">',n[n.length]=m,p?n[n.length]='<span class="mini-grid-sortIcon mini-icon"></span>':this.showSortIcon&&u.allowSort&&(n[n.length]='<span class="mini-grid-allowsort mini-icon"></span>'),n[n.length]='</div><div id="'+u._id+'" class="mini-grid-column-splitter"></div>',n[n.length]="</div></td>"}(this.isFrozen()&&1==e||this.isFrozenRight&&3==e)&&(n[n.length]='<td class="mini-grid-headerCell" style="width:0;"><div class="mini-grid-headerCell-inner" style="',n[n.length]='">0</div></td>'),n[n.length]="</tr>"}return n.push("</table>"),n.join("")},_createHeaderText:function(t,e){var i=t.header;return"function"==typeof i&&(i=i.call(this,t)),!mini.isNull(i)&&""!==i||(i="&nbsp;"),i},_createColumnColSpan:function(t,e,i){t.colspan&&(e[e.length]='colspan="'+t.colspan+'" ')},doUpdateColumns:function(){var t=this._columnsViewEl.scrollLeft,e=this.getVisibleColumnsRow(),i=this._createColumnsHTML(e,2);i+='<div class="mini-grid-topRightCell"></div>',this._columnsViewEl.innerHTML=i,mini[["addClass","removeClass"][0<this._columnModel._maxColumnLevel?0:1]](this._viewportEl,"mini-grid-composite-columns"),this._columnsViewEl.scrollLeft=t},doUpdate:function(){if(0!=this.canUpdate()){var t=this;this._bindScrollEvent();var e=this._isCreating();new Date;this._doUpdateSummaryRow();var i=this,n=this.getScrollLeft();i.doUpdateColumns(),e&&(this._useEmptyView=!0),this._doRemoveRowContent(),"cardview"==t.viewType?i.updateCardView():i.doUpdateRows(),0<n&&i.isVirtualScroll()&&i._syncScrollOffset(n),e&&(this._useEmptyView=!1),i.doLayout(),e&&!this._doUpdateTimer&&(this._doUpdateTimer=setTimeout(function s(){i.el&&(i.doUpdateColumns(),"cardview"==t.viewType?i.updateCardView():i.doUpdateRows(),i.doLayout(),i._doUpdateTimer=null)},15)),this.unmask(),t._fireUpdateTimer&&(clearTimeout(t._fireUpdateTimer),t._fireUpdateTimer=null),t._fireUpdateTimer=setTimeout(function(){t._fireUpdateTimer=null,t.fire("update")},100)}},_doRemoveRowContent:function(){this._rowsViewContentEl&&this._rowsViewContentEl.firstChild&&this._rowsViewContentEl.removeChild(this._rowsViewContentEl.firstChild),this._rowsLockContentEl&&this._rowsLockContentEl.firstChild&&this._rowsLockContentEl.removeChild(this._rowsLockContentEl.firstChild)},_isCreating:function(){return new Date-this._createTime<1e3},deferUpdate:function(t){if(t=t||5,!this._updateTimer&&!this._doUpdateTimer){var e=this;this._updateTimer=setTimeout(function(){e._updateTimer=null,e.doUpdate()},t)}},_stopDeferUpdate:function(){this._updateTimer&&(clearTimeout(this._updateTimer),this._updateTimer=null)},_pushUpdateCallback:function(t,e,i){var n=0;(this._doUpdateTimer||this._updateTimer)&&(n=20),0==n?t.apply(e,i):setTimeout(function(){t.apply(e,i)},n)},_updateCount:0,beginUpdate:function(){this._updateCount++},endUpdate:function(t){this._updateCount--,0!=this._updateCount&&!0!==t||(this._updateCount=0,this.doUpdate())},canUpdate:function(){return 0==this._updateCount},setDefaultRowHeight:function(t){this.defaultRowHeight=t},getDefaultRowHeight:function(){return this.defaultRowHeight},_getRowHeight:function(t){var e=this.defaultRowHeight;return t._height&&(e=parseInt(t._height),isNaN(parseInt(t._height))&&(e=rowHeight)),e=e-this._paddingTop-this._paddingBottom,
//if (!mini.isOpera) {
e-=1},_createGroupingHTML:function(s,o){var t=this.getGroupingView(),e=this.showGroupSummary,i=this.isFrozen(),r=0,a=this;function n(t){if(h.push('<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'),0<s.length){h.push(a._createTopRowHTML(s));for(var e=0,i=t.length;e<i;e++){var n=t[e];a._createRowHTML(n,r++,s,o,h)}}h.push("</table>")}var l=!1!==this.groupTitleCollapsible,h=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];h.push(this._createTopRowHTML(s));for(var d=0,u=t.length;d<u;d++)if(1!=o||this.isFrozen()){var c=t[d],m=this._createRowGroupId(c,o),f=this._createRowGroupRowsId(c,o),p=this._OnDrawGroup(c),g=c.expanded?"":" mini-grid-group-collapse ";h[h.length]='<tr id="',h[h.length]=m,h[h.length]='" class="mini-grid-groupRow',h[h.length]=g,h[h.length]='"><td style="width:0;"></td><td class="mini-grid-groupCell ',h[h.length]=p.cls,h[h.length]='" style="',h[h.length]=p.style,h[h.length]='" colspan="',h[h.length]=s.length,h[h.length]='"><div class="mini-grid-groupHeader ',l&&(h[h.length]="mini-grid-groupHeader-collapsible"),h[h.length]='">',!i||i&&1==o?(h[h.length]='<div class="mini-grid-group-ecicon"></div>',h[h.length]='<div class="mini-grid-groupTitle">'+p.cellHtml+"</div>"):h[h.length]="&nbsp;",h[h.length]="</div></td></tr>";var _=c.expanded?"":"display:none";if(h[h.length]='<tr class="mini-grid-groupRows-tr" style="',h[h.length]='"><td style="width:0;"></td><td class="mini-grid-groupRows-td" colspan="',h[h.length]=s.length,h[h.length]='"><div id="',h[h.length]=f,h[h.length]='" class="mini-grid-groupRows" style="',mini.isChrome&&(h[h.length]="margin-left:-1px;"),h[h.length]=_,h[h.length]='">',n(c.rows),h[h.length]="</div></td></tr>",e&&0<s.length){h[h.length]='<tr class="mini-grid-groupFooter">',h[h.length]='<td style="width:0;"></td>';for(var v=0,y=s.length;v<y;v++){var w=s[v];m="",p=this._OnDrawSummaryCell(c.rows,w,c);h[h.length]='<td id="',h[h.length]=m,h[h.length]='" class="mini-grid-cell '+p.cellCls+'" style="'+p.cellStyle+";",h[h.length]='"><div class="mini-grid-cell-inner">',h[h.length]=p.cellHtml,h[h.length]="</div></td>"}h[h.length]="</tr>"}}return h.push("</table>"),h.join("")},_isFastCreating:function(){return 50<this.getVisibleRows().length&&(this._isCreating()||this.getScrollTop()<50*this._defaultRowHeight)},isShowRowDetail:function(t){return!1},isCellValid:function(t,e){return!0},updateCardView:function(){for(var t=this.getVisibleRows(),e=(this.getVisibleColumns(),[]),i=0,n=t.length;i<n;i++){var s=t[i],o={rowCls:"",rowStyle:""},r=this.itemRenderer(s,i,o,this);e[e.length]='<div class="mini-grid-row ',e[e.length]=o.rowCls,e[e.length]='" style="',e[e.length]=o.rowStyle,e[e.length]='" id="',e[e.length]=this._createRowId(s,1),e[e.length]='">',e[e.length]=r,e[e.length]="</div>"}this._rowsViewContentEl.innerHTML=e.join("")},itemRenderer:function(t,e,i,n){return""},_createRowHTML:function(t,e,i,n,s){var o=!s;s=s||[];var r="",a=this.isFixedRowHeight();a&&(r=this._getRowHeight(t));var l,h,d=this.defaultRowHeight-1,u=" ",c=" ";s[s.length]='<tr class="mini-grid-row ',"added"==t._state&&this.showNewRow&&(s[s.length]="mini-grid-newRow "),this.isShowRowDetail(t)&&(s[s.length]="mini-grid-expandRow "),this.allowAlternating&&e%2==1&&(s[s.length]=this._alternatingCls,s[s.length]=" ");var m=this._rowClsHash[t._id];m&&(s[s.length]=m.join(" "),s[s.length]=" "),this._dataSource.isSelected(t)&&(s[s.length]=this._rowSelectedCls,s[s.length]=" "),l=s.length,s[s.length]=u,s[s.length]='" style="',h=s.length,s[s.length]=c,s[s.length]='" id="',s[s.length]=this._createRowId(t,n),!(s[s.length]='">')!==this._userEmptyTd&&(s[s.length]='<td style="width:0;"></td>');
//if (!_rowClsSb || _rowClsSb.indexOf(this._rowSelectedCls) == -1) {
for(var f=this._currentCell,p=0,g=i.length;p<g;p++){var _=i[p],v=this._createCellId(t,_),y=this._OnDrawCell(t,_,e,_._index);null!==y.cellHtml&&y.cellHtml!==undefined&&""!==y.cellHtml||(y.cellHtml="&nbsp;"),s[s.length]="<td ",y.rowSpan&&(s[s.length]='rowspan="'+y.rowSpan+'"'),y.colSpan&&(s[s.length]='colspan="'+y.colSpan+'"'),s[s.length]=' id="',s[s.length]=v,s[s.length]='" class="mini-grid-cell ',this.isCellValid(t,_)||(s[s.length]=" mini-grid-cell-error "),p==g-1&&(s[s.length]=" mini-grid-rightCell "),y.cellCls&&(s[s.length]=" "+y.cellCls+" "),f&&f[0]==t&&f[1]==_&&(s[s.length]=" ",s[s.length]=this._cellSelectedCls),s[s.length]='" style="',0==y.showHGridLines&&(s[s.length]="border-bottom:0;"),0==y.showVGridLines&&(s[s.length]="border-right:0;"),y.visible||(s[s.length]="display:none;"),_.align&&(s[s.length]="text-align:",s[s.length]=_.align,s[s.length]=";"),y.cellStyle&&(s[s.length]=y.cellStyle),s[s.length]='">',s[s.length]='<div class="mini-grid-cell-inner ';var w=_.allowCellWrap;(w=w||y.allowCellWrap)||(
//if (!e.allowCellWrap || !column.allowCellWrap) {
//if (!e.allowCellWrap) {
//if (!column.allowCellWrap) {
s[s.length]=" mini-grid-cell-nowrap "),y.cellInnerCls&&(s[s.length]=y.cellInnerCls),!!_.field&&this._dataSource.isModified(t,_.field)&&this.showModified&&(s[s.length]=" mini-grid-cell-dirty"),s[s.length]='" style="',a&&(s[s.length]="height:",_.name&&this._treeColumn===_.name?s[s.length]=d:s[s.length]=r,s[s.length]="px;",s[s.length]="line-height:",_.name&&this._treeColumn===_.name?s[s.length]=d:s[s.length]=r,s[s.length]="px;"),y.cellInnerStyle&&(s[s.length]=y.cellInnerStyle),s[s.length]='">',s[s.length]=y.cellHtml,s[s.length]="</div>",s[s.length]="</td>",y.rowCls&&(u=y.rowCls),y.rowStyle&&(c=y.rowStyle)}if((this.isFrozen()&&1==n||this.isFrozenRight()&&3==n)&&(s[s.length]='<td class="mini-grid-cell" style="width:0;',0==this.showHGridLines&&(s[s.length]="border-bottom:0;"),s[s.length]='"><div class="mini-grid-cell-inner" style="',a&&(s[s.length]="height:",s[s.length]=r,s[s.length]="px;"),s[s.length]='">0</div></td>'),s[l]=u,s[h]=c,s[s.length]="</tr>",o){var x=s.join("");return x=x.replace(/(<script(.*)<\/script(\s*)>)/i,"")}},_createRowsHTML:function(t,e,i,n){i=i||this.getVisibleRows();var s=['<table class="mini-grid-table mini-grid-rowstable" cellspacing="0" cellpadding="0" border="0">'];s.push(this._createTopRowHTML(t,!0,i));var o=this.uid+"$emptytext"+e;if(2==e&&(this._dataSource.loaded||this.alwaysShowEmptyText)){var r=this.showEmptyText&&0==i.length?"":"display:none;";s.push('<tr id="'+o+'" style="'+r+'"><td style="width:0"></td><td class="mini-grid-emptyText" colspan="'+t.length+'">'+this.emptyText+"</td></tr>")}var a=0;if(0<i.length){var l=i[0];a=this.getVisibleRows().indexOf(l)}for(var h=0,d=i.length;h<d;h++){var u=a+h,c=i[h];this._createRowHTML(c,u,t,e,s)}return n&&s.push(n),s.push("</table>"),s.join("")},doUpdateRows:function(){var t=this.getVisibleRows(),e=(new Date,this.getVisibleColumns());if(this.isGrouping()){var i=this._createGroupingHTML(e,2);this._rowsViewContentEl.innerHTML=i}else{i=this._createRowsHTML(e,2,t);this._rowsViewContentEl.innerHTML=i}},_createFilterRowHTML:function(t,e){var i=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0" style="position:absolute;top:0;left:0;height:100%;">'];i.push(this._createTopRowHTML(t)),i[i.length]="<tr>",i[i.length]='<td style="width:0;"></td>';for(var n=0,s=t.length;n<s;n++){var o=t[n],r=this._createFilterCellId(o);i[i.length]='<td id="',i[i.length]=r,i[i.length]='" class="mini-grid-filterCell" style="',i[i.length]='">&nbsp;</td>'}return i[i.length]='</tr></table><div class="mini-grid-scrollHeaderCell"></div>',i.join("")},_doRenderFilters:function(){for(var t=this.getVisibleColumns(),e=0,i=t.length;e<i;e++){var n=t[e];if(n.filter){var s=this.getFilterCellEl(n);s&&(s.innerHTML="",n.filter.render(s))}}},_doUpdateFilterRow:function(){this._filterViewEl.firstChild&&this._filterViewEl.removeChild(this._filterViewEl.firstChild);this.isFrozen();var t=this.getVisibleColumns(),e=this._createFilterRowHTML(t,2);this._filterViewEl.innerHTML=e,this._doRenderFilters()},_createSummaryRowHTML:function(t,e){var i=this.getDataView(),n=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'];n.push(this._createTopRowHTML(t));for(var s=0,o=this.summaryRows;s<o;s++){n[n.length]="<tr>",n[n.length]='<td style="width:0;"></td>';for(var r=0,a=t.length;r<a;r++){var l=t[r],h=this._createSummaryCellId(l,s),d=this._OnDrawSummaryCell(i,l,null,s);n[n.length]='<td id="',n[n.length]=h,n[n.length]='" class="mini-grid-summaryCell '+d.cellCls+'" style="'+d.cellStyle+";",n[n.length]='">',n[n.length]=d.cellHtml,n[n.length]="</td>"}n[n.length]="</tr>"}return n[n.length]='</table><div class="mini-grid-scrollHeaderCell"></div>',n.join("")},_doUpdateSummaryRow:function(){if(this.showSummaryRow){var t=this.getVisibleColumns(),e=this._createSummaryRowHTML(t,2);this._summaryViewEl.innerHTML=e}},_doSortByField:function(t,e){if(!t)return null;var i=this._columnModel._getDataTypeByField(t);this._dataSource._doClientSortField(t,e,i)},_expandGroupOnLoad:!0,_GroupID:1,_groupField:"",_groupDir:"",groupBy:function(t,e){t&&(this._groupField=t,"string"==typeof e&&(e=e.toLowerCase()),this._groupDir=e,this._createGroupingView(),this.deferUpdate())},clearGroup:function(){this._groupField="",this._groupDir="",this._groupDataView=null,this.deferUpdate()},setGroupField:function(t){this.groupBy(t)},getGroupField:function(){return this._groupField},getGroupDir:function(){return this._groupDir},setGroupDir:function(t){this._groupDir=field,this.groupBy(this._groupField,t)},isGrouping:function(){return""!=this._groupField},getGroupingView:function(){return this._groupDataView},enableGroupOrder:!0,_createGroupingView:function(){if(0!=this.isGrouping()){this._groupDataView=null;var t=this._dataSource,e=this._groupField,i=this._groupDir;(this.enableGroupOrder||i)&&this._doSortByField(e,i);for(var n=this.getVisibleRows(),s=[],o={},r=0,a=n.length;r<a;r++){var l=n[r],h=l[e],d=mini.isDate(h)?h.getTime():h;(g=o[d])||((g=o[d]={}).field=e,g.dir=i,g.value=h,g.rows=[],s.push(g),g.id="g"+this._GroupID++,g.expanded=this._expandGroupOnLoad),g.rows.push(l)}var u=t.sortField,c=t.sortOrder;if(u){var m=this._columnModel._getDataTypeByField(u),f=t._getSortFnByField(u,m);if(f){var p="desc"==c;for(r=0,a=s.length;r<a;r++){var g=s[r];mini.sort(g.rows,f),p&&g.rows.reverse()}}}this._groupDataView=s}},_OnDrawGroup:function(t){var e={group:t,rows:t.rows,field:t.field,dir:t.dir,value:t.value,cls:"",style:"",cellHtml:t.field+" ("+t.rows.length+" Items)"};return this.fire("drawgroup",e),e},getRowGroup:function(t){var e=typeof t;return"number"==e?this.getGroupingView()[t]:"string"==e?this._getRowGroupById(t):t},_getRowGroupByEvent:function(t){var e=mini.findParent(t.target,"mini-grid-groupRow");if(e){var i=e.id.split("$");if(i[0]!=this._id)return null;var n=i[i.length-1];return this._getRowGroupById(n)}return null},_getRowGroupById:function(t){for(var e=this.getGroupingView(),i=0,n=e.length;i<n;i++){var s=e[i];if(s.id==t)return s}return null},_createRowGroupId:function(t,e){return this._id+"$group"+e+"$"+t.id},_createRowGroupRowsId:function(t,e){return this._id+"$grouprows"+e+"$"+t.id},_createRowId:function(t,e){return this._id+"$row"+e+"$"+t._id},_createHeaderCellId:function(t,e){return this._id+"$headerCell"+e+"$"+t._id},_createCellId:function(t,e){return t._id+"$cell$"+e._id},_createFilterCellId:function(t){return this._id+"$filter$"+t._id},_createSummaryCellId:function(t,e){return this._id+"$summary$"+t._id+"_"+e},getFilterCellEl:function(t){return(t=this.getColumn(t))?document.getElementById(this._createFilterCellId(t)):null},getSummaryCellEl:function(t,e){return e=e||0,(t=this.getColumn(t))?document.getElementById(this._createSummaryCellId(t,e)):null},_doVisibleEls:function(){mini.GridView.superclass._doVisibleEls.call(this),this._columnsEl.style.display=this.showColumns?"block":"none",this._filterEl.style.display=this.showFilterRow?"block":"none",this._summaryEl.style.display=this.showSummaryRow?"block":"none",this._bottomPagerEl.style.display=this.showPager?"block":"none"},setShowColumns:function(t){this.showColumns=t,this._doVisibleEls(),this.deferLayout()},setShowFilterRow:function(t){this.showFilterRow=t,this._doVisibleEls(),this.deferLayout()},setShowSummaryRow:function(t){this.showSummaryRow=t,this._doVisibleEls(),this.deferLayout()},setShowPager:function(t){this.showPager=t,this._doVisibleEls(),this.deferLayout()},setFitColumns:function(t){this.fitColumns=t,mini.removeClass(this.el,"mini-grid-fixwidth"),0==this.fitColumns&&mini.addClass(this.el,"mini-grid-fixwidth"),this.deferLayout()},getBodyHeight:function(t){var e=mini.GridView.superclass.getBodyHeight.call(this,t);return e=e-this.getColumnsHeight()-this.getFilterHeight()-this.getSummaryHeight()-this.getPagerHeight()},getColumnsHeight:function(){return this.showColumns?mini.getHeight(this._columnsEl):0},getFilterHeight:function(){return this.showFilterRow?mini.getHeight(this._filterViewEl.firstChild):0},getSummaryHeight:function(){return this.showSummaryRow?mini.getHeight(this._summaryEl):0},getPagerHeight:function(){return this.showPager?mini.getHeight(this._bottomPagerEl):0},getGridViewBox:function(t){var e=mini.getBox(this._columnsEl),i=mini.getBox(this._bodyEl);return e.height=i.bottom-e.top,e.bottom=e.top+e.height,e},getSortField:function(t){return this._dataSource.sortField},getSortOrder:function(t){return this._dataSource.sortOrder},_createSource:function(){this._dataSource=new mini.DataTable},_bindSource:function(){var t=this._dataSource;t.on("loaddata",this.__OnSourceLoadData,this),t.on("cleardata",this.__OnSourceClearData,this)},__OnSourceLoadData:function(t){this._initData();var a=this,e=a.getSortField(),i=a.getSortOrder();"client"==a.sortMode&&e&&i&&a.sortBy(e,i),this.doUpdate(),setTimeout(function(){function t(){for(var t,e,i=0,n=a.data.length;i<n;i++)t=a.getCellEl(i,o),(e=s.call(a,{sender:a,cell:t,value:a.data[i][o.field],column:o}))&&(t.firstChild.innerHTML=e),mini.parse(t)}for(var e,s,i,o,n=0,r=a._column_rendered.length;n<r;n++)e=a._column_rendered[n],o=a._getColumnById(e.id),s="function"==typeof e.rendered?e.rendered:mini._getFunctoin(e.rendered),(i=e.beforeRender)?(i="function"==typeof i?i:mini._getFunctoin(i)).call(a,{sender:a,column:o},function(){t()}):t()},100)},__OnSourceClearData:function(t){this._initData(),this.doUpdate()},_initData:function(){},isFrozen:function(){this._columnModel._frozenStartColumn,this._columnModel._frozenEndColumn;
//return this.isTableView() && !this.isGrouping() && sc >= 0 && fc >= sc;
return this._columnModel.isFrozen()},isFrozenRight:function(){return this._columnModel.isFrozenRight()},_createColumnModel:function(){this._columnModel=new mini.ColumnModel(this)},_bindColumnModel:function(){this._columnModel.on("columnschanged",this.__OnColumnsChanged,this)},__OnColumnsChanged:function(t){this.columns=this._columnModel.columns,this._doUpdateFilterRow(),this._doUpdateSummaryRow(),this.doUpdate(),this.fire("columnschanged")},_column_rendered:[],_doUpdateRenderCallBack:function(){if(this.getColumns){var t=this.getColumns();this._column_rendered=[],this._recursionColumns(t,function(t){t.rendered&&this._column_rendered.push({rendered:t.rendered,beforeRender:t.beforeRender,id:t._id})})}},_recursionColumns:function(t,e){for(var i=0,n=t.length;i<n;i++)e.call(this,t[i]),t[i].columns&&this._recursionColumns(t[i].columns,e)},setColumns:function(t){this._columnModel.setColumns(t),this.columns=this._columnModel.columns},getColumns:function(){return this._columnModel.getColumns()},getBottomColumns:function(){return this._columnModel.getBottomColumns()},getVisibleColumnsRow:function(){return this._columnModel.getVisibleColumnsRow().clone()},getVisibleColumns:function(){return this._columnModel.getVisibleColumns().clone()},getFrozenColumns:function(){return this._columnModel.getFrozenColumns().clone()},getFrozenRightColumns:function(){return this._columnModel.getFrozenRightColumns().clone()},getUnFrozenColumns:function(){return this._columnModel.getUnFrozenColumns().clone()},getColumn:function(t){return this._columnModel.getColumn(t)},updateColumn:function(t,e){this._columnModel.updateColumn(t,e)},showColumns:function(t){for(var e=0,i=t.length;e<i;e++){var n=this.getColumn(t[e]);n&&(n.visible=!0)}this._columnModel._columnsChanged()},hideColumns:function(t){for(var e=0,i=t.length;e<i;e++){var n=this.getColumn(t[e]);n&&(n.visible=!1)}this._columnModel._columnsChanged()},showColumn:function(t){this.updateColumn(t,{visible:!0})},hideColumn:function(t){this.updateColumn(t,{visible:!1})},moveColumn:function(t,e,i){this._columnModel.moveColumn(t,e,i)},removeColumn:function(t){if(t=this.getColumn(t)){var e=this.getParentColumn(t);return t&&e&&(e.columns.remove(t),this._columnModel._columnsChanged()),t}},setDefaultColumnWidth:function(t){this._columnModel._defaultColumnWidth=t},getDefaultColumnWidth:function(){return this._columnModel._defaultColumnWidth},setColumnWidth:function(t,e){this.updateColumn(t,{width:e})},getColumnWidth:function(t){return this.getColumnBox(t).width},getParentColumn:function(t){return this._columnModel.getParentColumn(t)},getMaxColumnLevel:function(){return this._columnModel._getMaxColumnLevel()},_isCellVisible:function(t,e){return!0},_createDrawCellEvent:function(t,e,i,n){var s=mini._getMap(e.field,t),o={sender:this,rowIndex:i,columnIndex:n,record:t,row:t,column:e,field:e.field,value:s,cellHtml:s,rowCls:"",rowStyle:null,cellCls:e.cellCls||"",cellStyle:e.cellStyle||"",allowCellWrap:this.allowCellWrap,showHGridLines:this.showHGridLines,showVGridLines:this.showVGridLines,cellInnerCls:"",cellInnnerStyle:"",autoEscape:e.autoEscape};if(o.visible=this._isCellVisible(i,n),1==o.visible&&this._mergedCellMaps){var r=this._mergedCellMaps[i+":"+n];r&&(o.rowSpan=r.rowSpan,o.colSpan=r.colSpan)}return o},defaultColumnDateFormat:"yyyy-MM-dd",_OnDrawCell:function(t,e,i,n){var s=this._createDrawCellEvent(t,e,i,n),o=s.value,r=e.dateFormat||("date"==e.dataType?this.defaultColumnDateFormat:"");if(r&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(o,r):s.cellHtml=o),"float"==e.dataType){o=parseFloat(s.value);isNaN(o)||(decimalPlaces=parseInt(e.decimalPlaces),isNaN(decimalPlaces)&&(decimalPlaces=2),s.cellHtml=o.toFixed(decimalPlaces))}if("currency"==e.dataType&&(s.cellHtml=mini.formatCurrency(s.value,e.currencyUnit)),e.displayField&&(s.cellHtml=mini._getMap(e.displayField,t)),e.numberFormat){var a=parseFloat(s.cellHtml);isNaN(a)||(s.cellHtml=mini.formatNumber(a,e.numberFormat))}e.template&&(s.cellHtml=Mustache.render(e.template,t)),1==s.autoEscape&&(s.cellHtml=mini.htmlEncode(s.cellHtml));var l=e.renderer;if(l){var h="function"==typeof l?l:mini._getFunctoin(l);h&&(s.cellHtml=h.call(e,s))}return s.cellHtml=0===s.cellHtml||!1===s.cellHtml||s.cellHtml?String(s.cellHtml).trim():"",
//e.cellHtml = (e.cellHtml === 0 || !mini.isNull(e.cellHtml)) ? String(e.cellHtml).trim() : "";
this.fire("drawcell",s),s.cellHtml&&s.cellHtml.unshift&&0==s.cellHtml.length&&(s.cellHtml="&nbsp;"),null!==s.cellHtml&&s.cellHtml!==undefined&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s},_OnDrawSummaryCell:function(t,e,i,n){var s={row:n,group:i,result:this.getResultObject(),sender:this,data:t,column:e,field:e.field,value:"",cellHtml:"",cellCls:e.cellCls||"",cellStyle:e.cellStyle||"",allowCellWrap:this.allowCellWrap};if(e.summaryType){var o=mini.summaryTypes[e.summaryType];o&&(s.value=o(t,e.field))}var r=s.value;s.cellHtml=s.value,s.value&&parseInt(s.value)!=s.value&&s.value.toFixed&&(decimalPlaces=parseInt(e.decimalPlaces),isNaN(decimalPlaces)&&(decimalPlaces=2),s.cellHtml=parseFloat(s.value.toFixed(decimalPlaces))),e.dateFormat&&(mini.isDate(s.value)?s.cellHtml=mini.formatDate(r,e.dateFormat):s.cellHtml=r),s.cellHtml&&"currency"==e.dataType&&(s.cellHtml=mini.formatCurrency(s.cellHtml,e.currencyUnit));var a=e.summaryRenderer;return a&&(o="function"==typeof a?a:window[a])&&(s.cellHtml=o.call(e,s)),e.summaryValue=s.value,this.fire("drawsummarycell",s),null!==s.cellHtml&&s.cellHtml!==undefined&&""!==s.cellHtml||(s.cellHtml="&nbsp;"),s},getScrollTop:function(){return this._rowsViewEl.scrollTop},setScrollTop:function(t){this._rowsViewEl.scrollTop=t},getScrollLeft:function(){return this._rowsViewEl.scrollLeft},setScrollLeft:function(t){this._rowsViewEl.scrollLeft=t},_syncScroll:function(){var t=this._rowsViewEl.scrollLeft;this._filterViewEl.firstChild.style.left=-t+"px",this._summaryViewEl.scrollLeft=t,this._columnsViewEl.scrollLeft=t},__OnRowViewScroll:function(t){this._syncScroll()},pagerType:"pager",getPagerType:function(){return this.pagerType},setPagerType:function(t){this.pagerType=t;var e=mini.create({type:this.pagerType});e&&this._setBottomPager(e)},_pagers:[],_createPagers:function(){this._pagers=[];var t=new mini.Pager;this._setBottomPager(t)},_setBottomPager:function(t){(t=mini.create(t))&&(this._bottomPager&&(this.unbindPager(this._bottomPager),this._bottomPagerEl.removeChild(this._bottomPager.el)),(this._bottomPager=t).render(this._bottomPagerEl),this.bindPager(t))},bindPager:function(t){this._pagers.add(t)},unbindPager:function(t){this._pagers.remove(t)},alwaysShowEmptyText:!1,setAlwaysShowEmptyText:function(t){this.alwaysShowEmptyText=t},getAlwaysShowEmptyText:function(){return this.alwaysShowEmptyText},setShowEmptyText:function(t){this.showEmptyText=t,0==this.data.length&&this.deferUpdate()},getShowEmptyText:function(){return this.showEmptyText},setEmptyText:function(t){this.emptyText=t},getEmptyText:function(){return this.emptyText},setShowModified:function(t){this.showModified=t},getShowModified:function(){return this.showModified},setShowNewRow:function(t){this.showNewRow=t},getShowNewRow:function(){return this.showNewRow},setAllowCellWrap:function(t){this.allowCellWrap=t},getAllowCellWrap:function(){return this.allowCellWrap},setAllowHeaderWrap:function(t){this.allowHeaderWrap=t},getAllowHeaderWrap:function(){return this.allowHeaderWrap},setEnableGroupOrder:function(t){this.enableGroupOrder=t},getEnableGroupOrder:function(){return this.enableGroupOrder},setShowHGridLines:function(t){this.showHGridLines!=t&&(this.showHGridLines=t,this.deferUpdate())},getShowHGridLines:function(){return this.showHGridLines},setShowVGridLines:function(t){this.showVGridLines!=t&&(this.showVGridLines=t,this.deferUpdate())},getShowVGridLines:function(){return this.showVGridLines},setShowSortIcon:function(t){this.showSortIcon!=t&&(this.showSortIcon=t,this.deferUpdate())},getShowSortIcon:function(){return this.showSortIcon}}),mini.copyTo(mini.GridView.prototype,mini._DataTableApplys),mini.regClass(mini.GridView,"gridview"),
//        if(!inited){
mini.FrozenGridView=function(){mini.FrozenGridView.superclass.constructor.apply(this,arguments)},mini.extend(mini.FrozenGridView,mini.GridView,{isFixedRowHeight:function(){
//return this.fixedRowHeight || !this.allowCellWrap;
return this.fixedRowHeight},frozenPosition:"left",isRightFrozen:function(){return"right"==this.frozenPosition},_create:function(){mini.FrozenGridView.superclass._create.call(this);this.el;this._columnsLockEl=mini.before(this._columnsViewEl,'<div class="mini-grid-columns-lock"></div>'),this._rowsLockEl=mini.before(this._rowsViewEl,'<div class="mini-grid-rows-lock"><div class="mini-grid-rows-content"></div></div>'),this._columnsRightLockEl=mini.after(this._columnsViewEl,'<div class="mini-grid-columns-lock"></div>'),this._rowsRightLockEl=mini.after(this._rowsViewEl,'<div class="mini-grid-rows-lock" style="overflow-x: hidden; overflow-y: auto;"><div class="mini-grid-rows-content"></div></div>'),this._rowsLockContentEl=this._rowsLockEl.firstChild,this._rowsRightLockContentEl=this._rowsRightLockEl.firstChild;this._filterLockEl=mini.before(this._filterViewEl,'<div class="mini-grid-filterRow-lock" style="height:100%;"></div>');this._summaryLockEl=mini.before(this._summaryViewEl,'<div class="mini-grid-summaryRow-lock"></div>')},_initEvents:function(){mini.FrozenGridView.superclass._initEvents.call(this),mini.on(this._rowsEl,"mousewheel",this.__OnMouseWheel,this)},_createHeaderText:function(t,e){var i=t.header;return"function"==typeof i&&(i=i.call(this,t)),!mini.isNull(i)&&""!==i||(i="&nbsp;"),this.isFrozen()&&2==e&&t.viewIndex1&&(i="&nbsp;"),this.isFrozenRight()&&3==e&&t.colspan2&&t.columns&&(i="&nbsp;"),i},_createColumnColSpan:function(t,e,i){if(this.isFrozen()||this.isFrozenRight()){var n=t["colspan"+i];n&&(e[e.length]='colspan="'+n+'" ')}else t.colspan&&(e[e.length]='colspan="'+t.colspan+'" ')},doUpdateColumns:function(){var t=this._columnsViewEl.scrollLeft,e=this.isFrozen()?this.getFrozenColumnsRow():[],i=this.isFrozenRight()?this.getFrozenRightColumnsRow():[],n=this.isFrozen()||this.isFrozenRight()?this.getUnFrozenColumnsRow():this.getVisibleColumnsRow(),s=this.isFrozen()?this.getFrozenColumns():[],o=this.isFrozenRight()?this.getFrozenRightColumns():[],r=this.isFrozen()||this.isFrozenRight()?this.getUnFrozenColumns():this.getVisibleColumns(),a=this._createColumnsHTML(e,1,s),l=this._createColumnsHTML(n,2,r),h=this._createColumnsHTML(i,3,o),d='<div class="mini-grid-topRightCell"></div>';a+=d,l+=d,h+=d,this._columnsLockEl.innerHTML=a,this._columnsRightLockEl.innerHTML=h,this._columnsViewEl.innerHTML=l;var u=this._columnsLockEl.firstChild,c=this._columnsRightLockEl.firstChild;u.style.width="0px",c.style.width="0px",this._columnsViewEl.scrollLeft=t,mini[["addClass","removeClass"][0<this._columnModel._maxColumnLevel?0:1]](this._viewportEl,"mini-grid-composite-columns")},doUpdateRows:function(){var t=this.getVisibleRows(),e=this.getFrozenColumns(),i=this.getUnFrozenColumns(),n=this.getFrozenRightColumns();if(this.isGrouping()){var s=this._createGroupingHTML(e,1),o=this._createGroupingHTML(n,3),r=this._createGroupingHTML(i,2);this._rowsLockContentEl.innerHTML=s,this._rowsRightLockContentEl.innerHTML=o,this._rowsViewContentEl.innerHTML=r}else{s=this._createRowsHTML(e,1,this.isFrozen()?t:[]),r=this._createRowsHTML(i,2,t),o=this._createRowsHTML(n,3,this.isFrozenRight()?t:[]);this._rowsLockContentEl.innerHTML=s,this._rowsRightLockContentEl.innerHTML=o,this._rowsViewContentEl.innerHTML=r}var a=this._rowsLockContentEl.firstChild,l=this._rowsRightLockContentEl.firstChild;a.style.width="0px",l.style.width="0px"},_doUpdateFilterRow:function(){this._filterLockEl.firstChild&&this._filterLockEl.removeChild(this._filterLockEl.firstChild),this._filterViewEl.firstChild&&this._filterViewEl.removeChild(this._filterViewEl.firstChild);var t=this.getFrozenColumns(),e=this.getUnFrozenColumns(),i=this._createFilterRowHTML(t,1),n=this._createFilterRowHTML(e,2);this._filterLockEl.innerHTML=i,this._filterViewEl.innerHTML=n,this._doRenderFilters()},_doUpdateSummaryRow:function(){var t=this.getFrozenColumns(),e=this.getUnFrozenColumns(),i=this._createSummaryRowHTML(t,1),n=this._createSummaryRowHTML(e,2);this._summaryLockEl.innerHTML=i,this._summaryViewEl.innerHTML=n},_syncRowsHeightTimer:null,syncRowDetail:function(t){var e=this._getRowDetailEl(t,1),i=this._getRowDetailEl(t,2);e&&i&&this._doSyncRowHeight(e,i)},_doSyncRowHeight:function(t,e,i){var n=0,s=0,o=0;t&&(t.style.height="auto",n=t.cells[0].offsetHeight),e&&(e.style.height="auto",s=e.cells[0].offsetHeight),i&&(i.style.height="auto",o=i.cells[0].offsetHeight);var r=Math.max(n,s,o);t&&(t.style.height=r+"px"),e&&(e.style.height=r+"px"),i&&(i.style.height=r+"px")},_syncRowsHeight:function(){var C=this,b=this.isFrozen(),E=this.isFrozenRight();!function T(){new Date,document;for(var t,e,i,n,s,o,r,a,l,h,d,u,c,m=C.getDataView(),f={},p=0,g=m.length;p<g;p++){var _=m[p],v=C._getRowEl(_,1),y=C._getRowEl(_,2),w=C._getRowEl(_,3);y&&(!v&&b||!w&&E||(t=v,e=w,y.style.height="auto",b&&(t.style.height="auto"),E&&(e.style.height="auto"),f[p]={row1:v,row2:y,row3:w}))}for(p=0,g=m.length;p<g;p++){_=m[p];(x=f[p])&&(x.height=(i=x.row1,n=x.row2,s=x.row3,a=o=void 0,o=-1,r=n.cells[0].offsetHeight,a=-1,b&&(o=i.cells[0].offsetHeight),E&&(a=s.cells[0].offsetHeight),Math.max(o,r,a)))}for(p=0,g=m.length;p<g;p++){var x;_=m[p];(x=f[p])&&(l=x.row1,h=x.row2,d=x.row3,u=x.height,void 0,c=u+1+"px",h.style.height=c,b&&(l.style.height=c),E&&(d.style.height=c))}C._syncRowsHeightTimer=null}()},_syncColumnHeight:function(){var t=this._columnsLockEl,e=this._columnsRightLockEl,i=this._columnsViewEl;if(t.style.height=i.style.height="auto",e.style.height=i.style.height="auto",this.isFrozen()){var n=t.offsetHeight;n=(s=i.offsetHeight)<n?n:s,t.style.height=i.style.height=n+"px"}if(this.isFrozenRight()){n=e.offsetHeight;n=(s=i.offsetHeight)<n?n:s,e.style.height=i.style.height=n+"px"}t=this._summaryLockEl,i=this._summaryViewEl;if(t.style.height=i.style.height="auto",this.isFrozen()){var s;n=t.offsetHeight;n=(s=i.offsetHeight)<n?n:s,t.style.height=i.style.height=n+"px"}},_layoutColumns:function(){function t(t){return t.offsetHeight}function l(t){for(var e=[],i=0,n=t.cells.length;i<n;i++){var s=t.cells[i];"0px"!=s.style.width&&e.push(s)}return e}function s(t){for(var e=l(t),i=0,n=e.length;i<n;i++){e[i].style.height="auto"}}function a(t,e){for(var i=0,n=l(t),s=0,o=n.length;s<o;s++){var r=n[s];if(!(1<parseInt(r.rowSpan))||!e){var a=r.offsetHeight;i<a&&(i=a)}}return i}if(this.isFrozen()||this.isFrozenRight()){var o=this._columnsLockEl.firstChild,r=this._columnsViewEl.firstChild;!function f(){o.style.height=o.style.height="auto";for(var t=0,e=o.rows.length;t<e;t++){var i=o.rows[t],n=r.rows[t];s(i),s(n)}}();for(var e=0,i=o.rows.length;e<i;e++){var n,h,d=o.rows[e],u=r.rows[e];(n=a(d))==(h=a(u))||(n<h?(c(d,u),m(d,u)):h<n&&(c(u,d),m(u,d)))}(n=t(o))<(h=t(r))?mini.setHeight(o,h):h<n&&mini.setHeight(r,n)}function c(t,e){for(var i=a(e,!0),n=l(t),s=0,o=n.length;s<o;s++){var r=n[s];1<parseInt(r.rowSpan)||mini.setHeight(r,i)}}function m(t,e){for(var i=a(e),n=l(t),s=0,o=n.length;s<o;s++){var r=n[s];1<parseInt(r.rowSpan)&&mini.setHeight(r,i)}}},doLayout:function(){if(0!=this.canLayout()){this._doLayoutScroll=!1;var t=this.isFrozen(),e=this.isFrozenRight(),i=this.getViewportWidth(!0),n=this.getLockedWidth(),s=this.getLockedRightWidth(),o=i-n-s;this._doEmptyText();var r=this.isRightFrozen()?"marginRight":"marginLeft",a=this.isRightFrozen()?"right":"left";if(t||e){
//            if (mini.isIE6 || !mini.isIE)  this._columnsViewEl.style["width"] = viewWidth + "px";
if(this._filterViewEl.style[r]=n+"px",this._summaryViewEl.style[r]=n+"px",this._columnsViewEl.style[r]=n+"px",this._rowsViewEl.style[r]=n+"px",this._columnsViewEl.style.marginRight=s+"px",this._rowsViewEl.style.marginRight=s+"px",this._filterViewEl.style.width=o+"px",this._summaryViewEl.style.width=o+"px",this._columnsViewEl.style.width=o+"px",mini.isSafari||mini.isChrome||mini.isIE6){var l=mini.getBorders(this._rowsViewEl.parentNode);this._rowsViewEl.style.width=o-(l.left+l.right)+"px"}mini.setWidth(this._filterLockEl,n),mini.setWidth(this._summaryLockEl,n),mini.setWidth(this._columnsLockEl,n),mini.setWidth(this._columnsRightLockEl,s),mini.setWidth(this._rowsLockEl,n),mini.setWidth(this._rowsRightLockEl,s),this._filterLockEl.style[a]="0px",this._summaryLockEl.style[a]="0px",this._columnsLockEl.style[a]="0px",this._rowsLockEl.style[a]="0px",this._columnsRightLockEl.style.left="auto",this._columnsRightLockEl.style.right="0",this._rowsRightLockEl.style.left="auto",this._rowsRightLockEl.style.right="0"}else this._doClearFrozen();this._layoutColumns(),this._syncColumnHeight(),mini.FrozenGridView.superclass.doLayout.call(this);this._autoHeight;(t||e)&&((mini.isChrome||mini.isIE6)&&(this._layoutColumns(),this._syncColumnHeight(),mini.FrozenGridView.superclass.doLayout.call(this)),this._rowsLockEl.style.height="100%",this._rowsRightLockEl.style.height="100%"),this._syncRowsHeight()}},_doEmptyText:function(){},_getRowEl:function(t,e){t=this.getRecord(t);var i=this._createRowId(t,e);return document.getElementById(i)},_doClearFrozen:function(){this.isRightFrozen(),this.isRightFrozen();this._filterLockEl.style.left="-10px",this._summaryLockEl.style.left="-10px",this._columnsLockEl.style.left="-10px",this._rowsLockEl.style.left="-10px",this._columnsRightLockEl.style.left="-10px",this._rowsRightLockEl.style.left="-10px",this._filterLockEl.style.width="0px",this._summaryLockEl.style.width="0px",this._columnsLockEl.style.width="0px",this._rowsLockEl.style.width="0px",this._columnsRightLockEl.style.width="0px",this._rowsRightLockEl.style.width="0px",this._filterViewEl.style.marginLeft="0px",this._summaryViewEl.style.marginLeft="0px",this._columnsViewEl.style.marginLeft="0px",this._columnsViewEl.style.marginRight="0px",this._rowsViewEl.style.marginLeft="0px",this._rowsViewEl.style.marginRight="0px",this._filterViewEl.style.width="auto",this._summaryViewEl.style.width="auto",this._columnsViewEl.style.width="auto",this._rowsViewEl.style.width="auto",(mini.isSafari||mini.isChrome||mini.isIE6)&&(this._filterViewEl.style.width="100%",this._summaryViewEl.style.width="100%",this._columnsViewEl.style.width="100%",this._rowsViewEl.style.width="100%")},frozenColumns:function(t,e){this.frozen(t,e)},frozenRightColumns:function(t,e){this.frozenRight(t,e)},unFrozenColumns:function(){this.unFrozen()},frozen:function(t,e){this._doClearFrozen(),this._columnModel.frozen(t,e)},frozenRight:function(t,e){this._doClearFrozen(),this._columnModel.frozenRight(t,e)},unFrozen:function(){this._doClearFrozen(),this._columnModel.unFrozen()},setFrozenStartColumn:function(t){this._columnModel.setFrozenStartColumn(t)},setFrozenEndColumn:function(t){return this._columnModel.setFrozenEndColumn(t)},setFrozenRightStartColumn:function(t){this._columnModel.setFrozenRightStartColumn(t)},setFrozenRightEndColumn:function(t){return this._columnModel.setFrozenRightEndColumn(t)},getFrozenStartColumn:function(t){return this._columnModel._frozenStartColumn},getFrozenEndColumn:function(t){return this._columnModel._frozenEndColumn},getFrozenRightStartColumn:function(t){return this._columnModel._frozenRightStartColumn},getFrozenRightEndColumn:function(t){return this._columnModel._frozenRightEndColumn},getFrozenColumnsRow:function(){return this._columnModel.getFrozenColumnsRow()},getFrozenRightColumnsRow:function(){return this._columnModel.getFrozenRightColumnsRow()},getUnFrozenColumnsRow:function(){return this._columnModel.getUnFrozenColumnsRow()},getLockedWidth:function(){if(!this.isFrozen())return 0;var t=this._rowsLockContentEl.firstChild.firstChild;return t?t.offsetWidth:0},getLockedRightWidth:function(){if(!this.isFrozenRight())return 0;var t=this._rowsRightLockContentEl.firstChild.firstChild;return t?t.offsetWidth:0},_canDeferSyncScroll:function(){return this.isFrozen()},_syncScroll:function(){var t=this._rowsViewEl.scrollLeft;
//if(scrollLeft != 0) alert(scrollLeft);
this._filterViewEl.firstChild.style.left=-t+"px",this._summaryViewEl.scrollLeft=t,this._columnsViewEl.scrollLeft=t;var e;this.isFrozenRight()?(e=this._rowsRightLockEl.scrollTop,this._rowsLockEl.scrollTop=e,this._rowsViewEl.scrollTop=e):(e=this._rowsViewEl.scrollTop,this._rowsLockEl.scrollTop=e,this._rowsRightLockEl.scrollTop=e)},__OnMouseWheel:function(t){var e=this.getScrollTop()-t.wheelDelta,i=this.getScrollTop();this.setScrollTop(e),i!=this.getScrollTop()&&t.preventDefault()}}),mini.regClass(mini.FrozenGridView,"FrozenGridView"),mini.ScrollGridView=function(){mini.ScrollGridView.superclass.constructor.apply(this,arguments)},mini.extend(mini.ScrollGridView,mini.FrozenGridView,{virtualScroll:!0,virtualRows:25,defaultRowHeight:51,virtualColumns:!1,_canDeferSyncScroll:function(){return this.isFrozen()&&!this.isVirtualScroll()},setVirtualScroll:function(t){this.virtualScroll=t,this.doUpdate()},getVirtualScroll:function(t){return this.virtualScroll},isFitColumns:function(){return this.fitColumns&&!this.virtualColumns},setVirtualColumns:function(t){this.virtualColumns=t,this.doUpdate()},getVirtualColumns:function(t){return this.virtualColumns},isFixedRowHeight:function(){
//return this.fixedRowHeight || this.isVirtualScroll() || !this.allowCellWrap;
return this.fixedRowHeight||this.virtualScroll},isVirtualScroll:function(){return!!this.virtualScroll&&(0==this.isAutoHeight()&&0==this.isGrouping())},_getScrollView:function(){return this.getVisibleRows()},_getScrollViewCount:function(){return this._getScrollView().length},_getScrollRowHeight:function(t,e){if(e&&e._height){var i=parseInt(e._height);if(!isNaN(i))return i}return this.defaultRowHeight;
//        if (!record) return 0;
},_getRangeHeight:function(t,e){for(var i=0,n=this._getScrollView(),s=t;s<e;s++){var o=n[s];i+=this._getScrollRowHeight(s,o)}return i},_getIndexByScrollTop:function(t){return parseInt(t/this.defaultRowHeight)},__getScrollViewRange:function(t,e){return this._getScrollView().getRange(t,e)},_getColumnByScrollLeft:function(t){for(var e=0,i=this.getUnFrozenColumns(),n=i.length,s=0,o=n;s<o;s++){var r=i[s].pxWidth;if(isNaN(r)||(e+=r),t<=e)return s}return n},_getRangeWidth:function(t,e){for(var i=0,n=this.getUnFrozenColumns(),s=t;s<e;s++){var o=n[s];if(o){var r=o.pxWidth;isNaN(r)||(i+=r)}}return i},_getColumnAllWidth:function(){for(var t=0,e=this.getUnFrozenColumns(),i=0,n=e.length;i<n;i++){var s=e[i].pxWidth;isNaN(s)||(t+=s)}return t},_getViewRegion:function(){var t,e=this._getScrollView();if(0==this.isVirtualScroll())return t={top:0,bottom:0,rows:e,start:0,end:0};this.defaultRowHeight;for(var i=this._getViewNowRegion(),n=(this.getScrollTop(),this._vscrollEl.offsetHeight,this._getScrollViewCount()),s=i.start,o=i.end,r=0,a=n;r<a;r+=this.virtualRows){var l=r+this.virtualRows;r<=s&&s<l&&(s=r),r<o&&o<=l&&(o=l)}if(n<o&&(o=n),0==o&&(o=this.virtualRows),(t={top:this._getRangeHeight(0,s),bottom:this._getRangeHeight(o,this._getScrollViewCount()),rows:e=this.__getScrollViewRange(s,o),start:s,end:o,viewStart:s,viewEnd:o}).viewTop=this._getRangeHeight(0,t.viewStart),t.viewBottom=this._getRangeHeight(t.viewEnd,this._getScrollViewCount()),this.virtualColumns){var h=this.getScrollLeft(),d=this._rowsViewEl.offsetWidth;t.startColumn=this._getColumnByScrollLeft(h),t.endColumn=this._getColumnByScrollLeft(h+d),t.columns=this.getUnFrozenColumns().slice(t.startColumn,t.endColumn+1),t.right=this._getColumnAllWidth(),t.viewLeft=this._getRangeWidth(0,t.startColumn)}else t.columns=this.getUnFrozenColumns();return t},_getViewNowRegion:function(){this.defaultRowHeight;var t=this.getScrollTop(),e=this._rowsViewEl.offsetHeight,i=this._getIndexByScrollTop(t),n=this._getIndexByScrollTop(t+e+30),s=this._getScrollViewCount();return s<n&&(n=s),{start:i,end:n}},_canVirtualUpdate:function(){if(!this._viewRegion)return!0;var t=this._getViewNowRegion();return!(this._viewRegion.start<=t.start&&t.end<=this._viewRegion.end)},__OnColumnsChanged:function(t){this.columns=this._columnModel.columns,this._doUpdateFilterRow(),this._doUpdateSummaryRow(),this._doUpdateRenderCallBack(),0==this.getVisibleRows().length?this.doUpdate():this.deferUpdate(),this.isVirtualScroll()&&this.__OnVScroll(),this.fire("columnschanged")},doLayout:function(){0!=this.canLayout()&&(mini.ScrollGridView.superclass.doLayout.call(this),this._layoutScroll(),mini.isNumber(this._scrollTop)&&this._vscrollEl.scrollTop!=this._scrollTop&&(this._vscrollEl.scrollTop=this._scrollTop))},_createRowsHTML:function(t,e,i,n,s,o){var r=this.isVirtualScroll();if(!r)return mini.ScrollGridView.superclass._createRowsHTML.apply(this,arguments);r&&this._viewRegion;var a=['<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0" >'];if(a.push(this._createTopRowHTML(t)),this.isVirtualScroll()){var l=0==n?"display:none;":"";a.push('<tr class="mini-grid-virtualscroll-top" style="padding:0;border:0;'+l+'"><td colspan="'+t.length+'" style="height:'+n+"px;padding:0;border:0;"+l+'"></td></tr>')}new Date;if(1==e&&0==this.isFrozen()||3==e&&0==this.isFrozenRight());else for(var h=0,d=i.length;h<d;h++){var u=i[h];
//if (!record) continue;//???????????????????????
this._createRowHTML(u,o,t,e,a),o++}return this.isVirtualScroll()&&a.push('<tr class="mini-grid-virtualscroll-bottom" style="padding:0;border:0;"><td colspan="'+t.length+'" style="height:'+s+'px;padding:0;border:0;"></td></tr>'),a.push("</table>"),a.join("")},doUpdateRows:function(){if(0!=this.isVirtualScroll()){var t=this._getViewRegion();this._viewRegion=t;var e=this.getFrozenColumns(),i=this.getFrozenRightColumns(),n=t.columns,s=t.viewStart;t.start,t.viewEnd;if(this._scrollPaging){var o=this.getPageIndex()*this.getPageSize();s-=o,o,o}var r=this._createRowsHTML(e,1,t.rows,t.viewTop,t.viewBottom,s),a=this._createRowsHTML(i,3,t.rows,t.viewTop,t.viewBottom,s),l=this._createRowsHTML(n,2,t.rows,t.viewTop,t.viewBottom,s);this._rowsLockContentEl.innerHTML=r,this._rowsRightLockContentEl.innerHTML=a,this._rowsViewContentEl.innerHTML=l;var h=this._rowsViewContentEl.firstChild;if(this.virtualColumns){l='<div style="position:absolute;top:0px;left:'+t.right+'px;width:1px;height:1px;overflow:hidden;"></div>';jQuery(l).appendTo(this._rowsViewContentEl),h.style.width="0px",h.style.position="absolute",h.style.top="0px",h.style.left=t.viewLeft+"px"}var d=this.getScrollTop();this._rowsViewEl.scrollTop!=d&&this._syncScrollOffset(null,d)}else mini.ScrollGridView.superclass.doUpdateRows.call(this)},_create:function(){mini.ScrollGridView.superclass._create.call(this),this._vscrollEl=mini.append(this._rowsEl,'<div class="mini-grid-vscroll"><div class="mini-grid-vscroll-content"></div></div>'),this._vscrollContentEl=this._vscrollEl.firstChild},_initEvents:function(){mini.ScrollGridView.superclass._initEvents.call(this);var e=this;mini.on(this._vscrollEl,"scroll",this.__OnVScroll,this),mini._onScrollDownUp(this._vscrollEl,function(t){e._VScrollMouseDown=!0},function(t){e._VScrollMouseDown=!1})},_layoutScroll:function(){var t=this.isVirtualScroll();if(t){var e=this.getScrollHeight(),i=e>this._rowsViewEl.offsetHeight;if(t&&i?(this._vscrollEl.style.display="block",this._vscrollContentEl.style.height=e+"px",this._showVs=!0):(this._vscrollEl.style.display="none",this._showVs=!1),this._rowsViewEl.scrollWidth>this._rowsViewEl.clientWidth+1){var n=this.getBodyHeight(!0);n<0&&(n=0),this._vscrollEl.style.height=n+"px"}else this._vscrollEl.style.height="100%"}else this._vscrollEl.style.display="none"},getScrollHeight:function(){var t=this.getVisibleRows();return this._getRangeHeight(0,t.length)},setScrollTop:function(t){this._showVs&&(this._vscrollEl.scrollTop=t),this.isFrozenRight()?this._rowsRightLockEl.scrollTop=t:this._rowsViewEl.scrollTop=t},getScrollTop:function(){return this.isVirtualScroll()?this._vscrollEl.scrollTop:this._rowsViewEl.scrollTop},__OnVScroll:function(t){if(this.isVirtualScroll()){this._scrollTop=this._vscrollEl.scrollTop;var e=this;setTimeout(function(){e._syncScrollOffset(null,e._scrollTop),e.__scrollTimer=null},8),this._scrollTopTimer&&clearTimeout(this._scrollTopTimer),this._scrollTopTimer=setTimeout(function(){e._scrollTopTimer=null,e._tryUpdateScroll(),e._syncScrollOffset(null,e._scrollTop)},150)}},wheelIncrement:0,setWheelIncrement:function(t){this.wheelIncrement=t},getWheelIncrement:function(){return this.wheelIncrement},__OnMouseWheel:function(t){var e=t.wheelDelta?t:t.originalEvent,i=e.wheelDelta||40*-e.detail;0<i?i+=this.wheelIncrement:i-=this.wheelIncrement;var n=this.getScrollTop()-i,s=this.getScrollTop();this.setScrollTop(n),this.isVirtualScroll()&&this.isFrozen()&&this._syncScroll(),s==this.getScrollTop()&&!this.isVirtualScroll()||t.preventDefault()},_tryUpdateScroll:function(){if(this._canVirtualUpdate())if(this._scrollPaging){this.reload(null,null,function(t){})}else{new Date;var t=this._rowsViewEl.scrollLeft;this._doRemoveRowContent(),this.doUpdateRows(),this.deferLayout(50),this._syncScrollOffset(t)}},_updateScrollTop:function(t){this._syncScrollOffset(null,t),this._tryUpdateScroll()},__OnRowViewScroll:function(t){this._syncScroll(),this.virtualColumns&&this.doVirtualColumns()},doVirtualColumns:function(){var t=this;t._virtualColumnTimer&&(clearTimeout(t._virtualColumnTimer),t._virtualColumnTimer=null),t._virtualColumnTimer=setTimeout(function(){t._virtualColumnTimer=null,t._doRemoveRowContent(),t.doUpdateRows(),t.deferLayout(50)},500)}}),mini.regClass(mini.ScrollGridView,"ScrollGridView"),mini._onScrollDownUp=function(t,e,i){function n(t){mini.un(document,"mousemove",n),i(t)}function s(t){mini.un(document,"mouseup",s),i(t)}mini.on(t,"mousedown",function o(t){mini.isFirefox?mini.on(document,"mouseup",s):mini.on(document,"mousemove",n),e(t)})},mini.mousewheelEditable=!1,mini._Grid_Select=function(t){this.owner=t,el=t.el,t.on("rowmousemove",this.__OnRowMouseMove,this),mini.on(t._viewportEl,"mouseout",this.__OnMouseOut,this),mini.on(t._viewportEl,"mousewheel",this.__OnMouseWheel,this),mini.on(document,"mousewheel",this.__OnMouseWheel,this),t.on("cellmousedown",this.__OnCellMouseDown,this),t.on("cellmouseup",this.__OnGridCellClick,this),t.on("celldblclick",this.__OnGridCellClick,this),mini.on(t.el,"keydown",this.__OnGridKeyDown,this),jQuery(t._columnsEl).on("mouseenter",".mini-grid-headerCell",function(t){jQuery(t.currentTarget).addClass("mini-grid-header-over")}),jQuery(t._columnsEl).on("mouseleave",".mini-grid-headerCell",function(t){jQuery(t.currentTarget).removeClass("mini-grid-header-over")})},mini._Grid_Select.prototype={__OnGridKeyDown:function(t){var e=this.owner,i=mini.findParent(t.target,"mini-grid-detailRow"),n=!!i&&mini.isAncestor(e.el,i);if(!(mini.isAncestor(e._filterEl,t.target)||mini.isAncestor(e._summaryEl,t.target)||mini.isAncestor(e._toolbarEl,t.target)||mini.isAncestor(e._footerEl,t.target)||mini.findParent(t.target,"mini-grid-detailRow")&&n||mini.findParent(t.target,"mini-grid-rowEdit")||mini.findParent(t.target,"mini-tree-editinput"))){var s=e.getCurrentCell();if(!(t.shiftKey||t.ctrlKey||t.altKey)){37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode||t.preventDefault();var o=e.getVisibleColumns(),r=s?s[1]:null,a=s?s[0]:null;s||(a=e.getCurrent());var l=o.indexOf(r),h=function c(t){return e.getVisibleRows().indexOf(t)}(a),d=function m(){return e.getVisibleRows().length}();switch(t.keyCode){case 9:if(e.allowCellEdit&&e.editOnTabKey)return t.preventDefault(),void e._beginEditNextCell(0==t.shiftKey,!0);break;case 27:break;case 13:if(e.allowCellEdit&&e.editNextOnEnterKey&&r&&(e.isEditingCell(s)||!r.editor))return void e._beginEditNextCell(0==t.shiftKey);e.allowCellEdit&&s&&!r.readOnly&&!e.isReadOnly()&&e.beginEditCell();break;case 37:r?0<l&&(l-=1):l=0;break;case 38:a?0<h&&(h-=1):h=0,0!=h&&e.isVirtualScroll();break;case 39:r?l<o.length-1&&(l+=1):l=0;break;case 40:a?h<d-1&&(h+=1):h=0;break;default:return}if(r=o[l],a=function f(t){return e.getVisibleRows()[t]}(h),r&&a&&e.allowCellSelect){s=[a,r];e.setCurrentCell(s),e.scrollIntoView(a,r,!1)}if(!e.onlyCheckSelection&&37!=t.keyCode&&39!=t.keyCode&&a&&e.allowRowSelect){var u={record:a,selected:a,cancel:!1,htmlEvent:t};if(a&&(e.fire("beforerowselect",u),e.fire("beforeselect",u)),u.cancel)return;e.deselectAll(),e.setCurrent(a),a&&e.scrollIntoView(a,null,!1)}}}},__OnMouseWheel:function(t){var e=this.owner;if(t.stopPropagation(),!mini.mousewheelEditable){
//        if (gridEl != grid.el) {
var i=e._editingControl;i&&i.within(t)||e.allowCellEdit&&e.commitEdit()}},__OnGridCellClick:function(t){var e=this.owner,i=t.type;new Date;if("cellmouseup"==i&&(i="cellclick"),0!=e.allowCellEdit&&e.cellEditAction==i){var n=t.record,s=t.column;s.readOnly||e.isReadOnly()||t.htmlEvent.shiftKey||t.htmlEvent.ctrlKey||e.beginEditCell(n,s)}},__OnCellMouseDown:function(t){var e=this;!e.owner.selectOnRightClick&&3==t.htmlEvent.which||setTimeout(function(){//!!必须延迟1秒（不能删除）
e.__doSelect(t)},1)},__OnRowMouseMove:function(t){var e=this.owner,i=t.record;e.enabled&&0!=e.enableHotTrack&&e.focusRow(i)},__OnMouseOut:function(t){this.owner.allowHotTrackOut&&this.owner.focusRow(null)},__doSelect:function(t){var e=t.record,i=t.column,n=this.owner;if(!1!==e.enabled){if(n.allowCellSelect){var s=[e,i];n.setCurrentCell(s)}if((!n.onlyCheckSelection||i._multiRowSelect)&&n.allowRowSelect){var o={record:e,selected:e,cancel:!1,htmlEvent:t};if(e&&(n.isSelected(e)||(n.fire("beforerowselect",o),n.fire("beforeselect",o))),o.cancel)return;if(n.getMultiSelect())if(n.el.onselectstart=function(){},t.htmlEvent.shiftKey){n.el.onselectstart=function(){return!1};try{t.htmlEvent.preventDefault()}catch(o){}var r=n.getCurrent();r?(n.deselectAll(),n.selectRange(r,e),n.setCurrent(r)):(n.select(e),n.setCurrent(e))}else{if(n.el.onselectstart=function(){},t.htmlEvent.ctrlKey){n.el.onselectstart=function(){return!1};try{t.htmlEvent.preventDefault()}catch(o){}}!0===t.column._multiRowSelect||t.htmlEvent.ctrlKey||n.allowUnselect?n.isSelected(e)?n.deselect(e):(n.select(e),n.setCurrent(e)):n.isSelected(e)||(n.deselectAll(),n.select(e),n.setCurrent(e))}else n.isSelected(e)?(t.htmlEvent.ctrlKey||n.allowUnselect)&&n.deselectAll():(n.deselectAll(),n.select(e))}
//            return grid.onlyCheckSelection && !column._multiRowSelect;
}}},mini._Grid_RowGroup=function(t){this.owner=t,el=t.el,mini.on(t._bodyEl,"click",this.__OnClick,this)},mini._Grid_RowGroup.prototype={__OnClick:function(t){var e=this.owner,i=e._getRowGroupByEvent(t);if(i){if(!e.groupTitleCollapsible&&!mini.hasClass(t.target,"mini-grid-group-ecicon"))return;var n={htmlEvent:t,cancel:!1,group:i};if(e.fire("beforegroupclick",n),!0===n.cancel)return;e.toggleRowGroup(i)}}},mini._Grid_ColumnsMenu=function(t){this.owner=t,this.menu=this.createMenu(),mini.on(t.el,"contextmenu",this.__OnContextMenu,this),t.on("destroy",this.__OnGridDestroy,this)},mini._Grid_ColumnsMenu.prototype={__OnGridDestroy:function(t){this.menu&&this.menu.destroy(),this.menu=null},createMenu:function(){var t=mini.create({type:"menu",hideOnClick:!1});return t.on("itemclick",this.__OnItemClick,this),jQuery(t.el).addClass("mini-menu-open"),t},updateMenu:function(){for(var t=this.owner,e=this.menu,i=t.getBottomColumns(),n=[],s=0,o=i.length;s<o;s++){var r=i[s];if(!r.hideable){var a={};a.checked=r.visible,a.checkOnClick=!0,a.text=t._createHeaderText(r),"&nbsp;"==a.text&&("indexcolumn"==r.type&&(a.text="序号"),"checkcolumn"==r.type&&(a.text="选择")),n.push(a),a.enabled=r.enabled,a._column=r}}e.setItems(n)},__OnContextMenu:function(t){var e=this.owner;if(0!=e.showColumnsMenu&&0!=mini.isAncestor(e._columnsEl,t.target))return this.updateMenu(),this.menu.showAtPos(t.pageX,t.pageY),!1},__OnItemClick:function(t){for(var e=this.owner,i=this.menu,n=(e.getBottomColumns(),i.getItems()),s=t.item,o=s._column,r=0,a=0,l=n.length;a<l;a++){n[a].getChecked()&&r++}r<1&&s.setChecked(!0),s.getChecked()?e.showColumn(o):e.hideColumn(o)}},mini._Grid_CellToolTip=function(t){this.owner=t,mini.on(this.owner.el,"mousemove",this.__OnGridMouseMove,this)},mini._Grid_CellToolTip.prototype={__OnGridMouseMove:function(t){var i=this.owner;if(mini.hasClass(t.target,"mini-grid-headerCell-inner")){if((s=t.target).scrollWidth>s.clientWidth){var e=s.innerText||s.textContent||"";s.title=e.trim()}else s.title=""}else{var n=i._getCellByEvent(t),s=i._getCellEl(n[0],n[1]),o=i.getCellError(n[0],n[1]);if(s){if(o)return void setTimeout(function(){s.title=o.errorText},10);setTimeout(function(){var t=s;if(s.firstChild&&(mini.hasClass(s.firstChild,"mini-grid-cell-inner")&&(t=s.firstChild),mini.hasClass(s.firstChild,"mini-tree-nodetitle")&&(t=s.firstChild)),t.scrollWidth>t.clientWidth&&i.getShowCellTip()&&n[1].showCellTip){var e=t.innerText||t.textContent||"";s.title=e.trim()}else s.title=""},10)}}}},mini._Grid_Sorter=function(t){this.owner=t,this.owner.on("headercellclick",this.__OnGridHeaderCellClick,this),this.owner.on("headercelldblclick",this.__OnGridHeaderCellClick,this),mini.on(t._headerEl,"mousemove",this.__OnGridHeaderMouseMove,this),mini.on(t._headerEl,"mouseout",this.__OnGridHeaderMouseOut,this)},mini._Grid_Sorter.prototype={__OnGridHeaderMouseOut:function(t){this._focusedColumnEl&&mini.removeClass(this._focusedColumnEl,"mini-grid-headerCell-hover")},__OnGridHeaderMouseMove:function(t){var e=mini.findParent(t.target,"mini-grid-headerCell");e&&(mini.addClass(e,"mini-grid-headerCell-hover"),this._focusedColumnEl=e)},__OnGridHeaderCellClick:function(t){var e=this.owner,i=t.htmlEvent.type;if(("dblclick"!=i||e.sortDblClick)&&("click"!=i||!e.sortDblClick)&&mini.hasClass(t.htmlEvent.target,"mini-grid-headerCell-inner")&&e.allowSortColumn&&0==e.isEditing()){var n=t.column;if(!n.columns||0==n.columns.length){var s=n.sortField||n.field;if(s&&!1!==n.allowSort)if(e.allowCancelSort&&"desc"==e.getSortOrder())e.clearSort();else{var o="asc";e.getSortField()==s&&(o="asc"==e.getSortOrder()?"desc":"asc"),e.sortBy(s,o)}}}}},mini._Grid_ColumnMove=function(t){this.owner=t,mini.on(this.owner.el,"mousedown",this.__onGridMouseDown,this)},mini._Grid_ColumnMove.prototype={__onGridMouseDown:function(t){var e=this.owner;if(!e.isEditing()&&!mini.hasClass(t.target,"mini-grid-column-splitter")&&t.button!=mini.MouseButton.Right){var i=mini.findParent(t.target,e._headerCellCls);if(i){this._remove();var n=e._getColumnByEvent(t);e.allowMoveColumn&&n&&n.allowMove&&(this.dragColumn=n,this._columnEl=i,this.getDrag().start(t))}}},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!1,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){var i=this.owner;this._dragProxy=mini.append(document.body,'<div class="mini-grid-columnproxy"></div>'),this._dragProxy.innerHTML='<div class="mini-grid-columnproxy-inner" style="height:26px;">'+function n(t){var e=t.header;return"function"==typeof e&&(e=e.call(i,t)),!mini.isNull(e)&&""!==e||(e="&nbsp;"),e}(this.dragColumn)+"</div>",mini.setXY(this._dragProxy,t.now[0]+15,t.now[1]+18),mini.addClass(this._dragProxy,"mini-grid-no"),this.moveTop=mini.append(document.body,'<div class="mini-grid-movetop"></div>'),this.moveBottom=mini.append(document.body,'<div class="mini-grid-movebottom"></div>')},_OnDragMove:function(t){var e=this.owner,i=t.now[0];if(mini.setXY(this._dragProxy,i+15,t.now[1]+18),this.targetColumn=this.insertAction=null,mini.findParent(t.event.target,e._headerCellCls)){var n=e._getColumnByEvent(t.event);if(n&&n!=this.dragColumn)if(e.getParentColumn(this.dragColumn)==e.getParentColumn(n)){this.targetColumn=n,this.insertAction="before";var s=e.getColumnBox(this.targetColumn);i>s.x+s.width/2&&(this.insertAction="after")}}if(this.targetColumn){mini.addClass(this._dragProxy,"mini-grid-ok"),mini.removeClass(this._dragProxy,"mini-grid-no");var o=e.getColumnBox(this.targetColumn);this.moveTop.style.display="block",this.moveBottom.style.display="block","before"==this.insertAction?(mini.setXY(this.moveTop,o.x-4,o.y-9),mini.setXY(this.moveBottom,o.x-4,o.bottom)):(mini.setXY(this.moveTop,o.right-4,o.y-9),mini.setXY(this.moveBottom,o.right-4,o.bottom))}else mini.removeClass(this._dragProxy,"mini-grid-ok"),mini.addClass(this._dragProxy,"mini-grid-no"),this.moveTop.style.display="none",this.moveBottom.style.display="none"},_remove:function(){this.owner;mini.removeNode(this._dragProxy),mini.removeNode(this.moveTop),mini.removeNode(this.moveBottom),this._dragProxy=this.moveTop=this.moveBottom=this.dragColumn=this.targetColumn=null},_OnDragStop:function(t){this.owner.moveColumn(this.dragColumn,this.targetColumn,this.insertAction),this._remove()}},mini._Grid_ColumnSplitter=function(t){this.owner=t,mini.on(t.el,"mousedown",this.__OnMouseDown,this)},mini._Grid_ColumnSplitter.prototype={__OnMouseDown:function(t){var e=this.owner,i=t.target;if(mini.hasClass(i,"mini-grid-column-splitter")){var n=e._getColumnById(i.id);if(e.isEditing())return;e.allowResizeColumn&&n&&n.allowResize&&(this.splitterColumn=n,this.getDrag().start(t))}},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!0,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){var e=this.owner,i=e.getColumnBox(this.splitterColumn);this.columnBox=i,this._dragProxy=mini.append(document.body,'<div class="mini-grid-proxy"></div>');var n=e.getGridViewBox();n.x=i.x,n.width=i.width,n.right=i.right,mini.setBox(this._dragProxy,n),e._ignoreClick=!0},_OnDragMove:function(t){var e=this.owner,i=mini.copyTo({},this.columnBox).width+(t.now[0]-t.init[0]);i<e.columnMinWidth&&(i=e.columnMinWidth),i>e.columnMaxWidth&&(i=e.columnMaxWidth),mini.setWidth(this._dragProxy,i)},_OnDragStop:function(t){var e=this.owner,i=mini.getBox(this._dragProxy),n=this,s=e.allowSortColumn;e.allowSortColumn=!1,setTimeout(function(){jQuery(n._dragProxy).remove(),n._dragProxy=null,e.allowSortColumn=s},10);var o=this.splitterColumn,r=parseInt(o.width);if(r+"%"!=o.width){var a=e.getColumnWidth(o),l=parseInt(r/a*i.width);l<e.columnMinWidth&&(l=e.columnMinWidth),e.setColumnWidth(o,l)}setTimeout(function(){e._ignoreClick=!1},100)}},mini._Grid_DragDrop=function(t){this.owner=t,this.owner.on("CellMouseDown",this.__OnGridCellMouseDown,this)},mini._Grid_DragDrop.prototype={__OnGridCellMouseDown:function(t){if(t.htmlEvent.button!=mini.MouseButton.Right){var e=this.owner;if(!e._dragging&&(this.dropObj=e,!mini.findParent(t.htmlEvent.target,"mini-tree-editinput")&&!e.isReadOnly()&&0!=e.isAllowDrag(t.record,t.column))){var i=e._OnDragStart(t.record,t.column);if(!i.cancel){this.dragText=i.dragText;var n=t.record;this.isTree=!!e.isTree,this.beginRecord=n,this._getDrag().start(t.htmlEvent)}}}},_OnDragStart:function(t){var e=this.owner;e._dragging=!0;var i=this.beginRecord;this.dragData=e._getDragData(),-1==this.dragData.indexOf(i)&&this.dragData.push(i),this.feedbackEl=mini.append(document.body,'<div class="mini-feedback"></div>'),this.feedbackEl.innerHTML=this.dragText,this.lastFeedbackClass="",this.enableHotTrack=e.getEnableHotTrack(),e.setEnableHotTrack(!1)},_getDropTargetObj:function(t){var e=mini.findParent(t.target,"mini-grid",500);if(e)return mini.get(e)},_OnDragMove:function(t){this.owner;var e=this._getDropTargetObj(t.event);this.dropObj=e;var i=t.now[0],n=t.now[1];if(mini.setXY(this.feedbackEl,i+15,n+18),e&&e.allowDrop){this.isTree=e.isTree;var s=e._getRecordByEvent(t.event);(this.dropRecord=s)?this.isTree?this.dragAction=this.getFeedback(s,n,3):this.dragAction=this.getFeedback(s,n,2):this.dragAction="no"}else this.dragAction="no";e&&e.allowDrop&&!s&&0==e.getData().length&&(this.dragAction="add"),this.lastFeedbackClass="mini-feedback-"+this.dragAction,this.feedbackEl.className="mini-feedback "+this.lastFeedbackClass,"no"==this.dragAction&&(s=null),this.setRowFeedback(s,this.dragAction)},_OnDragStop:function(t){var e=this.owner,i=this.dropObj;if(e._dragging=!1,mini.removeNode(this.feedbackEl),e.setEnableHotTrack(this.enableHotTrack),this.feedbackEl=null,this.setRowFeedback(null),this.isTree){for(var n=[],s=0,o=this.dragData.length;s<o;s++){for(var r=this.dragData[s],a=!1,l=0,h=this.dragData.length;l<h;l++){var d=this.dragData[l];if(d!=r&&(a=e.isAncestor(d,r)))break}a||n.push(r)}this.dragData=n}if(("add"!=this.dragAction||this.dropRecord||(this.dropRecord=i.getRootNode?i.getRootNode():{__root:!0}),this.dropRecord&&i&&"no"!=this.dragAction)&&!(f=i._OnDragDrop(this.dragData,this.dropRecord,this.dragAction)).cancel){n=f.dragNodes;var u=f.targetNode,c=f.action;if(i.isTree)e==i?i.moveNodes(n,u,c):("move"==i.dropAction?e.removeNodes(n):"copy"==i.dropAction&&(n=mini.clone(n)),i.addNodes(n,u,c));else{var m=i.indexOf(u);"after"==c&&(m+=1),e==i?i.moveRow(n,m):("move"==i.dropAction?e.removeRows(n):"copy"==i.dropAction&&(n=mini.clone(n)),"add"==this.dragAction?i.addRows(n):i.addRows(n,m))}var f={dragNode:f.dragNodes[0],dropNode:f.targetNode,dragAction:f.action,dragNodes:f.dragNodes,targetNode:f.targetNode};i.fire("drop",f)}this.dropRecord=null,this.dragData=null},setRowFeedback:function(t,e){
//        if (this.lastRowFeedback != -1) {
this.owner;var i=this.dropObj;if(this.lastAddDomRow&&i&&i.removeRowCls(this.lastAddDomRow,"mini-tree-feedback-add"),null!=t&&"add"!=this.dragAction||(mini.removeNode(this.feedbackLine),this.feedbackLine=null),null!=(this.lastRowFeedback=t))if("before"==e||"after"==e){this.feedbackLine||(this.feedbackLine=mini.append(document.body,"<div class='mini-feedback-line'></div>")),this.feedbackLine.style.display="block";var n=i.getRowBox(t),s=n.x,o=n.y-1;"after"==e&&(o+=n.height),mini.setXY(this.feedbackLine,s,o);var r=i.getBox(!0);mini.setWidth(this.feedbackLine,r.width)}else i.addRowCls(t,"mini-tree-feedback-add"),this.lastAddDomRow=t},getFeedback:function(t,e,i){var n=this.owner,s=this.dropObj,o=s.getRowBox(t),r=o.height,a=e-o.y,l=null;if(-1!=this.dragData.indexOf(t))return"no";var h=!1;if(3==i){h=s.isLeaf(t);for(var d=0,u=this.dragData.length;d<u;d++){var c=this.dragData[d];if(s.isAncestor(c,t)){l="no";break}}}return null==l&&(l=2==i?r/2<a?"after":"before":h&&!1===s.allowLeafDropIn?r/2<a?"after":"before":r/3*2<a?"after":r/3<=a&&a<=r/3*2?"add":"before"),s._OnGiveFeedback(l,this.dragData,t,n).effect},_getDrag:function(){return this.drag||(this.drag=new mini.Drag({onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag}},mini._Grid_Events=function(t){this.owner=t,el=t.el,mini.on(el,"click",this.__OnClick,this),mini.on(el,"dblclick",this.__OnDblClick,this),mini.on(el,"mousedown",this.__OnMouseDown,this),mini.on(el,"mouseup",this.__OnMouseUp,this),mini.on(el,"mousemove",this.__OnMouseMove,this),mini.on(el,"mouseover",this.__OnMouseOver,this),mini.on(el,"mouseout",this.__OnMouseOut,this),mini.on(el,"keydown",this.__OnKeyDown,this),mini.on(el,"keyup",this.__OnKeyUp,this),mini.on(el,"contextmenu",this.__OnContextMenu,this),t.on("rowmousemove",this.__OnRowMouseMove,this),mini.on(window,"resize",this.__windowResize,this)},mini._Grid_Events.prototype={__windowResize:function(){var s=this.owner;setTimeout(function(){!function n(){var t=s._getEditingControl();if(t){var e=s.getCurrentCell(),i=s.getCellBox(e[0],e[1]);s._getEditWrap(i,t),s._setEditorBox(t,i)}}()},100)},_row:null,__OnRowMouseMove:function(t){var e=this.owner,i=t.record;this._row!=i&&(t.record=i,t.row=i,e.fire("rowmouseenter",t)),this._row=i},__OnClick:function(t){this.owner._ignoreClick||this._fireEvent(t,"Click")},__OnDblClick:function(t){this._fireEvent(t,"Dblclick")},__OnMouseDown:function(i){var n=this.owner;if(!mini.findParent(i.target,"mini-tree-editinput")&&!mini.findParent(i.target,"mini-tree-node-ecicon")){this._fireEvent(i,"MouseDown");var t=300;"a"==i.target.tagName.toLowerCase()&&i.target.href&&(t=10),setTimeout(function(){!function e(){var t=mini.findParent(i.target,"mini-grid-detailRow");mini.isAncestor(n.el,t)||n._editingCell||n._tryFocus(i)}()},t)}},__OnMouseUp:function(t){if(!mini.findParent(t.target,"mini-tree-editinput")&&!mini.findParent(t.target,"mini-tree-node-ecicon")&&!mini.findParent(t.target,"mini-tree-checkbox")){var e=this.owner;mini.isAncestor(e.el,t.target)&&this._fireEvent(t,"MouseUp")}},__OnMouseMove:function(t){this._fireEvent(t,"MouseMove")},__OnMouseOver:function(t){this._fireEvent(t,"MouseOver")},__OnMouseOut:function(t){this._fireEvent(t,"MouseOut")},__OnKeyDown:function(t){this._fireEvent(t,"KeyDown")},__OnKeyUp:function(t){this._fireEvent(t,"KeyUp")},__OnContextMenu:function(t){this._fireEvent(t,"ContextMenu")},_fireEvent:function(t,e){
//if (!this.enabled) return;
var i=this.owner,n=i._getCellByEvent(t),s=n[0],o=n[1];if(s){var r={record:s,row:s,htmlEvent:t};(a=i["_OnRow"+e])?a.call(i,r):i.fire("row"+e,r)}if(o){r={column:o,field:o.field,htmlEvent:t};(a=i["_OnColumn"+e])?a.call(i,r):i.fire("column"+e,r)}if(s&&o){r={sender:i,record:s,row:s,column:o,field:o.field,htmlEvent:t};(a=i["_OnCell"+e])?a.call(i,r):i.fire("cell"+e,r),o["onCell"+e]&&o["onCell"+e].call(o,r)}if(!s&&o&&mini.findParent(t.target,"mini-grid-headerCell")){var a;r={column:o,htmlEvent:t};if(a=i["_OnHeaderCell"+e])a.call(i,r);else{var l="onheadercell"+e.toLowerCase();o[l]&&(r.sender=i,o[l](r)),i.fire("headercell"+e,r)}}}},mini.DataGrid=function(t){mini.DataGrid.superclass.constructor.call(this,null),this._Events=new mini._Grid_Events(this),this._Select=new mini._Grid_Select(this),this._DragDrop=new mini._Grid_DragDrop(this),this._RowGroup=new mini._Grid_RowGroup(this),this._Splitter=new mini._Grid_ColumnSplitter(this),this._ColumnMove=new mini._Grid_ColumnMove(this),this._Sorter=new mini._Grid_Sorter(this),this._CellToolTip=new mini._Grid_CellToolTip(this),this._ColumnsMenu=new mini._Grid_ColumnsMenu(this),this._createPagers(),t&&mini.applyTo.call(this,t)},mini.extend(mini.DataGrid,mini.ScrollGridView,{uiCls:"mini-datagrid",selectOnLoad:!1,showHeader:!1,showPager:!0,validateOnAdd:!1,getValidateOnAdd:function(){return this.validateOnAdd},setValidateOnAdd:function(t){this.validateOnAdd=t},dropAction:"move",onlyCheckSelection:!1,_$onlyCheckSelection:!0,allowUnselect:!1,allowRowSelect:!0,allowCellSelect:!1,allowCellEdit:!1,cellEditAction:"cellclick",allowCellValid:!1,allowResizeColumn:!0,allowSortColumn:!0,allowMoveColumn:!0,showColumnsMenu:!1,virtualScroll:!1,enableHotTrack:!0,allowHotTrackOut:!0,showLoading:!0,columnMinWidth:8,_expandLoad:function(){},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.url;delete t.url;var n=t.data;delete t.data;var s=t.columns;delete t.columns;var o=t.defaultColumnWidth;return delete t.defaultColumnWidth,o&&this.setDefaultColumnWidth(o),mini.isNull(s)||this.setColumns(s),mini.DataGrid.superclass.set.call(this,t),mini.isNull(n)||this.setData(n),mini.isNull(i)||this.setUrl(i),mini.isNull(e)||this.setValue(e),this},doUpdate:function(){this._destroyEditors(),mini.DataGrid.superclass.doUpdate.apply(this,arguments)},_destroyEditors:function(){for(var t=mini.getChildControls(this),e=[],i=0,n=t.length;i<n;i++){var s=t[i];s.el&&mini.findParent(s.el,this._rowCls)&&(e.push(s),s.destroy())}},_OnDrawCell:function(){
//            if (!e.cellCls) e.cellCls = "";
return mini.DataGrid.superclass._OnDrawCell.apply(this,arguments)},_bindSource:function(){var t=this._dataSource;t.on("beforeload",this.__OnSourceBeforeLoad,this),t.on("preload",this.__OnSourcePreLoad,this),t.on("load",this.__OnSourceLoadSuccess,this),t.on("loaderror",this.__OnSourceLoadError,this),t.on("loaddata",this.__OnSourceLoadData,this),t.on("cleardata",this.__OnSourceClearData,this),t.on("sort",this.__OnSourceSort,this),t.on("filter",this.__OnSourceFilter,this),t.on("pageinfochanged",this.__OnPageInfoChanged,this),t.on("selectionchanged",this.__OnSelectionChanged,this),t.on("currentchanged",function(t){this.fire("currentchanged",t)},this),t.on("add",this.__OnSourceAdd,this),t.on("update",this.__OnSourceUpdate,this),t.on("remove",this.__OnSourceRemove,this),t.on("move",this.__OnSourceMove,this),t.on("beforeadd",function(t){this.fire("beforeaddrow",t)},this),t.on("beforeupdate",function(t){this.fire("beforeupdaterow",t)},this),t.on("beforeremove",function(t){this.fire("beforeremoverow",t)},this),t.on("beforemove",function(t){this.fire("beforemoverow",t)},this),t.on("beforeselect",function(t){this.fire("beforeselect",t)},this),t.on("beforedeselect",function(t){this.fire("beforedeselect",t)},this),t.on("select",function(t){this.fire("select",t)},this),t.on("deselect",function(t){this.fire("deselect",t)},this)},_getMaskWrapEl:function(){return this.el},_initData:function(){this.data=this._dataSource.getSource(),this.pageIndex=this.getPageIndex(),this.pageSize=this.getPageSize(),this.totalCount=this.getTotalCount(),this.totalPage=this.getTotalPage(),this.sortField=this.getSortField(),this.sortOrder=this.getSortOrder(),this.url=this.getUrl(),this._mergedCellMaps={},this._mergedCells={},this._cellErrors=[],this._cellMapErrors={},this.isGrouping()&&(this.groupBy(this._groupField,this._groupDir),this.collapseGroupOnLoad&&this.collapseGroups())},__OnSourceBeforeLoad:function(t){this.fire("beforeload",t),1!=t.cancel&&this.showLoading&&this.loading()},__OnSourcePreLoad:function(t){this.fire("preload",t)},__OnSourceLoadSuccess:function(t){this.fire("load",t),this.unmask()},__OnSourceLoadError:function(t){this.fire("loaderror",t),this.unmask()},__OnSourceSort:function(t){this.deferUpdate(),this.fire("sort",t)},__OnSourceFilter:function(t){this.deferUpdate(),this.fire("filter",t)},__OnSourceAdd:function(t){this._doAddRowEl(t.record,t.index);var e=this;e._addTimer||(e._addTimer=setTimeout(function(){e._addTimer=null,e._doUpdateSummaryRow(),e._viewRegion=e._getViewRegion()},10)),this.fire("addrow",t)},__OnSourceUpdate:function(t){this._doUpdateRowEl(t.record),this._doUpdateSummaryRow(),this.fire("updaterow",t)},__OnSourceRemove:function(t){var e=this;this._doRemoveRowEl(t.record),e._toSummary||(e._toSummary=setTimeout(function(){e._toSummary=null,e._doUpdateSummaryRow()},10)),this.fire("removerow",t),this.isVirtualScroll()&&this.deferUpdate()},__OnSourceMove:function(t){this._doMoveRowEl(t.record,t.index),this._doUpdateSummaryRow(),this.fire("moverow",t)},__OnSelectionChanged:function(t){!1!==t.fireEvent&&(t.select?this.fire("rowselect",t):this.fire("rowdeselect",t));var e=this;this._selectionTimer&&(clearTimeout(this._selectionTimer),this._selectionTimer=null),this._selectionTimer=setTimeout(function(){e._selectionTimer=null,!1!==t.fireEvent&&e.fire("SelectionChanged",t),e.fire("_selectchange",t)},1);new Date;this._doRowSelect(t._records,t.select)},__OnPageInfoChanged:function(t){this._updatePagesInfo()},_updatePagesInfo:function(){for(var t=this.getPageIndex(),e=this.getPageSize(),i=this.getTotalCount(),n=(this.getTotalPage(),this._pagers),s=0,o=n.length;s<o;s++){var r=n[s];r.update(t,e,i),this._dataSource.totalPage=r.totalPage}},setPagerButtons:function(t){this._bottomPager.setButtons(t)},setPager:function(t){if("string"==typeof t){if(!mini.byId(t))return;mini.parse(t),t=mini.get(t)}t&&this.bindPager(t)},bindPager:function(t){t&&(this.unbindPager(t),this._pagers.add(t),t.on("beforepagechanged",this.__OnPageChanged,this))},unbindPager:function(t){t&&(this._pagers.remove(t),t.un("pagechanged",this.__OnPageChanged,this))},__OnPageChanged:function(t){t.cancel=!0,this.gotoPage(t.pageIndex,t.pageSize)},_canUpdateRowEl:!0,_doUpdateRowEl:function(t){var e,i,n,s=this.getFrozenColumns(),o=this.getUnFrozenColumns(),r=this.getFrozenRightColumns(),a=this.indexOf(t),l=this._createRowHTML(t,a,o,2);if(h=this._getRowEl(t,2)){if(jQuery(h).before(l),e=h.previousSibling,h&&h.parentNode.removeChild(h),this.isFrozen()){l=this._createRowHTML(t,a,s,1);var h=this._getRowEl(t,1);jQuery(h).before(l),i=h.previousSibling,jQuery(h).remove()}if(this.isFrozenRight()){l=this._createRowHTML(t,a,r,3),h=this._getRowEl(t,3);jQuery(h).before(l),n=h.previousSibling,jQuery(h).remove()}this.deferLayout(),(e&&i||e&&n||i&&n)&&this._doSyncRowHeight(e,i,n)}},_doAddRowEl:function(t,e){var i=this.getFrozenColumns(),n=this.getUnFrozenColumns(),s=this.getFrozenRightColumns(),o=this._rowsLockContentEl.firstChild,r=this._rowsViewContentEl.firstChild,a=this._rowsRightLockContentEl.firstChild,l=mini.isNumber(e)?e:this.indexOf(t),h=this.getAt(l+1);function d(t,e,i,n){var s=this._createRowHTML(t,l,i,e);if(h){var o=this._getRowEl(h,e);jQuery(o).before(s)}else mini.append(n,s)}if(d.call(this,t,2,n,r),this.isFrozen()&&d.call(this,t,1,i,o),this.isFrozenRight()&&d.call(this,t,3,s,a),this.deferLayout(),this.showEmptyText){var u=jQuery(".mini-grid-emptyText",this._bodyEl)[0];u&&(u.style.display="none",u.parentNode.style.display="none")}},_doRemoveRowEl:function(t){var e=this._getRowEl(t,1),i=this._getRowEl(t,2),n=this._getRowEl(t,3);if(e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i),n&&n.parentNode.removeChild(n),i){var s=this._getRowDetailEl(t,1),o=this._getRowDetailEl(t,2),r=this._getRowDetailEl(t,3);if(s&&s.parentNode.removeChild(s),o&&o.parentNode.removeChild(o),r&&r.parentNode.removeChild(r),this.deferLayout(),this.showEmptyText&&0==this.getVisibleRows().length){var a=jQuery(".mini-grid-emptyText",this._bodyEl)[0];a&&(a.style.display="",a.parentNode.style.display="")}}},_doMoveRowEl:function(t,e){this._doRemoveRowEl(t),this._doAddRowEl(t)},_getRowGroupEl:function(t,e){if(1==e&&!this.isFrozen())return null;var i=this._createRowGroupId(t,e);return mini.byId(i,this.el)},_getRowGroupRowsEl:function(t,e){if(1==e&&!this.isFrozen())return null;var i=this._createRowGroupRowsId(t,e);return mini.byId(i,this.el)},_getRowEl:function(t,e){if(null==e&&(e=2),1==e&&!this.isFrozen())return null;t=this.getRecord(t);var i=this._createRowId(t,e);return mini.byId(i,this.el)},_getHeaderCellEl:function(t,e){if(null==e&&(e=2),1==e&&!this.isFrozen())return null;t=this.getColumn(t);var i=this._createHeaderCellId(t,e);return mini.byId(i,this.el)},getRowEl:function(t,e){return this._getRowEl(t,e)},getHeaderCellEl:function(t,e){return this._getHeaderCellEl(t,e)},_getCellEl:function(t,e){if(t=this.getRecord(t),e=this.getColumn(e),!t||!e)return null;var i=this._createCellId(t,e);return mini.byId(i,this.el)},getCellEl:function(t,e){return this._getCellEl(t,e)},getRecordByEvent:function(t){return this._getRecordByEvent(t)},_getRecordByEvent:function(t){var e=mini.findParent(t.target,this._rowCls);if(!e)return null;var i=e.id.split("$"),n=i[i.length-1];return this._getRowByID(n)},getColumnByEvent:function(t){return t?this._getColumnByEvent(t):null},_getColumnByEvent:function(t){var e=mini.findParent(t.target,this._cellCls);if(e=e||mini.findParent(t.target,this._headerCellCls)){var i=e.id.split("$"),n=i[i.length-1];return this._getColumnById(n)}return null},_getCellByEvent:function(t){return[this._getRecordByEvent(t),this._getColumnByEvent(t)]},getColumnFromEvent:function(t){return t?this._getColumnByEvent(t):null},getCellFromEvent:function(t){return this._getCellByEvent(t)},getRowFromEvent:function(t){var e=this._getCellByEvent(t);return e?e[0]:null},getRowByEvent:function(t){return this.getRowFromEvent(t)},getColumnByEvent:function(t){return this.getColumnFromEvent(t)},getCellByEvent:function(t){return this.getCellFromEvent(t)},_getRowByID:function(t){return this._dataSource.getby_id(t)},_getColumnById:function(t){return this._columnModel._getColumnById(t)},hasRowCls:function(t,e){var i=this._rowClsHash[t._id];return!!i&&-1!=i.indexOf(e)},addRowCls:function(t,e,i){var n=this._getRowEl(t,1),s=this._getRowEl(t,2),o=this._getRowEl(t,3);if(n&&mini.addClass(n,e),s&&mini.addClass(s,e),o&&mini.addClass(o,e),t&&!1!==i){var r=this._rowClsHash[t._id];r?r.remove(e):r=this._rowClsHash[t._id]=[],r.push(e)}},removeRowCls:function(t,e){var i=this._getRowEl(t,1),n=this._getRowEl(t,2),s=this._getRowEl(t,3);if(i&&mini.removeClass(i,e),n&&mini.removeClass(n,e),s&&mini.removeClass(s,e),t){var o=this._rowClsHash[t._id];o&&(o.remove(e),0==o.length&&delete this._rowClsHash[t._id])}},getCellBox:function(t,e){if(t=this.getRow(t),e=this.getColumn(e),!t||!e)return null;var i=this._getCellEl(t,e);return i?mini.getBox(i):null},getColumnBox:function(t){var e=this._createHeaderCellId(t,2),i=document.getElementById(e);if(i||(e=this._createHeaderCellId(t,1),i=document.getElementById(e)),i){var n=mini.getBox(i);return n.x-=1,n.left=n.x,n.right=n.x+n.width,n}},getRowBox:function(t){var e=this._getRowEl(t,1),i=this._getRowEl(t,2);if(!i)return null;var n=mini.getBox(i);if(e){var s=mini.getBox(e);n.x=n.left=s.left,n.width=n.right-n.x}return n},_doRowSelect:function(t,e){var i=this.isVirtualScroll(),n=this._viewRegion,s=i?n.start:-1,o=i?n.end:-1,r={};if(-1!=s)for(var a=this.getVisibleRows(),l=s,h=o;l<h;l++){var d=a[l];d&&(r[d._id]=!0)}for(new Date,l=0,h=t.length;l<h;l++){var u=t[l];-1!=s&&!r[u._id]||(e?this.addRowCls(u,this._rowSelectedCls,!1):this.removeRowCls(u,this._rowSelectedCls))}},_tryFocus:function(t){try{var e=t.target.tagName.toLowerCase();if("input"==e||"textarea"==e||"select"==e)return;if(mini.hasClass(t.target,"mini-placeholder-label"))return;mini.findParent(t.target,"mini-grid-rows-content")&&(mini.setXY(this._focusEl,t.pageX,t.pageY),this.focus(!1))}catch(ex){}},focus:function(t){try{var i=this.getCurrentCell();if(i&&!1!==t){var n=this.getCellBox(i[0],i[1]);mini.setX(this._focusEl,n.x)}var s=this.getCurrent();if(s){var o=this._getRowEl(s,2);if(o){if(!1!==t){var r=mini.getBox(o);mini.setY(this._focusEl,r.top)}mini.isIE||mini.isIE11||mini.isChrome?mini.isChrome?this.el.focus():this._focusEl.focus():this.el.focus()}}else mini.isIE||mini.isIE11||mini.isChrome?this._focusEl.focus():this.el.focus()}catch(e){}},focusRow:function(t){this._focusRow!=t&&(this._focusRow&&this.removeRowCls(this._focusRow,this._rowHoverCls),(this._focusRow=t)&&this.addRowCls(t,this._rowHoverCls,!1),mini.isIE6&&mini.repaint())},scrollIntoView:function(t,i,n){if(t=this.getRow(t)){n=this.isVirtualScroll();try{if(i&&(this._columnModel.isFrozenColumn(i)||this._columnModel.isFrozenRightColumn(i))&&(i=null),i){var s=this._getCellEl(t,i);mini.scrollIntoView(s,this._rowsViewEl,!0,1!=n),this._syncScroll()}if(this.isVirtualScroll()){n=!0;var o=this.getScrollTop(),r=this._vscrollEl.offsetHeight,a=(this._getViewRegion(),this.getVisibleRows().indexOf(t)),l=this._getRangeHeight(0,a),h=l+(t._height||this.defaultRowHeight);l<o?(this.setScrollTop(l),this._updateScrollTop(l)):o+r<h&&(l=o+h-(o+r),this.setScrollTop(l),this._updateScrollTop(l));
//                    if (virtualScroll != false) {
}else{var d=this._getRowEl(t,2);mini.scrollIntoView(d,this._rowsViewEl,!1),this._syncScroll()}}catch(e){}}},setShowLoading:function(t){this.showLoading=t},getShowLoading:function(){return this.showLoading},setEnableHotTrack:function(t){this.enableHotTrack=t},getEnableHotTrack:function(){return this.enableHotTrack},setAllowHotTrackOut:function(t){this.allowHotTrackOut=t},getAllowHotTrackOut:function(){return this.allowHotTrackOut},setOnlyCheckSelection:function(t){this.onlyCheckSelection=t},getOnlyCheckSelection:function(){return this.onlyCheckSelection},setAllowUnselect:function(t){this.allowUnselect=t},getAllowUnselect:function(){return this.allowUnselect},setAllowRowSelect:function(t){this.allowRowSelect=t},getAllowRowSelect:function(){return this.allowRowSelect},setAllowCellSelect:function(t){this.allowCellSelect=t},getAllowCellSelect:function(){return this.allowCellSelect},setAllowCellEdit:function(t){this.allowCellEdit=t},getAllowCellEdit:function(){return this.allowCellEdit},setCellEditAction:function(t){this.cellEditAction=t},getCellEditAction:function(){return this.cellEditAction},setAllowCellValid:function(t){this.allowCellValid=t},getAllowCellValid:function(){return this.allowCellValid},setAllowResizeColumn:function(t){this.allowResizeColumn=t,mini.removeClass(this.el,"mini-grid-resizeColumns-no"),t||mini.addClass(this.el,"mini-grid-resizeColumns-no")},getAllowResizeColumn:function(){return this.allowResizeColumn},setAllowSortColumn:function(t){this.allowSortColumn=t},getAllowSortColumn:function(){return this.allowSortColumn},setAllowMoveColumn:function(t){this.allowMoveColumn=t},getAllowMoveColumn:function(){return this.allowMoveColumn},setShowColumnsMenu:function(t){this.showColumnsMenu=t},getShowColumnsMenu:function(){return this.showColumnsMenu},setEditNextRowCell:function(t){this.editNextRowCell=t},getEditNextRowCell:function(){return this.editNextRowCell},setEditNextOnEnterKey:function(t){this.editNextOnEnterKey=t},getEditNextOnEnterKey:function(){return this.editNextOnEnterKey},setEditOnTabKey:function(t){this.editOnTabKey=t},getEditOnTabKey:function(){return this.editOnTabKey},setCreateOnEnter:function(t){this.createOnEnter=t},getCreateOnEnter:function(){return this.createOnEnter},_currentCell:null,_doCurrentCell:function(t){if(this._currentCell){var e=this._currentCell[0],i=this._currentCell[1],n=this._getCellEl(e,i);n&&(t?mini.addClass(n,this._cellSelectedCls):mini.removeClass(n,this._cellSelectedCls))}},setCurrentCell:function(t){if(this._currentCell!=t){if(this._doCurrentCell(!1),this._currentCell=t){var e=this.getRow(t[0]),i=this.getColumn(t[1]);this._currentCell=e&&i?[e,i]:null}if(this._doCurrentCell(!0),t)this._getAnchorCell(t[0],t[1])||(this.isFrozen()||this.isFrozenRight()?
//if (!this.virtualScroll) {
this.scrollIntoView(t[0],null,!1):this.scrollIntoView(t[0],t[1],!1));this.fire("currentcellchanged")}},getCurrentCell:function(){var t=this._currentCell;return t&&-1==this.indexOf(t[0])&&(t=this._currentCell=null),t},_editingCell:null,isEditingCell:function(t){return this._editingCell&&this._editingCell[0]==t[0]&&this._editingCell[1]==t[1]},beginEditCell:function(t,e){this._pushUpdateCallback(function n(t,e){new Date;var i=[t=this.getRow(t),e=this.getColumn(e)];if(t&&e&&this.setCurrentCell(i),i=this.getCurrentCell(),(!this._editingCell||!i||this._editingCell[0]!=i[0]||this._editingCell[1]!=i[1])&&(this._editingCell&&this.commitEdit(),i)){t=i[0];if("inline"!=(e=i[1]).editMode)!1!==this._OnCellBeginEdit(t,e,this.getCellEditor(e))&&(this.scrollIntoView(t,e,!1),this._editingCell=i,this._OnCellShowingEdit(t,e))}},this,[t,e])},cancelEdit:function(){if(this.allowCellEdit)this._editingCell&&this._OnCellEndEdit();else if(this.isEditing()){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){1==t[e]._editing&&this.cancelEditRow(e)}this._allowLayout=!0,this.doLayout()}},commitEdit:function(){if(this.allowCellEdit)this._editingCell&&(this._OnCellCommitEdit(this._editingCell[0],this._editingCell[1]),this._OnCellEndEdit());else if(this.isEditing()){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];1==n._editing&&this.commitEditRow(n)}this._allowLayout=!0,this.doLayout()}},getCellEditor:function(t,e){if(t=this.getColumn(t)){if(this.allowCellEdit){var i=t.__editor;if((i=i||mini.getAndCreate(t.editor))&&i!=t.__editor){if(i.setUrl&&window.epoint&&window.epoint.getCache&&window.Util&&window.Util.getRightUrl&&window.DtoUtils&&window.DtoUtils.bindBeforeLoad&&!i.url&&i.action){var n=i.action.indexOf("."),s=-1<n?i.action.substring(0,n):epoint.getCache("action"),o=i.action.substring(n+1);s&&(DtoUtils.bindBeforeLoad(i.el),i.setUrl(Util.getRightUrl("rest/"+s+"/"+o)))}t.editor=i,t.__editor=i}return i}if(e=this.getRow(e),t=this.getColumn(t),!(e=e||this.getEditingRow())||!t)return null;var r=this.uid+"$"+e._uid+"$"+t._id+"$editor";return mini.get(r)}},_OnCellBeginEdit:function(t,e,i,n){var s=mini._getMap(e.field,t),o={sender:this,rowIndex:this.indexOf(t),row:t,record:t,column:e,field:e.field,editor:i,value:s,cancel:!1};if(this.fire("cellbeginedit",o),!mini.isNull(e.defaultValue)&&(mini.isNull(o.value)||""===o.value)){var r=e.defaultValue,a=mini.clone({d:r});o.value=a.d}i=o.editor;if(s=o.value,o.cancel)return!1;
//if (!editor) return false;
//column.editor = editor;   //!!!不能加
if(!i&&"inline"!=e.editMode)return!1;if(!0===e.readOnly)return!1;if(!1===n)return!0;
//        if (column.editMode != "inline") {
if("inline"!=e.editMode){if(mini.isNull(s)&&(s=""),i.setValue&&i.setValue(s),i.ownerRowID=t._uid,e.displayField&&i.setText){var l=mini._getMap(e.displayField,t);if(!mini.isNull(e.defaultText)&&(mini.isNull(l)||""===l))l=(a=mini.clone({d:e.defaultText})).d;i.setText(l)}this.allowCellEdit&&(this._editingControl=o.editor)}return!0},_OnCellCommitEdit:function(t,e,i,n){var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:n||this.getCellEditor(e),value:mini.isNull(i)?"":i,text:"",cancel:!1};if(s.editor&&s.editor.getValue){try{s.editor.blur()}catch(ex){}s.value=s.editor.getValue()}s.editor&&s.editor.getText&&(s.text=s.editor.getText());var o=mini._getMap(e.field,t),r=s.value;if(s.oldValue=o,mini.isEquals(o,r))return s;if(this.fire("cellcommitedit",s),0==s.cancel&&this.allowCellEdit){var a={};a[e.field]=s.value,e.displayField&&(a[e.displayField]=s.text),this.updateRow(t,a)}return s},_OnCellEndEdit:function(t,e){if(this._editingCell||t){t=t||this._editingCell[0],e=e||this._editingCell[1];var i=mini._getMap(e.field,t),n={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,editor:this._editingControl,value:i};if(this.fire("cellendedit",n),this.allowCellEdit&&n.editor){var s=n.editor;s&&s.setIsValid&&s.setIsValid(!0),this._editWrap&&(this._editWrap.style.display="none");for(var o=this._editWrap.childNodes,r=o.length-1;0<=r;r--){var a=o[r];this._editWrap.removeChild(a)}s&&s.hidePopup&&s.hidePopup(),s&&s.setValue&&s.setValue(""),this._editingControl=null,this._editingCell=null,this.allowCellValid&&this.validateCell(t,e)}}},_OnCellShowingEdit:function(t,e){if(!this._editingControl)return!1;var i=this.getCellBox(t,e);if(i){var n=document.body.scrollWidth;i.right>n&&(i.width=n-i.left,i.width<10&&(i.width=10),i.right=i.left+i.width)}var s={sender:this,rowIndex:this.indexOf(t),record:t,row:t,column:e,field:e.field,cellBox:i,editor:this._editingControl};this.fire("cellshowingedit",s);var o=s.editor;if(o&&o.setIsValid&&o.setIsValid(!0),i){this._getEditWrap(o);this._editWrap.style.zIndex=mini.getMaxZIndex(),this._setEditorBox(o,i),mini.on(document,"mousedown",this.__OnBodyMouseDown,this),e.autoShowPopup&&o.showPopup&&o.showPopup()}o&&this.navEditMode&&(o.keyNavEnabled=!(!1!==e.navUpdown))},_getEditingControl:function(){return this._editingControl},_setEditorBox:function(t,e){t.setWidth&&((n=e.width)<20&&(n=20),t.setWidth(n));if(t.setHeight&&"textarea"==t.type){var i=e.height-1;t.minHeight&&i<t.minHeight&&(i=t.minHeight),t.setHeight(i)}if(t.setWidth){var n=e.width-1;t.minWidth&&n<t.minWidth&&(n=t.minWidth),t.setWidth(n)}var s=e,o=t.getHeight(),r=s.y;
//if (editor.type != "textarea") {
o<s.height-2&&(r=Math.round(s.y+s.height/2-o/2)),mini.setXY(this._editWrap,s.x,r),mini.setWidth(this._editWrap,s.width);var a=document.body.scrollWidth;s.x>a&&mini.setX(this._editWrap,-1e3)},__OnBodyMouseDown:function(t){if(this._editingControl){var e=this._getCellByEvent(t);if(this._editingCell&&e&&this._editingCell[0]==e.record&&this._editingCell[1]==e.column)return!1;if(0==(this._editingControl.within?this._editingControl.within(t):mini.isAncestor(this._editWrap,t.target))){var i=this;if(0==mini.isAncestor(this._bodyEl,t.target))setTimeout(function(){i.commitEdit()},1);else{var n=i._editingCell;setTimeout(function(){var t=i._editingCell;n==t&&i.commitEdit()},70)}mini.un(document,"mousedown",this.__OnBodyMouseDown,this)}}},getEditWrap:function(){return this._editWrap},_getEditWrap:function(t){
//        //if (editor.type != "textarea") {
return this._editWrap||(this._editWrap=mini.append(this.cellEditorContainer||mini.cellEditorContainer||document.body,'<div class="mini-grid-editwrap" style="position:absolute;"></div>'),mini.on(this._editWrap,"keydown",this.___OnEditControlKeyDown,this)),this._editWrap.style.zIndex=1e9,this._editWrap.style.display="block",t.render?(t.render(this._editWrap),setTimeout(function(){t.focus(),t.selectText&&setTimeout(function(){t.selectText()},11)},50),t.setVisible&&t.setVisible(!0)):t.el&&(this._editWrap.appendChild(t.el),setTimeout(function(){try{t.el.focus()}catch(e){}},50)),this._editWrap},___OnEditControlKeyDown:function(t){var e=this._editingControl;if(13!=t.keyCode||!e||"textarea"!=e.type){if(13==t.keyCode){var i=new Date;if(this._enterTimestamp&&i-this._enterTimestamp<80)return;if(this._enterTimestamp=i,(n=this._editingCell)&&n[1]&&!1===n[1].enterCommit)return;this.commitEdit(),this.focus(),this.editNextOnEnterKey&&(this.fire("celleditenter",{record:n[0],column:n[1]}),this._beginEditNextCell(0==t.shiftKey))}else 27==t.keyCode?(this.cancelEdit(),this.focus()):9==t.keyCode&&(this.commitEdit(),this.editOnTabKey&&(t.preventDefault(),this.commitEdit(),this._beginEditNextCell(0==t.shiftKey,!0)));if(this.navEditMode){if(n=this._editingCell)if((o=n[1])&&!1===o.navUpdown&&e&&(38==t.keyCode||40==t.keyCode))return;switch(t.keyCode){case 37:this.focus(),t.preventDefault(),this.commitEdit(),this._beginEditNextCell(!1!==t.shiftKey);break;case 39:this.focus(),this.commitEdit(),this.editOnTabKey&&(t.preventDefault(),this.commitEdit(),this._beginEditNextCell(0==t.shiftKey,!0));break;case 38:this.focus(),t.preventDefault();var n=this._editingCell;this.commitEdit();var s=n[0],o=n[1];if(!s)return;0<(a=this.indexOf(s))&&(a-=1);var r=[this.getRow(a),o];this.setCurrentCell(r),this.beginEditCell();break;case 40:this.focus(),t.preventDefault();n=this._editingCell;this.commitEdit();var a;s=n[0],o=n[1];if(!s)return;(a=this.indexOf(s))<this.getData().length-1&&(a+=1);r=[this.getRow(a),o];this.setCurrentCell(r),this.beginEditCell()}}}},navEditMode:!1,setNavEditMode:function(t){this.navEditMode=t},getNavEditMode:function(){return this.navEditMode},editNextRowCell:!1,editNextOnEnterKey:!1,editOnTabKey:!0,createOnEnter:!1,skipReadOnlyCell:!1,setSkipReadOnlyCell:function(t){this.skipReadOnlyCell=t},getSkipReadOnlyCell:function(){return this.skipReadOnlyCell},isCellCanEdit:function(t,e){return this._OnCellBeginEdit(t,e,this.getCellEditor(e),!1)},_beginEditNextCell:function(t,e){var i=new Date;if(!(this._editTimestamp&&i-this._editTimestamp<80)){this._editTimestamp=i;var n=this;if(g=this.getCurrentCell()){this.focus();var s=n.getVisibleColumns(),o=g?g[1]:null,r=g?g[0]:null,a=s.indexOf(o),l=function v(t){return n.getVisibleRows().indexOf(t)}(r),h=function y(){return n.getVisibleRows().length}();if(!1===t){if(this.skipReadOnlyCell){var d=this;function u(){for(var t=a-1==0?s.length:a-1;0<t;t--){if(o=s[t],d.isCellCanEdit(r,o))return o}}if(!u()||0==a){a=s.length;u();c()}}else(o=s[a-=1])||(o=s[s.length-1],c());function c(){r=_(l-1)}}else if(this.editNextRowCell&&!e)l+1<h&&(r=_(l+1));else{function m(){if(!(r=n.getAt(l+1))){if(!n.createOnEnter)return;r={},n.addRow(r)}}function f(){for(var t=a+1==p?0:a+1;t<p;t++){if(o=s[t],d.isCellCanEdit(r,o))return o}}if(this.skipReadOnlyCell){d=this;var p=s.length;if(!f()||a+1==p){a=0;f();m()}}else(o=s[a+=1])||(o=s[0],m())}
//            if (!column) {
//                if (!record) {
//            if (this.editNextRowCell && !tab) {
//                if (!column) {
//                    if (!record) {
var g=[r,o];if(n.setCurrentCell(g),!n.onlyCheckSelection&&n.allowRowSelect&&n.getCurrent()!=r&&(n.deselectAll(),n.setCurrent(r)),n.scrollIntoView(r,o,!1),n.isReadOnly()||o.readOnly)return!1;n.beginEditCell()}}
//if (!currentCell) record = grid.getCurrent();
function _(t){return n.getVisibleRows()[t]}},getEditorOwnerRow:function(t){var e=t.ownerRowID;return this.getRowByUID(e)},beginEditRow:function(t){this.allowCellEdit||this._pushUpdateCallback(function h(t){if(new Date,(t=this.getRow(t))&&(e=this._getRowEl(t,2))){
//if (!this.multiEdit) this.cancelEdit();
t._editing=!0,this._doUpdateRowEl(t);var e=this._getRowEl(t,2);mini.addClass(e,"mini-grid-rowEdit");for(var i=this.getVisibleColumns(),n=0,s=i.length;n<s;n++){var o=i[n],r=(t[o.field],this._getCellEl(t,o));if(r){"string"==typeof o.editor&&(o.editor=window.eval("("+o.editor+")"));var a=mini.copyTo({},o.editor);a.id=this.uid+"$"+t._uid+"$"+o._id+"$editor";var l=mini.create(a);this._OnCellBeginEdit(t,o,l)&&l&&(mini.addClass(r,"mini-grid-cellEdit"),r.innerHTML="",r.appendChild(l.el),mini.addClass(l.el,"mini-grid-editor"),l.setValue(t[o.field]))}}this.doLayout()}},this,[t])},cancelEditRow:function(t){if(!this.allowCellEdit&&(t=this.getRow(t))&&t._editing){delete t._editing;this._getRowEl(t);for(var e=this.getVisibleColumns(),i=0,n=e.length;i<n;i++){e[i];var s=this._createCellId(t,e[i]),o=document.getElementById(s);if(o){var r=o.firstChild,a=mini.get(r);a&&a.destroy()}}this._doUpdateRowEl(t),this.doLayout()}},commitEditRow:function(t){if(!this.allowCellEdit&&(t=this.getRow(t))&&t._editing){var e=this.getEditRowData(t,!1,!1);this._canUpdateRowEl=!1,this.updateRow(t,e),this._canUpdateRowEl=!0,this.cancelEditRow(t)}},isEditing:function(){for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){if(1==t[e]._editing)return!0}return!1},isEditingRow:function(t){return!!(t=this.getRow(t))&&!!t._editing},isNewRow:function(t){return"added"==t._state},getEditingRows:function(){for(var t=[],e=this.getDataView(),i=0,n=e.length;i<n;i++){var s=e[i];1==s._editing&&t.push(s)}return t},getEditingRow:function(){return this.getEditingRows()[0]},getEditData:function(t){for(var e=[],i=this.getDataView(),n=0,s=i.length;n<s;n++){if(1==i[n]._editing){var o=this.getEditRowData(n,t);e.push(o)}}return e},getEditRowData:function(t,e,i){if(!(t=this.getRow(t))||!t._editing)return null;for(var n=this.getIdField(),s=this.getParentField?this.getParentField():null,o={},r=this.getVisibleColumns(),a=0,l=r.length;a<l;a++){var h=r[a],d=this._createCellId(t,r[a]),u=document.getElementById(d);if(u){var c=null;if("checkboxcolumn"==h.type||"radiobuttoncolumn"==h.type){var m=h.isChecked(t,h)?h.trueValue:h.falseValue;c=this._OnCellCommitEdit(t,h,m)}else{var f=u.firstChild,p=mini.get(f);if(!p)continue;c=this._OnCellCommitEdit(t,h,null,p)}!1!==i?(mini._setMap(h.field,c.value,o),h.displayField&&mini._setMap(h.displayField,c.text,o)):(o[h.field]=c.value,h.displayField&&(o[h.displayField]=c.text))}}if(o[n]=t[n],s&&(o[s]=t[s]),e){var g=mini.copyTo({},t);o=mini.copyTo(g,o)}return o},collapseGroups:function(){if(this.isGrouping()){this._allowLayout=!1;for(var t=this.getGroupingView(),e=0,i=t.length;e<i;e++){var n=t[e];this.collapseRowGroup(n)}this._allowLayout=!0,this.doLayout()}},expandGroups:function(){if(this.isGrouping()){this._allowLayout=!1;for(var t=this.getGroupingView(),e=0,i=t.length;e<i;e++){var n=t[e];this.expandRowGroup(n)}this._allowLayout=!0,this.doLayout()}},toggleRowGroup:function(t){t.expanded?this.collapseRowGroup(t):this.expandRowGroup(t)},collapseRowGroup:function(t){if(t=this.getRowGroup(t)){t.expanded=!1;var e=this._getRowGroupEl(t,1),i=this._getRowGroupRowsEl(t,1),n=this._getRowGroupEl(t,2),s=this._getRowGroupRowsEl(t,2);i&&(i.style.display="none"),s&&(s.style.display="none"),e&&mini.addClass(e,"mini-grid-group-collapse"),n&&mini.addClass(n,"mini-grid-group-collapse"),this.doLayout()}},expandRowGroup:function(t){if(t=this.getRowGroup(t)){t.expanded=!0;var e=this._getRowGroupEl(t,1),i=this._getRowGroupRowsEl(t,1),n=this._getRowGroupEl(t,2),s=this._getRowGroupRowsEl(t,2);i&&(i.style.display=""),s&&(s.style.display=""),e&&mini.removeClass(e,"mini-grid-group-collapse"),n&&mini.removeClass(n,"mini-grid-group-collapse"),this.doLayout()}},showAllRowDetail:function(){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];this.showRowDetail(n)}this._allowLayout=!0,this.doLayout()},hideAllRowDetail:function(){this._allowLayout=!1;for(var t=this.getDataView(),e=0,i=t.length;e<i;e++){var n=t[e];this.hideRowDetail(n)}this._allowLayout=!0,this.doLayout()},isShowRowDetail:function(t){return!!(t="object"==typeof t?t:this.getRow(t))&&!!t._showDetail},toggleRowDetail:function(t){(t=this.getRow(t))&&(grid.isShowRowDetail(t)?grid.hideRowDetail(t):grid.showRowDetail(t))},showRowDetail:function(t){if((t=this.getRow(t))&&1!=t._showDetail){t._showDetail=!0;var e=this._getRowDetailEl(t,1,!0),i=this._getRowDetailEl(t,2,!0);e&&(e.style.display=""),i&&(i.style.display="");var n=this._getRowEl(t,1),s=this._getRowEl(t,2);n&&mini.addClass(n,"mini-grid-expandRow"),s&&mini.addClass(s,"mini-grid-expandRow"),this.fire("showrowdetail",{record:t});var o=this;this.isFrozen()&&setTimeout(function(){o.syncRowDetail(t)},1),this.doLayout()}},hideRowDetail:function(t){if((t=this.getRow(t))&&!0===t._showDetail){t._showDetail=!1;var e=this._getRowDetailEl(t,1),i=this._getRowDetailEl(t,2);e&&(e.style.display="none"),i&&(i.style.display="none");var n=this._getRowEl(t,1),s=this._getRowEl(t,2);n&&mini.removeClass(n,"mini-grid-expandRow"),s&&mini.removeClass(s,"mini-grid-expandRow"),this.fire("hiderowdetail",{record:t}),this.doLayout()}},_getRowDetailEl:function(t,e,i){if(!(t=this.getRow(t)))return null;var n=this._createRowDetailId(t,e),s=document.getElementById(n);return s||!0!==i||(s=this._createRowDetail(t,e)),s},_createRowDetail:function(t,e){var i=this.getFrozenColumns(),n=this.getUnFrozenColumns(),s=i.length;2==e&&(s=n.length);var o=this._getRowEl(t,e);if(!o)return null;var r=this._createRowDetailId(t,e),a='<tr id="'+r+'" class="mini-grid-detailRow"><td style="width:0"></td><td class="mini-grid-detailCell" colspan="'+s+'"></td></tr>';return jQuery(o).after(a),document.getElementById(r)},_createRowDetailId:function(t,e){return this._id+"$detail"+e+"$"+t._id},getRowDetailCellEl:function(t,e){e=e||2;var i=this._getRowDetailEl(t,e);if(i)return i.cells[1]},autoHideRowDetail:!0,setAutoHideRowDetail:function(t){this.autoHideRowDetail=t},getAutoHideRowDetail:function(){return this.autoHideRowDetail},mergeColumns:function(t){t&&0==mini.isArray(t)&&(t=[t]);var u=this.getVisibleColumns();t=t||u;var c=this.getDataView();c.push({});for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];if(s=this.getColumn(s)){var o=r(s);e.addRange(o)}}function r(t){if(t.field){for(var e=[],i=-1,n=1,s=u.indexOf(t),o=null,r=0,a=c.length;r<a;r++){var l=c[r],h=mini._getMap(t.field,l);
//if (rowIndex == -1 || value != cellValue) {
if(-1!=i&&mini.isEquals(h,o))n++;else{if(1<n){var d={rowIndex:i,columnIndex:s,rowSpan:n,colSpan:1};e.push(d)}i=r,n=1,o=h}}return e}}this.mergeCells(e)},mergeCells:function(t){if(mini.isArray(t)){this._mergedCells=t;var h=this._mergedCellMaps={};if(t=this._mergedCells)for(var e=0,i=t.length;e<i;e++){var n=t[e];n.rowSpan||(n.rowSpan=1),n.colSpan||(n.colSpan=1),s(n.rowIndex,n.columnIndex,n.rowSpan,n.colSpan,n)}this.doUpdate()}function s(t,e,i,n,s){for(var o=t,r=t+i;o<r;o++)for(var a=e,l=e+n;a<l;a++)h[o+":"+a]=o!=t||a!=e||s}},margeCells:function(t){this.mergeCells(t)},_isCellVisible:function(t,e){return!this._mergedCellMaps||!(!0===this._mergedCellMaps[t+":"+e])},_getAnchorCell:function(t,e){if(!this._mergedCellMaps)return null;var i=this.indexOf(t),n=this.getBottomColumns().indexOf(e);return this._mergedCellMaps[i+":"+n]},
//            if (!cells) return;
//                if (!cell.rowSpan) cell.rowSpan = 1;
//                if (!cell.colSpan) cell.colSpan = 1;
//                    if (j != 0) {
_getCellEls:function(t,e,i,n){var s=[];if(!mini.isNumber(t))return[];if(!mini.isNumber(e))return[];this.getVisibleColumns(),this.getDataView();for(var o=t,r=t+i;o<r;o++)for(var a=e,l=e+n;a<l;a++){var h=this._getCellEl(o,a);h&&s.push(h)}return s},_getDragData:function(){var t=this.getSelecteds().clone(),s=this;return mini.sort(t,function(t,e){var i=s.indexOf(t),n=s.indexOf(e);return n<i?1:i<n?-1:0},this),t},_getDragText:function(t){return"Records "+t.length},allowDrag:!1,allowDrop:!1,allowLeafDropIn:!1,setAllowLeafDropIn:function(t){this.allowLeafDropIn=t},getAllowLeafDropIn:function(){return this.allowLeafDropIn},setAllowDrag:function(t){this.allowDrag=t},getAllowDrag:function(){return this.allowDrag},setAllowDrop:function(t){this.allowDrop=t},getAllowDrop:function(){return this.allowDrop},isAllowDrag:function(t,e){return!this.isReadOnly()&&0!=this.enabled&&(!(!this.allowDrag||!e.allowDrag)&&!1!==t.allowDrag)},_OnDragStart:function(t,e){var i={node:t,nodes:this._getDragData(),column:e,cancel:!1};return i.record=i.node,i.records=i.nodes,i.dragText=this._getDragText(i.nodes),this.fire("dragstart",i),i},_OnGiveFeedback:function(t,e,i,n){var s={};return s.from=n,s.effect=t,s.nodes=e,s.node=s.nodes[0],s.targetNode=i,s.dragNodes=e,s.dragNode=s.dragNodes[0],s.dropNode=s.targetNode,s.dragAction=s.action,this.fire("givefeedback",s),s},_OnDragDrop:function(t,e,i){var n={dragNodes:t=t.clone(),targetNode:e,action:i,cancel:!1};return n.dragNode=n.dragNodes[0],n.dropNode=n.targetNode,n.dragAction=n.action,this.fire("beforedrop",n),this.fire("dragdrop",n),n},moveUp:function(t){if(mini.isArray(t))for(var n=this,e=0,i=(t=t.sort(function(t,e){var i=n.indexOf(t);return n.indexOf(e)<i?1:-1})).length;e<i;e++){var s=t[e],o=this.indexOf(s);this.moveRow(s,o-1)}},moveDown:function(t){if(mini.isArray(t)){var n=this;(t=t.sort(function(t,e){var i=n.indexOf(t);return n.indexOf(e)<i?1:-1})).reverse();for(var e=0,i=t.length;e<i;e++){var s=t[e],o=this.indexOf(s);this.moveRow(s,o+2)}}},pageSize:20,pageIndex:0,totalCount:0,totalPage:0,sortField:"",sortOrder:"",url:"",setAjaxAsync:function(t){this._dataSource.ajaxAsync=t,this.ajaxAsync=t},getAjaxAsync:function(){return this._dataSource.ajaxAsync},setAjaxMethod:function(t){this._dataSource.ajaxMethod=t,this.ajaxMethod=t},getAjaxMethod:function(){return this._dataSource.ajaxMethod},setAjaxType:function(t){this._dataSource.ajaxType=t,this.ajaxType=t},getAjaxType:function(){return this._dataSource.ajaxType},setAjaxOptions:function(t){this._dataSource.setAjaxOptions(t)},getAjaxOptions:function(){return this._dataSource.getAjaxOptions()},setAutoLoad:function(t){this._dataSource.setAutoLoad(t)},getAutoLoad:function(){return this._dataSource.getAutoLoad()},setUrl:function(t){this._dataSource.setUrl(t),this.url=t},getUrl:function(){return this._dataSource.getUrl()},load:function(t,e,i,n){this._dataSource.load(t,e,i,n)},reload:function(t,e,i){this.accept(),this._dataSource.reload(t,e,i)},gotoPage:function(t,e){this._dataSource.gotoPage(t,e)},sortBy:function(t,e){if(!t)return null;var i=this._dataSource;if(this.sortField=i.sortField=t,this.sortOrder=i.sortOrder=e,"server"==this._dataSource.sortMode)this._dataSource.sortBy(t,e);else{var n=this._columnModel._getDataTypeByField(t);this._dataSource._doClientSortField(t,e,n)}},sortDblClick:!1,setSortDblClick:function(t){this.sortDblClick=t},getSortDblClick:function(){return this.sortDblClick},showCellTip:!0,setShowCellTip:function(t){this.showCellTip=t},getShowCellTip:function(){return this.showCellTip},setCheckSelectOnLoad:function(t){this._dataSource.setCheckSelectOnLoad(t),this.checkSelectOnLoad=t},getCheckSelectOnLoad:function(){return this._dataSource.getCheckSelectOnLoad()},setSelectOnLoad:function(t){this._dataSource.setSelectOnLoad(t),this.selectOnLoad=t},getSelectOnLoad:function(){return this._dataSource.getSelectOnLoad()},allowCancelSort:!1,setAllowCancelSort:function(t){this.allowCancelSort=t},getAllowCancelSort:function(){return this.allowCancelSort},setSortMode:function(t){this._dataSource.setSortMode(t),this.sortMode=t},getSortMode:function(){return this._dataSource.getSortMode()},setPageIndex:function(t){this._dataSource.setPageIndex(t),this.pageIndex=t},getPageIndex:function(){return this._dataSource.getPageIndex()},setPageSize:function(t){this._dataSource.setPageSize(t),this._virtualRows=t,this.pageSize=t},getPageSize:function(){return this._dataSource.getPageSize()},setTotalCount:function(t){this._dataSource.setTotalCount(t),this.totalCount=t},getTotalCount:function(){return this._dataSource.getTotalCount()},getTotalPage:function(){return this._dataSource.getTotalPage()},setSortField:function(t){this._dataSource.setSortField(t),this.sortField=t},getSortField:function(){return this._dataSource.sortField},setSortOrder:function(t){this._dataSource.setSortOrder(t),this.sortOrder=t},getSortOrder:function(){return this._dataSource.sortOrder},setPageIndexField:function(t){this._dataSource.pageIndexField=t,this.pageIndexField=t},getPageIndexField:function(){return this._dataSource.pageIndexField},setPageSizeField:function(t){this._dataSource.pageSizeField=t,this.pageSizeField=t},getPageSizeField:function(){return this._dataSource.pageSizeField},setStartField:function(t){this._dataSource.startField=t,this.startField=t},getStartField:function(){return this._dataSource.startField},setLimitField:function(t){this._dataSource.limitField=t,this.limitField=t},getLimitField:function(){return this._dataSource.limitField},setSortFieldField:function(t){this._dataSource.sortFieldField=t,this.sortFieldField=t},getSortFieldField:function(){return this._dataSource.sortFieldField},setSortOrderField:function(t){this._dataSource.sortOrderField=t,this.sortOrderField=t},getSortOrderField:function(){return this._dataSource.sortOrderField},setTotalField:function(t){this._dataSource.totalField=t,this.totalField=t},getTotalField:function(){return this._dataSource.totalField},setDataField:function(t){this._dataSource.dataField=t,this.dataField=t},getDataField:function(){return this._dataSource.dataField},setErrorField:function(t){this._dataSource.errorField=t,this.errorField=t},getErrorField:function(){return this._dataSource.errorField},setErrorMsgField:function(t){this._dataSource.errorMsgField=t,this.errorMsgField=t},getErrorMsgField:function(){return this._dataSource.errorMsgField},setStackTraceField:function(t){this._dataSource.stackTraceField=t,this.stackTraceField=t},getStackTraceField:function(){return this._dataSource.stackTraceField},setPageSizeWidth:function(t){this._bottomPager.setPageSizeWidth(t)},getPageSizeWidth:function(){return this._bottomPager.getPageSizeWidth()},getBottomPager:function(){return this._bottomPager},sizeText:"",setSizeText:function(t){this._bottomPager.sizeText=t},getSizeText:function(){return this.sizeText},showPagerButtonText:!1,setShowPagerButtonText:function(t){this._bottomPager.setShowButtonText(t)},getShowPagerButtonText:function(){return this.showPagerButtonText},showPagerButtonIcon:!1,setShowPagerButtonIcon:function(t){this._bottomPager.setShowButtonIcon(t)},getShowPagerButtonIcon:function(){return this.showPagerButtonIcon},setShowReloadButton:function(t){this._bottomPager.setShowReloadButton(t)},getShowReloadButton:function(){return this._bottomPager.getShowReloadButton()},setShowPageInfo:function(t){this._bottomPager.setShowPageInfo(t)},getShowPageInfo:function(){return this._bottomPager.getShowPageInfo()},setSizeList:function(t){mini.isArray(t)&&this._bottomPager.setSizeList(t)},getSizeList:function(){return this._bottomPager.getSizeList()},setShowPageSize:function(t){this._bottomPager.setShowPageSize(t)},getShowPageSize:function(){return this._bottomPager.getShowPageSize()},setShowPageIndex:function(t){this.showPageIndex=t,this._bottomPager.setShowPageIndex(t)},getShowPageIndex:function(){return this._bottomPager.getShowPageIndex()},setShowTotalCount:function(t){this._bottomPager.setShowTotalCount(t)},getShowTotalCount:function(){return this._bottomPager.getShowTotalCount()},setPagerStyle:function(t){this.pagerStyle=t,mini.setStyle(this._bottomPager.el,t)},setPagerCls:function(t){this.pagerCls=t,mini.addClass(this._bottomPager.el,t)},setDropAction:function(t){this.dropAction=t},getDropAction:function(){return this.dropAction},groupTitleCollapsible:!0,setGroupTitleCollapsible:function(t){this.groupTitleCollapsible=t},getGroupTitleCollapsible:function(){return this.groupTitleCollapsible},allowEmptyContextMenu:!1,setAllowEmptyContextMenu:function(t){this.allowEmptyContextMenu=t},getAllowEmptyContextMenu:function(){return this.allowEmptyContextMenu},_beforeOpenContentMenu:function(t,e){mini.isAncestor(this._bodyEl,e.htmlEvent.target)?t.fire("BeforeOpen",e):e.cancel=!0},__OnHtmlContextMenu:function(t){var e={popupEl:this.el,htmlEvent:t,cancel:!1};if(mini.isAncestor(this._columnsEl,t.target)){if(this.headerContextMenu){if(this.headerContextMenu.fire("BeforeOpen",e),1==e.cancel)return;if(this.headerContextMenu.fire("opening",e),1==e.cancel)return;this.headerContextMenu.showAtPos(t.pageX,t.pageY),this.headerContextMenu.fire("Open",e)}}else{var i=mini.findParent(t.target,"mini-grid-detailRow");if(i&&mini.isAncestor(this.el,i))return;
//if (!f && this.uiCls == "mini-tree") return
//            if (!f && this.type == "tree") return
if(!mini.findParent(t.target,"mini-tree-nodeshow")&&"tree"==this.type&&!this.allowEmptyContextMenu)return;if(!this.allowEmptyContextMenu&&!mini.findParent(t.target,"mini-grid-table"))return;if(mini.findParent(t.target,"mini-grid-filterRow"))return;if(mini.findParent(t.target,"mini-grid-summaryRow"))return;if(this.contextMenu){if(this._beforeOpenContentMenu(this.contextMenu,e),1==e.cancel)return;if(this.contextMenu.fire("opening",e),1==e.cancel)return;this.contextMenu.showAtPos(t.pageX,t.pageY),this.contextMenu.fire("Open",e)}}return!1},headerContextMenu:null,setHeaderContextMenu:function(t){var e=this._getContextMenu(t);e&&this.headerContextMenu!==e&&(this.headerContextMenu=e,mini.addClass(e.el,"mini-menu-open"),this.headerContextMenu.owner=this,mini.on(this.el,"contextmenu",this.__OnHtmlContextMenu,this))},getHeaderContextMenu:function(){return this.headerContextMenu},selectOnRightClick:!0,setSelectOnRightClick:function(t){this.selectOnRightClick=t},getSelectOnRightClick:function(){return this.selectOnRightClick},_get_originals:function(){return this._dataSource._originals},_set_originals:function(t){this._dataSource._originals=t},_set_clearOriginals:function(t){this._dataSource._clearOriginals=t},_set_originalIdField:function(t){this._dataSource._originalIdField=t},_set_autoCreateNewID:function(t){this._dataSource._autoCreateNewID=t},getAttrs:function(t){for(var e=mini.DataGrid.superclass.getAttrs.call(this,t),i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],r=mini.getAttr(o,"property");r&&("columns"==(r=r.toLowerCase())?(e.columns=mini._ParseColumns(o),mini.removeNode(o)):"data"==r&&(e.data=o.innerHTML,mini.removeNode(o)))}return mini._ParseString(t,e,["oncelleditenter","onselect","ondeselect","onbeforeselect","onbeforedeselect","url","sizeList","bodyCls","bodyStyle","footerCls","footerStyle","pagerCls","pagerStyle","onheadercellclick","onheadercellmousedown","onheadercellcontextmenu","onrowdblclick","onrowclick","onrowmousedown","onrowcontextmenu","onrowmouseenter","onrowmouseleave","oncellclick","oncellmousedown","oncellcontextmenu","oncelldblclick","onbeforeload","onpreload","onloaderror","onload","onupdate","ondrawcell","oncellbeginedit","onselectionchanged","ondrawgroup","onbeforeshowrowdetail","onbeforehiderowdetail","onshowrowdetail","onhiderowdetail","idField","valueField","pager","oncellcommitedit","oncellendedit","headerContextMenu","loadingMsg","emptyText","cellEditAction","sortMode","oncellvalidation","onsort","ondrawsummarycell","ondrawgroupsummarycell","onresize","oncolumnschanged","ajaxMethod","ajaxOptions","onaddrow","onupdaterow","onremoverow","onmoverow","onbeforeaddrow","onbeforeupdaterow","onbeforeremoverow","onbeforemoverow","pageIndexField","pageSizeField","sortFieldField","sortOrderField","startField","limitField","totalField","dataField","sortField","sortOrder","stackTraceField","errorField","errorMsgField","pagerButtons","onbeforegroupclick","dropAction","sizeText","pagerType","viewType","itemRenderer","summaryPosition","ondragstart","onbeforedrop","ondrop","ongivefeedback"]),mini._ParseBool(t,e,["showColumns","showFilterRow","showSummaryRow","showPager","showFooter","enableGroupOrder","validateOnAdd","showHGridLines","showVGridLines","showSortIcon","allowSortColumn","allowMoveColumn","allowResizeColumn","fitColumns","showLoading","multiSelect","allowAlternating","resultAsData","allowRowSelect","allowUnselect","onlyCheckSelection","allowHotTrackOut","enableHotTrack","showPageIndex","showPageSize","showTotalCount","checkSelectOnLoad","allowResize","autoLoad","autoHideRowDetail","allowCellSelect","allowCellEdit","allowCellWrap","allowHeaderWrap","selectOnLoad","virtualScroll","virtualColumns","collapseGroupOnLoad","showGroupSummary","showEmptyText","alwaysShowEmptyText","allowCellValid","showModified","showColumnsMenu","showPageInfo","showReloadButton","showNewRow","editNextOnEnterKey","createOnEnter","skipReadOnlyCell","ajaxAsync","allowDrag","allowDrop","allowLeafDropIn","editNextRowCell","fixedRowHeight","showCellTip","showPagerButtonText","showPagerButtonIcon","groupTitleCollapsible","navEditMode","selectOnRightClick","sortDblClick","allowEmptyContextMenu","showGroupSummary","allowCancelSort"]),mini._ParseInt(t,e,["frozenStartColumn","frozenEndColumn","frozenRightStartColumn","frozenRightEndColumn","pageSizeWidth","pageIndex","pageSize","defaultRowHeight","defaultColumnWidth","wheelIncrement","summaryRows"]),"string"==typeof e.ajaxOptions&&(e.ajaxOptions=window.eval("("+e.ajaxOptions+")")),"string"==typeof e.sizeList&&(e.sizeList=window.eval("("+e.sizeList+")")),!e.idField&&e.valueField&&(e.idField=e.valueField),e.pagerButtons&&(e.pagerButtons=mini.byId(e.pagerButtons)),e.itemRenderer&&(e.itemRenderer=window[e.itemRenderer]),e}}),mini.regClass(mini.DataGrid,"datagrid"),mini_DataGrid_CellValidator_Prototype={getCellErrors:function(){for(var t=this._cellErrors.clone(),e=this._dataSource,i=0,n=t.length;i<n;i++){var s=t[i],o=s.record;if(!e.getby_id(o._id)){var r=s.column,a=o[this._rowIdField]+"$"+r._id;delete this._cellMapErrors[a],this._cellErrors.remove(s)}}return this._cellErrors},getCellError:function(t,e){if(t=this.getNode?this.getNode(t):this.getRow(t),e=this.getColumn(e),t&&e){var i=t[this._rowIdField]+"$"+e._id;return this._cellMapErrors?this._cellMapErrors[i]:null}},isValid:function(){return 0==this.getCellErrors().length},isCellValid:function(t,e){if(!this._cellMapErrors)return!0;var i=t[this._rowIdField]+"$"+e._id;return!this._cellMapErrors[i]},validate:function(t){t=t||this.getDataView(),mini.isArray(t)||(t=[]);for(var e=0,i=t.length;e<i;e++){var n=t[e];this.validateRow(n)}},validateRow:function(t){for(var e=this.getBottomColumns(),i=0,n=e.length;i<n;i++){var s=e[i];this.validateCell(t,s)}},validateCell:function(t,e){if(t=this.getNode?this.getNode(t):this.getRow(t),e=this.getColumn(e),t&&e&&0!=e.visible){var i=mini._getMap(e.field,t),n={record:t,row:t,node:t,column:e,field:e.field,value:i,isValid:!0,errorText:""};if(e.vtype&&mini._ValidateVType(e.vtype,n.value,n,e),1==n.isValid&&e.unique&&e.field)for(var s={},o=this.data,r=e.field,a=0,l=o.length;a<l;a++){var h=o[a],d=h[r];if(mini.isNull(d)||""===String(d).trim());else{var u=s[d];if(u&&h==t){n.isValid=!1,n.errorText=mini._getErrorText(e,"uniqueErrorText"),this.setCellIsValid(u,e,n.isValid,n.errorText);break}s[d]=h}}this.fire("cellvalidation",n),this.setCellIsValid(t,e,n.isValid,n.errorText)}},setIsValid:function(t){if(t)for(var e=this._cellErrors.clone(),i=0,n=e.length;i<n;i++){var s=e[i];this.setCellIsValid(s.record,s.column,!0)}},_removeRowError:function(t){for(var e=this.getColumns(),i=0,n=e.length;i<n;i++){var s=e[i],o=t[this._rowIdField]+"$"+s._id,r=this._cellMapErrors[o];r&&(delete this._cellMapErrors[o],this._cellErrors.remove(r))}},setCellIsValid:function(t,e,i,n){if(t=this.getRow(t),e=this.getColumn(e),t&&e){var s=t[this._rowIdField]+"$"+e._id,o=this._getCellEl(t,e),r=this._cellMapErrors[s];delete this._cellMapErrors[s],this._cellErrors.remove(r),!0===i?o&&r&&mini.removeClass(o,"mini-grid-cell-error"):(r={record:t,column:e,isValid:i,errorText:n},this._cellMapErrors[s]=r,this._cellErrors.add(r),o&&mini.addClass(o,"mini-grid-cell-error"))}}},mini.copyTo(mini.DataGrid.prototype,mini_DataGrid_CellValidator_Prototype),mini.TreeGrid=function(){mini.TreeGrid.superclass.constructor.apply(this,arguments),mini.addClass(this.el,"mini-tree"),this.setAjaxAsync(!1),this.setAutoLoad(!0),1==this.showTreeLines&&mini.addClass(this.el,"mini-tree-treeLine"),this._AsyncLoader=new mini._Tree_AsyncLoader(this),this._Expander=new mini._Tree_Expander(this),this.setShowArrow(this.showArrow)},mini.copyTo(mini.TreeGrid.prototype,mini._DataTreeApplys),mini.extend(mini.TreeGrid,mini.DataGrid,{isTree:!0,uiCls:"mini-treegrid",showPager:!1,showNewRow:!1,showCheckBox:!1,showRadioButton:!1,showTreeIcon:!0,showExpandButtons:!0,showTreeLines:!1,showArrow:!1,expandOnDblClick:!0,expandOnNodeClick:!1,loadOnExpand:!0,_checkBoxType:"checkbox",iconField:"iconCls",_treeColumn:null,leafIconCls:"mini-tree-leaf",folderIconCls:"mini-tree-folder",fixedRowHeight:!1,_checkBoxCls:"mini-tree-checkbox",_expandNodeCls:"mini-tree-expand",_collapseNodeCls:"mini-tree-collapse",_eciconCls:"mini-tree-node-ecicon",_inNodeCls:"mini-tree-nodeshow",
//        if (!mini.isNull(value)) {
//        if (!mini.isNull(columns)) {
isEditingNode:function(t){return this._editingNode==t},indexOf:function(t){return this._dataSource.indexOfList(t)},_getDragText:function(t){return"Nodes "+t.length},_initEvents:function(){mini.TreeGrid.superclass._initEvents.call(this),this.on("nodedblclick",this.__OnNodeDblClick,this),this.on("nodeclick",this.__OnNodeClick,this),this.on("cellclick",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodeclick",t)},this),this.on("cellmousedown",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodemousedown",t)},this),this.on("celldblclick",function(t){t.node=t.record,t.isLeaf=this.isLeaf(t.node),this.fire("nodedblclick",t)},this),this.on("beforerowselect",function(t){t.node=t.selected,t.isLeaf=this.isLeaf(t.node),this.fire("beforenodeselect",t)},this),this.on("rowselect",function(t){t.node=t.selected,t.isLeaf=this.isLeaf(t.node),this.fire("nodeselect",t)},this);var e=this;this.on("layout",function(){if(e.allowAlternating){var t=$(e._contentEl).find(".mini-grid-rows-content > .mini-grid-table > tbody");t.find("> .mini-grid-row").each(function(t,e){t%2==1&&$(e).addClass("mini-grid-row-alt")}),t.find("> .mini-tree-nodes-tr").each(function(t,e){$(e).prev().addClass("mini-treegrid-expandRow")})}else $(e.el).find(".mini-grid-row-alt").removeClass("mini-grid-row-alt")})},setValue:function(t,e){if(mini.isNull(t)&&(t=""),t=String(t),this.getValue()!=t){var i=this.getCheckedNodes();if(this.uncheckNodes(i,this.checkRecursive),this.value=t,this.showCheckBox){var n=String(t).split(",");this._dataSource.doCheckNodes(n,!0,!1!==e)}else this.selectNode(t,!1)}},getValue:function(t){return this.showCheckBox?(!1===t&&(t="leaf"),this._dataSource.getCheckedNodesId(t)):this._dataSource.getSelectedsId()},getText:function(){var t=[];this.showCheckBox?t=this.getCheckedNodes():(o=this.getSelectedNode())&&t.push(o);for(var e=[],i=this.getTextField(),n=0,s=t.length;n<s;n++){var o=t[n];e.push(o[i])}return e.join(",")},isGrouping:function(){return!1},_createSource:function(){this._dataSource=new mini.DataTree},_bindSource:function(){mini.TreeGrid.superclass._bindSource.call(this);var t=this._dataSource;t.on("expand",this.__OnTreeExpand,this),t.on("collapse",this.__OnTreeCollapse,this),t.on("_checkchanged",this.__OnCheckChanged,this),t.on("addnode",this.__OnSourceAddNode,this),t.on("removenode",this.__OnSourceRemoveNode,this),t.on("movenode",this.__OnSourceMoveNode,this),t.on("beforeloadnode",this.__OnBeforeLoadNode,this),t.on("loadnode",this.__OnLoadNode,this)},__OnBeforeLoadNode:function(t){this.__showLoading=this.showLoading,this.showLoading=!1,this.addNodeCls(t.node,"mini-tree-loading"),this.fire("beforeloadnode",t)},__OnLoadNode:function(t){this.showLoading=this.__showLoading,this.removeNodeCls(t.node,"mini-tree-loading"),this.fire("loadnode",t)},_virtualUpdate:function(){var t=this;t._updateNodeTimer&&(clearTimeout(t._updateNodeTimer),t._updateNodeTimer=null),t._updateNodeTimer=setTimeout(function(){t._updateNodeTimer=null,t.doUpdateRows(),t.deferLayout(50)},5)},__OnSourceAddNode:function(t){var e=this._dataSource.isVisibleNode(t.node);if(1==this.isVirtualScroll())this._virtualUpdate();else if(e)this._doAddNodeEl(t.node);else{var i=this.getParentNode(t.node);this._dataSource.isVisibleNode(i)&&this._doUpdateTreeNodeEl(i)}this.fire("addnode",t)},__OnSourceRemoveNode:function(t){if(1==this.isVirtualScroll())this._virtualUpdate();else{this._doRemoveNodeEl(t.node);var e=this.getParentNode(t.node),i=this.getChildNodes(e);if(0==i.length)this._doUpdateTreeNodeEl(e);else{var n=t.index;1<n&&n==i.length&&this._doUpdateTreeNodeEl(i[i.length-1])}}this.fire("removenode",t)},__OnSourceMoveNode:function(t){this._doMoveNodeEl(t.node),this.fire("movenode",t);var e=t.oldParentNode;if(e!=t.parentNode){var i=this.getChildNodes(e);if(i){var n=i[i.length-1];n&&this._doUpdateTreeNodeEl(n)}}},_doAddNodeEl:function(t){var e=this.getFrozenColumns(),i=this.getUnFrozenColumns(),l=this.getParentNode(t),h=this.indexOf(t),d=!1;function n(t,e,i){var n=this._createRowHTML(t,h,e,i),s=this.indexOfNode(t)+1,o=this.getChildNodeAt(s,l);if(o){var r=this._getNodeEl(o,i);jQuery(r).before(n)}else{var a=this._getNodesEl(l,i);a?mini.append(a.firstChild,n):d=!0}}n.call(this,t,i,2),n.call(this,t,e,1),d&&this._doUpdateTreeNodeEl(l)},_doRemoveNodeEl:function(t){this._doRemoveRowEl(t);var e=this._getNodesEl(t,1),i=this._getNodesEl(t,2);e&&e.parentNode.removeChild(e),i&&i.parentNode.removeChild(i)},_doMoveNodeEl:function(t){if(1==this.isVirtualScroll())this._virtualUpdate();else{this._doRemoveNodeEl(t);var e=this.getParentNode(t);this._doUpdateTreeNodeEl(e)}},_doUpdateNodeTitle:function(t){this._doUpdateTreeNodeEl(t,!1)},_doUpdateTreeNodeEl:function(t,e){if(e=!1!==e,this.getRootNode()!=t){if(this.isVisibleNode(t)){var i=t,n=this.getFrozenColumns(),s=this.getFrozenRightColumns(),o=this.getUnFrozenColumns(),r=this._createNodeHTML(t,n,1,null,e),a=this._createNodeHTML(t,s,3,null,e),l=this._createNodeHTML(t,o,2,null,e),h=this._getNodeEl(t,1),d=this._getNodeEl(t,2),u=this._getNodeEl(t,3),c=this._getNodesTr(t,1),m=this._getNodesTr(t,2),f=this._getNodesTr(t,3),p=this._getRowDetailEl(t,1),g=this._getRowDetailEl(t,2),_=this._getRowDetailEl(t,3),v=(t=(y=mini.createElements(r))[0],y[1]);h&&(mini.before(h,t),e&&(p?mini.after(p,v):mini.before(h,v)),mini.removeNode(h),e&&mini.removeNode(c));t=(y=mini.createElements(l))[0],v=y[1];d&&(mini.before(d,t),e&&(g?mini.after(g,v):mini.before(d,v)),mini.removeNode(d),e&&mini.removeNode(m));var y;t=(y=mini.createElements(a))[0],v=y[1];u&&(mini.before(u,t),e&&(_?mini.after(_,v):mini.before(u,v)),mini.removeNode(u),e&&mini.removeNode(f)),1==t.checked||this.isLeaf(t)||this._doCheckNodeEl(i)}}else this.doUpdate()},addNodeCls:function(t,e){this.addRowCls(t,e)},removeNodeCls:function(t,e){this.removeRowCls(t,e)},doUpdate:function(){mini.TreeGrid.superclass.doUpdate.apply(this,arguments)},setData:function(t){t=t||[],this._dataSource.setData(t)},loadList:function(t,e,i){e=e||this.getIdField(),i=i||this.getParentField();var n=mini.listToTree(t,this.getNodesField(),e,i);this.setData(n)},_createDrawCellEvent:function(t,e,i,n){var s=mini.TreeGrid.superclass._createDrawCellEvent.call(this,t,e,i,n);return s.node=s.record,s.isLeaf=this.isLeaf(s.node),this._treeColumn&&this._treeColumn==e.name&&(s.isTreeCell=!0,s.img=t[this.imgField],s.iconCls=this._getNodeIcon(t),s.nodeCls="",s.nodeStyle="",s.nodeHtml="",s.showTreeIcon=this.showTreeIcon,s.checkBoxType=this._checkBoxType,s.showCheckBox="showCheckBox"in t?t.showCheckBox:this.showCheckBox,s.showRadioButton=this.showRadioButton,s.showCheckBox&&!s.isLeaf&&(s.showCheckBox=this.showFolderCheckBox),s.showRadioButton&&!s.isLeaf&&(s.showRadioButton=this.showFolderCheckBox),s.enabled=!1!==s.node.enabled,s.checkable=this.getCheckable(s.node)),s},_OnDrawCell:function(t,e,i,n){var s=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);return this._treeColumn&&this._treeColumn==e.name&&(this.fire("drawnode",s),s.nodeStyle&&(s.cellStyle=s.nodeStyle),s.nodeCls&&(s.cellCls=s.nodeCls),s.nodeHtml&&(s.cellHtml=s.nodeHtml),this._createTreeColumn(s)),s},_isViewFirstNode:function(t){if(this._viewNodes){var e=this.getParentNode(t);return this._getViewChildNodes(e)[0]===t}return this.isFirstNode(t)},_isViewLastNode:function(t){if(this._viewNodes){var e=this.getParentNode(t),i=this._getViewChildNodes(e);return i[i.length-1]===t}return this.isLastNode(t)},_isInViewLastNode:function(t,e){if(this._viewNodes){for(var i=null,n=this.getAncestors(t),s=0,o=n.length;s<o;s++){var r=n[s];this.getLevel(r)==e&&(i=r)}return!(!i||i==this.root)&&this._isViewLastNode(i)}return this.isInLastNode(t,e)},isInLastNode:function(t,e){for(var i=null,n=this.getAncestors(t),s=0,o=n.length;s<o;s++){var r=n[s];this.getLevel(r)==e&&(i=r)}return!(!i||i==this.root)&&this.isLastNode(i)},_createNodeTitle:function(t,e,i){var n=!e;e=e||[];var s=this.isLeaf(t),o=this.getLevel(t),r=i.nodeCls;s||(r=this.isExpandedNode(t)?this._expandNodeCls:this._collapseNodeCls),!1===t.enabled&&(r+=" mini-disabled"),s||(r+=" mini-tree-parentNode");var a=this.getChildNodes(t);a&&a.length;e[e.length]='<div class="mini-tree-nodetitle '+r+'" >';
//if (!this.showExpandButtons && parentNode && !hasChilds) ii = 1;
for(
//if (!this.showExpandButtons) level -= 1;
var l=this.getParentNode(t),h=0;h<=o;h++)if(h!=o&&!(s&&o-1<h)){var d="";this._isInViewLastNode(t,h)&&(d="background:none"),e[e.length]='<span class="mini-tree-indent " style="'+d+'"></span>'}var u="";if(this._isViewFirstNode(t)&&0==o?u="mini-tree-node-ecicon-first":this._isViewLastNode(t)&&(u="mini-tree-node-ecicon-last"),this._isViewFirstNode(t)&&this._isViewLastNode(t)&&(u="mini-tree-node-ecicon-firstAndlast",l==this.root&&(u="mini-tree-node-ecicon-firstLast")),e[e.length]=s?'<span class="'+this._eciconCls+" "+u+'" style="'+(this.showExpandButtons?"":"display:none")+'"></span>':'<a class="'+this._eciconCls+" "+u+'" style="'+(this.showExpandButtons?"":"display:none")+'" '+(mini.isChrome?"":'href="javascript:void(0);"')+' onclick="return false;" hidefocus></a>',e[e.length]='<span class="mini-tree-nodeshow mini-corner-all">',i.showTreeIcon)if(i.img){var c=this.imgPath+i.img;e[e.length]='<span class="mini-tree-icon mini-icon mini-iconfont" style="background-image:url('+c+');"></span>'}else e[e.length]='<span class="'+i.iconCls+' mini-tree-icon mini-icon mini-iconfont"></span>';if(i.showRadioButton&&!i.showCheckBox&&(e[e.length]='<span class="mini-tree-radio mini-icon" ></span>'),i.showCheckBox){var m=this._createCheckNodeId(t),f=this.isCheckedNode(t);i.enabled;!1!==i.enabled&&(!1===i.checkable?"disabled":""),e[e.length]='<span id="'+m+'" class="mini-icon '+this._checkBoxCls+" "+(f?"mini-tree-checkbox-checked":"")+'"></span>'}if(e[e.length]='<span class="mini-tree-nodetext">',this._editingNode==t){var p=this._id+"$edit$"+t._id,g=i.value;e[e.length]='<input id="'+p+'" type="text" class="mini-tree-editinput" value="'+g+'"/>'}else e[e.length]=i.cellHtml;if(e[e.length]="</span>",e[e.length]="</span>",e[e.length]="</div>",n)return e.join("")},_createCheckNodeId:function(t){return this._id+"$checkbox$"+t._id},_createTreeColumn:function(t){var e=t.record;t.column;t.headerCls+=" mini-tree-treecolumn",t.cellCls+=" mini-tree-treecell",t.cellStyle+=";padding:0;";var i=this.isLeaf(e);t.cellHtml=this._createNodeTitle(e,null,t),1==e.checked||i||t.showCheckBox&&this._renderCheckState(e)},
//        if (!isLeaf) {
//            if (i == level && !isLeaf) break;
//        if (!isLeaf) {
//        if (node.checked != true && !isLeaf) {//1）父节点；2）没选中
_renderCheckState:function(t){if(this._renderCheckStateNodes||(this._renderCheckStateNodes=[]),this._renderCheckStateNodes.push(t),!this._renderCheckStateTimer){var n=this;this._renderCheckStateTimer=setTimeout(function(){n._renderCheckStateTimer=null;var t=n._renderCheckStateNodes;n._renderCheckStateNodes=null;for(var e=0,i=t.length;e<i;e++)n._doCheckNodeEl(t[e])},1)}},_createNodeHTML:function(t,e,i,n,s){var o=!n;n=n||[];var r=this._dataSource,a=r.getDataView().indexOf(t);if(this._createRowHTML(t,a,e,i,n),!1!==s){var l=r.getChildNodes(t),h=this.isVisibleNode(t);if(l&&0<l.length){var d=this.isExpandedNode(t);if(1==d){var u=d&&h?"":"display:none",c=this._createNodesId(t,i);n[n.length]='<tr class="mini-tree-nodes-tr" style="',mini.isIE&&(n[n.length]=u),n[n.length]='" ><td class="mini-tree-nodes-td" colspan="',n[n.length]=e.length+1,n[n.length]='" >',n[n.length]='<div class="mini-tree-nodes" id="',n[n.length]=c,n[n.length]='" style="',n[n.length]=u,n[n.length]='">',this._createNodesHTML(l,e,i,n),n[n.length]="</div>",n[n.length]="</td></tr>"}}}if(o)return n.join("")},_createNodesHTML:function(t,e,i,n){if(!t)return"";var s=!n;(n=n||[]).push('<table class="mini-grid-table" cellspacing="0" cellpadding="0" border="0">'),n.push(this._createTopRowHTML(e,!0));var o=this.uid+"$emptytext"+i;if(2==i&&"treegrid"==this.type&&(this._dataSource.loaded||this.alwaysShowEmptyText)){var r=parseInt($(this.el).find(".mini-grid-rows-view").height(),10);r&&200<r&&(r=.3*r>>0);var a=this.showEmptyText&&0==t.length?"":"display:none;";n.push('<tr id="'+o+'" style="'+a+'"><td style="width:0"></td><td class="mini-grid-emptyText" style="padding-top:'+(r+80)+"px;background-position:center "+r+'px" colspan="'+e.length+'">'+this.emptyText+"</td></tr>")}if(0<e.length)for(var l=0,h=t.length;l<h;l++){var d=t[l];this._createNodeHTML(d,e,i,n)}return n.push("</table>"),s?n.join(""):void 0},_createRowsHTML:function(t,e){if(this.isVirtualScroll())return mini.TreeGrid.superclass._createRowsHTML.apply(this,arguments);var i=this._dataSource,n=[],s=[],o=i.getRootNode();return!0!==this._useEmptyView&&(s=i.getChildNodes(o)),(2==e?this._rowsViewEl.firstChild:this._rowsLockEl.firstChild).id=this._createNodesId(o,e),this._createNodesHTML(s,t,e,n),n.join("")},_createNodesId:function(t,e){return this._id+"$nodes"+e+"$"+t._id},_getNodeEl:function(t,e){return this._getRowEl(t,e)},_getNodesEl:function(t,e){t=this.getNode(t);var i=this._createNodesId(t,e);return document.getElementById(i)},_getNodesTr:function(t,e){var i=this._getNodesEl(t,e);if(i)return i.parentNode.parentNode},checkOnTextClick:!1,setCheckOnTextClick:function(t){this.checkOnTextClick=t},getCheckOnTextClick:function(){return this.checkOnTextClick},setTreeColumn:function(t){this._treeColumn=t,this.deferUpdate()},getTreeColumn:function(){return this._treeColumn},setShowTreeIcon:function(t){this.showTreeIcon=t,this.deferUpdate()},getShowTreeIcon:function(){return this.showTreeIcon},setShowCheckBox:function(t){this.showCheckBox=t,this.deferUpdate()},getShowCheckBox:function(){return this.showCheckBox},setShowRadioButton:function(t){this.showRadioButton=t,this.deferUpdate()},getShowRadioButton:function(){return this.showRadioButton},setCheckBoxType:function(t){this._checkBoxType=t,this._doUpdateCheckState()},getCheckBoxType:function(){return this._checkBoxType},setIconsField:function(t){this._iconsField=t},getIconsField:function(){return this._iconsField},_getNodeIcon:function(t){var e=t[this.iconField];return e=e||(this.isLeaf(t)?this.leafIconCls:this.folderIconCls)},_getCheckBoxEl:function(t){if(0==this.isVisibleNode(t))return null;var e=this._id+"$checkbox$"+t._id;return mini.byId(e,this.el)},useAnimation:!0,_updateNodeTimer:null,_doExpandCollapseNode:function(t){(s=this)._updateNodeTimer&&(clearTimeout(s._updateNodeTimer),s._updateNodeTimer=null);new Date;if(1!=this.isVirtualScroll())if(mini.isIE6||!this.useAnimation||this.isFrozen())o.call(this);else{var e=this.isExpandedNode(t);function i(t,e,i){var n=this._getNodesEl(t,e);if(n){var s=mini.getHeight(n);n.style.overflow="hidden",n.style.height="0px";var o={height:s+"px"},r=this;r._inAniming=!0,jQuery(n).animate(o,250,function(){n.style.height="auto",r._inAniming=!1,r.doLayout(),mini.repaint(n)})}}function n(t,e,i){var n=this._getNodesEl(t,e);if(n){mini.getHeight(n);var s=this;s._inAniming=!0,jQuery(n).animate({height:"0px"},180,function(){n.style.height="auto",s._inAniming=!1,i&&i.call(s),s.doLayout(),mini.repaint(n)})}else i&&i.call(this)}var s=this;e?(o.call(this),i.call(this,t,2),i.call(this,t,1)):(n.call(this,t,2,o),n.call(this,t,1))}else this._updateTimer||(s._updateNodeTimer=setTimeout(function(){s._updateNodeTimer=null,s.doUpdateRows(),s.deferLayout(50)},5));function o(){this._doUpdateTreeNodeEl(t),this.deferLayout(20)}},__OnTreeCollapse:function(t){this._doExpandCollapseNode(t.node)},__OnTreeExpand:function(t){this._doExpandCollapseNode(t.node)},_doCheckNodeEl:function(t){var e=this._getCheckBoxEl(t);if(e){var i=this.getCheckModel();mini.removeClass(e,"mini-tree-checkbox-indeterminate");var n=t.indeterminate&&!t.checked;if("cascade"==i||n)"indeterminate"==(n?"indeterminate":this.getCheckState(t))?mini.addClass(e,"mini-tree-checkbox-indeterminate"):mini.removeClass(e,"mini-tree-checkbox-indeterminate");t.checked?mini.addClass(e,"mini-tree-checkbox-checked"):mini.removeClass(e,"mini-tree-checkbox-checked")}},__OnCheckChanged:function(t){for(var e=0,i=t._nodes.length;e<i;e++){var n=t._nodes[e];this._doCheckNodeEl(n)}this._checkChangedTimer&&(clearTimeout(this._checkChangedTimer),this._checkChangedTimer=null);var s=this;this._checkChangedTimer=setTimeout(function(){s._checkChangedTimer=null,s.fire("_checkchanged")},1)},_tryToggleCheckNode:function(t){if(!1!==t.enabled&&0!=this.getCheckable(t)){var e=this.isCheckedNode(t),i={node:t,cancel:!1,checked:e,isLeaf:this.isLeaf(t)};this.fire("beforenodecheck",i),i.cancel||(this._dataSource.doCheckNodes(t,!e,!0),
//            this._dataSource.doCheckNodes(node, !checked, true);
//            this._dataSource.doCheckNodes(node, !checked, true);
this.fire("nodecheck",i))}},_tryToggleNode:function(t){var e={node:t,cancel:!1};if(this.isExpandedNode(t)){if(this.fire("beforecollapse",e),1==e.cancel)return;this.collapseNode(t),e.type="collapse",this.fire("collapse",e)}else{if(this.fire("beforeexpand",e),1==e.cancel)return;this.expandNode(t),e.type="expand",this.fire("expand",e)}},_OnCellMouseDown:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellmousedown",t)},_OnCellClick:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||(mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.checkOnTextClick?this._tryToggleCheckNode(t.record):this.fire("cellclick",t))},__OnNodeDblClick:function(t){
//        if (this.expandOnDblClick && !e.isLeaf && !this._inAniming) {
},__OnNodeClick:function(t){
//        if (this.expandOnNodeClick && !e.isLeaf && !this._inAniming) {
},setNodeText:function(t,e){if(t=this.getNode(t)){var i={};i[this.getTextField()]=e,this.updateNode(t,i)}},setNodeIconCls:function(t,e){if(t=this.getNode(t)){var i={};i[this.iconField]=e,this.updateNode(t,i)}},setIconField:function(t){this.iconField=t},getIconField:function(){return this.iconField},setAllowSelect:function(t){this.setAllowRowSelect(t)},getAllowSelect:function(){return this.getAllowRowSelect()},setShowExpandButtons:function(t){this.showExpandButtons!=t&&(this.showExpandButtons=t,this.doUpdate())},getShowExpandButtons:function(){return this.showExpandButtons},setShowTreeLines:function(t){1==(this.showTreeLines=t)?mini.addClass(this.el,"mini-tree-treeLine"):mini.removeClass(this.el,"mini-tree-treeLine")},getShowTreeLines:function(){return this.showTreeLines},setShowArrow:function(t){1==(this.showArrow=t)?mini.addClass(this.el,"mini-tree-showArrows"):mini.removeClass(this.el,"mini-tree-showArrows")},getShowArrow:function(){return this.showArrow},setLeafIcon:function(t){this.leafIcon=t},getLeafIcon:function(){return this.leafIcon},setFolderIcon:function(t){this.folderIcon=t},getFolderIcon:function(){return this.folderIcon},getExpandOnDblClick:function(){return this.expandOnDblClick},setExpandOnNodeClick:function(t){(this.expandOnNodeClick=t)?mini.addClass(this.el,"mini-tree-nodeclick"):mini.removeClass(this.el,"mini-tree-nodeclick")},getExpandOnNodeClick:function(){return this.expandOnNodeClick},setLoadOnExpand:function(t){this.loadOnExpand=t},getLoadOnExpand:function(){return this.loadOnExpand},hideNode:function(t){if(t=this.getNode(t)){t.visible=!1,this._doUpdateTreeNodeEl(t);var e=this._getNodeEl(t,1),i=this._getNodeEl(t,2),n=this._getNodeEl(t,3);e&&(e.style.display="none"),i&&(i.style.display="none"),n&&(n.style.display="none")}},showNode:function(t){(t=this.getNode(t))&&(t.visible=!0,this._doUpdateTreeNodeEl(t))},enableNode:function(t){if(t=this.getNode(t)){t.enabled=!0;var e=this._getNodeEl(t,1),i=this._getNodeEl(t,2);e&&mini.removeClass(e,"mini-disabled"),i&&mini.removeClass(i,"mini-disabled");var n=this._getCheckBoxEl(t);n&&(n.disabled=!1)}},disableNode:function(t){if(t=this.getNode(t)){t.enabled=!1;var e=this._getNodeEl(t,1),i=this._getNodeEl(t,2);e&&mini.addClass(e,"mini-disabled"),i&&mini.addClass(i,"mini-disabled");var n=this._getCheckBoxEl(t);n&&(n.disabled=!0)}},imgPath:"",setImgPath:function(t){this.imgPath=t},getImgPath:function(){return this.imgPath},imgField:"img",setImgField:function(t){this.imgField=t},getImgField:function(){return this.imgField},getAttrs:function(t){var e=mini.TreeGrid.superclass.getAttrs.call(this,t);if(mini._ParseString(t,e,["value","url","idField","textField","iconField","nodesField","parentField","valueField","checkedField","leafIcon","folderIcon","leafField","ondrawnode","onbeforenodeselect","onnodeselect","onnodemousedown","onnodeclick","onnodedblclick","onbeforenodecheck","onnodecheck","onbeforeexpand","onexpand","onbeforecollapse","oncollapse","dragGroupName","dropGroupName","onendedit","expandOnLoad","ondragstart","onbeforedrop","ondrop","ongivefeedback","treeColumn","onaddnode","onremovenode","onmovenode","imgPath","imgField","hoverMode"]),mini._ParseBool(t,e,["allowSelect","showCheckBox","showRadioButton","showExpandButtons","showTreeIcon","showTreeLines","checkRecursive","enableHotTrack","showFolderCheckBox","resultAsTree","allowDrag","allowDrop","showArrow","expandOnDblClick","removeOnCollapse","autoCheckParent","loadOnExpand","expandOnNodeClick","useAnimation","checkOnTextClick"]),e.expandOnLoad){var i=parseInt(e.expandOnLoad);mini.isNumber(i)?e.expandOnLoad=i:e.expandOnLoad="true"==e.expandOnLoad}var m=e.idField||this.getIdField(),f=e.textField||this.getTextField(),p=e.iconField||this.getIconField(),g=e.nodesField||this.getNodesField();var n=function _(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i],o=mini.getChildNodes(s),r=o[0],a=o[1];r&&a||(r=s);var l=jQuery(r),h={};h[m]=r.getAttribute("value"),h[p]=l.attr("iconCls"),h[f]=r.innerHTML,e.add(h);var d=l.attr("expanded");d&&(h.expanded="false"!=d);var u=l.attr("allowSelect");if(u&&(h.allowSelect="false"!=u),a){var c=_(mini.getChildNodes(a));0<c.length&&(h[g]=c)}}return e}(mini.getChildNodes(t));return 0<n.length&&(e.data=n),!e.idField&&e.valueField&&(e.idField=e.valueField),e}}),mini.regClass(mini.TreeGrid,"TreeGrid"),mini.Tree=function(){mini.Tree.superclass.constructor.apply(this,arguments);var t=[{name:"node",header:"",field:this.getTextField(),width:"auto",allowDrag:!0,editor:{type:"textbox"}}];this._columnModel.setColumns(t),this._column=this._columnModel.getColumn("node"),mini.removeClass(this.el,"mini-treegrid"),mini.addClass(this.el,"mini-tree-nowrap"),this.setBorderStyle("border:0")},mini.extend(mini.Tree,mini.TreeGrid,{
//        return !(mini.isIE6 || mini.isIE7);
_userEmptyTd:!(mini.isChrome||mini.isIE6||mini.isIE7),setTextField:function(t){this._dataSource.setTextField(t),this._columnModel.updateColumn("node",{field:t}),this.textField=t},uiCls:"mini-tree",hoverMode:"title",_rowHoverCls:"mini-tree-node-hover",_rowSelectedCls:"mini-tree-selectedNode",_getRecordByEvent:function(t,e){"node"==this.hoverMode&&(e=!1);var i=mini.Tree.superclass._getRecordByEvent.call(this,t);return!1===e?i:i&&mini.findParent(t.target,"mini-tree-nodeshow")?i:null},_treeColumn:"node",defaultRowHeight:51,_getRowHeight:function(t){var e=this.defaultRowHeight;
//        //if (!mini.isOpera) {
return t._height&&(e=parseInt(t._height),isNaN(parseInt(t._height))&&(e=rowHeight)),e},showHeader:!1,showTopbar:!1,showFooter:!1,showColumns:!1,showHGridLines:!1,showVGridLines:!1,showTreeLines:!0,setTreeColumn:null,setColumns:null,getColumns:null,frozen:null,unFrozen:null,showModified:!1,_OnCellMouseDown:function(t){this._editInput&&this._editInput.blur(),this.fire("cellmousedown",t)},beginEdit:function(e){if(e=this.getNode(e)){var t=this.getColumn(0),i=mini._getMap(t.field,e),n={record:e,node:e,column:t,field:t.field,value:i,cancel:!1};if(this.fire("cellbeginedit",n),1!=n.cancel){this._editingNode=e,this._doUpdateNodeTitle(e);var s=this;setTimeout(function(){o()},100),o()}}function o(){var t=s._id+"$edit$"+e._id;s._editInput=document.getElementById(t),s._editInput.focus(),mini.selectRange(s._editInput,0,1e3),mini.on(s._editInput,"keydown",s.__OnEditInputKeyDown,s),mini.on(s._editInput,"blur",s.__OnEditInputBlur,s)}},cancelEdit:function(t){var e=this._editingNode;this._editingNode=null,e&&(!1!==t&&this._doUpdateNodeTitle(e),mini.un(this._editInput,"keydown",this.__OnEditInputKeyDown,this),mini.un(this._editInput,"blur",this.__OnEditInputBlur,this)),this._editInput=null},__OnEditInputKeyDown:function(t){if(13==t.keyCode){var e=this._editingNode,i=this._editInput.value;this._editingNode=null,this.setNodeText(e,i),this.cancelEdit(!1),this.fire("endedit",{node:e,text:i})}else 27==t.keyCode&&this.cancelEdit()},__OnEditInputBlur:function(t){var e=this._editingNode;if(e){var i=this._editInput.value;this.cancelEdit(),this.setNodeText(e,i),this.fire("endedit",{node:e,text:i})}},addRowCls:function(t,e){var i=this._getRowEl(t,1),n=this._getRowEl(t,2);i&&mini.addClass(i,e),n&&mini.addClass(n,e),i&&mini.addClass(i.cells[1],e),n&&mini.addClass(n.cells[1],e)},removeRowCls:function(t,e){var i=this._getRowEl(t,1),n=this._getRowEl(t,2);i&&mini.removeClass(i,e),n&&mini.removeClass(n,e),i&&mini.removeClass(i.cells[1],e),n&&mini.removeClass(n.cells[1],e)},scrollIntoView:function(e){if(e=this.getNode(e)){this.isVisibleNode(e)||this.expandPath(e);var i=this;setTimeout(function(){if(i.isVirtualScroll())mini.Tree.superclass.scrollIntoView.call(i,e);else{var t=i._getNodeEl(e,2);mini.scrollIntoView(t,i._rowsViewEl,!1)}},10)}}}),mini.regClass(mini.Tree,"Tree"),mini._Tree_Expander=function(t){this.owner=t,mini.on(t.el,"click",this.__OnClick,this),mini.on(t.el,"dblclick",this.__OnDblClick,this)},mini._Tree_Expander.prototype={_canToggle:function(){return!this.owner._dataSource._isNodeLoading()},__OnClick:function(t){var e=this.owner,i=e._getRecordByEvent(t,!1);if(i&&!1!==i.enabled&&!mini.findParent(t.target,"mini-tree-checkbox")){var n=e.isLeaf(i);if(mini.findParent(t.target,e._eciconCls)){if(0==this._canToggle())return;e._tryToggleNode(i)}else if(e.expandOnNodeClick&&!n&&!e._inAniming){if(0==this._canToggle())return;e._tryToggleNode(i)}}},__OnDblClick:function(t){var e=this.owner,i=e._getRecordByEvent(t,!1);if(i&&!1!==i.enabled&&!e.isEditingNode(i)){var n=e.isLeaf(i);if(!e._inAniming&&!mini.findParent(t.target,e._eciconCls)&&!mini.findParent(t.target,"mini-tree-checkbox")&&!e.expandOnNodeClick&&e.expandOnDblClick&&!n){if(0==this._canToggle())return;t.preventDefault(),e._tryToggleNode(i)}}}},mini._Tree_AsyncLoader=function(t){(this.owner=t).on("expand",this.__OnBeforeNodeExpand,this)},mini._Tree_AsyncLoader.prototype={__OnBeforeNodeExpand:function(t){var e=this.owner,i=t.node,n=e.isLeaf(i),s=i[e.getNodesField()];n||s&&0!=s.length||e.loadOnExpand&&!1!==i.asyncLoad&&(t.cancel=!0,e.loadNode(i))}},mini.DataGrid.prototype.validateCell=mini_DataGrid_CellValidator_Prototype.validateCell=function(t,e){if(t=this.getNode?this.getNode(t):this.getRow(t),e=this.getColumn(e),t&&e&&0!=e.visible){var i=mini._getMap(e.field,t),n={record:t,row:t,node:t,column:e,field:e.field,value:mini.htmlUnescape(i),isValid:!0,errorText:""};if(e.vtype&&mini._ValidateVType(e.vtype,n.value,n,e),1==n.isValid&&e.unique&&e.field)for(var s={},o=this.data,r=e.field,a=0,l=o.length;a<l;a++){var h=o[a],d=h[r];if(mini.isNull(d)||""===String(d).trim());else{var u=s[d];if(u&&h==t){n.isValid=!1,n.errorText=mini._getErrorText(e,"uniqueErrorText"),this.setCellIsValid(u,e,n.isValid,n.errorText);break}s[d]=h}}this.fire("cellvalidation",n),this.setCellIsValid(t,e,n.isValid,n.errorText)}},mini.overwrite(mini.DataGrid,{pageSize:window.EpFrameSysParams&&EpFrameSysParams.ui_grid_pagesize||10,getExtraAttrs:function(t){var e={};return mini._ParseBool(t,e,["holdSelectedStatus"]),e}}),mini.overwrite(mini.DataTable,{pageSize:window.EpFrameSysParams&&EpFrameSysParams.ui_grid_pagesize||10}),function(){if(mini.isIE){var i=mini.DataGrid.prototype._setEditorBox;mini.overwrite(mini.DataGrid,{_isInitEditorWrap:!0,_setEditorBox:function(t,e){this._isInitEditorWrap?(i.call(this,t,e),i.call(this,t,e),this._isInitEditorWrap=!1,this._setEditorBox=i):i.call(this,t,e)}})}}(),mini.overwrite(mini.Form,{getValidateFields:function(t){for(var e,i=[],n=this.getFields(),s=0,o=n.length;s<o;s++){var r=n[s];r.validate&&r.isDisplay&&(e=r,!mini.isDisplay(e.el,function(t){if(mini.hasClass(t,"mini-tabs-body")||mini.hasClass(t,"fui-acc-bd")||mini.hasClass(t,"invisible"))return!0})&&!r.forceValidate||(r.enabled||t||r.forceValidate)&&i.push(r))}return i},getErrors:function(){for(var t=[],e=this.getValidateFields(),i=0,n=e.length;i<n;i++){var s=e[i];s.isValid&&0==s.isValid()&&t.push(s)}return t}}),mini.overwrite(mini.MessageBox,{show:function(e){(e=mini.copyTo({width:"360",height:"145",customCls:"",showModal:!0,timeout:0,minWidth:150,maxWidth:800,minHeight:50,maxHeight:350,showHeader:!0,title:"",titleIcon:"",iconCls:"",iconStyle:"",message:"",html:"",spaceStyle:"",showCloseButton:!0,buttons:null,buttonWidth:null,callback:null,showNoTipCheck:!1,clickNoTipCheck:!1},e)).buttonText||(e.buttonText={}),e.buttonText=jQuery.extend({},mini.MessageBox.buttonText,e.buttonText),e.autoFocus===undefined&&(e.autoFocus=mini.MessageBox.autoFocus),e.message=String(e.message);var i=e.callback,n=e.control||new mini.Window;e.customCls&&n.addCls(e.customCls),n.addCls("mini-messagebox"),n.setBodyStyle("overflow:hidden"),n.setShowModal(e.showModal),n.setTitle(e.title||""),n.setIconCls(e.titleIcon),n.setShowHeader(e.showHeader),n.setShowCloseButton(e.showCloseButton);var t=n.uid+"$table",s=n.uid+"$content",o='<i class="mini-messagebox-icon mini-iconfont '+e.iconCls+'" style="'+e.iconStyle+'"></i><p class="mini-messagebox-msg">'+(e.message||"")+"</p>";n._bodyEl.innerHTML='<div class="mini-messagebox-content"></div><div class="mini-messagebox-buttons"></div>';var r=n._bodyEl.firstChild;if(e.html?"string"==typeof e.html?r.innerHTML=e.html:mini.isElement(e.html)&&r.appendChild(e.html):(r.innerHTML=o,n._content=r.lastChild),e.showNoTipCheck){var a=n._bodyEl.lastChild;a.innerHTML='<label class="mini-messagebox-checkbox"><input type="checkbox">'+epoint_local.no_longer_tips+"</label>",mini.on(a.firstChild,"click",function(){if(e.clickNoTipCheck){var t=this.firstChild.checked;e.clickNoTipCheck.apply(this,[t])}})}n._Buttons=[];var l=n._bodyEl.lastChild;if(e.buttons&&0<e.buttons.length)for(var h=0,d=e.buttons.length;h<d;h++){var u=e.buttons[h],c=e.buttonText[u];c=c||u;var m=new mini.Button;m.setText(c),m.setWidth(e.buttonWidth),m.render(l),m.action=u,m.on("click",function(t){var e=t.sender;i&&!1===i(e.action)||mini.MessageBox.hide(n)}),h!=d-1&&m.setStyle(e.spaceStyle),m.setCls("mini-messagebox-button"),"ok"==u?(m.addCls("ok"),m.setState("primary")):m.setGhost(!0),n._Buttons.push(m)}else mini.addClass(n._bodyEl,"no-btn");n.setMinWidth(e.minWidth),n.setMinHeight(e.minHeight),n.setMaxWidth(e.maxWidth),n.setMaxHeight(e.maxHeight),n.setWidth(e.width),n.setHeight(e.height),mini.parse(r),n.show(e.x,e.y,{animType:e.animType});var f=n.getWidth();n.setWidth(f+"px");var p=$(r).css("position","relative").outerHeight(!0);$(r).css("position","");var g=p?p+($(n._headerEl).is(":visible")?$(n._headerEl).outerHeight(!0):0)+($(l).is(":visible")?$(l).outerHeight(!0):0):n.getHeight();g>e.maxHeight&&(g=e.maxHeight,n._content.style.overflow="auto"),n.setHeight(g+"px");var _=document.getElementById(t);_&&(_.style.width="100%");var v=document.getElementById(s);if(v&&(v.style.width="100%"),e.autoFocus){var y=n._Buttons[0];y?y.focus():n.focus()}return n.on("beforebuttonclick",function(t){i&&i("close"),t.cancel=!0,mini.MessageBox.hide(n)}),mini.on(n.el,"keydown",function(t){27==t.keyCode&&(i&&i("close"),mini.MessageBox.hide(n))}),e.timeout&&setTimeout(function(){mini.MessageBox.hide(n.uid)},e.timeout),window.parent.postMessage(JSON.stringify({type:"openDialog"}),"*"),n.uid},hide:function(t){if(t){var e="object"==typeof t?t:mini.getbyUID(t);if(e){for(var i=0,n=e._Buttons.length;i<n;i++){e._Buttons[i].destroy()}e._Buttons=null,window.parent.postMessage(JSON.stringify({type:"closeDialog"}),"*"),e.destroy()}}},prompt:function(t,e,i,n,s,o){var r=new mini.Window;r.addCls("mini-prompt");var a=r.uid,l=a+"$prompt",h=t||mini.MessageBox.promptMessage;h=n?'<label class="mini-prompt-label">'+h+'</label><input id="'+l+'" class="mini-textarea mini-prompt-input" errorMode="text">':'<label class="mini-prompt-label">'+h+'</label><input type="text" id="'+l+'" class="mini-textbox mini-prompt-input" errorMode="text">';var d=o&&o.iconCls?'<span class="mini-messagebox-icon mini-iconfont '+o.iconCls+'"></span>':"",u=jQuery.extend({control:r,title:e||mini.MessageBox.promptTitle,buttons:["ok","cancel"],html:d+'<div class="mini-messagebox-prompt" >'+h+"</div>",callback:function(t){var e=mini.get(l);if("ok"===t&&s&&e.validate&&e.validate(),i)return i(t,e.getValue())},autoFocus:!1},o||{});return a=mini.MessageBox.show(u),s&&mini.get(l).on("validation",s),setTimeout(function(){mini.get(l).focus();var t=r._bodyEl.firstChild,e=r._bodyEl.lastChild,i=$(t).css("position","relative").outerHeight(!0);$(t).css("position","");var n=i?i+($(r._headerEl).is(":visible")?$(r._headerEl).outerHeight(!0):0)+($(e).is(":visible")?$(e).outerHeight(!0):0):r.getHeight();r.setHeight(n+"px")},50),a},deletePrompt:function(i,n,t){t=t||{},n=n||function(){};var s=$.extend({title:epoint_local.MessageBox.deleteConfirmTitle,tpl:epoint_local.MessageBox.deleteConfirmTpl},t),e=$('<span class="mini-delete-prompt-content'+(s.selectable?" select":"")+'"></span>').text(i)[0].outerHTML,o=s.tpl.replace(/%s/,e),r=mini.prompt(o,s.title,function(t,e){if("ok"===t){if(e!==i)return!1;n(),"function"==typeof s.onConfirm&&s.onConfirm.call(null)}else"function"==typeof s.onCancel&&s.onCancel.call(null)},!1,function(t){t.value!==i?(t.errorText=epoint_local.MessageBox.confirmErrorText,t.isValid=!1):(t.errorText="",t.isValid=!0)},{buttonText:{ok:epoint_local.MessageBox.buttonText.confirmDelete},iconCls:"mini-messagebox-confirm"});
//         if (valid !== button.getEnabled()) {
return mini.get(r).addCls("mini-delete-prompt"),r},confirm:function(t,e,i){return mini.MessageBox.show({minWidth:250,title:e||mini.MessageBox.confirmTitle,buttons:["ok","cancel"],message:t,iconCls:"mini-messagebox-question",callback:i})}}),mini.prompt=mini.MessageBox.prompt,mini.deletePrompt=mini.MessageBox.deletePrompt,mini.showMessageBox=mini.MessageBox.show,mini.confirm=mini.MessageBox.confirm,
/*
mini.showTips = mini.MessageBox.showTips = function(options) {
    var id = mini.newId('mini-tips-');
    options = jQuery.extend(
        {
            content: '',
            state: 'default',
            showIcon: true,
            x: 'center',
            y: 'top',
            offset: [10, 10],
            fixed: true,
            timeout: 2000
        },
        options
    );

    var cls = 'mini-tips-' + options.state;
    var showIconCls = options.showIcon ? ' mini-tips-showIcon' : '';
    var html = '<div id="' + id + '" class="mini-tips ' + cls + showIconCls + '">' + options.content + '</div>';
    var jq = jQuery(html).appendTo(document.body);

    options.el = jq[0];
    options.timeoutHandler = function() {
        jq.slideUp(function() {
            jq.remove();
        });
    };

    mini.showAt(options);
    jq.hide().slideDown();
    return id;
};

mini.hideTips = mini.MessageBox.hideTips = function(id, immediately) {
    if (!id) return;

    if (immediately) {
        return $(this).remove();
    }
    return jQuery('#' + id).slideUp(function() {
        $(this).remove();
    });
};
*/
mini.showTips=mini.MessageBox.showTips=function(t){var e=mini.newId("mini-tips-");(t=jQuery.extend({content:"",state:"default",showIcon:!0,x:"center",y:"top",offset:[10,10],timeout:2e3,showClose:!1},t)).offset[0]=t.offset[0]>>>0,t.offset[1]=t.offset[1]>>>0;var i="mini-tips-"+t.state,n=t.showIcon?" mini-tips-showIcon":"",s='<div id="'+e+'" class="mini-tips '+i+n+'">'+t.content.replace(/<(script\b[^<]*(?:(?!<\/script>)<[^<]*)*)<(\/script)>/gi,"&lt;$1&lt;$2&gt;")+"</div>",o=function l(t){var e=t.x,i=t.y,n=e+"-"+i,s=t.offset.join("-"),o="mini-tips-container_"+n+"_"+s,r=jQuery("#"+o);r.length||((r=jQuery('<div id="'+o+'" class="mini-tips-container x-'+e+'"></div>').appendTo("body")).css({top:{top:0},center:{top:"50%"},bottom:{bottom:"0"}}[i]),r.css({left:{left:0},center:{left:"50%"},right:{right:"0"}}[e]),t.offset[0]&&("right"===e?r.css({marginRight:t.offset[0]}):r.css({marginLeft:t.offset[0]})),t.offset[1]&&("bottom"===i?r.css({marginBottom:t.offset[1]}):r.css({marginTop:t.offset[1]})));return r.css("z-index",mini.getMaxZIndex()),r}(t),r=jQuery(s).appendTo(o);if(!0===t.showClose&&$('<span class="mini-tips-close action-icon icon-remove" onclick="jQuery(this).remove();mini.hideTips(\''+e+"')\"></span>").appendTo(r),r.hide().slideDown(),0!==t.timeout){var a=setTimeout(function(){r.slideUp(function(){mini.hideTips(e,!0)})},t.timeout);r.data("timer",a)}return e},mini.hideTips=mini.MessageBox.hideTips=function(t,e){if(t){var i=$("#"+t),n=i.data("timer");return clearTimeout(n),e?(s(),i.remove()):i.slideUp(function(){s(),i.remove()})}function s(){i.siblings().length||i.parent().remove()}},jQuery(function(){mini._controlTips=new mini.ToolTip,mini._controlTips.set({trigger:"hover",target:document,selector:'[class*="mini-"][data-tooltip], [class*="mini-"] [data-tooltip], [class*="uc-"] [data-tooltip]',onbeforeopen:function(t){jQuery(t.element).hasClass("mini-error")&&(t.cancel=!0)}})}),mini.Avatar=function(){mini.Avatar.superclass.constructor.call(this)},mini.extend(mini.Avatar,mini.Control,{uiCls:"mini-avatar",username:"",shortName:"",bgColor:"",portrait:"",_tpl:'{{#portrait}}<img class="mini-avatar-img" src="{{portrait}}" >{{/portrait}}{{^portrait}}<span class="mini-avatar-text" style="background:{{avatarBg}}">{{shortName}}</span>{{/portrait}}',_create:function(){var t=document.createElement("span");this._portraitEl=document.createElement("img"),this._portraitEl.className="mini-avatar-img",this._textEl=document.createElement("span"),this._textEl.className="mini-avatar-text",t.appendChild(this._portraitEl),t.appendChild(this._textEl),this.el=t},_getShortName:function(){return this.username?this.username.substr(-2):""},setData:function(t){var e=t.username,i=t.bgColor,n=t.portrait;this.setUsername(e),this.setBgColor(i),this.setPortrait(n)},getData:function(){return{username:this.username,bgColor:this.bgColor,portrait:this.portrait}},setUsername:function(t){this.username=t,this._textEl.setAttribute("title",t),this._portraitEl.setAttribute("title",t),this._textEl.innerText=this._getShortName(),this.portrait?this.el.setAttribute("mode","img"):this.el.setAttribute("mode","")},getUsername:function(){return this.username},setBgColor:function(t){this.bgColor=t,this._textEl.style.backgroundColor=t},getBgColor:function(){return this.bgColor},setPortrait:function(t){this.portrait=t,this.portrait?(this._portraitEl.setAttribute("src",t),this.el.setAttribute("mode","img")):this.el.setAttribute("mode","")},getPortrait:function(){return this.portrait},getAttrs:function(t){var e=mini.Avatar.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["username","bgColor","portrait","width","height"]),e},setWidth:function(t){$(this.el).add(this._textEl).add(this._portraitEl).css("width",t)},setHeight:function(t){var e;e="number"==typeof t?t+"px":/px$/.test(t)?t:parseInt(t,10)+"px",$(this.el).add(this._textEl).add(this._portraitEl).css({height:t,"line-height":e})}}),mini.regClass(mini.Avatar,"avatar"),mini.BubbleDialog={positionMap:{"left-top":{xAlign:"outleft",yAlign:"top",xOffset:-14,yOffset:-10},"left-middle":{xAlign:"outleft",yAlign:"middle",xOffset:-14},"left-bottom":{xAlign:"outleft",yAlign:"bottom",xOffset:-14,yOffset:10},"right-top":{xAlign:"outright",yAlign:"top",xOffset:14,yOffset:-10},"right-middle":{xAlign:"outright",yAlign:"middle",xOffset:14},"right-bottom":{xAlign:"outright",yAlign:"bottom",xOffset:14,yOffset:10},"top-left":{xAlign:"left",yAlign:"above",xOffset:-10,yOffset:-14},"top-center":{xAlign:"center",yAlign:"above",yOffset:-14},"top-right":{xAlign:"right",yAlign:"above",xOffset:10,yOffset:-14},"bottom-left":{xAlign:"left",yAlign:"below",xOffset:-10,yOffset:14},"bottom-center":{xAlign:"center",yAlign:"below",yOffset:14},"bottom-right":{xAlign:"right",yAlign:"below",xOffset:10,yOffset:14}},show:function(m){(m=mini.copyTo({invokerID:"",position:"top-left",width:"236",height:"110",customCls:"mini-bubbledialog",showModal:!1,timeout:0,minWidth:150,maxWidth:800,minHeight:50,maxHeight:350,showHeader:!1,title:"",titleIcon:"",iconCls:"",iconStyle:"",message:"",html:"",spaceStyle:"",showCloseButton:!1,buttons:["cancel","ok"],buttonWidth:null,callback:null,showNoTipCheck:!1,clickNoTipCheck:!1},m)).message=String(m.message);var i=m.callback,f=m.control||new mini.Window;m.customCls&&f.addCls(m.customCls),f.addCls("mini-messagebox"),f.setBodyStyle("overflow:hidden"),f.setShowModal(m.showModal),f.setTitle(m.title||""),f.setIconCls(m.titleIcon),f.setShowHeader(m.showHeader),f.setShowCloseButton(m.showCloseButton);var t=f.uid+"$table",e=f.uid+"$content",n='<i class="mini-messagebox-icon mini-iconfont '+m.iconCls+'" style="'+m.iconStyle+'"></i><p class="mini-messagebox-msg">'+(m.message||"")+"</p>";f._bodyEl.innerHTML='<div class="mini-messagebox-content"></div><div class="mini-messagebox-buttons"></div>';var s=f._bodyEl.firstChild;if(m.html?"string"==typeof m.html?s.innerHTML=m.html:mini.isElement(m.html)&&s.appendChild(m.html):(s.innerHTML=n,f._content=s.lastChild),m.showNoTipCheck){var o=f._bodyEl.lastChild;o.innerHTML='<label class="mini-messagebox-checkbox"><input type="checkbox">'+epoint_local.no_longer_tips+"</label>",mini.on(o.firstChild,"click",function(){if(m.clickNoTipCheck){var t=this.firstChild.checked;m.clickNoTipCheck.apply(this,[t])}})}f._Buttons=[];var r=f._bodyEl.lastChild;if(m.buttons&&0<m.buttons.length)for(var a=0,l=m.buttons.length;a<l;a++){var h=m.buttons[a],d=mini.MessageBox.buttonText[h];d=d||h;var u=new mini.Button;u.setText(d),u.setWidth(m.buttonWidth),u.render(r),u.action=h,u.on("click",function(t){var e=t.sender;i&&!1===i(e.action)||mini.MessageBox.hide(f)}),a!==l-1&&u.setStyle(m.spaceStyle),u.setCls("mini-messagebox-button"),"ok"===h&&(u.addCls("ok"),u.setState("primary")),f._Buttons.push(u)}else mini.addClass(f._bodyEl,"no-btn");f.setMinWidth(m.minWidth),f.setMinHeight(m.minHeight),f.setMaxWidth(m.maxWidth),f.setMaxHeight(m.maxHeight),f.setWidth(m.width),f.setHeight(m.height),mini.parse(s);var p=mini.BubbleDialog.positionMap[m.position];$.extend(m,p),function x(){f.showAtEl(m.invokerID,m);var t=$(f.el),e=parseInt(f.x,10),n=parseInt(f.y,10),i=parseInt(t.outerWidth(),10),s=parseInt(t.outerHeight(),10),o=$("#"+m.invokerID),r=parseInt(o.offset().left,10),a=parseInt(o.offset().top,10),l=parseInt(o.outerWidth(),10),h=parseInt(o.outerHeight(),10);"above"===m.yAlign||"below"===m.yAlign?"above"===m.yAlign&&a<n+s+10?m.position=u("bottom-"):"below"===m.yAlign&&n<a+h+10&&(m.position=u("top-")):"outleft"!==m.xAlign&&"outright"!==m.xAlign||("outleft"===m.xAlign&&r<e+i+10?m.position=u("right-"):"outright"===m.xAlign&&e<r+l+10&&(m.position=u("left-"))),f.addCls(m.position);var d=$('<div class="mini-bubbledialog-arrow"></div>');function u(t){var e=0===t.indexOf("bottom")||0===t.indexOf("top");return t+=e?-1!==m.position.indexOf("left")?"left":"right":-1!==m.position.indexOf("top")?"top":"bottom",p=mini.BubbleDialog.positionMap[t],$.extend(m,p),t}d.appendTo($(f.el)),f.showAtEl(m.invokerID,m),function c(){var t=r+l/2-f.x-10,e=a+h/2-n-10,i=m.position.split("-")[0];"top"===i||"bottom"===i?d.css("left",t+"px"):d.css("top",e+"px")}()}();var c=f.getWidth();f.setWidth(c+"px");var g=$(s).css("position","relative").outerHeight(!0);$(s).css("position","");var _=g?g+($(f._headerEl).is(":visible")?$(f._headerEl).outerHeight(!0):0)+($(r).is(":visible")?$(r).outerHeight(!0):0):f.getHeight();_>m.maxHeight&&(_=m.maxHeight,f._content.style.overflow="auto"),f.setHeight(_+"px");var v=document.getElementById(t);v&&(v.style.width="100%");var y=document.getElementById(e);if(y&&(y.style.width="100%"),mini.MessageBox.autoFocus){var w=f._Buttons[0];w?w.focus():f.focus()}return f.on("beforebuttonclick",function(t){i&&i("close"),t.cancel=!0,mini.MessageBox.hide(f)}),mini.on(f.el,"keydown",function(t){27===t.keyCode&&(i&&i("close"),mini.MessageBox.hide(f))}),m.timeout&&setTimeout(function(){mini.MessageBox.hide(f.uid)},m.timeout),window.parent.postMessage(JSON.stringify({type:"openDialog"}),"*"),f.uid}},mini.showBubbleDialog=mini.BubbleDialog.show,mini.CatalogImport=function(){mini.CatalogImport.superclass.constructor.call(this)},mini.extend(mini.CatalogImport,mini.Control,{uiCls:"mini-catalogimport",url:"",pickerText:epoint_local.CatalogImport.pickerText,deleteText:epoint_local.CatalogImport.deleteText,uploadingText:epoint_local.CatalogImport.uploadingText,validateText:epoint_local.CatalogImport.validateText,resultTpl:epoint_local.CatalogImport.resultTpl,expandText:epoint_local.CatalogImport.expandText,importResultText:epoint_local.CatalogImport.importResultText,importErrorText:epoint_local.CatalogImport.importErrorText,importSuccessText:epoint_local.CatalogImport.importSuccessText,exportText:epoint_local.CatalogImport.exportText,_create:function(){this.el=document.createElement("div"),this.uploader=new mini.WebUploader,this.uploader.set({uploadUrl:this.url,pickerText:this.pickerText,fileNumLimit:1,limitType:"xls,xlsx,xlsm",showDefaultUI:!1,auto:!1,renderTo:this.el}),this.uploader.on("beforefilequeued",this._onBeforeFileQueued,this),this.uploader.on("filesqueued",this._onFilesQueued,this),this.uploader.on("uploadbeforesend",this._onUploadBeforeSend,this),this.uploader.on("uploadprogress",this._onUploadProgress,this),this.uploader.on("uploadsuccess",this._onUploadSuccess,this),this.uploader._uploadBtn.hide(),this.fileList=document.createElement("div"),this.fileList.className="mini-catalogimport-filelist",this.el.appendChild(this.fileList),this._bindEvent()},_bindEvent:function(){var t=this;
//     if (self.isImportFinished && !self.isDetailShow) {
jQuery(this.fileList).on("click",".catalogimport-delete",function(){$(this).closest(".mini-catalogimport-item").remove(),t.uploader.clearFile()}).on("click",".catalogimport-export",function(){t.fire("exportresult",{attachGuid:t._curAttachGuid})})},_onFilesQueued:function(t){var i=t.files[0],n=this;if(i){var e=this._generateFileList({id:i.id,name:i.name,size:i.size});this.isImportFinished=!1,jQuery(e).appendTo(this.fileList),this.uploader._uploader.md5File(i).progress(function(t){}).then(function(t){var e={fileMD5:n._curFileMD5=t,fileName:i.name,fileSize:i.size};e[n.uploader.id+"_action"]="queryFileStatus",n.uploader.getCommonData&&(e.commonDto=mini.encode(n.uploader.getCommonData())),n._onPostFileMd5(e),$.ajax(n.url,{dataType:"json",data:e,type:"post",success:function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),n._onQueryFileStatus(t)}})})}},_onPostFileMd5:function(t){this.fire("postfilemd5",{data:t})},_curFileMD5:"",_curAttachGuid:"",_onQueryFileStatus:function(t){t.msg&&mini.alert(t.msg),this.setDetailStatus(t.detail),this._curAttachGuid=t.attachGuid,this._oldAttachGuid=t.attachGuidOld,t.end?this._onFinished(t.status):(t.pollingFrequency&&(this._pollingFrequency=t.pollingFrequency),"importStatus"==t.action?this.pollingStatus(t):"upload"==t.action?this.uploader._uploader.upload():jQuery(this.fileList).find(".mini-catalogimport-action").removeClass("hidden"))},_onUploadBeforeSend:function(t){this.isContinueImport&&(t.data.attachGuid=this._curAttachGuid),t.data.fileMD5=this._curFileMD5},_onUploadProgress:function(t){var e=t.file,i=t.percentage,n=mini.byId(e.id),s=jQuery(".mini-catalogimport-progressbar",n),o=jQuery(".progress-text",s),r=jQuery(".progress-body",s),a=Math.round(100*i)+"%";o.text(a),r.width(a)},_generateFileList:function(t){var e=[];return e.push('<div class="mini-catalogimport-item" id="'+t.id+'">'),e.push('<span class="mini-catalogimport-info">'+t.name+"</span>"),e.push('<span class="mini-catalogimport-size">('+this._getSize(t.size)+")</span>"),e.push('<span class="mini-catalogimport-action hidden"><a href="javascript:void(0)" class="catalogimport-delete">'+this.deleteText+"</a></span>"),e.push('<span class="mini-catalogimport-status">'+this.uploadingText+"</span>"),e.push('<span class="mini-catalogimport-progressbar"><span class="progress-text">0%</span><div class="progress-body"></div></span>'),e.push("</div>"),e.join("")},_onPollingStatus:function(t){if(t.status){var e,i=mini.byId(this._currentFileId),n=jQuery(".mini-catalogimport-status",i),s=jQuery(".mini-catalogimport-progressbar",i),o=jQuery(".progress-text",s),r=jQuery(".progress-body",s);n.text(t.status),0<=t.handlepercent?(e=t.handlepercent+"%",s.removeClass("hidden"),o.text(e),r.width(e)):s.addClass("hidden")}},_generateStatuslist:function(t){var e,i,n,s=!0,o=!0,r=['<div class="catalogimport-status-item">'];if(r.push('<h3 class="catalogimport-status-title">'+t.sheetName+"</h3>"),r.push('<h4 class="catalogimport-status-type">'+this.validateText+":</h4>"),r.push('<p class="catalogimport-status-count">'+Mustache.render(this.resultTpl,{0:t.checkCount,1:t.checkSuccessCount,2:t.checkErrorCount})),(n=t.checkMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="catalogimport-status-toggle">'+this.expandText+"</a></p>"),r.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else s=!1;if(t.saveCount)if(s||(r.push("</p>"),s=!0),r.push('<h4 class="catalogimport-status-type">'+this.importResultText+"：</h4>"),r.push('<p class="catalogimport-status-count">'+Mustache.render(this.resultTpl,{0:t.saveCount,1:t.saveSuccessCount,2:t.saveErrorCount})),(n=t.saveMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="catalogimport-status-toggle">'+this.expandText+"</a></p>"),r.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else o=!1;if((n=t.taskMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="catalogimport-status-toggle">'+this.expandText+"</a></p>"),r.push('<div class="catalogimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else s&&o||r.push("</p>");return r.push("</div>"),r.join("")},_getSize:function(t){return 1048576<(t=parseInt(t))?(t/1048576).toFixed(2)+"M":(t/1024).toFixed(2)+"K"},_pollingFrequency:1e3,_oldAttachGuid:"",_onUploadSuccess:function(t){var e=t.ret,i=t.file;if(mini.getSecondRequestData&&(e=mini.getSecondRequestData(e)),e=(e=e.data||e).extraDatas||e,this._pollingFrequency=e.pollingFrequency,"importStatus"==e.action)return this._curAttachGuid=e.attachGuid,this._oldAttachGuid=e.attachGuidOld,e.fileId=i.id,void this.pollingStatus(e);var n=this;mini.alert(this.importErrorText,"",function(){n._onFinished(e)})},_onFinished:function(t){var e=t.status||this.importSuccessText,i=t.success;this.isImportFinished=!0;var n=mini.byId(this._currentFileId),s=jQuery(".mini-catalogimport-status",n),o=jQuery(".mini-catalogimport-progressbar",n),r=jQuery(".mini-catalogimport-action",n);s.text(e),o.addClass("hidden"),i?setTimeout(function(){s.addClass("hidden")},1e3):(s.addClass("error"),s.append('<a class="catalogimport-export">'+this.exportText+"</a>"),r.removeClass("hidden")),this._events.importfinished&&this.fire("importfinished",t)},_onBeforeFileQueued:function(t){this._events.beforefilequeued&&this.fire("beforefilequeued",t)},_currentFileId:"",pollingStatus:function(t){t.fileId&&(this._currentFileId=t.fileId),this._onPollingStatus(t);var e=this,i={fileMD5:this._curFileMD5,attachGuid:this._curAttachGuid,attachGuidOld:this._oldAttachGuid};i[this.uploader.id+"_action"]="importStatus",this.uploader.getCommonData&&(i.commonDto=mini.encode(this.uploader.getCommonData())),jQuery.ajax({url:this.url,data:i,type:"POST",dataType:"json"}).done(function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),t.msg&&mini.alert(t.msg),t.end?e._onFinished(t):setTimeout(jQuery.proxy(e.pollingStatus,e,t),e._pollingFrequency),e.setDetailStatus(t.detail)})},setDetailStatus:function(t){this.detailStatus=t,this.isDetailShow&&this.renderDetailStatus()},renderDetailStatus:function(){var t,e=this.detailStatus,i=[],n=0;if(e)for(t=e.length;n<t;n++)i.push(this._generateStatuslist(e[n]));this.detailContent.innerHTML=i.join("")},showDetailStatus:function(){this.renderDetailStatus(),this.detailEl.style.display="block",this.isDetailShow=!0},hideDetailStatus:function(){this.detailEl.style.display="none",this.isDetailShow=!1},setUrl:function(t){this.url=t,this.uploader&&this.uploader.setUploadUrl(t)},getUrl:function(){return this.url},setPickerText:function(t){},setEnabled:function(t){mini.CatalogImport.superclass.setEnabled.call(this,t),this.uploader&&this.uploader.setEnabled(t)},getAttrs:function(t){var e=mini.CatalogImport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","pickerText","onbeforefilequeued","onpostfilemd5","onimportfinished","onexportresult"]),e}}),mini.regClass(mini.CatalogImport,"catalogimport");var ColorPaletteHistory=function(){this.notifyList=[],this.history=[],this.maxHistory=10},vEb,NJb,XNb;function wEb(t){var e=$(t.target||t.srcElement);e.closest(".laydate-time-list > li li").length&&vEb(function(){!function o(t){var e=t.position().top,i=t.outerHeight(!0),n=t.parent(),s=n[0].offsetHeight;0<e&&e<s-i||(n[0].scrollTop=n[0].scrollTop+e)}(e)})}function OJb(t){return'<svg icon="'+t+'"><use xlink:href="#'+t+'"></use></svg>'}function PJb(){var e;function o(t){var e,i=t.className;if(jQuery(t).hasClass("action-icon")){if(e=i.match(/icon-(\w+)-svg/)){if(t.firstChild&&NJb(t.firstChild).attr("icon")==e[0])return;t.innerHTML=OJb(e[0])}}else SJb(t)}(e=new MutationObserver(function(t){t.forEach(function(t){switch(t.type){case"childList":!function s(t){for(var e,i=0,n=t.length;i<n;i++)(e=t[i]).nodeType===Node.ELEMENT_NODE&&o(e)}(t.addedNodes);break;case"attributes":!function n(t){if(!t)return;var e=t.firstElementChild;if(!e)return;var i=e.getAttribute("icon");if(jQuery(t).hasClass(i))return;o(t)}(t.target)}}),e.takeRecords()})).observe(document.body,{childList:!0,attributes:!0,attributeOldValue:!1,characterData:!1,subtree:!0}),jQuery(window).on("unload",function(){e.disconnect()})}function QJb(){SJb(),setTimeout(QJb,500)}function SJb(t){(t?jQuery(t).find(".action-icon"):jQuery(".action-icon")).each(function(t,e){var i=e.className.match(/icon-(\w+)-svg/);if((i=!!i&&i[0])&&mini.Icon.SVG_MAP[i]){if(e.firstChild&&NJb(e.firstChild).attr("icon")===i)return;e.innerHTML=OJb(i)}})}jQuery.extend(ColorPaletteHistory.prototype,{record:function(t){var e=this.history.indexOf(t);0<=e&&this.history.splice(e,1),this.history.unshift(t),this.history=this.history.slice(0,this.maxHistory),this.notify()},notify:function(){var e=this;this.notifyList.forEach(function(t){t._setHistory(e.history.slice())})},sub:function(t){this.notifyList.indexOf(t)<0&&(this.notifyList.push(t),t._setHistory(this.history))},unSub:function(t){t._setHistory([]);var e=this.notifyList.indexOf(t);0<=e&&this.notifyList.splice(e,1)}}),mini.ColorPalette=function(){mini.ColorPalette.superclass.constructor.call(this)},mini.extend(mini.ColorPalette,mini.Control,{uiCls:"mini-colorpalette",format:"hex",enableAlpha:!0,enableHistory:!1,history:[],defaultColorCard:[["#B71C1C","#C62828","#D32F2F","#E53935","#F44336","#EF5350","#E57373","#EF9A9A","#FFCDD2","#FFEBEE"],["#F57F17","#F9A825","#FBC02D","#FDD835","#FFEB3B","#FFEE58","#FFF176","#FFF59D","#FFF9C4","#FFFDE7"],["#004D40","#00695C","#00796B","#00897B","#009688","#26A69A","#4DB6AC","#80CBC4","#B2DFDB","#E0F2F1"],["#0D47A1","#1565C0","#1976D2","#1E88E5","#2196F3","#42A5F5","#64B5F6","#90CAF9","#BBDEFB","#E3F2FD"],["#4A148C","#6A1B9A","#7B1FA2","#8E24AA","#9C27B0","#AB47BC","#BA68C8","#CE93D8","#E1BEE7","#F3E5F5"],["#212121","#424242","#616161","#757575","#9E9E9E","#BDBDBD","#E0E0E0","#EEEEEE","#F5F5F5","#FAFAFA"]],colorCard:!1,h:0,s:1,v:1,a:1,ready:!1,_create:function(){var t=this;this.el=document.createElement("div"),this.el.className=this.uiCls+" clearfix",this.el.innerHTML='<div class="mini-colorpalette-sv"><div class="mini-colorpalette-sv-color"></div><div class="mini-colorpalette-s"></div><div class="mini-colorpalette-v"></div><div class="mini-colorpalette-sv-picker"></div></div><div class="mini-colorpalette-ha l"><div class="mini-colorpalette-h"><div class="mini-colorpalette-h-picker"></div></div><div class="mini-colorpalette-a"><div class="mini-colorpalette-a-color"></div><div class="mini-colorpalette-a-picker"></div></div></div><div class="mini-colorpalette-preview r"><div class="mini-colorpalette-preview-color"></div></div><div class="mini-colorpalette-text l clearfix"><div class="mini-colorpalette-hex-text l"><input type="text" tabindex="1"><span class="mini-colorpalette-text-info">HEX</span></div><div class="mini-colorpalette-a-text r"><input type="text" tabindex="5"><span class="mini-colorpalette-text-info">A</span></div><div class="mini-colorpalette-b-text r"><input type="text" tabindex="4"><span class="mini-colorpalette-text-info">B</span></div><div class="mini-colorpalette-g-text r"><input type="text" tabindex="3"><span class="mini-colorpalette-text-info">G</span></div><div class="mini-colorpalette-r-text r"><input type="text" tabindex="2"><span class="mini-colorpalette-text-info">R</span></div></div><div class="mini-colorpalette-colorcard l hidden"></div><div class="mini-colorpalette-history l hidden"></div>',this._$svEl=jQuery(".mini-colorpalette-sv",this.el),this._$svColorEl=jQuery(".mini-colorpalette-sv-color",this.el),this._$svPickerEl=jQuery(".mini-colorpalette-sv-picker",this.el),this._$hEl=jQuery(".mini-colorpalette-h",this.el),this._$hPickerEl=jQuery(".mini-colorpalette-h-picker",this.el),this._$aEl=jQuery(".mini-colorpalette-a",this.el),this._$aColorEl=jQuery(".mini-colorpalette-a-color",this.el),this._$aPickerEl=jQuery(".mini-colorpalette-a-picker",this.el),this._$previewColorEl=jQuery(".mini-colorpalette-preview-color",this.el),this._$hexInput=jQuery(".mini-colorpalette-hex-text > input",this.el),this._$aInput=jQuery(".mini-colorpalette-a-text > input",this.el),this._$bInput=jQuery(".mini-colorpalette-b-text > input",this.el),this._$gInput=jQuery(".mini-colorpalette-g-text > input",this.el),this._$rInput=jQuery(".mini-colorpalette-r-text > input",this.el),this._$colorCardEl=jQuery(".mini-colorpalette-colorcard",this.el),this._$historyEl=jQuery(".mini-colorpalette-history",this.el),this._isSvDragging=!1,this._isHDragging=!1,this._isADragging=!1,this.setEnableHistory(this.enableHistory),this._afterReady=[],this.externalSrc=this.externalSrc||mini.externalSrc,window.tinycolor?this._init():mini.loadJS(this.externalSrc+"tinycolor/tinycolor.js",function(){t._init()})},_init:function(){this._bindEvents(),this._syncColor(),this._renderAlpha(),this._renderColorCard(),this.ready=!0,this._afterReady.forEach(function(t){t()}),this._afterReady=[],this.fire("ready")},_bindEvents:function(){var i=this;function t(){var t=tinycolor(jQuery(this).data("color"));t.isValid()&&(i._setHsva(t.toHsv()),i.__OnValueChanged()),i.__OnColorClick()}function e(){var t=tinycolor({r:i._$rInput.val(),g:i._$gInput.val(),b:i._$bInput.val(),a:i._$aInput.val()/100});t.isValid()&&(i._setHsva(t.toHsv()),i.__OnValueChanged())}mini.on(this._$svEl[0],"mousedown",this._svDragStart,this),mini.on(this._$hEl[0],"mousedown",this._hDragStart,this),mini.on(this._$aEl[0],"mousedown",this._aDragStart,this),mini.on(window,"mouseup",function(){i._svDragEnd(),i._hDragEnd(),i._aDragEnd()}),this._$hexInput.on("input",function(){var t=this.value.slice(0,6);if(6===(this.value=t).length){var e=tinycolor(t);e.isValid()&&(i._setHsv(e.toHsv()),i.__OnValueChanged())}}),this._$hexInput.on("change",function(){i._syncColor()}),this._$rInput.on("input",e),this._$gInput.on("input",e),this._$bInput.on("input",e),this._$aInput.on("input",e),this._$colorCardEl.on("click",".mini-colorpalette-colorlump",t),this._$historyEl.on("click",".mini-colorpalette-colorlump",t)},_renderColorCard:function(){var e=this;if(this.colorCard){var i=[],o=0,t=[];Array.isArray(this.colorCard)?t=this.colorCard:this.colorCard&&(t=this.defaultColorCard),o=Array.isArray(t[0])?(t.forEach(function(t){t.length>o&&(o=t.length),i.push({colors:e.enableAlpha?t:t.map(function(t){return tinycolor(t).toHexString()})})}),10<o?10:o):(i.push({colors:this.enableAlpha?t:t.map(function(t){return tinycolor(t).toHexString()})}),10),i=i.map(function(t){for(var e=t.colors,i=(o-e.length%o)%o,n=[],s=0;s<i;s++)n.push("");return{colors:e,placeholder:n}}),this._$colorCardEl.empty().removeClass("hidden").append(Mustache.render('{{#rows}}<div class="mini-colorpalette-colorcard-row">{{#colors}}<span class="mini-colorpalette-colorlump" data-color="{{.}}"><span class="mini-colorpalette-colorlump-color" style="background-color: {{.}}"></span></span>{{/colors}}{{#placeholder}}<span class="mini-colorpalette-placeholder"></span>{{/placeholder}}</div>{{/rows}}',{rows:i}))}else this._$colorCardEl.empty().addClass("hidden")},_setHistory:function(t){this.history=t,this._renderHistory()},_renderHistory:function(){var e=this;if(this.enableHistory&&this.history.length){var i=this.history.map(function(t){return e.enableAlpha?t:tinycolor(t).toHexString()});this.enableAlpha||(i=i.filter(function(t,e){return i.indexOf(t)===e}));for(var t=10-i.length,n=[],s=0;s<t;s++)n.push("");this._$historyEl.empty().removeClass("hidden").append(Mustache.render('{{#colors}}<span class="mini-colorpalette-colorlump" data-color="{{.}}"><span class="mini-colorpalette-colorlump-color" style="background-color: {{.}}"></span></span>{{/colors}}{{#placeholder}}<span class="mini-colorpalette-placeholder"></span>{{/placeholder}}',{colors:i,placeholder:n}))}else this._$historyEl.empty().addClass("hidden")},_renderAlpha:function(){this.a=this.enableAlpha?this.a:1,this._$aEl.toggleClass("hidden",!this.enableAlpha),this._$aInput.parent().toggleClass("hidden",!this.enableAlpha),this._$hEl.toggleClass("full-height",!this.enableAlpha)},_svDragStart:function(t){var e=this._$svEl.width(),i=this._$svEl.height(),n=t.pageX-this._$svEl.offset().left,s=t.pageY-this._$svEl.offset().top;this.s=n/e,this.v=1-s/i,this.__OnValueChanged(),this._isSvDragging=!0,mini.on(window,"mousemove",this._svDragging,this)},_svDragging:function(t){if(this._isSvDragging){var e=this._$svEl.width(),i=this._$svEl.height(),n=t.pageX-this._$svEl.offset().left,s=t.pageY-this._$svEl.offset().top;n=e<n?e:n<0?0:n,s=i<s?i:s<0?0:s,this.s=n/e,this.v=1-s/i,this.__OnValueChanged()}},_svDragEnd:function(){this._isSvDragging=!1,mini.un(window,"mousemove",this._svDragging,this)},_hDragStart:function(t){var e=this._$hEl.width(),i=t.pageX-this._$hEl.offset().left;this.h=i/e*360,this.__OnValueChanged(),this._isHDragging=!0,mini.on(window,"mousemove",this._hDragging,this)},_hDragging:function(t){if(this._isHDragging){var e=this._$hEl.width(),i=t.pageX-this._$hEl.offset().left;i=e<i?e:i<0?0:i,this.h=i/e*360,this.__OnValueChanged()}},_hDragEnd:function(){this._isHDragging=!1,mini.un(window,"mousemove",this._hDragging,this)},_aDragStart:function(t){var e=this._$aEl.width(),i=t.pageX-this._$aEl.offset().left;this.a=i/e,this.__OnValueChanged(),this._isADragging=!0,mini.on(window,"mousemove",this._aDragging,this)},_aDragging:function(t){if(this._isADragging){var e=this._$aEl.width(),i=t.pageX-this._$aEl.offset().left;i=e<i?e:i<0?0:i,this.a=i/e,this.__OnValueChanged()}},_aDragEnd:function(){this._isADragging=!1,mini.un(window,"mousemove",this._aDragging,this)},_getHColor:function(){return tinycolor({h:this.h,s:1,v:1})},_getHsvColor:function(){return tinycolor({h:this.h,s:this.s,v:this.v})},_getHsvaColor:function(){return tinycolor({h:this.h,s:this.s,v:this.v,a:this.a})},_setHsv:function(t){this.h=t.h,this.s=t.s,this.v=t.v},_setHsva:function(t){this.h=t.h,this.s=t.s,this.v=t.v,this.a=t.a},_syncColor:function(){this._syncHPicker(),this._syncSVPicker(),this.enableAlpha&&this._syncAPicker();var t=this._getHColor(),e=this._getHsvColor(),i=this._getHsvaColor();this._$svColorEl.css("background-color",t.toHexString()),this._$aColorEl.css("background-image","linear-gradient(to right, transparent, "+e.toHexString()+")"),this._$previewColorEl.css("background-color",i.toRgbString());var n=i.toRgb();this._$rInput.val(n.r),this._$gInput.val(n.g),this._$bInput.val(n.b),this._$aInput.val(Math.round(100*n.a)),this._$hexInput.val(i.toHex().toUpperCase())},_syncHPicker:function(){var t=this.h/360*100+"%";this._$hPickerEl.css("left",t)},_syncSVPicker:function(){var t=100*this.s+"%",e=100*(1-this.v)+"%";this._$svPickerEl.css({left:t,top:e})},_syncAPicker:function(){var t=100*this.a+"%";this._$aPickerEl.css("left",t)},__OnValueChanged:function(){this._syncColor(),this.fire("valuechanged",{value:this._getFormattedColor()})},__OnColorClick:function(){this.fire("colorclick",{value:this._getFormattedColor()})},_getFormattedColor:function(){var t=this._getHsvaColor();return"hex"===this.format?1===this.a?t.toHexString():t.toHex8String():"rgb"===this.format?t.toRgbString():"hsl"===this.format?t.toHslString():"hsv"===this.format?t.toHsvString():void 0},getValue:function(){var t=this._getHsvaColor();return this.enableHistory&&mini.ColorPalette.history.record(t.toHex8String()),this._getFormattedColor()},setValue:function(t){var e=this;if(this.ready){var i=tinycolor(t);if(i.isValid()){var n=i.toHsv();this.enableAlpha?this._setHsva(n):this._setHsv(n),this._syncColor()}}else this._afterReady.push(function(){e.setValue(t)})},getFormat:function(){return this.format},setFormat:function(t){0<=["hex","rgb","hsl","hsv"].indexOf(t)&&(this.format=t)},getEnableHistory:function(){return this.enableHistory},setEnableHistory:function(t){this.enableHistory=t,mini.ColorPalette.history||(mini.ColorPalette.history=new ColorPaletteHistory),mini.ColorPalette.history[t?"sub":"unSub"](this)},getEnableAlpha:function(){return this.enableAlpha},setEnableAlpha:function(t){var e=this;this.enableAlpha=t,this.ready?(this._renderAlpha(),this._renderColorCard(),this._renderHistory(),this._syncColor()):this._afterReady.push(function(){e.setEnableAlpha(e.enableAlpha)})},getColorCard:function(){return this.colorCard},setColorCard:function(t){var i=this;if(!0===t||"true"===t||""===t)this.colorCard=!0;else try{t=mini.decode(t),Array.isArray(t)&&t.length?this.colorCard=t:this.colorCard=!1}catch(e){this.colorCard=!1}this.ready?this._renderColorCard():this._afterReady.push(function(){i.setColorCard(i.colorCard)})},setHue:function(t){var e=tinycolor({h:t,s:this.s,v:this.v,a:this.a});e.isValid()&&(this.h=e.toHsv().h,this._syncColor())},setSaturation:function(t){var e=tinycolor({h:this.h,s:t,v:this.v,a:this.a});e.isValid()&&(this.s=e.toHsv().s,this._syncColor())},setBrightness:function(t){var e=tinycolor({h:this.h,s:this.s,v:t,a:this.a});e.isValid()&&(this.v=e.toHsv().v,this._syncColor())},setAlpha:function(t){if(this.enableAlpha){var e=tinycolor({h:this.h,s:this.s,v:this.v,a:t});e.isValid()&&(this.a=e.toHsv().a,this._syncColor())}},getAttrs:function(t){var e=mini.ColorPalette.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["format","colorCard","onValueChanged","onColorClick","onReady"]),mini._ParseBool(t,e,["enableHistory","enableAlpha"]),e}}),mini.regClass(mini.ColorPalette,"colorpalette"),mini.ColorPicker=function(){mini.ColorPicker.superclass.constructor.call(this)},mini.extend(mini.ColorPicker,mini.ButtonEdit,{uiCls:"mini-colorpicker",value:"#ffffff",format:"hex",colorCard:!1,enableHistory:!1,enableAlpha:!0,allowInput:!0,showColorText:!0,ready:!1,_create:function(){mini.ColorPicker.superclass._create.call(this),this._buttonEl.innerHTML='<span class="mini-colorpicker-preview"><span class="mini-colorpicker-preview-color"></span></span>',this._previewColorEl=this._buttonEl.firstChild.firstChild,this._colorPalette=new mini.ColorPalette,this._colorPalette.setValue(this.value),this._colorPalette.setFormat(this.format),this._colorPalette.setColorCard(this.colorCard),this._colorPalette.setEnableHistory(this.enableHistory),this._colorPalette.setEnableAlpha(this.enableAlpha),this._popup=new mini.Popup,this._popup.setBody(this._colorPalette.el),this._popup.setyOffset(8),(this._popup.__parent=this)._popup.el.setAttribute("attached","true"),this._renderColorText(),this._syncPreviewColor(this.value),mini.ColorPicker.superclass.setText.call(this,this.value),this._afterReady=[]},_initEvents:function(){mini.ColorPicker.superclass._initEvents.call(this),mini.on(this._textEl,"input",this.__OnInput,this),mini.on(this._textEl,"blur",this.__OnBlur,this),mini.on(this.el,"click",this.__OnClick,this),this._colorPalette.on("ready",this.__OnReady,this),this._colorPalette.on("valuechanged",function i(t){var e=t.value;mini.ColorPicker.superclass.setText.call(this,e),this._syncPreviewColor(e)},this),this._colorPalette.on("colorclick",function t(){this._popup.hide()},this),this._popup.on("close",function e(){jQuery(this._textEl).trigger("blur");var t=this._colorPalette.getValue();t!==this.value&&(this._syncFromPalette(t),this.__OnValueChanged())},this)},__OnReady:function(){this.ready=!0,this._afterReady.forEach(function(t){t()}),this._afterReady=[],this.fire("ready")},__OnClick:function(t){this._popup.showAtEl(this.el),mini.ColorPicker.superclass.__OnClick.call(this,t)},__OnInput:function(){var t=this._textEl.value;this._colorPalette.setValue(t),this._syncPreviewColor(),this.fire("input",{value:t})},__OnValueChanged:function(){this.fire("valuechanged",{value:this.value})},_syncPreviewColor:function(t){this._previewColorEl.style.backgroundColor=t||this._colorPalette.getValue()},_syncFromPalette:function(t){var e=this;this.ready?(t=t||this._colorPalette.getValue(),this._syncPreviewColor(t),mini.ColorPicker.superclass.setText.call(this,t),mini.ColorPicker.superclass.setValue.call(this,t)):this._afterReady.push(function(){e._syncFromPalette(t)})},_renderColorText:function(){var t=jQuery(this._textEl),e=jQuery(this.el);this.showColorText?(t.removeClass("hidden"),e.removeClass("no-text")):(t.addClass("hidden"),e.addClass("no-text"))},setValue:function(t){this._colorPalette.setValue(t),this._syncFromPalette()},setFormat:function(t){this._colorPalette.setFormat(t),this.format=this._colorPalette.getFormat(),this._syncFromPalette()},getFormat:function(){return this.format},setColorCard:function(t){this._colorPalette.setColorCard(t),this.colorCard=this._colorPalette.getColorCard()},getColorCard:function(){return this.colorCard},setEnableHistory:function(t){this._colorPalette.setEnableHistory(t),this.enableHistory=this._colorPalette.getEnableHistory()},getEnableHistory:function(){return this.enableHistory},setEnableAlpha:function(t){this._colorPalette.setEnableAlpha(t),this.enableAlpha=this._colorPalette.getEnableAlpha(),this._syncFromPalette()},getEnableAlpha:function(){return this.enableAlpha},setShowColorText:function(t){this.showColorText=t,this._renderColorText()},getShowColorText:function(){return this.showColorText},showPopup:function(){this._popup.showAtEl(this.el)},hidePopup:function(){this._popup.hide()},getAttrs:function(t){var e=mini.ColorPicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["format","colorCard","onValueChanged","onReady"]),mini._ParseBool(t,e,["enableHistory","enableAlpha","showColorText"]),e}}),mini.regClass(mini.ColorPicker,"colorpicker"),mini.Cropper=function(){mini.Cropper.superclass.constructor.call(this)},mini.extend(mini.Cropper,mini.Control,{uiCls:"mini-cropper",url:"",maxSize:5242880,maxSizeStr:"5M",title:epoint_local.Cropper.title,imageSizeText:epoint_local.Cropper.imageSizeText,selectImgText:epoint_local.Cropper.selectImgText,onlinePhotoText:epoint_local.Cropper.onlinePhotoText,previewText:epoint_local.Cropper.previewText,reselectText:epoint_local.Cropper.reselectText,finishText:epoint_local.Cropper.finishText,cancelText:epoint_local.Cropper.cancelText,validateText:epoint_local.Cropper.validateText,imageSizeAlertText:epoint_local.Cropper.imageSizeAlertText,noImageAlert:epoint_local.Cropper.noImageAlert,cropperConfig:{dragMode:"move",aspectRatio:1,cropBoxResizable:!0,viewMode:2,zoomOnWheel:!0,autoCropArea:.9,preview:".image-preview",autoCrop:!0},_create:function(){var t=this;this.cropperConfig=$.extend(!0,{},this.cropperConfig),this.el=document.createElement("div"),this.externalSrc=this.externalSrc||mini.externalSrc,window.Cropper?this._initCropper():(mini.loadCSS(this.externalSrc+"cropper/cropper.min.css"),mini.loadJS(this.externalSrc+"cropper/cropper.min.js",function(){t._initCropper()})),window.WebCam?this._initWebCam():mini.loadJS(this.externalSrc+"webcam/webcam.min.js",function(){t._initWebCam()})},_loadImg:function(t){this.$cropperImg.attr("src",t),this.cropper&&this.cropper.destroy(),this.cropper=new Cropper(this.$cropperImg[0],this.cropperConfig),this.$cropperBody.removeClass("is-empty")},_initCropper:function(){var n=this,t=document.createElement("div");t.className="mini-cropper-container is-empty",t.innerHTML='<input type="file" class="input-image" name="file" accept="image/*"/><p class="info measure">'+this.imageSizeText+': <span class="img-measure"></span></p><div class="img-cropper"><img /><label class="select-img" title="'+this.selectImgText+'">'+this.selectImgText+'</label><label class="take-img" title="'+this.onlinePhotoText+'">'+this.onlinePhotoText+'</label></div><div class="right"><span class="preview-text">'+this.previewText+'</span><div class="image-preview-wrap" style="width: 100px; height: 100px;"><div class="image-preview" style="width: 100%; height: 100%; overflow: hidden"></div></div><span class="info">100*100</span><div class="image-preview-wrap" style="width: 28px; height: 28px;"><div class="image-preview" style="width: 100%; height: 100%; overflow: hidden"></div></div><span class="info">28*28</span></div><div class="re-change"><label class="change-img">'+this.reselectText+'</label><label class="re-take-img">'+this.onlinePhotoText+'</label></div><div class="footer"><span class="finish btn">'+this.finishText+'</span><span class="cancel btn">'+this.cancelText+"</span></div>",this.$cropperBody=$(t),this.$cropperImg=$(".img-cropper > img",t),this.$imagePreview=$(".image-preview",t),this.$imgMeasure=$(".img-measure",t);var s=$(".input-image",t),e=$(".finish.btn",t),i=$(".cancel.btn",t),o=$(".select-img, .change-img",t),r=$(".take-img, .re-take-img",t);this.$cropperImg.on("crop",function(t){n.__OnCropBoxChange(t)}),s.on("change",function(){var t,e=this.files;if(e&&e.length)if(t=e[0],/^image\/\w+$/.test(t.type)){var i=new FileReader;i.addEventListener("load",function(){n._loadImg(i.result),s.val("")},!1),i.readAsDataURL(t)}else mini.alert(n.validateText)}),o.on("click",function(){s.trigger("click")}),r.on("click",function(){n._startWebCam()}),e.on("click",function(){var t=n.getImageData();t?n._validateSize(t)?n.__OnCropped(t):mini.alert(n.imageSizeAlertText+n.maxSizeStr):mini.alert(n.noImageAlert)}),i.on("click",function(){n._cropperWindow.hide()}),this._cropperWindow=new mini.Window,this._cropperWindow.setTitle(this.title),this._cropperWindow.setBody(t),this._cropperWindow.setWidth(480),this._cropperWindow.setHeight(420),this._cropperWindow.on("close",function(t){n.__OnClose(t),n._webCamWindow.hide(),n._resetCropper()})},_initWebCam:function(){var e=this,t=document.createElement("div");t.className="mini-cropper-webcam",t.innerHTML='<div class="webcam-container"></div><span class="snap-button"></span>';var i=$(".snap-button",t);this._webCamWindow=new mini.Window,this._webCamWindow.setTitle(this.onlinePhotoText),this._webCamWindow.setBody(t),this._webCamWindow.setWidth(378),this._webCamWindow.setHeight(425),this._webCamWindow.on("close",function(){e._resetWebCam()}),i.on("click",function(){Webcam.snap(function(t){e._loadImg(t),e._webCamWindow.hide()})}),Webcam.set({width:480,height:360,dest_width:480,dest_height:360,crop_width:360,crop_height:360,image_format:"jpeg",jpeg_quality:90})},_startCropper:function(){this._cropperWindow.show()},_resetCropper:function(){this.cropper&&(this.cropper.destroy(),this.cropper=null),this.$cropperBody.addClass("is-empty")},_startWebCam:function(){this._webCamWindow.show(),Webcam.attach(".mini-cropper-webcam .webcam-container")},_resetWebCam:function(){Webcam.reset()},_validateSize:function(t){var e=t.substr(22),i=(e=e.replace(/=/g,"")).length;return!(i-i/8*2>=this.maxSize)},__OnCropped:function(t){this._cropperWindow.hide(),this.fire("cropped",{data:t}),this.url&&this.__OnBeforeUpload({data:t})},__OnClose:function(t){this.fire("close",t)},__OnCropBoxChange:function(t){var e=t.originalEvent.detail.width,i=t.originalEvent.detail.height;this.$imgMeasure.text(Math.round(e)+"x"+Math.round(i)),this.fire("cropboxchange",{htmlEvent:t})},__OnBeforeUpload:function(t){this.fire("beforeupload",t),t.cancel||this._upload(t.data)},__OnUploaded:function(t){this.fire("uploaded",t)},_upload:function(t){var e=this;this.url&&(mini.mask({el:document.body,cls:"mini-mask-loading"}),Util.ajax({url:this.url,data:{imgData:t}}).always(function(){mini.unmask(document.body)}).done(function(t){e.__OnUploaded({data:t})}))},getImageData:function(){return this.cropper?this.cropper.getCroppedCanvas().toDataURL():null},show:function(){this._startCropper()},hide:function(){this._cropperWindow.hide()},getAttrs:function(t){var e=mini.Cropper.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["oncropped","oncropboxchange","onclose","onbeforeupload","onuploaded","aspectRatio","title","url"]),mini._ParseInt(t,e,["maxSize"]),e},setAspectRatio:function(t){var e;e=/^([1-9][\d]*|0)(\.[\d]+)?\s*\/\s*([1-9][\d]*|0)(\.[\d]+)?$/.test(t)?Util.safeEval(t):+t,Number.isNaN(e)||(this.cropperConfig.aspectRatio=e,this.cropper&&this.cropper.setAspectRatio(this.cropperConfig.aspectRatio))},getAspectRatio:function(){return this.cropperConfig.aspectRatio},setMaxSize:function(t){var e=parseInt(t,10);if(!Number.isNaN(e)){this.maxSize=e;for(var i=0;1024<=e;)e/=1024,i++;this.maxSizeStr=e+["B","KB","MB","GB","TB"][i]}},getMaxSize:function(){return this.maxSize},setTitle:function(t){this.title=t,this._cropperWindow&&this._cropperWindow.setTitle(t)},getTitle:function(){return this.title},setUrl:function(t){this.url=t},getUrl:function(){return this.url}}),mini.regClass(mini.Cropper,"cropper"),mini.DataExport=function(){mini.DataExport.superclass.constructor.call(this)},mini.extend(mini.DataExport,mini.Button,{mapClass:"com.epoint.basic.faces.export.DataExport",extraId:"",exportAction:"",paramName:"commonDto",gridId:"",exportUrl:"",fileName:"",position:"right",uiCls:"mini-dataexport",columnsValue:"",columnsText:"",dynamicColumns:!1,expandText:epoint_local.DataExport.expandText,collapseText:epoint_local.DataExport.collapseText,exportText:epoint_local.DataExport.expandText,leftListTitle:epoint_local.DataExport.leftListTitle,rightListTitle:epoint_local.DataExport.rightListTitle,fromText:epoint_local.DataExport.fromText,pageNumInfo:epoint_local.DataExport.pageNumInfo,pageText:epoint_local.DataExport.pageText,exportModelText:epoint_local.DataExport.exportModelText,selectExportText:epoint_local.DataExport.selectExportText,allExportText:epoint_local.DataExport.allExportText,curPageExportText:epoint_local.DataExport.curPageExportText,_clearBorder:!1,showExportModel:!1,showIcon:!1,_iconCls:"icon-upload",_create:function(){mini.DataExport.superclass._create.apply(this,arguments),this.set({text:this.collapseText,disableMultiClick:!1}),this.showIcon&&this.setIconCls(this._iconCls),this.popup=new mini.Popup,(this.popup.__parent=this).popup.el.setAttribute("attached","true"),this.panel=new mini.Panel,this.popup.addCls("mini-dataexport-popup"),this.panel.addCls("mini-dataexport-panel"),this.panel.set({width:450,showToolbar:!1,showFooter:!1,showHeader:!1}),this.popup.render(document.body),this.panel.render(this.popup.el);var t=['<div class="mini-export-list"><div class="mini-export-left"></div><div class="mini-export-middle"></div><div class="mini-export-right"></div></div>'];t.push('<div class="mini-export-line">'),t.push('<div id="'+this.id+'-rbl" class="mini-radiobuttonlist" repeatItems="1" repeatLayout="table" ></div>'),t.push('<div id="'+this.id+'-model-ck" class="mini-checkbox model-ck" style="display:none" text="'+this.exportModelText+'"></div>'),t.push("</div>"),t.push('<a id="'+this.id+'-action" class="mini-button mini-btn-primary mini-export-btn">'+this.exportText+"</a>"),t.push('<div style="display:none;"></div>'),this.panel.setBody(t.join("")),mini.parse(this.popup.el),this._panel=this.panel.el,this._exportBtn=mini.get(this.id+"-action",this._panel);var e=this.panel.getBodyEl();this._listContent=e.firstChild,this._exportRbl=mini.get(this.id+"-rbl",this._panel),this._exportRbl.setData([{text:this.selectExportText,id:"0"},{text:this.allExportText,id:"1"},{text:this.curPageExportText,id:"2"},{text:this.fromText+'<input type="text" class="mini-export-num" id="'+this.id+'-fromnum"/>'+this.pageNumInfo+'<input type="text" class="mini-export-num" id="'+this.id+'-tonum"/>'+this.pageText,id:"3"}]),this._radioTrs=this._exportRbl._innerEl.getElementsByTagName("tr"),this._rowTr=this._radioTrs[0],this._curPageTr=this._radioTrs[2],this._pageTr=this._radioTrs[3],this._fromNumInput=mini.byId(this.id+"-fromnum",this._pageTr),this._toNumInput=mini.byId(this.id+"-tonum",this._pageTr),this.exportModelCheck=mini.get(this.id+"-model-ck",this._panel),this._exportFormWrap=e.lastChild;var i=this.id+"-exportIFrame";this._exportFormWrap.innerHTML='<form method="post" target="'+i+'"><input type="hidden" name="'+this.paramName+'" /></form><iframe id="'+i+'" name="exportIFrame" style="display:none;"></iframe>',this._exportForm=this._exportFormWrap.firstChild,this._exportFormField=this._exportForm.firstChild,this._exportIframe=this._exportFormWrap.lastChild,this._contentL=this._listContent.firstChild,this._contentM=this._listContent.childNodes[1],this._contentR=this._listContent.lastChild,this._contentL.innerHTML='<div class="mini-export-list-header">'+this.leftListTitle+'</div><div class="mini-export-list-content"></div>',this._contentR.innerHTML='<div class="mini-export-list-header">'+this.rightListTitle+'</div><div class="mini-export-list-content"></div>',this.leftListBox=new mini.ListBox,this.leftListBox.set({height:170,width:180,valueField:"field",showCheckBox:!0,multiSelect:!0}),this.leftListBox.render(this._contentL.lastChild),this.rightListBox=new mini.ListBox,this.rightListBox.set({height:170,width:180,valueField:"field",showCheckBox:!0,multiSelect:!0}),this.rightListBox.render(this._contentR.lastChild),this._initButtons()},_initEvents:function(){mini.DataExport.superclass._initEvents.apply(this,arguments);var s=this;this.on("click",function(){mini.hasClass(s.el,"mini-button-popup")?s.hidePanel():s.showPanel()}),this._exportBtn.on("click",function(t){s._OnExport(t)}),mini.on(this._fromNumInput,"blur",function(){if(s.dataGrid){var t=s.dataGrid.getPageIndex()+1,e=s.dataGrid.getTotalPage(),i=parseInt(s._toNumInput.value,10),n=parseInt(this.value,10);n?e<n&&(n=e):n=t,i<n&&(n=i),this.value=n}}),mini.on(this._toNumInput,"blur",function(){if(s.dataGrid){s.dataGrid.getPageIndex();var t=s.dataGrid.getTotalPage(),e=parseInt(s._fromNumInput.value,10),i=parseInt(this.value,10);(!i||t<i)&&(i=t),i<e&&(i=e),this.value=i}}),mini.on(document,"mouseup",this._OnDocMouseUp,this),mini.on(this._exportIframe,"load",function(){s.fire("exportsuccess")})},_getExportData:function(){var t={columns:this.rightListBox.data,fileName:this.fileName};if(t.fileName||window.console&&window.console.error&&console.error("未指定导出文件的filename，导出文件可能不正常！"),this.gridId){this.dataGrid||(this.dataGrid=mini.get(this.gridId));var e=this._exportRbl.value,i=this.dataGrid.getPageSize(),n=this.dataGrid.getTotalCount(),s=this.dataGrid.getSortField(),o=this.dataGrid.getSortOrder(),r=this.dataGrid.getTotalPage()-1,a=0,l=0,h=this.dataGrid.getPageIndex(),d=this.exportModelCheck.checked;switch(e){case"0":l=a=h,t.idField=this.dataGrid.idField,t.checkedRows={},t.checkedRows[this.dataGrid.idField]=this._getSelectedGridIds();break;case"1":a=0,l=r;break;case"2":l=a=h;break;case"3":a=parseInt(this._fromNumInput.value,10)-1,l=parseInt(this._toNumInput.value)-1,mini.isNumber(a)||(a=h),(!mini.isNumber(l)||l<a)&&(l=r)}mini.copyTo(t,{fromIndex:a,toIndex:l,pageSize:i,totalCount:n,sortField:s,sortOrder:o,exportByTemplate:d})}return t},_getSelectedGridIds:function(){var t=[],e=[],i=this.dataGrid.idField;this.dataGrid&&(e=this.dataGrid.getAllSelecteds());for(var n=0,s=e.length;n<s;n++){var o=e[n];t.push(o[i])}return t.join(",")},_OnExport:function(t){var e=this._getExportData();e.exportUrl=this.exportUrl,this.dataGrid&&this.dataGrid.action&&(e.gridAction=this.dataGrid.action,e.gridColumns=this._getColumns(this.dataGrid.columns));var i={htmlEvent:t,sender:this,data:e,cancel:!1};if(this.fire("beforeexport",i),i.cancel)return this.hidePanel();this._exportFormField.value="string"==typeof i.data?i.data:mini.encode(i.data);var n=$.cookie(window.CSRF_COOKIE_NAME||"_CSRFCOOKIE");n&&(this._csrfField||(this._csrfField=this._addHiddenToExportForm(window.CSRF_HD_NAME||"CSRFCOOKIE")),this._csrfField.value=n),this.cmdParams&&(this._cmdParams_field||(this._cmdParams_field=this._addHiddenToExportForm("cmdParams")),this._cmdParams_field.value=this.cmdParams);var s=Util.addReplayAttackData({commonDto:this._exportFormField.value,cmdParams:this.cmdParams},this.exportUrl);if(s.reqtime)for(var o in s)"commonDto"!==o&&"cmdParams"!==o&&(this["_"+o+"_field"]||(this["_"+o+"_field"]=this._addHiddenToExportForm(o)),this["_"+o+"_field"].value=s[o]);this._exportForm.submit(),this.hidePanel()},_addHiddenToExportForm:function(t){var e=document.createElement("input");return e.type="hidden",e.name=t,this._exportForm.appendChild(e),e},_OnDocMouseUp:function(t){mini.isAncestor(this.popup.el,t.target)||mini.isAncestor(this.el,t.target)||this.hidePanel()},_initButtons:function(){this._contentM.innerHTML='<button class="mini-export-listbtn mini-icon right" type="button"></button><button class="mini-export-listbtn mini-icon right-all" type="button"></button><button class="mini-export-listbtn mini-icon left" type="button"></button><button class="mini-export-listbtn mini-icon left-all" type="button"></button>';var n=this;mini.on(this._contentM,"click",function(t){var e,i=t.target;mini.hasClass(i,"right")?(e=n.leftListBox.getSelecteds(),n.leftListBox.removeItems(e),n.rightListBox.addItems(e)):mini.hasClass(i,"right-all")?(e=n.leftListBox.getData(),n.leftListBox.removeItems(e),n.rightListBox.addItems(e)):mini.hasClass(i,"left")?(e=n.rightListBox.getSelecteds(),n.rightListBox.removeItems(e),n.leftListBox.addItems(e)):mini.hasClass(i,"left-all")&&(e=n.rightListBox.getData(),n.rightListBox.removeItems(e),n.leftListBox.addItems(e)),n._enableExportBtn()})},_enableExportBtn:function(){this.gridId&&0===this.rightListBox.data.length?this._exportBtn.disable():this._exportBtn.enable()},setExportUrl:function(t){var e=/\([\w\W]*\)/,i=t.match(e);i&&(t=t.replace(e,""),this.cmdParams=i[0].replace("(","[").replace(")","]")),this.exportUrl=t,this._exportForm.action=t},getExportUrl:function(){return this.exportUrl},getGridId:function(){return this.gridId},setGridId:function(t){this.gridId=t,this.dataGrid=mini.get(t)},showPanel:function(){var t={cancel:!1};if(this.fire("beforeshowpanel",t),!t.cancel){if(this._adjustRadioLayout(),this.setText(this.expandText),this.addCls("mini-button-popup"),!this.isInit||this.dynamicColumns){var e=this.getColumns();"left"==this.position?(this.leftListBox.setData(e),this.rightListBox.setData([])):(this.rightListBox.setData(e),this.leftListBox.setData([])),this.isInit=!0}this._enableExportBtn(),this.popup.showAtEl(this.el),this.fire("showpanel",t)}},_adjustRadioLayout:function(){!this.dataGrid&&this.gridId&&(this.dataGrid=mini.get(this.gridId)),this.dataGrid?(mini.removeClass(this._exportRbl.el,"hidden"),this.dataGrid.multiSelect&&this._getSelectedGridIds()?(mini.removeClass(this._rowTr,"hidden"),this._exportRbl.setValue("0")):(mini.addClass(this._rowTr,"hidden"),this._exportRbl.setValue("1"),this.dataGrid.showPager||(mini.addClass(this._curPageTr,"hidden"),mini.addClass(this._pageTr,"hidden")),this._fromNumInput.value=this.dataGrid.getPageIndex()+1)):mini.addClass(this._exportRbl.el,"hidden")},hidePanel:function(){this.removeCls("mini-button-popup"),this.setText(this.collapseText),this.popup.hide(),this.fire("hidepanel")},getColumns:function(){var t=[];if(this.columnsData)t=this.columnsData;else if(this.columnsValue)for(var e=this.columnsValue.split(","),i=this.columnsText.split(","),n=e.length,s=0;s<n;s++)t.push({text:i[s]?i[s]:e[s],field:e[s]});else this.gridId&&(this.dataGrid||(this.dataGrid=mini.get(this.gridId)),t=this.dataGrid?this._getColumns(this.dataGrid.columns):[]);var o={columns:t};return this.fire("beforeupdatecolumn",o),t=o.columns,this.columnsData=t},_getColumns:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];if(s.field)e.push({text:s.header,field:s.field,code:s.code,format:s.format,dataOptions:s["data-options"]});else if(s.columns){var o=this._getColumns(s.columns);e=e.concat(o)}}return e},setCollapseText:function(t){this.collapseText=t,this&&this.setText(t)},getFileName:function(){return this.fileName},setFileName:function(t){this.fileName=t},setShowIcon:function(t){this.showIcon=t,this&&this.setIconCls(t?this._iconCls:"")},setShowExportModel:function(t){this.showExportModel!=t&&((this.showExportModel=t)?this.exportModelCheck.show():(this.exportModelCheck.hide(),this.exportModelCheck.setChecked(!1)))},setData:function(t){this.columnsValue||(this.columnsData=t,this.isInit=!1)},getData:function(){return this.columnsData||[]},getExtraId:function(){return this.extraId},setExtraId:function(t){this.extraId=t},getAttrs:function(t){var e=mini.DataExport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["gridId","exportUrl","onbeforeexport","fileName","columnsText","columnsValue","position","expandText","collapseText","onbeforeupdatecolumn","onexportsuccess","onbeforeshowpanel","onshowpanel","onhidepanel","exportAction"]),mini._ParseBool(t,e,["dynamicColumns","showIcon","showExportModel"]),e.text=e.expandText,e.text||(e.text=this.expandText),e}}),mini.regClass(mini.DataExport,"dataexport"),mini.DataImport=function(){mini.DataImport.superclass.constructor.call(this)},mini.extend(mini.DataImport,mini.Control,{uiCls:"mini-dataimport",url:"",pickerText:epoint_local.DataImport.pickerText,expandText:epoint_local.DataImport.expandText,collapseText:epoint_local.DataImport.collapseText,continueImportTip:epoint_local.DataImport.continueImportTip,continueText:epoint_local.DataImport.continueText,retryText:epoint_local.DataImport.retryText,retryTip:epoint_local.DataImport.retryTip,viewDetailText:epoint_local.DataImport.viewDetailText,validateText:epoint_local.DataImport.validateText,resultTpl:epoint_local.DataImport.resultTpl,importResultText:epoint_local.DataImport.importResultText,importFailAlert:epoint_local.DataImport.importFailAlert,importSuccessText:epoint_local.DataImport.importSuccessText,extraId:"",_create:function(){this.el=document.createElement("div"),this.uploader=new mini.WebUploader,this.uploader.set({uploadUrl:this.url,pickerText:this.pickerText,fileNumLimit:1,limitType:"xls,xlsx,xlsm",showDefaultUI:!1,auto:!1,renderTo:this.el}),this.uploader.on("beforefilequeued",this._onBeforeFileQueued,this),this.uploader.on("filesqueued",this._onFilesQueued,this),this.uploader.on("uploadbeforesend",this._onUploadBeforeSend,this),this.uploader.on("uploadprogress",this._onUploadProgress,this),this.uploader.on("uploadsuccess",this._onUploadSuccess,this),this.uploader._uploadBtn.hide(),this.maskEl=document.createElement("div"),this.maskEl.className="mini-dataimport-mask",this.maskEl.innerHTML='<div class="mini-dataimport-mask-content"></div>',this.maskContent=this.maskEl.firstChild,document.body.appendChild(this.maskEl),this.detailEl=document.createElement("div"),this.detailEl.className="mini-dataimport-detail",this.detailEl.innerHTML='<div class="mini-dataimport-detail-content"></div><i class="dataimport-detail-close">X</i>',this.detailContent=this.detailEl.firstChild,document.body.appendChild(this.detailEl),this._bindEvent()},_bindEvent:function(){var i=this;jQuery(this.maskEl).on("click",".dataimport-showdetail",function(){return i.showDetailStatus(),!1}).on("click",".dataimport-continue",function(){i.isContinueImport=!0,i.uploader._uploader.upload()}).on("click",".dataimport-restart",function(){i.uploader._uploader.upload()}).on("click",function(){i.isImportFinished&&!i.isDetailShow&&(i.maskEl.style.display="none")}),jQuery(this.detailEl).on("click",".dataimport-detail-close",function(){i.hideDetailStatus()}).on("click",".dataimport-status-toggle",function(){var t=$(this),e=t.parent();e.hasClass("opened")?(t.text(i.expandText),e.removeClass("opened")):(t.text(i.collapseText),e.addClass("opened"))})},_onFilesQueued:function(t){var i=t.files[0],n=this;if(i){var e=this._generateFileList({id:i.id,name:i.name,size:i.size});this.isImportFinished=!1,this.maskContent.innerHTML=e,this.maskEl.style.display="block",this.uploader._uploader.md5File(i).progress(function(t){}).then(function(t){var e={fileMD5:n._curFileMD5=t,fileName:i.name,fileSize:i.size};e[n.uploader.id+"_action"]="queryFileStatus",n.uploader.getCommonData&&(e.commonDto=mini.encode(n.uploader.getCommonData())),n._onPostFileMd5(e),$.ajax(n.url,{dataType:"json",data:e,type:"post",success:function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),n._onQueryFileStatus(t)}})})}},_onPostFileMd5:function(t){var e,i;if(this.extraId){for(var n in e=DtoUtils.getCommonDto(this.extraId).getData(!0),i=this.uploader.getCommonData(),e)Object.prototype.hasOwnProperty.call(e,n)&&"_common_hidden_viewdata"!=n&&i.push(e[n]);t.commonDto=mini.encode(i)}this.fire("postfilemd5",{data:t}),Util.addReplayAttackData(t,this.url)},_curFileMD5:"",_curAttachGuid:"",_onQueryFileStatus:function(t){t.msg&&mini.alert(t.msg),this.setDetailStatus(t.detail),this._curAttachGuid=t.attachGuid,this._oldAttachGuid=t.attachGuidOld,t.end?this._onFinished(t.status):(t.pollingFrequency&&(this._pollingFrequency=t.pollingFrequency),"importStatus"==t.action?this.pollingStatus(t):"upload"==t.action?this.uploader._uploader.upload():jQuery(this.maskContent).find(".mini-dataimport-action").removeClass("hidden"))},_onUploadBeforeSend:function(t){this.isContinueImport&&(t.data.attachGuid=this._curAttachGuid),t.data.fileMD5=this._curFileMD5},_onUploadProgress:function(t){var e=t.file,i=t.percentage,n=mini.byId(e.id),s=jQuery(".mini-dataimport-progressbar",n),o=jQuery(".progress-text",s),r=jQuery(".progress-body",s),a=Math.round(100*i)+"%";o.text(a),r.width(a)},_generateFileList:function(t){var e=[];return e.push('<div class="mini-dataimport-item">'),e.push('<span class="mini-dataimport-info">'+t.name+"</span>"),e.push('<span class="mini-dataimport-size">('+this._getSize(t.size)+")</span>"),e.push('<span class="mini-dataimport-progressbar"><span class="progress-text">0%</span><div class="progress-body"></div></span>'),e.push('<span class="mini-dataimport-action hidden"><a href="javascript:void(0)" class="dataimport-continue" title="'+this.continueImportTip+'">'+this.continueText+'</a><a href="javascript:void(0)" class="dataimport-restart" title="'+this.retryTip+'">'+this.retryText+'</a><a href="javascript:void(0)" class="dataimport-showdetail hidden">'+this.viewDetailText+"</a></span>"),e.push("</div>"),e.join("")},_generateImportStatus:function(t){var e=[];return e.push('<div class="mini-dataimport-item">'),e.push('<span class="mini-dataimport-info">'+(t.status||"")+"</span>"),0<=t.handlepercent&&e.push('<span class="mini-dataimport-progressbar"><span class="progress-text">'+t.handlepercent+'%</span><div class="progress-body" style="width:'+t.handlepercent+'%;"></div></span>'),t.end&&e.push('<span class="mini-dataimport-action"><a href="javascript:void(0)" class="dataimport-showdetail">'+this.viewDetailText+"</a></span>"),e.push("</div>"),e.join("")},_generateStatuslist:function(t){var e,i,n,s=!0,o=!0,r=['<div class="dataimport-status-item">'];if(r.push('<h3 class="dataimport-status-title">'+t.sheetName+"</h3>"),r.push('<h4 class="dataimport-status-type">'+this.validateText+":</h4>"),r.push('<p class="dataimport-status-count">'+Mustache.render(this.resultTpl,{0:t.checkCount,1:t.checkSuccessCount,2:t.checkErrorCount})),(n=t.checkMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="dataimport-status-toggle">'+this.expandText+"</a></p>"),r.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else s=!1;if(t.saveCount)if(s||(r.push("</p>"),s=!0),r.push('<h4 class="dataimport-status-type">'+this.importResultText+":</h4>"),r.push('<p class="dataimport-status-count">'+Mustache.render(this.resultTpl,{0:t.saveCount,1:t.saveSuccessCount,2:t.saveErrorCount})),(n=t.saveMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="dataimport-status-toggle">'+this.expandText+"</a></p>"),r.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else o=!1;if((n=t.taskMsg)&&(i=n.length)){for(r.push('<a href="javascript:void(0);" class="dataimport-status-toggle">'+this.expandText+"</a></p>"),r.push('<div class="dataimport-status-detail">'),e=0;e<i;e++)r.push("<p>"+n[e]+"</p>");r.push("</div>")}else s&&o||r.push("</p>");return r.push("</div>"),r.join("")},_getSize:function(t){return 1048576<(t=parseInt(t))?(t/1048576).toFixed(2)+"M":(t/1024).toFixed(2)+"K"},_pollingFrequency:1e3,_oldAttachGuid:"",_onUploadSuccess:function(t){var e=t.ret;t.file;if(mini.getSecondRequestData&&(e=mini.getSecondRequestData(e)),e=(e=e.data||e).extraDatas||e,this._pollingFrequency=e.pollingFrequency,"importStatus"==e.action)return this._curAttachGuid=e.attachGuid,this._oldAttachGuid=e.attachGuidOld,void this.pollingStatus(e);var i=this;mini.alert(this.importFailAlert,"",function(){i._onFinished(e.status),i.maskEl.style.display="none"})},_onFinished:function(t){t=t||this.importSuccessText,this.isImportFinished=!0,this.maskContent.innerHTML=t+'<a href="javascript:void(0);" class="dataimport-showdetail">'+this.viewDetailText+"</a>",this._events.importfinished&&this.fire("importfinished"),this.uploader.clearFile()},_onBeforeFileQueued:function(t){this._events.beforefilequeued&&this.fire("beforefilequeued",t)},pollingStatus:function(t){this.maskContent.innerHTML=this._generateImportStatus(t);var e=this,i={fileMD5:this._curFileMD5,attachGuid:this._curAttachGuid,attachGuidOld:this._oldAttachGuid};i[this.uploader.id+"_action"]="importStatus",this.uploader.getCommonData&&(i.commonDto=mini.encode(this.uploader.getCommonData())),jQuery.ajax({url:this.url,data:i,type:"POST",dataType:"json"}).done(function(t){mini.getSecondRequestData&&(t=mini.getSecondRequestData(t)),t.msg&&mini.alert(t.msg),t.end?e._onFinished(t.status):setTimeout(jQuery.proxy(e.pollingStatus,e,t),e._pollingFrequency),e.setDetailStatus(t.detail)})},setDetailStatus:function(t){this.detailStatus=t,this.isDetailShow&&this.renderDetailStatus()},renderDetailStatus:function(){var t,e=this.detailStatus,i=[],n=0;if(e)for(t=e.length;n<t;n++)i.push(this._generateStatuslist(e[n]));this.detailContent.innerHTML=i.join("")},showDetailStatus:function(){this.renderDetailStatus(),this.detailEl.style.display="block",this.isDetailShow=!0},hideDetailStatus:function(){this.detailEl.style.display="none",this.isDetailShow=!1},setUrl:function(t){t=-1!=t.indexOf("isCommondto")?t:t+(-1!=t.indexOf("?")?"&":"?")+"isCommondto=true",this.url=t,this.uploader&&this.uploader.setUploadUrl(t)},getUrl:function(){return this.url},setPickerText:function(t){this.pickerText=t,this.uploader.setPickerText(t)},setEnabled:function(t){mini.CatalogImport.superclass.setEnabled.call(this,t),this.uploader&&this.uploader.setEnabled(t)},getAttrs:function(t){var e=mini.DataImport.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","extraId","pickerText","onbeforefilequeued","onpostfilemd5","onimportfinished"]),e}}),mini.regClass(mini.DataImport,"dataimport"),mini.DatePicker=function(){mini.DatePicker.superclass.constructor.apply(this,arguments),mini.addClass(this.el,"mini-datepicker"),this.on("validation",this.__OnValidation,this)},mini.extend(mini.DatePicker,mini.ButtonEdit,{valueFormat:"",format:"yyyy-MM-dd",maxDate:"9999-12-31",minDate:"1753-01-01",showTime:!1,timeFormat:"H:mm",showYesterdayButton:!1,showTodayButton:!0,showClearButton:!0,showOkButton:!1,firstDayOfWeek:0,valueType:"date",formField:!0,allowInput:!0,uiCls:"mini-datepicker",_create:function(){mini.DatePicker.superclass._create.call(this),this.externalSrc=this.externalSrc||mini.externalSrc;var t=this;window.laydate?this._init():mini.loadJS(this.externalSrc+"laydate/laydate.js",function(){t._init()})},_init:function(){var o=this,t={elem:this._textEl,format:this._translateToLaydateFormat(this.format),readOnly:this.readOnly,enabled:this.enabled,btns:this._getBtns(),trigger:"click",lang:"en-US"===mini.locale?"en":"cn",ready:function(t){o._onLaydateReady(t),o.showPopup(!0)},done:function(t,e,i){setTimeout(function(){o._onLaydateDone(t,e,i),o._tryValidate()},10)},onHide:function(){o.hidePopup()},drawdate:function(t,e){var i={allowSelect:!0,date:mini.parseDate(t.year+"-"+t.month+"-"+t.date),dom:e};o.fire("drawdate",i),i.allowSelect||mini.addClass(e,"laydate-disabled")},drawmonth:function(t,e){var i={allowSelect:!0,date:mini.parseDate(t.year+"-"+(t.month+1)),dom:e};o.fire("drawmonth",i),i.allowSelect||mini.addClass(e,"laydate-disabled")},drawyear:function(t,e){var i={allowSelect:!0,date:mini.parseDate(t.year),dom:e};o.fire("drawyear",i),i.allowSelect||mini.addClass(e,"laydate-disabled")},showtime:function(t){var n=/ss$/i.test(o.format),e=$(t).find(".laydate-time-list");$.each(e,function(t,e){var i=$(e).find("> li");n?i.css("width","33.33333%").show():i.css("width","50%").eq(2).hide()})},onBtnClick:function(e){setTimeout(function(){var t={action:e,value:o.value};o.fire("btnclick",t)},10)},onViewChanged:function(t,e,i,n,s){o._onLaydateViewChanged(t,e,i,n,s)},onMonthYearItemClick:function(t,e,i){o._onLaydateMonthYearItemClick(t,e,i)},onBeforeRender:function(){o._onLaydateBeforeRender()}};this.minDate&&(t.min=mini.formatDate(new Date(this.minDate),"yyyy-MM-dd HH:mm:ss")),this.maxDate&&(t.max=mini.formatDate(new Date(this.maxDate),"yyyy-MM-dd HH:mm:ss")),this._beforeLaydateInit(t),this.laydate=laydate.render(t),this._fixedHoverScroller()},_translateToLaydateFormat:function(t){return t.replace(/(y)\1{1}/g,function(t,e,i,n){return"y"===n.charAt(i-1)||"y"===n.charAt(i+2)?"yy":"y"})},_onLaydateReady:function(t){this._updateOkBtn()},_updateOkBtn:function(){if(this.laydate){var t=$(this.laydate._laydate.footer).find(".laydate-btns-confirm");1===this._selectedItem.length?t.removeClass("laydate-disabled"):t.addClass("laydate-disabled")}},_onLaydateDone:function(t,e,i){t=new Date(e.year,e.month-1,e.date,e.hours,e.minutes,e.seconds),this.setValue(t),this._oldValue!==this.value&&(this.fire("valuechanged",{value:this.value,oldValue:this._oldValue}),this._oldValue=this.value)},_selectedItem:[],_setSelectedItem:function(t){this._selectedItem=t?[t]:[]},_beforeLaydateInit:function(t){this.showTime&&(t.type="datetime",this.showOkButton=!0,t.btns=this._getBtns())},_onLaydateBeforeRender:function(){this._setSelectedItem(this.value)},_onLaydateViewChanged:function(t,e,i,n,s){},_onLaydateMonthYearItemClick:function(t,e,i){},_fixedHoverScroller:function(){var t=mini._scrollBarWidth,e="fixed-hover-scroller-for-daterange";if(t&&!$("#"+e).length){var i=[".laydate-time-list li ol {margin-right: "+t+"px}",".laydate-time-list>li:hover ol{","margin-right:0;}",".laydate-time-list li > p {padding-right: "+t+"px}"].join("");$('<style id="'+e+'">'+i+"</style>").appendTo("head")}},_fixedTimeScrollPos:(vEb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.setTimeout,document.addEventListener?function(){document.removeEventListener("click",wEb,!0),document.addEventListener("click",wEb,!0)}:function(){}),showPopup:function(t){if(t){var e=jQuery(this.el).find(".mini-buttonedit-button")[0];e&&mini.addClass(e,this._buttonPressedCls);var i=".daterange-"+this.id;$("html, body, .fui-content").on("scroll"+i,function(){$("body").trigger("click"),$("html, body, .fui-content").off("scroll"+i)}),this.fire("showPopup")}else jQuery(this._textEl).trigger("click")},hidePopup:function(){var t=jQuery(this.el).find(".mini-buttonedit-button")[0];t&&mini.removeClass(t,this._buttonPressedCls),this.fire("hidePopup")},_monthPicker:!1,within:function(t){return!!mini.isAncestor(this.el,t.target)||!!mini.isAncestor(this.laydate._laydate.elem,t.target)},minDateErrorText:"",maxDateErrorText:"",__OnValidation:function(t){if(!1!==t.isValid){var e=this.value;if(mini.isDate(e)){var i=mini.parseDate(this.maxDate),n=mini.parseDate(this.minDate),s=this.maxDateErrorText||mini.VTypes.maxDateErrorText,o=this.minDateErrorText||mini.VTypes.minDateErrorText;mini.isDate(i)&&e.getTime()>i.getTime()&&(t.isValid=!1,t.errorText=String.format(s,mini.formatDate(i,this.format))),mini.isDate(n)&&e.getTime()<n.getTime()&&(t.isValid=!1,t.errorText=String.format(o,mini.formatDate(n,this.format)))}}},setFormat:function(t){"string"==typeof t&&this.format!==t&&(this.format=t,this._textEl.value=this.getFormValue(),this._updateLaydateFormat())},_updateLaydateFormat:function(){var n,s="yyyy|y|MM|M|dd|d|HH|H|mm|m|ss|s";this.laydate&&(this.laydate.config.format=this._translateToLaydateFormat(this.format),(n=this.laydate._laydate).format=this.laydate.config.format.match(new RegExp(s+"|.","g"))||[],n.EXP_IF="",n.EXP_SPLIT="",mini.forEach(n.format,function(t,e){var i=new RegExp(s).test(t)?"\\d{"+(new RegExp(s).test(n.format[0===e?e+1:e-1]||"")?/^yyyy|y$/.test(t)?4:t.length:/^yyyy$/.test(t)?"1,4":/^y$/.test(t)?"1,308":"1,2")+"}":"\\"+t;n.EXP_IF=n.EXP_IF+i,n.EXP_SPLIT=n.EXP_SPLIT+"("+i+")"}),n.EXP_IF=new RegExp("^"+(this.delimiter?n.EXP_IF+"\\s\\"+this.delimiter+"\\s"+n.EXP_IF:n.EXP_IF)+"$"),n.EXP_SPLIT=new RegExp("^"+n.EXP_SPLIT+"$",""))},getFormat:function(){return this.format},setValueFormat:function(t){"string"==typeof t&&this.valueFormat!==t&&(this.valueFormat=t)},getValueFormat:function(){return this.valueFormat},_oldValue:"",setValue:function(t){this.getFormValue()!==t&&("date"===this.valueType?t=mini.parseDate(t):mini.isDate(t)&&(t=mini.formatDate(t,this.format)),mini.isNull(t)&&(t=""),mini.isDate(t)&&(t=new Date(t.getTime()),mini.isDate(t)&&isNaN(t.getTime())&&(t="")),this.value=t),this.text=this.getFormValue(),this._textEl.value=this.text},nullValue:"",setNullValue:function(t){"null"===t&&(t=null),this.nullValue=t},getNullValue:function(){return this.nullValue},getValue:function(){if("date"!==this.valueType)return this.value;if(!mini.isDate(this.value))return this.nullValue;var t=this.value;return this.valueFormat&&(t=mini.formatDate(t,this.valueFormat)),t},getFormValue:function(t){return"date"!==this.valueType?this.value:mini.isDate(this.value)?(t=t||this.format,mini.formatDate(this.value,t)):""},setViewDate:function(t){},getViewDate:function(){},setShowTime:function(t){this.showTime!==t&&(this.showTime=t,this._updateLaydateShowTime())},_updateLaydateShowTime:function(){this.laydate&&(this.showTime?(this.laydate.config.type="datetime",this.showOkButton=!0,this.laydate.config.btns=this._getBtns()):this.laydate.config.type="date")},getShowTime:function(){return this.showTime},setTimeFormat:function(t){this.timeFormat!==t&&(this.timeFormat=t)},getTimeFormat:function(){return this.timeFormat},setShowYesterdayButton:function(t){this.showYesterdayButton=t},getShowYesterdayButton:function(){return this.showYesterdayButton},setShowTodayButton:function(t){this.showTodayButton=t,this._updateLaydateBtns()},getShowTodayButton:function(){return this.showTodayButton},setShowClearButton:function(t){this.showClearButton=t,this._updateLaydateBtns()},getShowClearButton:function(){return this.showClearButton},setShowOkButton:function(t){this.showOkButton=t,this._updateLaydateBtns()},getShowOkButton:function(){return this.showOkButton},_getBtns:function(){var t=[];return this.showClearButton&&t.push("clear"),this.showTodayButton&&t.push("now"),this.showOkButton&&t.push("confirm"),t},_updateLaydateBtns:function(){this.laydate&&(this.laydate.config.btns=this._getBtns())},setShowWeekNumber:function(t){this.showWeekNumber=t},getShowWeekNumber:function(){return this.showWeekNumber},setMaxDate:function(t){if(this.maxDate=t,this.laydate){var e=new Date(this.maxDate);this.laydate.config.max={year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()}}},getMaxDate:function(){return this.maxDate},setMinDate:function(t){if(this.minDate=t,this.laydate){var e=new Date(this.minDate);this.laydate.config.min={year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()}}},getMinDate:function(){return this.minDate},setMaxDateErrorText:function(t){this.maxDateErrorText=t},getMaxDateErrorText:function(){return this.maxDateErrorText},setMinDateErrorText:function(t){this.minDateErrorText=t},getMinDateErrorText:function(){return this.minDateErrorText},setEnabled:function(t){mini.DatePicker.superclass.setEnabled.call(this,t),this.laydate&&(this.laydate.config.enabled=t)},_OnButtonClick:function(t){t.stopPropagation();var e={htmlEvent:t,cancel:!1};this.fire("beforebuttonclick",e),1!=e.cancel&&(this.fire("buttonclick",e),jQuery(this._textEl).trigger("click"))},__OnInputTextChanged:function(t){var e=this._textEl.value;if("date"==this.valueType){var i=mini.parseDate(e);
//if (!d || isNaN(d) || d.getFullYear() == 1970) {
i&&!isNaN(i)||(i=null)}this.setValue(e)},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8===t.keyCode&&(this.isReadOnly()||!1===this.allowInput))return!1;if(9!==t.keyCode){if(!this.isReadOnly())switch(t.keyCode){case 27:t.preventDefault(),this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 9:case 13:this.__OnInputTextChanged(null);var i=this;setTimeout(function(){i.fire("enter",e)},10);break;case 37:break;case 38:t.preventDefault();break;case 39:break;case 40:this.keyNavEnabled&&(t.preventDefault(),this.showPopup())}}else this.isShowPopup()&&this.hidePopup()},setReadOnly:function(t){mini.DatePicker.superclass.setReadOnly.call(this,t),this.laydate&&(this.laydate.config.readOnly=t)},getAttrs:function(t){var e=mini.DatePicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["format","viewDate","timeFormat","ondrawdate","ondrawmonth","ondrawyear","onbtnclick","minDate","maxDate","valueType","valueFormat","nullValue","minDateErrorText","maxDateErrorText"]),mini._ParseBool(t,e,["showTime","showTodayButton","showClearButton","showOkButton","showWeekNumber","showYesterdayButton","allowInput"]),e}}),mini.regClass(mini.DatePicker,"datepicker"),mini.MonthPicker=function(){mini.MonthPicker.superclass.constructor.apply(this,arguments)},mini.extend(mini.MonthPicker,mini.DatePicker,{uiCls:"mini-monthpicker",valueFormat:"",format:"yyyy-MM",_monthPicker:!0,showOkButton:!0,_beforeLaydateInit:function(t){t.type="month"}}),mini.regClass(mini.MonthPicker,"monthpicker"),mini.DateRangePicker=function(){mini.DateRangePicker.superclass.constructor.call(this)},mini.extend(mini.DateRangePicker,mini.DatePicker,{uiCls:"mini-daterangepicker",rangeType:"date",delimiter:"~",showOkButton:!0,showQuickSelect:!1,footTipText:epoint_local.DateRangePicker.footTipText,quickSelectText:jQuery.extend({},epoint_local.DateRangePicker.quickSelectText),customQuickSelect:[],set:function(t){if("string"==typeof t)return this;var e=t.rangeType;delete t.rangeType;var i=t.format;return delete t.format,mini.DateRangePicker.superclass.set.call(this,t),mini.isNull(e)||this.setRangeType(e),mini.isNull(i)||this.setFormat(i),this},_onLaydateReady:function(t){var e=$(".laydate-footer-btns",this.laydate._laydate.footer);e.length&&$('<span class="laydate-footer-tips">'+this.footTipText+"</span>").insertBefore(e),this.showQuickSelect&&this._renderQuickSelect(),this._onLaydateRender(t)},_onLaydateRender:function(t){},_onLaydateDone:function(t,e,i){this.setValue({startDate:this._formatDate(e),endDate:this._formatDate(i)}),this.value.startDate==this._oldValue.startDate&&this.value.endDate==this._oldValue.endDate||(this.fire("valuechanged",{value:this.value,oldValue:this._oldValue}),this._oldValue=this.value)},_beforeLaydateInit:function(t){this.showTime&&(t.type="datetime"),t.range=this.delimiter},_formatDate:function(t){if(!t||function i(t){for(var e in t)return!1;return!0}(t))return"";var e=this.format.replace(/yyyy/g,t.year);return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/yy/g,(t.year+"").substring(2))).replace(/MM/g,t.month<10?"0"+t.month:t.month)).replace(/M/g,t.month)).replace(/dd/g,t.date<10?"0"+t.date:t.date)).replace(/d/g,t.date)).replace(/HH/g,t.hours<10?"0"+t.hours:t.hours)).replace(/H/g,t.hours)).replace(/mm/g,t.minutes<10?"0"+t.minutes:t.minutes)).replace(/m/g,t.minutes)).replace(/ss/g,t.seconds<10?"0"+t.seconds:t.seconds)).replace(/s/g,t.seconds)},_mergeQuickSelect:function(){this.quickSelect||this._initQuickSelect();var t,e,i,n,s=this.quickSelect.slice(0),o=[];for(t=0,e=s.length;t<e;t++)o.push(s[t].text);for(t=0,e=this.customQuickSelect.length;t<e;t++)i=this.customQuickSelect[t],-1<(n=o.indexOf(i.text))?s[n]=i:s.push(i);return s},_initQuickSelect:function(){this.quickSelect=[{text:this.quickSelectText.thisWeek,start:function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()+1)},end:function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()+7)}},{text:this.quickSelectText.thisMonth,start:function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth(),1)},end:function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth()+1,0)}},{text:this.quickSelectText.thisQuarter,start:function(){var t=new Date,e=t.getMonth(),i=0;return 2<e&&(i=5<e?8<e?9:6:3),new Date(t.getFullYear(),i,1)},end:function(){var t=new Date,e=t.getMonth(),i=2;return 2<e&&(i=5<e?8<e?11:8:5),new Date(t.getFullYear(),i+1,0)}},{text:this.quickSelectText.thisYear,start:function(){var t=new Date;return new Date(t.getFullYear(),0,1)},end:function(){var t=new Date;return new Date(t.getFullYear(),11,31)}}]},_renderQuickSelect:function(){var t,e,i=this.laydate._laydate.elem,n=0,s=['<div class="daterange-quick-select">'],o=this._mergeQuickSelect(),r=this;for(s.push('<ul class="quick-select-list">'),t=o.length;n<t;n++)"string"==typeof(e=o[n]).start&&(e.start=mini._getFunctoin(e.start)),"string"==typeof e.end&&(e.end=mini._getFunctoin(e.end)),s.push('<li class="quick-select-item" data-start="'+mini.formatDate(e.start(),this.format)+'" data-end="'+mini.formatDate(e.end(),this.format)+'">'+e.text+"</li>");s.push("</ul>"),s.push("</div>"),mini.addClass(i,"show-quick-select"),mini.append(i,s.join("")),$(i).on("click",".quick-select-item",function(){var t=$(this),e=t.data("start"),i=t.data("end");r.setValue({startDate:e,endDate:i}),r.value.startDate===r._oldValue.startDate&&r.value.endDate===r._oldValue.endDate||(r.fire("valuechanged",{value:r.value,oldValue:r._oldValue}),r._oldValue=r.value),r._tryValidate(),$("body").trigger("click")})},setMinDate:function(t){this.minDate=mini.parseDate(t),this.laydate&&(this.laydate.config.min={year:this.minDate.getFullYear(),month:this.minDate.getMonth(),date:this.minDate.getDate(),hours:this.minDate.getHours(),minutes:this.minDate.getMinutes(),seconds:this.minDate.getSeconds()})},setMaxDate:function(t){this.maxDate=mini.parseDate(t),this.laydate&&(this.laydate.config.max={year:this.maxDate.getFullYear(),month:this.maxDate.getMonth(),date:this.maxDate.getDate(),hours:this.maxDate.getHours(),minutes:this.maxDate.getMinutes(),seconds:this.maxDate.getSeconds()})},setRangeType:function(t){this.rangeType=t,this.el.setAttribute("range-type",t),this.laydate&&(this.laydate.config.type=t),"datetime"==t?(this.format="yyyy-MM-dd HH:mm",this.showTime=!0):this.showTime=!1},setShowTime:function(t){this.showTime!==t&&(this.showTime=t,this.showTime?this.rangeType="datetime":this.rangeType="date")},_oldValue:{startDate:"",endDate:""},value:{startDate:"",endDate:""},setValue:function(t){"string"==typeof t&&(t=mini.JSON.decode(t)),t.startDate&&t.endDate?(this.value={startDate:mini.formatDate(mini.parseDate(t.startDate),this.format),endDate:mini.formatDate(mini.parseDate(t.endDate),this.format)},this.text=this.value.startDate+" "+this.delimiter+" "+this.value.endDate):(this.value={startDate:"",endDate:""},this.text=""),this._textEl.value=this.text},getValue:function(){return this.value},getFormValue:function(){return mini.encode(this.value)},getText:function(){return this._textEl.value},validate:function(){var t={value:this.getValue(),errorText:"",isValid:!0};return this.required&&(""!==String(t.value.startDate).trim()&&""!==String(t.value.endDate).trim()||(t.isValid=!1,t.errorText=this.requiredErrorText)),this.fire("validation",t),this.errorText=t.errorText,this.setIsValid(t.isValid),this.isValid()},setQuickSelect:function(t){"string"==typeof t&&(t=mini.decode(t)),mini.isArray(t)||(t=[t]),this.quickSelect=t},setCustomQuickSelect:function(t){"string"==typeof t&&(t=mini.decode(t)),mini.isArray(t)||(t=[t]),this.customQuickSelect=t},getAttrs:function(t){var e=mini.DateRangePicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["rangeType","format","minDate","maxDate","onvaluechanged","emptyText","onShowPopup","onHidePopup","quickSelect","customQuickSelect"]),mini._ParseBool(t,e,["showQuickSelect"]),e}}),mini.regClass(mini.DateRangePicker,"daterangepicker"),mini.DistrictPicker=function(){mini.DistrictPicker.superclass.constructor.call(this)},mini.DistrictPicker.KEY_INDEX={prefix:0,areaCode:1,pprefix:2,text:3,initial:4,pinyin_s:5,pinyin:6,clan:7,level:8},mini.DistrictPicker.parseData=function(t){var e=t.split(/\r\n|\n/),i=[],n=mini.DistrictPicker.KEY_INDEX;return e.forEach(function(t){if(t){var e=t.split(",");i.push({id:e[n.prefix],pid:e[n.pprefix],prefix:e[n.prefix],areaCode:e[n.areaCode],pprefix:e[n.pprefix],text:e[n.text],initial:e[n.initial],pinyin_s:e[n.pinyin_s],pinyin:e[n.pinyin],clan:e[n.clan],level:e[n.level]})}}),i},mini.DistrictPicker.arrayToTree=function(t){var s={};t.forEach(function(t){s[t.id]||(s[t.id]=t)});var o=[];return t.forEach(function(t){var e=t,i=t.pid;if(i!==undefined){var n=s[i];n?(n.items||(n.items=[]),n.items.push(e)):o.push(e)}else o.push(e)}),o},mini.DistrictPicker.makeMap=function(t){var e={},i=!1,n={};return t.forEach(function(t){e[t.id]?(i=!0,n[t.id]?n[t.id].push(t):n[t.id]=[e[t.id],t]):e[t.id]=t}),i&&console.error("行政代码重复：",n),e},mini.extend(mini.DistrictPicker,mini.PopupEdit,{uiCls:"mini-districtpicker",data:[],listData:[],sourceUrl:"",province:null,city:null,district:null,split:"/",value:"",text:"",emptyText:epoint_local.DistrictPicker.emptyText,selectText:epoint_local.DistrictPicker.selectText,__selectEnd:!1,__oldValue:"",__popupMode:"select",popupHeight:360,popupWidth:420,inputAsValue:!1,_create:function(){mini.DistrictPicker.superclass._create.apply(this,arguments),this.on("beforeshowpopup",this.__beforeShowPopup,this),this._initInputEvent(),this._syncInputState()},_afterApply:function(){this.sourceLoaded=!1,this._requestSource()},_createPopup:function(){mini.DistrictPicker.superclass._createPopup.apply(this,arguments),this._panelContentEl=this.popup._contentEl,this._panelContentEl.innerHTML='<div class="mini-districtpicker-tabs"><div class="mini-districtpicker-tabs-header clearfix"><span class="mini-districtpicker-tab" data-target="province">'+this.selectText+'</span><span class="mini-districtpicker-tab" data-target="city">'+this.selectText+'</span><span class="mini-districtpicker-tab" data-target="district">'+this.selectText+'</span></div></div><div class="mini-districtpicker-search" style="display:none"><div class="mini-districtpicker-search-list"></div></div>',this._tabsEl=this._panelContentEl.firstChild,this._tabHeaderEl=this._tabsEl.firstChild;var t=document.createElement("div");t.className=this.uiCls+"-tabs-body";var e=document.createElement("div");e.className=this.uiCls+"-tab-panel",e.setAttribute("data-id","province"),e.style.display="none",this._provinceEl=e,t.appendChild(e);var i=document.createElement("div");i.className=this.uiCls+"-tab-panel",i.setAttribute("data-id","city"),i.style.display="none",this._cityEl=i,t.appendChild(i);var n=document.createElement("div");n.className=this.uiCls+"-tab-panel",n.setAttribute("data-id","district"),n.style.display="none",this._districtEl=n,t.appendChild(n),this._panelContentEl.firstChild.appendChild(t),this._tabBodyEl=t,this._searchWrap=this._panelContentEl.lastChild,this._searchList=this._searchWrap.firstChild,this._initPopupEvent()},_initPopupEvent:function(){var n=this;this.popup.on("close",this.__beforeClosePopup,this),jQuery(this.popup.el).on("click",".mini-districtpicker-tab",function(){var t=this.getAttribute("data-target");n._activePanel(t)}).on("click",".mini-districtpicker-province-item",function(){jQuery(this).addClass("active").siblings().removeClass("active");var t=this.getAttribute("data-id"),e=n.dataMap[t];e?(n.setText(e.text+e.level),n.setProvince(e)):console.error("something  wrong!")}).on("click",".mini-districtpicker-city-item",function(){jQuery(this).addClass("active").siblings().removeClass("active");var t=this.getAttribute("data-id"),e=n.dataMap[t];e?(n.setText(n.province.text+n.province.level+n.split+e.text+e.level),n.setCity(e)):console.error("something  wrong!")}).on("click",".mini-districtpicker-district-item",function(){jQuery(this).addClass("active").siblings().removeClass("active");var t=this.getAttribute("data-id"),e=n.dataMap[t];e?(n.setText(n.province.text+n.province.level+n.split+n.city.text+n.city.level+n.split+e.text+e.level),n.setDistrict(e)):console.error("something  wrong!")}).on("click",".mini-districtpicker-search-item",function(){var t=this.getAttribute("data-id"),e=n.dataMap[t];if(e){var i=n._getFullPath(t);e.items&&e.items.length?(n.__popupMode="select",1===i.length?(n.setProvince(i[0]),n.setCity(e),n.setText(n.province.text+n.province.level+n.split+n.city.text+n.city.level),jQuery(n._provinceEl).find('.mini-districtpicker-province-item[data-id="'+i[0].id+'"]').addClass("active"),jQuery(n._cityEl).find('.mini-districtpicker-city-item[data-id="'+e.id+'"]').addClass("active")):0===i.length&&(n.setProvince(e),n.setText(n.province.text+n.province.level),jQuery(n._provinceEl).find('.mini-districtpicker-province-item[data-id="'+i[0].id+'"]').addClass("active"))):(2==i.length?(n.setProvince(i[0]),n.setCity(i[1]),n.setDistrict(e)):1===i.length?(n.setProvince(i[0]),n.setCity(e)):0===i.length&&n.setProvince(e),n._selectedEnd())}})},__beforeClosePopup:function(){this.__selectEnd||(this._setValue(this.__oldValue),this._restoreValue())},_clearPopupContent:function(){this._tabBodyEl&&(this._provinceEl.innerHTML="",this._cityEl.innerHTML="",this._districtEl.innerHTML="",jQuery(this._tabHeaderEl).children().addClass("hidden").eq(0).text(this.selectText).removeClass("hidden"))},__beforeShowPopup:function(){if(this.__popupMode="select",this.__oldValue=this.value,this.__selectEnd=!1,this.province){var t=this.valueData;t[0]&&(this._renderProvince(),this._activePanel("province"),this._setSelected("province",t[0]),jQuery(this._provinceEl).find('>[data-id="'+t[0].id+'"]').addClass("active")),t[1]&&(this._renderCity(),this._activePanel("city"),this._setSelected("city",t[1]),jQuery(this._cityEl).find('>[data-id="'+t[1].id+'"]').addClass("active")),t[2]&&(this._renderDistrict(),this._activePanel("district"),this._setSelected("district",t[2]),jQuery(this._districtEl).find('>[data-id="'+t[2].id+'"]').addClass("active"))}else this._clearPopupContent(),this._renderProvince(),this._activePanel("province")},_activePanel:function(t){var e=jQuery(this._searchWrap),i=jQuery(this._tabsEl);"select"==this.__popupMode?(i.show(),e.hide(),jQuery(this._tabHeaderEl).find('[data-target="'+t+'"]').addClass("active").siblings().removeClass("active"),jQuery(this._tabBodyEl).find('[data-id="'+t+'"]').show().siblings().hide()):(i.hide(),e.show())},_setSelected:function(t,e,i){var n=jQuery(this._tabHeaderEl).find('[data-target="'+t+'"]');n.attr({"data-id":e.id}).text(e.text).removeClass("hidden"),n.nextAll().addClass("hidden"),i&&n.next().text(this.selectText).removeClass("hidden")},_selectedEnd:function(){this.__selectEnd=!0,this.popup.hide(),this.makeValue(!0),this._syncInputState()},makeValue:function(t){var e=[],i=[],n=[];this.province&&e.push(this.province),this.city&&e.push(this.city),this.district&&e.push(this.district),(this.valueData=e).forEach(function(t){n.push(t.text+t.level),i.push(t.id)}),this._setValue(i.join(",")),this.setText(n.join(this.split)),t&&this.doValueChanged()},_renderProvince:function(){var e=this.uiCls+"-province-item",t=$.map(this.data,function(t){return'<span class="'+e+'" data-id="'+t.id+'"><span>'+t.text+"</span></span>"}).join("");this._provinceEl.innerHTML=t},_renderCity:function(t){var e=t||this.province,i=this.uiCls+"-city-item",n=$.map(e.items,function(t){return'<span class="'+i+'" data-id="'+t.id+'"><span>'+t.text+"</span></span>"}).join("");this._cityEl.innerHTML=n},_renderDistrict:function(t){var e=t||this.city,i=this.uiCls+"-district-item",n=$.map(e.items,function(t){return'<span class="'+i+'" data-id="'+t.id+'"><span>'+t.text+"</span></span>"}).join("");this._districtEl.innerHTML=n},setProvince:function(t){this.province=t,this.city=null,this.district=null,this.isShowPopup()&&(t.items&&t.items.length?(this._setSelected("province",t,!0),this._activePanel("city"),this._renderCity(t)):(this._setSelected("province",t,!1),this._selectedEnd()))},getProvince:function(){return this.province},setCity:function(t){this.city=t,this.district=null,this.isShowPopup()&&(t.items&&t.items.length?(this._setSelected("city",t,!0),this._renderDistrict(t),this._activePanel("district")):(this._setSelected("city",t,!1),this._selectedEnd()))},getCity:function(){return this.city},setDistrict:function(t){this.district=t,this.province&&this.city&&this.district&&this._selectedEnd()},getDistrict:function(){return this.district},setSourceUrl:function(t){this.sourceUrl=t},getSourceUrl:function(){return this.sourceUrl},_setValue:function(){mini.DistrictPicker.superclass.setValue.apply(this,arguments),this._syncInputState()},setValue:function(t){this._setValue(t),this._restoreValue()},_restoreValue:function(){if(this.sourceLoaded){var t=this.value.split(","),e=t[0],i=this.dataMap[e];i?this.setProvince(i):this.setProvince(null);var n=t[1],s=this.dataMap[n];s?this.setCity(s):this.setCity(null);var o=t[2],r=this.dataMap[o];r?this.setDistrict(r):this.setDistrict(null),this.makeValue(!1)}},
//     if (!mini.isAncestor(this._borderEl, e.target)) return;
//     if (!mini.isAncestor(this._textEl, e.target)) {
__OnInputKeyDown:function(t){var e={htmlEvent:t};this.fire("keydown",e),13==t.keyCode&&this.fire("enter",e)},_OnButtonMouseDown:function(t,e){this.addCls(this._focusCls),this.fire("buttonmousedown",{htmlEvent:t,spinType:e})},_doSearch:function(t){if(!t)return this.__popupMode="select",void this._activePanel("province");this.__popupMode="search",this._activePanel();var e,i=/^\w+$/.test(t),n=new RegExp(t,"i");e=i?this.listData.filter(function(t){return n.test(t.initial)||n.test(t.pinyin_s)||n.test(t.pinyin)}):this.listData.filter(function(t){return n.test(t.text)}),this._renderSearch(e,!i&&t,n)},_renderSearch:function(t,n,s){var o=this,e=$.map(t,function(t){var e=o._getFullPathText(t.id),i=n?t.text.replace(s,'<span class="mini-districtpicker-search-item-kw">'+n+"</span>"):t.text;return'<div class="mini-districtpicker-search-item" data-id="'+t.id+'" data-issub="">'+i+(e?'<span class="mini-districtpicker-search-item-path">'+e+"</span>":"")+"</div>"});t.length?jQuery(this._searchList).html(e.join("")).removeClass("empty"):jQuery(this._searchList).empty().addClass("empty")},_getFullPath:function(t){var e=[],i="string"==typeof t?this.dataMap[t]:t;if(!i)return e;for(var n=this.dataMap[i.pid];n;){if(n.id===n.pid){console.error("数据异常：",n);break}e.unshift(n),n=this.dataMap[n.pid]}return e},_getFullPathText:function(t,e){return this._getFullPath(t).map(function(t){return t.text+t.level}).join(this.split)},_initInputEvent:function(){var i=this;jQuery(this._textEl).on("click",function(t){i.allowInput&&!i.isShowPopup()&&i.showPopup()}).on("keyup",mini.throttle(function(t){if(!0===i.allowInput){var e=jQuery.trim(t.target.value);this._doSearch(e)}},100,this)),this.on("closeClick",function(){i.value="",i._restoreValue()})},_syncInputState:function(){this.value?(this.setAllowInput(!1),this.setShowClose(!0)):(this.setAllowInput(!0),this.setShowClose(!1))},_requestSource:function(){var e=this;this.sourceUrl?jQuery.ajax({url:this.sourceUrl,dataType:"text"}).done(function(t){e.listData=mini.DistrictPicker.parseData(t),e.data=mini.DistrictPicker.arrayToTree(e.listData),e.dataMap=mini.DistrictPicker.makeMap(e.listData),e.sourceLoaded=!0,e._restoreValue()}):mini.DistrictPicker.dataLoader?mini.DistrictPicker.dataLoader.then(function(){e.listData=mini.DistrictPicker.listData,e.data=mini.DistrictPicker.data,e.dataMap=mini.DistrictPicker.dataMap,e.sourceLoaded=!0,e._restoreValue()}):mini.DistrictPicker.dataLoader=jQuery.ajax({url:mini.externalSrc+"district/district-full.csv",dataType:"text"}).done(function(t){e.listData=mini.DistrictPicker.listData=mini.DistrictPicker.parseData(t),e.data=mini.DistrictPicker.data=mini.DistrictPicker.arrayToTree(e.listData),e.dataMap=mini.DistrictPicker.dataMap=mini.DistrictPicker.makeMap(e.listData),e.sourceLoaded=!0,e._restoreValue()})},searchByText:function(e){if(!this.sourceLoaded||e+""!==e||""===e)return null;var t=this.listData.filter(function(t){return(t.text+t.clan+t.level).includes(e)});return mini.clone(t)},getAttrs:function(t){var e=mini.DistrictPicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["sourceUrl"]),e}}),mini.regClass(mini.DistrictPicker,"districtpicker"),mini.Drawer=function(){mini.Drawer.superclass.constructor.call(this),this.addCls("mini-drawer"),this.setAllowDrag(!1),this.setAllowResize(!1)},mini.extend(mini.Drawer,mini.Panel,{uiCls:"mini-drawer",placement:"right",showCloseButton:!0,showModal:!0,showHeader:!1,width:"",height:"100%",_create:function(){mini.Drawer.superclass._create.call(this),this.el.className+=" right",this.$el=jQuery(this.el)},_afterApply:function(){this.$el.css("transform",this._transformDirect[this.placement]),this.$el.addClass("initialized")},setPlacement:function(t){if(this.placement!==t)switch(this.$el.removeClass(this.placement),this.placement=t,this.$el.addClass(t),t){case"top":case"bottom":"100%"===this.height&&this.setHeight(""),this.setWidth("100%");break;case"right":case"left":default:this.setHeight("100%"),"100%"===this.width&&this.setWidth("")}},_transformDirect:{left:"translateX(-200%)",right:"translateX(200%)",top:"translateY(-200%)",bottom:"translateY(200%)"},setAllowDrag:function(){this.allowDrag=!1},setShowMaxButton:function(){this.showMaxButton=!1},setShowMinButton:function(){this.showMinButton=!1},max:function(){this.show()},restore:function(){this.show()},show:function(){var t=this._containerEl||document.body;(!this.isRender()||this.el.parentNode!=t&&this.showInBody)&&(this.setVisible(!1),this.render(t),this.$el.css("transform",this._transformDirect[this.placement]),this.$el.addClass("initialized"),this.setVisible(!0));var e={cancel:!1};this.fire("beforeopen",e),e.cancel||(this._zIndex=mini.getMaxZIndex(),this.$el.css({transform:"none","z-index":this._zIndex}),this._doModal(),this.fire("open"))},hide:function(){var t={cancel:!1};this.fire("beforeclose",t),t.cancel||(this.$el.css("transform",this._transformDirect[this.placement]),this._modalEl&&(this._modalEl.style.display="none"),this.fire("close"))},_doModal:function(){if(this.el){var t=this.showModal&&this.isDisplay()&&this.visible;if(this._modalEl||0!=this.showModal){if(!this._modalEl){var e="__modal"+this._id;this._modalEl=mini.append(document.body,'<div id="'+e+'" class="mini-modal mini-widget-content" style="display:none"></div>'),mini_onOne(this._modalEl,"click",this.hide,this)}t?(this._modalEl.style.display="block",this._modalEl.style.zIndex=this._zIndex-1):this._modalEl.style.display="none"}else this._modalEl&&mini.removeNode(this._modalEl)}else this._modalEl&&mini.removeNode(this._modalEl)},setTitle:function(t){this.setShowHeader(!!t),mini.Drawer.superclass.setTitle.call(this,t)},destroy:function(t){this.$el.css("transform",this._transformDirect[this.placement]),this._modalEl&&(jQuery(this._modalEl).remove(),this._modalEl=null);var e="__modal"+this._id;jQuery("[id='"+e+"']").remove();var i=this;setTimeout(function(){mini.Drawer.superclass.destroy.call(i,t)},200)},getAttrs:function(t){var e=mini.Drawer.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["placement","onopen","onclose","onbeforeopen","onbeforeclose"]),e}}),mini.regClass(mini.Drawer,"drawer"),mini.openDrawer=function(t){"string"==typeof t&&(t={url:t}),(t=mini.copyTo({title:"",url:"",showCloseButton:!0},t)).closeAction="destroy";var e=t.onload;delete t.onload;var i=t.ondestroy;delete t.ondestroy;var n=t.url;delete t.url;var s=new mini.Drawer;return s.set(t),s.load(n,e,i),s.show(),s},mini.FilterTree=function(){mini.FilterTree.superclass.constructor.call(this),this.initComponents(),this.bindEvents()},mini.extend(mini.FilterTree,mini.Tree,{filterMode:"client",filterUrl:"",height:"100%",emptyText:epoint_local.FilterTree.emptyText,uiCls:"mini-filtertree",mapClass:"",autoLoad:!1,resultAsTree:!1,initComponents:function(){var t='<input name="filterInput" class="mini-buttonedit mini-filtertree-filter" emptyText="'+this.emptyText+'" />';this.set({showToolbar:!0,toolbar:t})},_filterKey:"",bindEvents:function(){var e=this;this._filterInput=mini.getbyName("filterInput",this),this._filterInput.on("enter",function(){var t=e._filterInput._textEl.value;e._doFilter(t)}),this._filterInput.on("buttonclick",function(){var t=e._filterInput._textEl.value;e._doFilter(t)}),this.on("load",function(t){var e=t.data;t.xhr&&"client"===this.filterMode&&0<!this._initialData.length&&(this._initialData=mini.clone(e))})},setData:function(t){mini.FilterTree.superclass.setData.call(this,t),"client"===this.filterMode&&(this._initialData=mini.clone(t))},_doFilter:function(a){var l=this;if(l._filterKey=a,"server"==l.filterMode){var h={data:{search_condition:a},url:l.getFilterUrl(),sender:l,cancel:!1};if(l.fire("serverfilter",h),h.cancel)return;l.fire("beforeload",h),mini.ajax({url:h.url,data:h.data,type:"post",success:function(t,e,i){t&&"null"!=t||(t="{ tatal: 0, data: [] }"),delete h.params;var n={text:t,result:null,sender:l,options:h,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(r){1==mini_debugger&&alert(url+"\n json is error.")}mini.isArray(s)&&(s={data:s}),l.dataField&&(s.data=mini._getMap(l.dataField,s)),s.data||(s.data=[]);var o={data:s.data,cancel:!1,result:s};l.fire("preload",o),1!=o.cancel&&(l.getResultAsTree()?l.loadData(o.data):l.loadList(o.data),l.showRadioButton&&l.value&&l.setValue(l.value),l.fire("filter"),""!==a&&l.expandAll())}})}else""===a?(l.clearFilter(),l.isFilter=!1):(a=mini.htmlEncode(a.toLowerCase()),l.filter(function(t){if(-1!=(t[l.textField]?t[l.textField].toLowerCase():"").indexOf(a))return!0}),l.expandAll(),l.isFilter=!0),l.fire("filter")},_OnCellClick:function(t){if(!mini.findParent(t.htmlEvent.target,this._eciconCls)){var e,i;if(this._filterKey&&(e=t.record[this.nodesField]))for(var n=0,s=e.length;n<s;n++)i=e[n][this.textField],e[n][this.textField]=i.replace(/<\/?.+?>/g,"");mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.checkOnTextClick?this._tryToggleCheckNode(t.record):this.fire("cellclick",t)}},_OnDrawCell:function(t,e,i,n){var s=mini.TreeGrid.superclass._OnDrawCell.call(this,t,e,i,n);if(this._treeColumn&&this._treeColumn==e.name){var o=s.node;if(!1===o.ckr&&(s.showCheckBox=!1,s.showRadioButton=!1),this._filterKey=this._filterInput.getValue(),this._filterKey){var r=t[e.field];/<[^>]+>/.test(r)||(s.nodeHtml=r.replace(new RegExp("("+function a(t){return t.replace(/\\/g,"\\\\").replace(/\$/g,"\\$").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\./g,"\\.").replace(/\[/g,"\\[").replace(/\?/g,"\\?").replace(/\^/g,"\\^").replace(/\{/g,"\\{").replace(/\|/g,"\\|").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(this._filterKey)+")","gi"),'<span class="mini-highlight">$1</span>'))}this.fire("drawnode",s),s.nodeStyle&&(s.cellStyle=s.nodeStyle),s.nodeCls&&(s.cellCls=s.nodeCls),s.nodeHtml?s.cellHtml=s.nodeHtml:o.textCls&&(s.cellHtml='<span class="'+o.textCls+'">'+s.cellHtml+"</span>"),this._createTreeColumn(s)}return s},clearFilter:function(){(this._filterKey||this.isFilter)&&(this._filterInput.setValue(""),this._filterInput.setText(""),this._filterKey="",mini.FilterTree.superclass.clearFilter.call(this),"server"===this.filterMode?this.reload():this._initialData&&this.setData(this._initialData))},getFilterUrl:function(){return this.filterUrl||this.url},setFilterUrl:function(t){this.filterUrl=t},getFilterMode:function(){return this.filterMode},setFilterMode:function(t){this.filterMode=t},setEmptyText:function(t){this.emptyText!=t&&(this._filterInput.emptyText=this.emptyText=t,this._filterInput._doEmpty())},getEmptyText:function(){return this.emptyText},getAttrs:function(t){var e=mini.FilterTree.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["filterMode","filterUrl","emptyText","onserverfilter"]),e.filterUrl||(e.filterUrl=e.url),e}}),mini.regClass(mini.FilterTree,"filtertree"),mini.Icon={},mini.Icon.SVG_CONTENT='<svg><symbol id="icon-trash-svg" viewBox="0 0 400 400"><g><rect x="40.01" y="110.4" fill="#4E5463" width="319.96" height="40" /><rect x="120.16" y="40.53" fill="#4E5463" width="159.72" height="40" /><rect x="146.87" y="190.56" fill="currentColor" width="40" height="90.18" /><rect x="213.39" y="190.56" fill="currentColor" width="40" height="90.18" /><path fill="#4E5463" d="M281.84,360.32H118.21c-20.95,0-38-17.05-38-38V131.26h40v189.06h159.63V131.26h40v191.06 C319.84,343.28,302.8,360.32,281.84,360.32z" /></g></symbol><symbol id="icon-modify-svg" viewBox="0 0 400 400"><g><path fill="#4E5463" d="M301.98,360.57H97.94c-20.95,0-38-17.05-38-38V118.44c0-20.95,17.05-38,38-38h57.1l25.07,40H99.94v200.13 h200.03v-95.49l40-24.68v122.17C339.98,343.52,322.93,360.57,301.98,360.57z" /><rect x="139.43" y="120" transform="matrix(0.6394 -0.7689 0.7689 0.6394 -16.6869 244.4267)" fill="currentColor" width="225.6" height="40" /></g></symbol><symbol id="icon-download-svg" viewBox="0 0 400 400"><g><path fill="#4E5463" d="M60.04,320.4h280.04v39.99H60.04v-20V320.4z" /><path fill="currentColor" d="M219.99,40.4v209.52H180V40.4h20H219.99z" /><polygon fill="currentColor" points="312.84,159.27 298.7,145.13 200,243.83 101.03,144.87 72.75,173.15 171.72,272.11 171.72,272.11 200,300.39 326.98,173.41 " /></g></symbol><symbol id="icon-clouddown-svg" viewBox="0 0 400 400"><g><path fill="currentColor" d="M219.91,190.42v119.54h-39.99V190.42h20H219.91z" /><path fill="currentColor" d="M143.44,237.17L228.28,322L200,350.28l-84.83-84.83l14.14-14.14L143.44,237.17z" /><path fill="currentColor" d="M284.83,265.45L200,350.28L171.72,322l84.83-84.83l14.14,14.14L284.83,265.45z" /><path fill="#4E5463" d="M342.36,171.17c-12.12-12.58-27.07-21.57-43.46-26.33c0.29-2.88,0.44-5.79,0.44-8.71 c0-47.24-38.43-85.67-85.68-85.67c-43.92,0-80.23,33.22-85.11,75.85c-54.97,3.95-98.49,49.94-98.49,105.9 c0,56.45,44.29,102.75,99.94,105.99v-40.11c-33.58-3.15-59.94-31.49-59.94-65.87c0-36.49,29.69-66.18,66.18-66.18 c3.22,0,6.5,0.24,9.75,0.72l27.14,4l-4.49-27.06c-0.42-2.54-0.63-5.08-0.63-7.56c0-25.19,20.49-45.67,45.67-45.67 c25.19,0,45.68,20.49,45.68,45.67c0,5.97-1.14,11.78-3.39,17.27l-10.8,26.4l28.5,1.16c31.58,1.28,56.31,27.05,56.31,58.67 c0,32.39-26.35,58.74-58.74,58.74c-0.41,0-0.81-0.01-1.22-0.02v39.99c0.41,0,0.81,0.03,1.22,0.03 c54.45,0,98.74-44.29,98.74-98.74C369.96,213.97,360.16,189.66,342.36,171.17z" /></g></symbol><symbol id="icon-view-svg" viewBox="0 0 400 400"><g><path fill="currentColor" d="M354.05,326.12l-60.92-60.92c-7.81-7.81-20.47-7.81-28.28,0c-7.81,7.81-7.81,20.47,0,28.28l60.92,60.92 c3.91,3.91,9.02,5.86,14.14,5.86c5.12,0,10.24-1.95,14.14-5.86C361.86,346.6,361.86,333.93,354.05,326.12z" /><path fill="#4E5463" d="M184.8,329c-79.6,0-144.35-64.76-144.35-144.35c0-79.6,64.76-144.35,144.35-144.35 c79.6,0,144.35,64.76,144.35,144.35C329.16,264.24,264.4,329,184.8,329z M184.8,80.29c-57.54,0-104.35,46.81-104.35,104.35 S127.26,289,184.8,289c57.54,0,104.35-46.81,104.35-104.35S242.35,80.29,184.8,80.29z" /><path fill="currentColor" d="M239.81,200.35c-11.05,0-20-8.95-20-20c0-16.58-13.49-30.07-30.07-30.07c-11.05,0-20-8.95-20-20 s8.95-20,20-20c38.64,0,70.07,31.43,70.07,70.07C259.81,191.39,250.85,200.35,239.81,200.35z" /></g></symbol><symbol id="icon-search-svg" viewBox="0 0 400 400"><g><path fill="currentColor" d="M354.05,326.12l-60.92-60.92c-7.81-7.81-20.47-7.81-28.28,0c-7.81,7.81-7.81,20.47,0,28.28l60.92,60.92 c3.91,3.91,9.02,5.86,14.14,5.86c5.12,0,10.24-1.95,14.14-5.86C361.87,346.6,361.87,333.93,354.05,326.12z" /><path fill="#4E5463" d="M184.8,329c-79.6,0-144.35-64.76-144.35-144.35c0-79.6,64.76-144.35,144.35-144.35 c79.6,0,144.35,64.76,144.35,144.35C329.16,264.24,264.4,329,184.8,329z M184.8,80.29c-57.54,0-104.35,46.81-104.35,104.35 S127.26,289,184.8,289c57.54,0,104.35-46.81,104.35-104.35S242.34,80.29,184.8,80.29z" /></g></symbol><symbol id="icon-select-svg" viewBox="0 0 400 400"><g><path fill="currentColor" d="M209.47,210.35v119.99l119.99-119.99H209.47z" /><path fill="#4E5463" d="M169.93,350.34H89.6c-21.77,0-39.48-17.71-39.48-39.48V89.99c0-21.77,17.71-39.48,39.48-39.48h220.77 c21.77,0,39.48,17.71,39.48,39.48v90.4h-40V90.51H90.12v219.83h79.81V350.34z" /><path fill="currentColor" d="M329.46,350.37c-5.12,0-10.24-1.95-14.14-5.86l-79.8-79.8c-7.81-7.81-7.81-20.47,0-28.28 c7.81-7.81,20.47-7.81,28.28,0l79.8,79.8c7.81,7.81,7.81,20.47,0,28.28C339.7,348.41,334.58,350.37,329.46,350.37z" /></g></symbol><symbol id="icon-voice-svg" viewBox="0 0 400 400"><g><path fill="#4E5463" d="M245.37,360.37l-28.78-27.78c34.4-35.63,53.34-82.53,53.34-132.06c0-49.57-18.97-96.5-53.41-132.14 l28.76-27.8c41.69,43.13,64.64,99.93,64.64,159.93C309.93,260.48,287.01,317.24,245.37,360.37z" /><path fill="currentColor" d="M180.71,297.84l-28.75-27.82c18.13-18.74,28.12-43.42,28.12-69.51c0-26.1-10-50.8-28.15-69.54l28.73-27.83 c25.42,26.25,39.42,60.83,39.42,97.37C220.09,237.04,206.1,271.6,180.71,297.84z" /><path fill="currentColor" d="M123.2,242.4c10.52-10.82,17-25.6,17-41.88c0-16.32-6.5-31.12-17.06-41.94l-43.27,41.91L123.2,242.4z" /></g></symbol><symbol id="icon-location-svg" viewBox="0 0 400 400"><g><path fill="currentColor" d="M209.99,231c-33.39,0-60.55-27.16-60.55-60.55c0-33.39,27.16-60.55,60.55-60.55 c33.39,0,60.55,27.16,60.55,60.55C270.55,203.84,243.38,231,209.99,231z M209.99,149.9c-11.33,0-20.55,9.22-20.55,20.55 S198.66,191,209.99,191c11.33,0,20.55-9.22,20.55-20.55S221.33,149.9,209.99,149.9z" /><path fill="#4E5463" d="M209.99,360.44c-5.91,0-11.52-2.62-15.32-7.15l-88.8-105.89c-1.39-1.66-2.74-3.39-4.01-5.15 c-2.08-2.88-3.85-5.64-5.42-8.44c-10.77-19.26-16.46-41.17-16.46-63.36c0-34.6,13.44-67.17,37.84-91.7 c24.39-24.52,56.87-38.13,91.45-38.31c34.79-0.18,67.57,13.27,92.33,37.9c24.76,24.63,38.4,57.34,38.4,92.11 c0,22.1-5.65,43.94-16.35,63.16c-1.59,2.86-3.45,5.77-5.53,8.65c-1.26,1.75-2.61,3.48-4,5.13l-88.81,105.9 C221.52,357.82,215.91,360.44,209.99,360.44z M209.99,80.44c-0.17,0-0.33,0-0.5,0c-49.36,0.27-89.51,40.65-89.51,90.01 c0,15.37,3.93,30.53,11.37,43.84c0.81,1.44,1.76,2.92,2.93,4.53c0.71,0.98,1.46,1.95,2.23,2.87l73.48,87.62l73.49-87.63 c0.77-0.92,1.52-1.88,2.22-2.85c1.18-1.63,2.16-3.17,3.01-4.68c0,0,0,0,0,0c7.39-13.28,11.3-28.39,11.3-43.7 c0-24.04-9.45-46.68-26.61-63.75C256.36,89.75,233.85,80.44,209.99,80.44z" /></g></symbol><symbol id="icon-pause-svg" viewBox="0 0 400 400"><g><path fill="#4E5463" d="M199.91,360.23c-88.16,0-159.88-71.72-159.88-159.88c0-88.16,71.72-159.88,159.88-159.88 c88.16,0,159.88,71.72,159.88,159.88C359.79,288.51,288.07,360.23,199.91,360.23z M199.91,80.46 c-66.1,0-119.88,53.78-119.88,119.88s53.78,119.88,119.88,119.88s119.88-53.78,119.88-119.88S266.01,80.46,199.91,80.46z" /><rect x="146.88" y="140.17" fill="currentColor" width="40" height="120.34" /><rect x="213.39" y="140.17" fill="currentColor" width="40" height="120.34" /></g></symbol><symbol id="icon-play-svg" viewBox="0 0 400 400"><g><path fill="#4E5463" d="M199.91,360.23c-88.16,0-159.88-71.72-159.88-159.88c0-88.16,71.72-159.88,159.88-159.88 c88.16,0,159.88,71.72,159.88,159.88C359.79,288.51,288.07,360.23,199.91,360.23z M199.91,80.46 c-66.1,0-119.88,53.78-119.88,119.88s53.78,119.88,119.88,119.88c66.1,0,119.88-53.78,119.88-119.88S266.01,80.46,199.91,80.46z" /><path fill="currentColor" d="M170.16,270.3c-3.33,0-6.67-0.83-9.69-2.51c-6.36-3.52-10.31-10.22-10.31-17.49v-99.9 c0-7.27,3.95-13.97,10.31-17.49c6.36-3.52,14.13-3.32,20.3,0.54l79.87,49.95c5.84,3.66,9.39,10.06,9.39,16.96 c0,6.89-3.55,13.3-9.39,16.96l-79.87,49.95C177.53,269.28,173.85,270.3,170.16,270.3z M190.16,186.49v27.7l22.15-13.85 L190.16,186.49z" /></g></symbol><symbol id="icon-print-svg" viewBox="0 0 400 400"><g><path fill="#4E5463" d="M289.66,150.27H109.86V40.4h179.81V150.27z M149.86,110.27h99.81V80.4h-99.81V110.27z" /><path fill="currentColor" d="M289.86,359.4h-180V196.07h180V359.4z M149.86,319.4h100v-83.33h-100V319.4z" /><path fill="#4E5463" d="M359.98,290.4h-50.02v-40h10.02V150.27h-240V250.4H90v40H39.98V148.27c0-20.95,17.05-38,38-38h244 c20.95,0,38,17.05,38,38V290.4z" /></g></symbol><symbol id="icon-transform-svg" viewBox="0 0 400 400"><g><path fill="#4E5463" d="M189.95,190.35H39.73V78.52c0-20.95,17.05-38,38-38h112.22V190.35z M79.73,150.35h70.22V80.52H79.73V150.35 z" /><path fill="#4E5463" d="M322.04,360.63H209.82V210.81h150.22v111.83C360.04,343.59,342.99,360.63,322.04,360.63z M249.82,320.63 h70.22v-69.83h-70.22V320.63z" /><polygon fill="currentColor" points="360.04,190.46 320.04,190.46 320.04,120.4 263.32,120.4 263.32,80.4 360.04,80.4 " /><polygon fill="currentColor" points="136.45,320.5 39.73,320.5 39.73,210.43 79.73,210.43 79.73,280.5 136.45,280.5 " /><polygon fill="currentColor" points="289.84,160.41 209.99,100.4 289.84,40.4 " /><polygon fill="currentColor" points="110.09,240.49 189.94,300.5 110.09,360.5 " /></g></symbol><symbol id="icon-export-svg" viewBox="0 0 400 400"><g><path fill="#4E5463" d="M310.34,350.34H89.57c-21.77,0-39.48-17.71-39.48-39.48V89.99c0-21.77,17.71-39.48,39.48-39.48h90.42v40 H90.09v219.83h219.73V210.01h40v100.86C349.81,332.63,332.11,350.34,310.34,350.34z" /><path fill="currentColor" d="M219.95,260.4h-40v-102c0-20.95,17.05-38,38-38h111.96v40H219.95V260.4z" /><path fill="currentColor" d="M329.91,160.4c-5.12,0-10.24-1.95-14.14-5.86l-69.8-69.79c-7.81-7.81-7.81-20.47,0-28.28 c7.81-7.81,20.47-7.81,28.28,0l69.8,69.79c7.81,7.81,7.81,20.47,0,28.28C340.15,158.44,335.03,160.4,329.91,160.4z" /></g></symbol><symbol id="icon-back-svg" viewBox="0 0 400 400"><g><polygon fill="#4E5463" points="296.12,289.87 160.29,289.87 160.29,249.87 266.98,249.87 284.9,170.17 139.86,170.09 139.86,129.54 340.03,129.49" /><polygon fill="currentColor" points="139.86,69.79 50.08,145.89 139.86,230.38" /></g></symbol><symbol id="icon-disband-svg" viewBox="0 0 400 400"><path style="fill: currentColor;" d="M359.9,265.31l-27.92,28.31l27.86,28.49 M359.84,322.11l-28.21,28.35L303.9,322.1l-27.14,27.52l-28.34-28.23 l27.51-27.89l-27.08-27.69l28.21-28.35l26.95,27.56l27.55-27.94l28.34,28.23" /><path style="fill: #4E5463;" d="M230.82,320.42H79.93V293.8l82.88-38.98c10-4.7,14.29-16.62,9.59-26.61l-24.47-51.09v-45.7 c0-28.72,23.28-52,52-52s52,23.28,52,52v46.29l-24.1,50.4c-4.09,8.71-1.35,18.88,6.04,24.45c9.71-22.05,27.65-39.66,49.92-48.94 l8.08-16.64l0.25,0.12v-44.16l-0.19-0.09v-11.44c0-50.81-41.19-92-92-92c-50.81,0-92,41.19-92,92v55.73l0.25-0.12l19.51,40.1 l-87.76,41.28v92.01H257.2C245.25,349.7,236.05,335.97,230.82,320.42z" /></symbol></svg>',mini.Icon.SVG_MAP=["icon-trash-svg","icon-modify-svg","icon-download-svg","icon-clouddown-svg","icon-view-svg","icon-search-svg","icon-select-svg","icon-voice-svg","icon-location-svg","icon-pause-svg","icon-play-svg","icon-print-svg","icon-transform-svg","icon-export-svg","icon-back-svg","icon-disband-svg"].reduce(function(t,e){return t[e]=!0,t},{}),NJb=this.jQuery,mini.Icon.parseSVG=SJb,jQuery(function TJb(){document.body.insertAdjacentHTML("beforeend",'<div class="hidden" style="display:none">'+mini.Icon.SVG_CONTENT+"</div>"),SJb(),function t(){return window.MutationObserver?PJb():QJb()}()}),mini.ImageUploader=function(){mini.ImageUploader.superclass.constructor.call(this)},mini.extend(mini.ImageUploader,mini.Control,{uiCls:"mini-imageuploader",actionButtons:[{icon:"icon-upload",name:epoint_local.upload_text,role:"reselect"},{icon:"icon-trash",name:epoint_local.delete_text,role:"remove"}],showButton:!0,maxBtnNum:3,imageWidth:80,imageHeight:80,limitWidth:NaN,limitHeight:NaN,accept:"image/*",limitType:"gif,jpg,jpeg,bmp,png,webp",_limitRegExp:/^(gif|jpg|jpeg|bmp|png|webp)$/i,numLimit:undefined,sizeLimit:undefined,fileNameLengthLimit:window.EpFrameSysParams&&EpFrameSysParams.file_limit_namelength,multiple:!1,serverFileNum:0,data:[],enableSort:!1,STATE_TEXT:{PEDDING:"pedding",UPLOADING:"UPLOADING",DONE:"done",FAIL:"fail"},deleteAlert:epoint_local.ImageUploader.deleteAlert,deleteAlertTitle:epoint_local.ImageUploader.deleteAlertTitle,typeErrorAlert:epoint_local.ImageUploader.typeErrorAlert,typeAcceptedText:epoint_local.ImageUploader.typeAcceptedText,imageCountAlert:epoint_local.ImageUploader.imageCountAlert,imageNameLengthAlert:epoint_local.ImageUploader.imageNameLengthAlert,imageSizeAlert:epoint_local.ImageUploader.imageSizeAlert,imageMeasureAlert:epoint_local.ImageUploader.imageMeasureAlert,fileCountAlert:epoint_local.ImageUploader.fileCountAlert,showTips:function(t){return window.epoint?epoint.showTips(t.content,t):mini.showTips(t)},setAction:function(t){this.action=t,this.controlData={id:this.id,type:this.type,mapClass:this.mapClass,action:this.action};var e=t.split(".");if(!(e.length<2)){var i=Util.getRightUrl("/rest/"+e[0]+"/"+e[1]+"?isCommondto=true"),n=/\([\w\W]*\)/,s=i.match(n);s&&(i=i.replace(n,""),this.cmdParams=s[0].replace("(","[").replace(")","]"));var o=Util.getUrlParams();i=Util.addUrlParams(i,o,"ignore"),this.setUploadUrl(i)}},_dealUrl:function(t){return t},_create:function(){this.serverFiles={},this.externalSrc=this.externalSrc||mini.externalSrc,this._fileIdPrefix=this.id+"$file$",this._fileIndex=0,this._createInput(),this.el=document.createElement("div"),this.el.innerHTML='<div class="mini-imageuploader-list" style="user-select:none"><label class="mini-imageuploader-addbutton"></label></div>',this._listEl=this.el.firstChild,this.el.appendChild(this._fileInput),this._$addBtn=jQuery(this.el).find(".mini-imageuploader-addbutton"),this._$addBtn.css({width:this.imageWidth?this.imageWidth:"",height:this.imageHeight?this.imageHeight:"",lineHeight:this.imageHeight?this.imageHeight+"px":""}).attr({"for":this.id+"$file"}),mini.on(this._$addBtn[0],"click",this.__onAddBtnClick,this),this.on("change",this.__onFileChange,this)},setActionButtons:function(t){var r=this,a=this.id+"$action$more";this.actionButtons=t;var e,i=this.actionButtonsMap={};if(jQuery.each(t,function(t,e){e.id||(e.id=r.id+"$action$"+(t+1)),i[e.id]=e}),jQuery(this.el).off("click",".mini-imageuploader-btn").on("click",".mini-imageuploader-btn",function(t){var e=t.target,i=e.getAttribute("data-id");if(i!==a){var n=r.actionButtonsMap[i];if(n){var s=n.role;if(s){if(r.readOnly||!r.enabled)return;r.handleActionBtnClick(s,r._genderActionBtnEventData(e))}else{var o=n.handle;"function"!=typeof o&&(o=window[o]),"function"==typeof o&&o.call(r,r._genderActionBtnEventData(e))}}}else r._showActionPopup(e)}),!(this.actionButtons.length>this.maxBtnNum))return e=jQuery.map(this.actionButtons,function(t){return'<span class="mini-imageuploader-btn action-icon '+t.icon+'" data-tooltip="'+t.name+'" data-id="'+t.id+'" role="'+t.role+'"></span>'}).join(""),void(this._actionBtnHtml=e);var n=this.actionButtons.slice(0,this.maxBtnNum-1);n.push({id:a,icon:"icon-omit",handle:this._showActionPopup,name:epoint_local.more_text});var s=this.actionButtons.slice(this.maxBtnNum-1);this._initActonBtnPopup(s),e=jQuery.map(n,function(t){return'<span class="mini-imageuploader-btn action-icon '+t.icon+'" data-tooltip="'+t.name+'" data-id="'+t.id+'" role="'+t.role+'"></span>'}).join(""),this._actionBtnHtml=e},_genderActionBtnEventData:function(t){var e=jQuery(t),i=this.actionButtonsMap[e.attr("data-id")],n=e.closest(".mini-imageuploader-item"),s=n.attr("file-id"),o=n.attr("file-guid"),r=this.data.filter(function(t){return t.id===s||t.attachGuid===o})[0];return{sender:this,source:this,icon:i,file:r,fileEl:n[0]}},_initActonBtnPopup:function(t){if(!this.__extMenuInited){var r=this,e=new mini.Menu;e.set({minWidth:50,yOffset:4}),e.setItems($.map(t,function(t){return{id:t.id,text:t.name,iconCls:t.icon}})),e.on("itemclick",function(t){var e=t.item.id,i=t.sender.popupEl,n=r.actionButtonsMap[e];if(n){var s=n.role;if(s){if(r.readOnly||!r.enabled)return;r.handleActionBtnClick(s,r._genderActionBtnEventData(i))}else{var o=n.handle;"function"!=typeof o&&(o=window[o]),"function"==typeof o&&o.call(r,r._genderActionBtnEventData(i))}}});var i=e.hide;e.hide=function(){i.apply(this,arguments),jQuery(r.el).find(".mini-imageuploader-btn").removeClass("active")},this.__extMenu=e,this.__extMenuInited=!0,this._showActionPopup=function(t){e.popupEl=t,e.showAtEl(t),jQuery(t).addClass("active")}}},handleActionBtnClick:function(t,e){var i=this;switch(t){case"remove":mini.confirm(this.deleteAlert,this.deleteAlertTitle,function(t){"ok"===t&&i.removeImage(e.file)});break;case"reselect":this.reselectImage(e.file)}},_getFileData:function(t){for(var e=null,i=0,n=this.data.length;i<n;i++){var s=this.data[i];if(s.id===t){e=s;break}}return e},_removeFileData:function(t){for(var e=!1,i=0,n=this.data.length;i<n;i++){if(this.data[i].id===t){e=this.data.splice(i,1)[0];break}}return e},removeImage:function(t){var e="string"!=typeof t?t.id:t,i={action:"delete",attachGuid:e};window.epoint&&(i.commonDto=mini.encode(this.getCommonData()),this.cmdParams&&(i.cmdParams=this.cmdParams),i[this.id+"_action"]="delete",i[this.id+"_attachGuid"]=e);var n={type:"beforeRemove",sender:this,source:this,data:i};if(this.fire("beforeRemove",n),!0!==n.cancel){var s=this._removeFileData(e);return s&&(this.serverFiles[e]&&(delete this.serverFiles[e],this.serverFileNum--),jQuery.ajax({url:this.uploadUrl,data:n.data,type:"POST"}).done(function(){}),jQuery(this.el).find('.mini-imageuploader-item[file-id="'+e+'"]').remove(),s&&this._updateAddBtnState()),s}},reselectImage:function(t){var s="string"!=typeof t?t.id:t,o=this,r=(this._getFileData(s),jQuery(this.el).find('.mini-imageuploader-item[file-id="'+s+'"]'));this._fileInput.removeAttribute("multiple"),this.on("selectFile",function a(t){if(!o.readOnly&&o.enabled){t.cancel=!0,o.setMultiple(o.multiple),o.un("selectFile",a,this);var e=t.files;if(e.length){var i=t.files[0];if(!o._checkFileType(i))return mini.alert(o.typeErrorAlert+"!</br>"+o.typeAcceptedText+":"+o.limitType);if(1<e.length)return mini.alert(o.imageCountAlert);var n=i.name.lastIndexOf(".");return n=-1!==n?i.name.substring(0,n):i.name,o.fileNameLengthLimit&&mini.getStrLengthUft8(n)>o.fileNameLengthLimit?mini.alert(Mustache.render(o.imageNameLengthAlert,{0:o.fileNameLengthLimit})):o.sizeLimit&&i.size>1024*o.sizeLimit?mini.alert(Mustache.render(o.imageSizeAlert,{0:o.sizeLimit})):void o._validateWidthHeight(i).then(function(t){var e={sender:o,source:o,cancel:!1,type:"beforequeued",file:t};if(o.fire("beforequeued",e),!e.cancel){t.fromServer=!1,t.state=o.STATE_TEXT.PEDDING,o.data.push(t),o._removeFileData(s);var i=o._genderImgEl(t,r[0]);o._doUpload(t,i,s)}})}}},this);var e=document.createElement("label");e.setAttribute("for",this._fileInput.id),document.body.appendChild(e),e.click(),document.body.removeChild(e)},__onAddBtnClick:function(t){!this.readOnly&&this.enabled&&(this.multi||!(this._fileInput.files&&this._fileInput.files.length||this.data&&this.data.length||$(this._listEl).find(".mini-imageuploader-item").length)||t.preventDefault())},_createInput:function(){this._fileInput=document.createElement("input"),this._fileInput.style.cssText="display:none",this._fileInput.setAttribute("type","file"),this._fileInput.setAttribute("accept",this.accept),this.multiple?this._fileInput.setAttribute("multiple",""):this._fileInput.removeAttribute("multiple"),this.readOnly||!this.enabled?this._fileInput.setAttribute("disabled",!0):this._fileInput.removeAttribute("disabled"),this._fileInput.id=this.id+"$file";var s=this;jQuery(this._fileInput).on("change",function o(t){if(!s.readOnly&&s.enabled){var e=t.originalEvent,i={files:this.files,cancel:!1};s.fire("selectFile",i),i.cancel||s.fire("change",i);var n=e.target.cloneNode(!0);n.value=null,this.parentNode.replaceChild(n,this),jQuery(s._fileInput).off(),s._fileInput=n,jQuery(s._fileInput).on("change",o)}})},_getFileWrapper:function(t){return{id:this._fileIdPrefix+ ++this._fileIndex,name:t.name,size:t.size,type:t.type,ext:t.name.substr(t.name.lastIndexOf(".")+1),file:t}},_validateWidthHeight:function(t){var i=this._getFileWrapper(t),n=jQuery.Deferred();if(!this.limitWidth&&!this.limitHeight)return n.resolve(i),n.promise();var s=this,o=new Image,r=URL.createObjectURL(i.file);return o.onload=function(){o.onload=null,o.onerror=null,URL.revokeObjectURL(r),i.width=o.width,i.height=o.height;var t=!0;s.limitWidth&&(t=o.width===s.limitWidth),s.limitHeight&&t&&(t=o.height===s.limitHeight);var e={sender:s,source:s,isValid:t,width:o.width,height:o.height};e.errorText=e.isValid?"":Mustache.render(s.imageMeasureAlert,{0:s.limitWidth,1:s.limitHeight}),s.fire("limitValidation",e),e.isValid?n.resolve(i):(s.showTips({content:e.errorText,state:"danger"}),n.reject(i))},o.onerror=function(t){o.onload=null,o.onerror=null,URL.revokeObjectURL(r),n.reject(t)},o.src=r,n.promise()},_checkFileType:function(t){var e=t.name.lastIndexOf(".");if(!~e)return!1;var i=t.name.substr(e+1);return this._limitRegExp.test(i)},__onFileChange:function(t){var e=t.files;if(e.length){for(var i=[],n=0;n<e.length;n++)this._checkFileType(e[n])&&i.push(e[n]);i.length!==e.length&&mini.alert(this.typeErrorAlert+"!</br>"+this.typeAcceptedText+":"+this.limitType),i.length+this.data.length>this.numLimit?this.showTips({content:Mustache.render(this.fileCountAlert,{0:this.numLimit-this.data.length}),state:"danger"}):i.length&&this.__doFilesAdd(i)}},__doFilesAdd:function(e){this._filesQueue=[];var i=this;if(this._validateImageSize(e)){var n=0;(function s(){if(n<e.length){var t=e[n++];return i.__fileQueue(t).then(s)}})().then(function(){var t={sender:i,source:i,type:"queued",files:i._filesQueue};i.fire("queued",t),i._updateAddBtnState(),i.__doFilesUpload()})}},_validateImageSize:function(t){if(this.sizeLimit)for(var e=1024*this.sizeLimit,i=0,n=t.length;i<n;i++)if(t[i].size>e)return mini.alert(Mustache.render(this.imageSizeAlert,{0:this.sizeLimit})),!1;return!0},__fileQueue:function(t){var i=$.Deferred(),n=this;return this._validateWidthHeight(t).then(function(t){var e={sender:n,source:n,cancel:!1,type:"beforequeued",file:t};if(n.fire("beforequeued",e),e.cancel)return i.resolve();t.fromServer=!1,t.state=n.STATE_TEXT.PEDDING,n._filesQueue.push(t),n.data.push(t),i.resolve()},function(){i.resolve()}),i.promise()},_updateAddBtnState:function(){this.multiple?this.data.length>=this.numLimit?this._$addBtn.hide():this._$addBtn.show():this._fileInput.files&&this._fileInput.files.length||this.data&&this.data.length||$(this._listEl).find(".mini-imageuploader-item").length?this._$addBtn.hide():this._$addBtn.show()},__doFilesUpload:function(){for(var t=0,e=this._filesQueue.length;t<e;t++){var i=this._filesQueue[t];this._doUpload(i,this._genderImgEl(i))}},_genderItemEl:function(t){var e=document.createElement("div");if(e.className="mini-imageuploader-item",jQuery(e).css({width:this.imageWidth?this.imageWidth:"",height:this.imageHeight?this.imageHeight:""}),e.innerHTML='<div class="mini-imageuploader-btns">'+this._actionBtnHtml+"</div>",e.setAttribute("file-id",t.id),t.fileGuid&&e.setAttribute("file-guid",t.fileGuid),t.downloadUrl){var i=document.createElement("img");i.className="mini-imageuploader-img",i.src=this._dealUrl(t.downloadUrl),e.insertAdjacentElement("afterbegin",i)}return e},_genderImgEl:function(t,e){var i=t.file,n=this._genderItemEl(t),s=document.createElement("img");s.className="mini-imageuploader-img";var o=URL.createObjectURL(i);return s.onload=function(){s.onload=null,URL.revokeObjectURL(o)},s.src=o,n.insertAdjacentElement("afterbegin",s),e?jQuery(e).replaceWith(n):jQuery(n).insertBefore(this._$addBtn),n},getCommonData:function(){return this.controlData||(this.controlData={id:this.id,type:"imageuploader",mapClass:this.mapClass,action:this.action,dataOptions:this["data-options"]}),[this.controlData,this.getViewdata()]},getViewdata:function(){var t=mini.get("_common_hidden_viewdata");return this.viewData||(this.viewData={id:"_common_hidden_viewdata",type:"hidden",value:""}),t&&(this.viewData.value=t.getValue()),this.viewData},_onUploadBeforeSend:function(t){t.commonDto=mini.encode(this.getCommonData()),this.cmdParams&&(t.cmdParams=this.cmdParams),t[this.id+"_action"]="upload"},_doUpload:function(n,s,t){var e=n.file,o=this,i={};window.epoint?(i.commonDto=mini.encode(this.getCommonData()),this.cmdParams&&(i.cmdParams=this.cmdParams),i[this.id+"_action"]="upload"):i.action="upload",t&&(i.action="replace",i.attachGuid=t);var r={type:"beforeUpload",sender:this,source:this,data:i};this.fire("beforeUpload",r);var a=new FormData;$.each(r.data,function(t,e){a.append(t,e)}),a.append("file",e,e.name||""),jQuery.ajax({method:"post",url:this.uploadUrl,contentType:!1,processData:!1,dataType:"json",data:a,xhr:function(){var t=new XMLHttpRequest;return t.upload.onloadstart=function(){n.state=o.STATE_TEXT.UPLOADING},t.upload.onprogress=function(t){var e=t.loaded/t.total;1<=e&&(e=1);var i=(100*e).toFixed(2)+"%";n.progress=e,o.fire("uploadprogress",{progress:e,percent:i,file:n,fileEl:s})},t}}).done(function(t){o.__onUploadSuccess(t,n,s)}).fail(function(t){console.error(t),n.state=o.STATE_TEXT.FAIL,o.fire("uploadError",{type:"uploadError",sender:o,source:o,file:n,fileEl:s})})},__onUploadSuccess:function(t,e,i){var n=mini.getSecondRequestData?mini.getSecondRequestData(t).data:t,s=jQuery(i).find(".mini-imageuploader-img")[0];if(URL.revokeObjectURL(s.src),e.progress<1&&(e.progress=1,this.fire("uploadprogress",{progress:1,percent:"100%",file:e,fileEl:i})),e.state=this.STATE_TEXT.DONE,n.attachLength&&(e.size=n.attachLength),n.width&&(e.width=n.width),n.height&&(e.height=n.height),n.uploadDateTime&&(e.date=n.uploadDateTime),n.downloadUrl){e.downloadUrl=n.downloadUrl;var o=window.Util?window.Util.getRightUrl(n.downloadUrl):n.downloadUrl;o+=(/\?/.test(o)?"&_t=":"?_t=")+ +new Date,s.src=o}n.attachGuid&&(i.setAttribute("file-id",n.attachGuid),i.setAttribute("file-guid",n.attachGuid),e.id=n.attachGuid),this.fire("uploadSuccess",{type:"uploadSuccess",sender:this,source:this,file:e,fileEl:i})},getData:function(){return this.data||[]},setData:function(t){if(!jQuery.isArray(t))return!1;var e=$.map(t,function(t){return Util.browsers.isIE&&(t.downloadUrl=t.downloadUrl+"&"+Date.now()),{fromServer:!0,id:t.attachGuid,state:"success",size:t.attachLength,width:t.width,height:t.height,date:t.uploadDateTime,fileGuid:t.attachGuid,downloadUrl:t.downloadUrl}}),i=this.data=e;this.serverFileNum=this.data.length,this._updateAddBtnState();var n,s=document.createDocumentFragment();this.serverFiles={};for(var o=0,r=i.length;o<r;o++)n=i[o],this.serverFiles[n.fileGuid]=n,s.appendChild(this._genderItemEl(n));this._$addBtn.parent().empty(),this._listEl.appendChild(s),this._listEl.appendChild(this._$addBtn[0]),this.fire("load",{sender:this,eventType:"load",data:t})},clearFile:function(t){if(!t)return this.setData([]),void this._updateAddBtnState();var i=this;jQuery.each(this.data,function(t,e){i.removeImage(e)})},getMultiple:function(){return this.multiple},setMultiple:function(t){this.multiple=!0===t,this.multiple?this._fileInput.setAttribute("multiple",""):this._fileInput.removeAttribute("multiple")},getNumLimit:function(){return this.numLimit},setNumLimit:function(t){if(!jQuery.isNumeric(t))return!1;this.numLimit=t},getSizeLimit:function(){return this.sizeLimit},setSizeLimit:function(t){if(!jQuery.isNumeric(t))return!1;this.sizeLimit=t},getFileNameLengthLimit:function(){return this.fileNameLengthLimit},setFileNameLengthLimit:function(t){if(!jQuery.isNumeric(t))return!1;this.fileNameLengthLimit=t},getImageWidth:function(){return this.imageWidth},setImageWidth:function(t){if(!jQuery.isNumeric(t))return!1;this.imageWidth=t,this._$addBtn.css({width:this.imageWidth?this.imageWidth:""}),jQuery(this.el).find(".mini-imageuploader-item").css({width:this.imageWidth?this.imageWidth:""})},getImageHeight:function(){return this.imageHeight},setImageHeight:function(t){if(!jQuery.isNumeric(t))return!1;this.imageHeight=t,this._$addBtn.css({height:this.imageHeight?this.imageHeight:"",lineHeight:this.imageHeight?this.imageHeight+"px":""}),jQuery(this.el).find(".mini-imageuploader-item").css({height:this.imageHeight?this.imageHeight:""})},setUploadUrl:function(t){this.uploadUrl=t},getUploadUrl:function(){return this.uploadUrl},setLimitWidth:function(t){"number"!=typeof t&&(t=parseInt(t,10)),this.limitWidth=t},getLimitWidth:function(){return this.limitWidth},setLimitHeight:function(t){"number"!=typeof t&&(t=parseInt(t,10)),this.limitHeight=t},getLimitHeight:function(){return this.limitHeight},getAccept:function(){return this.accept},setAccept:function(t){this.accept=t,this._fileInput.setAttribute("accept",t)},setLimitType:function(t){this.limitType=t;var e=[];(t||"").split(",").forEach(function(t){"."===t[0]&&(t=t.substr(1)),(t=jQuery.trim(t))&&e.push(t)}),e.length?this._limitRegExp=new RegExp("^("+e.join("|")+")$","i"):this._limitRegExp=/[\s\S]*/i},getLimitType:function(){return this.limitType},setShowButton:function(t){this.showButton=!!t,this.showButton?this.removeCls("mini-imageuploader-hidebtn"):this.addCls("mini-imageuploader-hidebtn")},getShowButton:function(){return this.showButton},setEnabled:function(t){mini.ImageUploader.superclass.setEnabled.call(this,t),this.readOnly||!this.enabled?this._fileInput.setAttribute("disabled",!0):this._fileInput.removeAttribute("disabled")},setReadOnly:function(t){mini.ImageUploader.superclass.setReadOnly.call(this,t),this.readOnly||!this.enabled?this._fileInput.setAttribute("disabled",!0):this._fileInput.removeAttribute("disabled")},setEnableSort:function(t){this.enableSort=t;var i=jQuery(this._listEl),n=this;this.enableSort?i.sortable({revert:!0,delay:150,distance:10,items:">.mini-imageuploader-item",update:function(){var t=i.sortable("toArray",{attribute:"file-guid"}),e={commonDto:mini.encode(n.getCommonData())};e[n.id+"_action"]="saveSort",e.sort=t.join(","),Util.ajax({url:n.uploadUrl,dataType:"json",data:e,type:"post",success:function(){}})}}):i.sortable("destroy")},getEnableSort:function(){return this.enableSort},getAttrs:function(t){var e=mini.ImageUploader.superclass.getAttrs.call(this,t),i=jQuery(t).children('[type="button"]'),n=[];return $.each(i,function(t,e){"button"===e.getAttribute("type")&&n.push({icon:e.getAttribute("icon"),name:e.getAttribute("title")||e.innerText,role:e.getAttribute("role"),handle:e.getAttribute("onclick")})}),n.length?e.actionButtons=n:this.setActionButtons(this.actionButtons),mini._ParseInt(t,e,["imageWidth","imageHeight","limitWidth","limitHeight","numLimit","sizeLimit","maxBtnNum"]),mini._ParseBool(t,e,["multiple","showButton","enableSort"]),mini._ParseString(t,e,["accept","uploadUrl","limitType","onLimitValidation","onbeforequeued","onqueued","onbeforeUpload","onuploadprogress","onuploadsuccess","onuploaderror","onbeforeremove"]),e}}),mini.regClass(mini.ImageUploader,"imageuploader"),XNb=function(k){var s,t=navigator.userAgent,I=/iphone/i.test(t),o=/chrome/i.test(t),F=/android/i.test(t);k.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},k.fn.extend({caret:function(t,e){var i;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof t?(e="number"==typeof e?e:t,this.each(function(){this.setSelectionRange?this.setSelectionRange(t,e):this.createTextRange&&((i=this.createTextRange()).collapse(!0),i.moveEnd("character",e),i.moveStart("character",t),i.select())})):(this[0].setSelectionRange?(t=this[0].selectionStart,e=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),t=0-i.duplicate().moveStart("character",-1e5),e=t+i.text.length),{begin:t,end:e})},unmask:function(){return this.trigger("unmask")},mask:function(e,w){var n,x,C,b,E,T,S;if(!e&&0<this.length){var t=k(this[0]).data(k.mask.dataName);return t?t():void 0}return w=k.extend({autoclear:k.mask.autoclear,placeholder:k.mask.placeholder,completed:null},w),n=k.mask.definitions,x=[],C=T=e.length,b=null,k.each(e.split(""),function(t,e){"?"==e?(T--,C=t):n[e]?(x.push(new RegExp(n[e])),null===b&&(b=x.length-1),t<C&&(E=x.length-1)):x.push(null)}),this.trigger("unmask").each(function(){function a(){if(w.completed){for(var t=b;t<=E;t++)if(x[t]&&p[t]===l(t))return;w.completed.call(f)}}function l(t){return w.placeholder.charAt(t<w.placeholder.length?t:0)}function h(t){for(;++t<T&&!x[t];);return t}function d(t,e){var i,n;if(!(t<0)){for(i=t,n=h(e);i<T;i++)if(x[i]){if(!(n<T&&x[i].test(p[n])))break;p[i]=p[n],p[n]=l(n),n=h(n)}c(),f.caret(Math.max(b,t))}}function r(){m(),f.val()!=_&&f.change()}function u(t,e){var i;for(i=t;i<e&&i<T;i++)x[i]&&(p[i]=l(i))}function c(){f.val(p.join(""))}function m(t){var e,i,n,s=f.val(),o=-1;for(n=e=0;e<T;e++)if(x[e]){for(p[e]=l(e);n++<s.length;)if(i=s.charAt(n-1),x[e].test(i)){p[e]=i,o=e;break}if(n>s.length){u(e+1,T);break}}else p[e]===s.charAt(n)&&n++,e<C&&(o=e);return t?c():o+1<C?w.autoclear||p.join("")===g?(f.val()&&f.val(""),u(0,T)):c():(c(),f.val(f.val().substring(0,o+1))),C?e:b}var f=k(this),p=k.map(e.split(""),function(t,e){return"?"!=t?n[t]?l(e):t:void 0}),g=p.join(""),_=f.val();f.data(k.mask.dataName,function(){return k.map(p,function(t,e){return x[e]&&t!=l(e)?t:null}).join("")}),f.one("unmask",function(){f.off(".mask").removeData(k.mask.dataName)}).on("focus.mask",function(){var t;f.prop("readonly")||(clearTimeout(s),_=f.val(),t=m(),s=setTimeout(function(){c(),t==e.replace("?","").length?f.caret(0,t):f.caret(t)},10))}).on("blur.mask",r).on("keydown.mask",function v(t){if(!f.prop("readonly")){var e,i,n,s=t.which||t.keyCode;S=f.val(),8===s||46===s||I&&127===s?(i=(e=f.caret()).begin,(n=e.end)-i==0&&(i=46!==s?function o(t){for(;0<=--t&&!x[t];);return t}(i):n=h(i-1),n=46===s?h(n):n),u(i,n),d(i,n-1),t.preventDefault()):13===s?r.call(this,t):27===s&&(f.val(_),f.caret(0,m()),t.preventDefault())}}).on("keypress.mask",function y(t){if(!f.prop("readonly")){var e,i,n,s=t.which||t.keyCode,o=f.caret();if(!(t.ctrlKey||t.altKey||t.metaKey||s<32)&&s&&13!==s){if(o.end-o.begin!=0&&(u(o.begin,o.end),d(o.begin,o.end-1)),(e=h(o.begin-1))<T&&(i=String.fromCharCode(s),x[e].test(i))){if(function r(t){var e,i,n,s;for(i=l(e=t);e<T;e++)if(x[e]){if(n=h(e),s=p[e],p[e]=i,!(n<T&&x[n].test(s)))break;i=s}}(e),p[e]=i,c(),n=h(e),F){setTimeout(function(){k.proxy(k.fn.caret,f,n)()},0)}else f.caret(n);o.begin<=E&&a()}t.preventDefault()}}}).on("input.mask paste.mask",function(){f.prop("readonly")||setTimeout(function(){var t=m(!0);f.caret(t),a()},0)}),o&&F&&f.off("input.mask").on("input.mask",function i(){var t=f.val(),e=f.caret();if(t.length<S.length){for(m(!0);0<e.begin&&!x[e.begin-1];)e.begin--;if(0===e.begin)for(;e.begin<b&&!x[e.begin];)e.begin++;f.caret(e.begin,e.begin)}else{for(m(!0);e.begin<T&&!x[e.begin];)e.begin++;f.caret(e.begin,e.begin)}a()}),m()})}})},"function"==typeof define&&define.amd?define(["jquery"],XNb):XNb("object"==typeof exports?require("jquery"):jQuery),mini.InputMask=function(){mini.InputMask.superclass.constructor.call(this)},mini.extend(mini.InputMask,mini.TextBox,{uiCls:"mini-inputmask",mask:"",set:function(t){if("string"==typeof t)return this;var e=t.mask;return delete t.mask,mini.InputMask.superclass.set.call(this,t),e&&this.setMask(e),this},setMask:function(t){this.mask=t,jQuery(this._textEl).mask(t)},getMask:function(){return this.mask},getAttrs:function(t){var e=mini.InputMask.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["mask"]),e}}),mini.regClass(mini.InputMask,"inputmask"),mini.JsonEditor=function(){mini.JsonEditor.superclass.constructor.call(this)},mini.extend(mini.JsonEditor,mini.Control,{uiCls:"mini-jsoneditor",width:400,height:400,options:{mode:"tree",modes:[],search:!1,indentation:2,colorPicker:!1,timestampTag:!1,enableSort:!1,enableTransform:!1,enableTrace:!1,traceIdSeparator:"###",showTraceId:!1},value:{},_create:function(){var t=this;this.options=jQuery.extend(!0,{},this.options),this.el=document.createElement("div"),this.externalSrc=this.externalSrc||mini.externalSrc,window.JSONEditor?this._init():(mini.loadCSS(this.externalSrc+"jsoneditor/jsoneditor.min.css"),mini.loadJS(this.externalSrc+"jsoneditor/jsoneditor.min.js",function(){t._init()}))},_init:function(){this._bindEvents(),this.editor=new JSONEditor(this.el,this.options),this.editor.set(this.value),this.value=this.editor.get()},_bindEvents:function(){this.options.onChange=this.__onChange.bind(this),this.options.onModeChange=this.__onModeChanged.bind(this)},__onChange:function(){this.__onTextChanged(),this.__onValueChanged()},__onValueChanged:function(){try{this.value=this.editor.get(),this.fire("valuechanged",{value:this.value})}catch(t){return}},__onTextChanged:function(){this.fire("textchanged",{text:this.editor.getText()})},__onModeChanged:function(t,e){this.options.mode=t,this.fire("modechanged",{newMode:t,oldMode:e})},_reNew:function(){if(this.editor){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){e.editor.destroy&&e.editor.destroy();try{e.editor=new JSONEditor(e.el,e.options),e.editor.set(e.value)}catch(t){for(console.error(t);e.el.firstChild;)e.el.removeChild(e.el.lastChild)}},17)}},setValue:function(t){"string"==typeof t&&(t=JSON.parse(t)),this.value=t,this.editor&&(this.editor.set(this.value),this.value=this.editor.get())},getValue:function(){return this.editor.get()},setWidth:function(t){this.width=t,jQuery(this.el).css("width",t)},getWidth:function(){return this.width},setHeight:function(t){this.height=t,jQuery(this.el).css("height",t)},getHeight:function(){return this.height},setMode:function(t){this.options.mode=t,this.editor&&this.editor.setMode(t)},getMode:function(){return this.options.mode},setModes:function(t){this.options.modes=t?t.split(","):[],this._reNew()},getModes:function(){return this.options.modes.join(",")},setSearch:function(t){this.options.search=t,this._reNew()},getSearch:function(){return this.options.search},setIndentation:function(t){this.options.indentation=t,this._reNew()},getIndentation:function(){return this.options.indentation},setEnableTrace:function(t){this.options.enableTrace=t,this._reNew()},getEnableTrace:function(){return this.options.enableTrace},setTraceIdSeparator:function(t){this.options.traceIdSeparator=t,this._reNew()},getTraceIdSeparator:function(){return this.options.traceIdSeparator},setShowTraceId:function(t){this.options.showTraceId=t,this._reNew()},getShowTraceId:function(){return this.options.showTraceId},getAttrs:function(t){var e=mini.JsonEditor.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onvaluechanged","ontextchanged","onmodechanged","mode","modes","value","traceIdSeparator"]),mini._ParseInt(t,e,["width","height","indentation"]),mini._ParseBool(t,e,["search","enableTrace","showTraceId"]),e}}),mini.regClass(mini.JsonEditor,"jsoneditor"),mini.LargeFileUploader=function(){mini.LargeFileUploader.superclass.constructor.call(this)},mini.extend(mini.LargeFileUploader,mini.Control,{mapClass:"com.epoint.basic.faces.fileupload.NTKOUploader",uiCls:"mini-largefileuploader",showDefaultUI:!0,serverFileNum:0,fileSizeLimit:window.EpFrameSysParams&&EpFrameSysParams.file_limit_size||0,fileSingleSizeLimit:window.EpFrameSysParams&&EpFrameSysParams.file_single_limit_size||0,limitType:window.EpFrameSysParams&&EpFrameSysParams.file_limit_type||"",chunkSize:window.EpFrameSysParams&&EpFrameSysParams.ntko_file_slice_limit_size||5242880,needChunkLocal:!1,uploadUrl:"",fileNumLimit:1,multiSelect:!1,auto:!0,externalSrc:"",pickerText:epoint_local.LargeFileUploader.pickerText,startText:epoint_local.LargeFileUploader.startText,pauseText:epoint_local.LargeFileUploader.pauseText,numLimitErrorText:epoint_local.LargeFileUploader.numLimitErrorText,sizeLimitErrorText:epoint_local.LargeFileUploader.sizeLimitErrorText,typeDeniedErrorText:epoint_local.LargeFileUploader.typeDeniedErrorText,sizeErrorText:epoint_local.LargeFileUploader.sizeErrorText,emptyFileErrorText:epoint_local.LargeFileUploader.emptyFileErrorText,epointUserText:epoint_local.LargeFileUploader.epointUserText,ntkoLoadErrorText:epoint_local.LargeFileUploader.ntkoLoadErrorText,deleteFileConfirmText:epoint_local.LargeFileUploader.deleteFileConfirmText,systemTipText:epoint_local.LargeFileUploader.systemTipText,ntkoInitErrorTitle:epoint_local.LargeFileUploader.ntkoInitErrorTitle,ntkoInitErrorText:epoint_local.LargeFileUploader.ntkoInitErrorText,ntkoErrorCheckBrowserText:epoint_local.LargeFileUploader.ntkoErrorCheckBrowserText,analyzingText:epoint_local.LargeFileUploader.analyzingText,uploadedText:epoint_local.LargeFileUploader.uploadedText,uploadFailedText:epoint_local.LargeFileUploader.uploadFailedText,uploadErrorText:epoint_local.LargeFileUploader.uploadErrorText,set:function(t){if("string"==typeof t)return this;var e=t.pickerText;delete t.pickerText;var i=t.needChunkLocal;return delete t.needChunkLocal,i&&(this.needChunkLocal=i),mini.LargeFileUploader.superclass.set.call(this,t),e&&(this._picker.innerHTML=e),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<div class="mini-uploader-btns"><div class="mini-ntko-pick">'+this.pickerText+'</div></div><div class="mini-uploader-list"></div><div class="mini-ntko"></div>',this._buttons=this.el.firstChild,this._fileList=this.el.children[1],this._ntkoContent=this.el.lastChild,this._picker=this._buttons.firstChild,this._uploadBtn=new mini.Button,this._uploadBtn.setText(this.startText),this._uploadBtn.render(this._buttons),this._ntkoContent.innerHTML='<object id="'+this.uid+'-ntko" classid="clsid:882C96AC-B79E-4f50-A7A6-6E5E42431A05" codebase="'+(this.externalSrc||mini.externalSrc)+'ntkoLFUploader/NtkoLFUploader.cab#version=6,1,1,8"><PARAM NAME="FileBlockSize" VALUE="'+this.chunkSize+'"><PARAM NAME="BackColor" VALUE="16744576"><PARAM NAME="ForeColor" VALUE="16777215"><PARAM NAME="IsUseUTF8Data" VALUE="true"><param name="ProductCaption" value="'+(window.NTKO_ProductCaption||this.epointUserText)+'"><param name="ProductKey" value="'+(window.NTKO_ProductKey||"3CF3019EA6883730AB34F0D5A8FACDB1CDB2A9EA")+'"><PARAM NAME="MakerCaption" VALUE="'+(window.NTKO_MakerCaption||epoint_local.epoint)+'"><PARAM NAME="MakerKey" VALUE="'+(window.NTKO_MakerKey||"39337AFCA7AFD1F882A3BF53CBE1E4AC804C65A6")+'"><span style="color: red;">'+this.ntkoLoadErrorText+".</span></object>",this._ntko=this._ntkoContent.firstChild,this._errorContent=""},_initEvents:function(){mini._BindEvents(function(){mini_onOne(this._picker,"click",this.__OnPickerClick,this)},this);var o=this,n=this._ntko;if(this._uploadBtn.on("click",function(){n.IsUploading?(o.stopUpload(),o._uploadBtn.setText(o.pauseText)):(o.beginUpload(),o._uploadBtn.setText(o.startText))}),this.auto&&this._uploadBtn.hide(),n.attachEvent)n.attachEvent("BeforeFileAdded",function(t,e,i){n.CancelLastCommand=!o._beforeFileQueued(t,e,i)}),n.attachEvent("OnLocalFileAdded",function(t,e,i){o._onFilesQueued(t,e,i)}),n.attachEvent("OnFileProcessStatusChange",function(t,e,i,n){o._onUploadProgress(t,e,i,n)}),n.attachEvent("OnOneFileUploadFinished",function(t,e){o._onFileFinished(t,e)}),n.attachEvent("OnSaveToURLFinished",function(t){o._onUploadFinished(t)});else{var t=this.uid+"-ntko",e='var lfu = mini.getbyUID("'+this.uid+'");',i=e+"lfu._ntko.CancelLastCommand = !lfu._beforeFileQueued(filePath, fileName, fileSize);";s({target:t,event:"BeforeFileAdded(filePath, fileName, fileSize)",text:i}),s({target:t,event:"OnLocalFileAdded(filePath, fileName, fileSize)",text:i=e+"lfu._onFilesQueued(filePath, fileName, fileSize);"}),s({target:t,event:"OnFileProcessStatusChange(file, statusText, isPersent, persentNumber)",text:i=e+"lfu._onUploadProgress(file, statusText, isPersent, persentNumber);"}),s({target:t,event:"OnOneFileUploadFinished(file, isAllUploaded)",text:i=e+"lfu._onFileFinished(file, isAllUploaded);"}),s({target:t,event:"OnSaveToURLFinished(isAllSuccess)",text:i=e+"lfu._onUploadFinished(isAllSuccess);"})}function s(t){var e=document.createElement("script");e.language="JScript",e.setAttribute("for",t.target),e.event=t.event,e.text=t.text,document.body.appendChild(e)}this.showDefaultUI&&jQuery(this._fileList).on("click",".mini-uploader-remove",function(){var t=jQuery(this),n=t.attr("fileId"),s=t.attr("fileGuid");mini.confirm(o.deleteFileConfirmText,o.systemTipText,function(t){if("ok"==t&&(n!=s?o.removeFile(n):(jQuery(o._fileList).find("#"+n).remove(),o.serverFileNum--),s)){var e={commonDto:mini.encode(o.getCommonData())};this.cmdParams&&(e.cmdParams=this.cmdParams),e[o.id+"_action"]="delete",e[o.id+"_attachGuid"]=s;var i={sender:o,eventType:"beforefileremove",fileGuid:s,data:e};o.fire("beforefileremove",i),$.ajax({url:o.uploadUrl,data:i.data,dataType:"json",type:"post"}).done(function(t){t=mini.getSecondRequestData(t),o.fire("fileremovesuccess",{sender:o,eventType:"fileremovesuccess",fileGuid:s,data:t})})}})})},_afterApply:function(){this._ntko.StatusCode===undefined&&(this._buttons.innerHTML='<a class="noflash" title="'+this.ntkoInitErrorTitle+'">'+this.ntkoInitErrorText+"</a>",mini.showPageWarning({html:this.ntkoErrorCheckBrowserText}))},__OnPickerClick:function(){var t=this._ntko;try{t.AddLocalFile("",this.multiSelect,this._ntkoFileType),this.auto&&this.beginUpload()}catch(e){10==t.StatusCode?window.console&&console.log("用户取消操作"):window.console&&console.error("error："+e.number+":"+e.description)}},_blocksFileField:"NTKO_LF_BLOCK",beginUpload:function(){if(this._onStartUpload()){var t=this._ntko;t.QueryFileStatusURL=this._ntkoQueryFileStatusURL,t.FinishedUploadURL=this._ntkoFinishedUploadURL+this.getReAttackParm(this._ntkoFinishedUploadURL);var e={data:{}};this._onUploadBeforeSend(e),t.BeginSaveToURL(this.uploadUrl+"&query=upload",this._blocksFileField,function n(t){var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")}(e.data))}},stopUpload:function(){this._ntko.StopSaveToURL(),this._onStopUpload()},reset:function(){this._ntko.Reset(),this._onReset()},removeFile:function(t){var e,i=this._ntko,n=this._getFileIndex(t);if(-1<n&&(e=i.GetFile(n),i.RemoveFile(n),this._fileIds[e.FilePath]=undefined,delete this._fileIds[e.FilePath],this._onFileDequeued(e)),this.showDefaultUI){var s=jQuery(this._fileList).find("#"+t);s.length&&s.remove()}},clearFile:function(){for(var t in this._fileIds)this.removeFile(this._fileIds[t].id);this.showDefaultUI&&jQuery(this._fileList).empty()},_getFileIndex:function(t){var e=0;for(var i in this._fileIds){if(this._fileIds[i].id===t)return e;e++}return-1},_ntkoFileType:"*.*",setLimitType:function(t){this.limitType=t.toLowerCase(),this._ntkoFileType=this._getNtkoFileType(t)},getLimitType:function(){return this.limitType},setAuto:function(t){this.auto!=t&&((this.auto=t)?this._uploadBtn.hide():this._uploadBtn.show())},getAuto:function(){return this.auto},_getNtkoFileType:function(t){if(!t)return"*.*";for(var e=[],i=t.split(","),n=0,s=i.length;n<s;n++)e.push("*."+i[n]);return e.join(";")},getFileList:function(){return this._fileList},setFileNumLimit:function(t){t=parseInt(t)||0,1===(this.fileNumLimit=t)&&(this.multiSelect=!1)},getFileNumLimit:function(){return this.fileNumLimit},setUploadUrl:function(t){var e=window.location.search.substring(1),i="?";0<t.indexOf("?")&&(i="&"),t+=i+"type=ntko",e&&(t+="&"+e),this.needChunkLocal&&(t+="&needChunkLocal=1"),this.uploadUrl=t,this._ntkoQueryFileStatusURL=t+"&query=getStatus",this._ntkoFinishedUploadURL=t+"&query=finished"},getUploadUrl:function(){return this.uploadUrl},setFileSingleSizeLimit:function(t){this.fileSingleSizeLimit=t},getFileSingleSizeLimit:function(){return this.fileSingleSizeLimit},_validateFile:function(t){var e=this._ntko.FilesCount;return this.fileNumLimit&&e>=this.fileNumLimit-this.serverFileNum?(this._errorContent=String.format(this.numLimitErrorText,this.fileNumLimit),!1):this.fileSingleSizeLimit&&t.size>1024*this.fileSingleSizeLimit?(this._errorContent=String.format(this.sizeErrorText,this.fileSingleSizeLimit),!1):0===t.size?(this._errorContent=this.emptyFileErrorText,!1):!this.limitType||-1!=(","+this.limitType+",").indexOf(","+t.ext.toLowerCase()+",")||(this._errorContent=String.format(this.typeDeniedErrorText,this.limitType),!1)},_parseAttachFile:function(t){var e={path:t.FilePath,name:t.FileName,size:t.FileSize,md5:t.MD5ID};return e.ext=e.name.substr(e.name.lastIndexOf(".")+1),e.id=this._fileIds[e.path].id,e},_beforeFileQueued:function(t,e,i){var n={path:t,name:e,size:i,ext:e.substr(e.lastIndexOf(".")+1)};if(this._events.beforefilequeued){var s={source:this,sender:this,type:"beforefilequeued",file:n,cancel:!1};if(this.fire("beforefilequeued",s),s.cancel)return!1}return!!this._validateFile(n)||(this._errorContent&&mini.alert(this._errorContent),this._errorContent="",!1)},_fileIds:{},_onFilesQueued:function(t,e,i){var n={path:t,name:e,size:i,ext:e.substr(e.lastIndexOf(".")+1),id:mini.UUID()};if(this._fileIds[n.path]={id:n.id},this.showDefaultUI){var s=this._generateFileList({id:n.id,name:n.name,size:n.size,date:mini.formatDate(new Date,"yyyy-MM-dd")});jQuery(this._fileList).append(s)}this._events.filesqueued&&this.fire("filesqueued",{files:[n]})},_generateFileList:function(t){t.fileGuid=t.fileGuid||"",t.downloadUrl?t.downloadUrl=_rootPath+"/"+(-1!=t.downloadUrl.indexOf("attachGuid")?t.downloadUrl:t.downloadUrl+(-1!=t.downloadUrl.indexOf("?")?"&":"?")+"attachGuid="+t.fileGuid):t.downloadUrl="javascript:void(0)";var e=[];return e.push('<div id="'+t.id+'" class="mini-uploader-item'+(t.success?" success":"")+'">'),e.push('<a href="'+t.downloadUrl+'" class="mini-uploader-info">'+t.name+"</a>"),e.push('<span class="mini-uploader-size">('+this._getSize(t.size)+(t.date?"/"+t.date:"")+")</span>"),e.push('<span class="mini-uploader-error"></span>'),e.push('<span class="mini-uploader-progressbar" style="display: none;"><span class="progress-text">0%</span><div class="progress-body"></div></span>'),t.hideDelete||e.push('<a href="javascript:void(0)" class="mini-uploader-remove" fileId="'+t.id+'" fileGuid="'+t.fileGuid+'">'+epoint_local.delete_text+"</a>"),e.push("</div>"),e.join("")},_needPostData:!0,_onFileDequeued:function(t){this.fire("filedequeued",{file:t})},_onUploadBeforeSend:function(t){(t=t.data).commonDto=mini.encode(this.getCommonData()),this.cmdParams&&(t.cmdParams=this.cmdParams);for(var e,i=window.location.search.substring(1).split("&"),n=0,s=i.length;n<s;n++)(e=i[n].split("="))[0]&&(t[e[0]]=e[1]);var o={sender:this,data:t};this.fire("uploadbeforesend",o),t.replaynoticeid=o.data.replaynoticeid,t.reqtime=o.data.reqtime,t.paramsign=o.data.paramsign,t.dtosign=o.data.dtosign},_onUploadProgress:function(t,e,i,n){t=this._parseAttachFile(t);var s,o=!1,r=mini.byId(t.id),a=jQuery(".mini-uploader-progressbar",r),l=jQuery(".progress-text",a),h=jQuery(".progress-body",a);i?o||0!==e.indexOf("正在分析文件")?(this.showDefaultUI&&(s=Math.round(n)+"%",l.text(this.uploadedText+":"+s),h.width(s)),this.fire("uploadprogress",{file:t,percentage:n/100})):(this.showDefaultUI&&(s=Math.round(n)+"%",l.text(this.analyzingText),h.width(s)),this.fire("md5progress",{file:t,percentage:n/100}),100==n&&(o=!0)):this._fileIds[t.path].started||(this.showDefaultUI&&a.show(),this.fire("uploadstart",{file:t}),this._fileIds[t.path].started=!0)},_onFileFinished:function(t,e){t=this._parseAttachFile(t),e?this._onUploadSuccess(t):this._onUploadError(t,this._parseNtkoRet(this._ntko.LastFinishedUploadRetMes)),this._onUploadComplete(t)},_onUploadSuccess:function(t){var e=this._parseNtkoRet(this._ntko.LastFinishedUploadRetMes);if(e.uploadFailed)return mini.alert(e.failedMsg||this.uploadFailedText),void this.removeFile(t.id);if(this.fire("uploadaccept",{ret:e,object:{file:t}}),this.showDefaultUI){var i=jQuery("#"+t.id),n=e.attachGuid,s=e.downloadUrl;s&&(s=decodeURIComponent(s),s=_rootPath+"/"+(-1!=s.indexOf("attachGuid")?s:s+(-1!=s.indexOf("?")?"&":"?")+"attachGuid="+n)),i.addClass("success"),i.find(".mini-uploader-error").html("").hide(),n&&(i.find(".mini-uploader-remove").attr("fileGuid",n),s&&i.find(".mini-uploader-info").attr("href",s))}this.fire("uploadsuccess",{file:t})},_onUploadError:function(t,e){this.showDefaultUI&&jQuery("#"+t.id).find(".mini-uploader-error").html(this.uploadErrorText).show(),this.fire("uploaderror",{file:t,reason:e})},_onUploadComplete:function(t){this.showDefaultUI&&jQuery("#"+t.id).find(".mini-uploader-progressbar").fadeOut(),this.fire("uploadcomplete",{file:t})},_getSize:function(t){return 1048576<(t=parseInt(t))?(t/1048576).toFixed(2)+"M":(t/1024).toFixed(2)+"K"},getCommonData:function(){return this.controlData||(this.controlData={id:this.id,type:"largeFileUploader",mapClass:this.mapClass,action:this.action,showDefaultUI:this.showDefaultUI,needChunkLocal:this.needChunkLocal,dataOptions:this["data-options"]}),[this.controlData,this.getViewdata()]},getViewdata:function(){var t,e,i=mini.get("_common_hidden_viewdata");return this.viewData||(this.viewData={id:"_common_hidden_viewdata",type:"hidden",value:""}),i&&((t=mini.decode(i.getValue())).pageUrl&&(t.pageUrl=t.pageUrl.substr(0,t.pageUrl.indexOf("?"))),t.cmdParams&&((e=mini.decode(t.cmdParams)).pageUrl&&(e.pageUrl=e.pageUrl.substr(0,e.pageUrl.indexOf("?"))),t.cmdParams=mini.encode(e)),this.viewData.value=mini.encode(t)),this.viewData},getReAttackParm:function(t){var e="",i=mini.decode(this.getViewdata().value);if(e+=i.replayAttack?"&replayAttack="+i.replayAttack:"",e+=i.pageurl?"&pageurl="+i.pageurl:"",window.Util&&Util.addReplayAttackData){var n=Util.addReplayAttackData({},t+e);e+=n.replaynoticeid?"&replaynoticeid="+n.replaynoticeid:"",e+=n.reqtime?"&reqtime="+n.reqtime:"",e+=n.paramsign?"&paramsign="+n.paramsign:"",e+=n.dtosign?"&dtosign="+n.dtosign:""}return e},setShowDefaultUI:function(t){this.showDefaultUI=t,this.controlData&&(this.controlData.showDefaultUI=t)},setPostData:function(t){this.postData=t},getPostData:function(){return this.postData},_onStartUpload:function(){if(this.postData&&this._needPostData){var e=this,t={commonDto:mini.encode(this.getCommonData())};return this.cmdParams&&(t.cmdParams=this.cmdParams),t[this.id+"_incache"]=!0,t[this.id+"_postData"]=this.postData,t[this.id+"_fileCount"]=this._uploader.getFiles().length,t[this.id+"_fileLoadedCount"]=this._uploader.getStats().successNum,Util.ajax({url:this.uploadUrl,data:t,dataType:"json"}).done(function(t){e._needPostData=!1,e.beginUpload()}),!1}if(this._events.startupload){var i={source:this,sender:this,type:"startupload",cancel:!1};if(this.fire("startupload",i),i.cancel)return!1}return!0},_onStopUpload:function(){this.fire("stopupload")},_onUploadFinished:function(t){this._uploadBtn.setText(this.startText),this._needPostData=!0,this.fire("uploadfinished",{isAllSuccess:t})},_onReset:function(){this._fileIds={},this.fire("reset")},_parseNtkoRet:function(t){var o={},e=t.split("&");return $.each(e,function(t,e){var i=e.split("="),n=i[0],s=i[1];"undefined"==typeof o[n]?o[n]=s:"string"==typeof o[n]?o[n]=[o[n],s]:o[n].push(s)}),o},setAction:function(t){this.action=t,this.controlData={id:this.id,type:"largeFileUploader",mapClass:this.mapClass,action:this.action,showDefaultUI:this.showDefaultUI,dataOptions:this["data-options"]};var e=t.split(".");if(!(e.length<2)){var i=Util.getRightUrl("/rest/"+e[0]+"/"+e[1]+"?isCommondto=true"),n=/\([\w\W]*\)/,s=i.match(n);s&&(i=i.replace(n,""),this.cmdParams=s[0].replace("(","[").replace(")","]"));var o=Util.getUrlParams();delete o["@epoint_user_loginid"],i=Util.addUrlParams(i,o,"ignore",!1),this.setUploadUrl(i)}},setData:function(t){if(t=t.files||t,this.serverFileNum=t.length,this.showDefaultUI){for(var e="",i=[],n=0,s=t.length;n<s;n++,e=[])e=this._generateFileList({id:t[n].attachGuid,name:t[n].attachFileName,size:t[n].attachLength,date:t[n].uploadDateTime,fileGuid:t[n].attachGuid,downloadUrl:t[n].downloadUrl,hideDelete:t[n].readonly,success:!0}),i.push(e);jQuery(this._fileList).html(i.join(""))}this.fire("load",{sender:this,eventType:"load",data:t})},getAttrs:function(t){var e=mini.LargeFileUploader.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["uploadUrl","limitType","postData","pickerText","onbeforefilequeued","onfilesqueued","onreset","onstartupload","onstopupload","onuploadfinished","onuploadstart","onuploadbeforesend","onuploadaccept","onuploadprogress","onmd5progress","onuploadsuccess","onuploaderror","onuploadcomplete","onfileremovesuccess","onload"]),mini._ParseBool(t,e,["auto","multiSelect","showDefaultUI","needChunkLocal"]),mini._ParseInt(t,e,["fileNumLimit","fileSingleSizeLimit"]),e}}),mini.regClass(mini.LargeFileUploader,"largefileuploader"),mini.MonacoEditor=function(){mini.MonacoEditor.superclass.constructor.call(this)},mini.MonacoEditor.MONACO_PATH=mini.externalSrc+"monaco-editor/vs",mini.MonacoEditor.loadMonaco=function(){if(window.__MONACO_PROMISE__)return window.__MONACO_PROMISE__;var n='        require.config({            paths: {                "vs": "${MONACO_PATH}"            },            "vs/nls" : {                availableLanguages: {"*": "zh-cn"}            }        });        require(["vs/editor/editor.main"], function () {          window.__monaco_editor__ = monaco;        });'.replace(/\${MONACO_PATH}/,mini.MonacoEditor.MONACO_PATH),t=new Promise(function(t,e){var i=document.createElement("script");i.id="monaco-editor-loader",i.src=mini.MonacoEditor.MONACO_PATH+"/loader.js",i.onload=function(){i.onload=null,t("loader")},i.onerror=function(){i.onerror=null,e("monaco-editor资源加载失败")},document.body.appendChild(i)}).then(function(){return new Promise(function(t,e){var i=document.createElement("script");i.text=n,i.onerror=function(){i.onerror=null,e("monaco-editor资源加载失败")},document.body.appendChild(i),t("editor")})}).then(function(){return new Promise(function(t,e){var i,n=0;!function s(){window.__monaco_editor__?(clearTimeout(i),t(window.__monaco_editor__)):n++<1e3?setTimeout(s,30):e("monaco-editor资源加载失败")}()})});return window.__MONACO_PROMISE__=t},mini.extend(mini.MonacoEditor,mini.Control,{uiCls:"mini-monacoeditor",minHeight:200,width:"",height:"",_clearBorder:!1,defaultOptions:{lineHeight:20,autoIndent:!0,formatOnPaste:!0,lineNumbers:"on",minimap:{enabled:!0},tabCompletion:"on",quickSuggestions:{comments:!0},snippetSuggestions:"top",accessibilitySupport:"on",suggest:{},readOnly:!0},options:{},_currentOptions:{},language:"",theme:"vs-dark",loadJsSuggest:!0,_initEditor:function(){var i=this;mini.MonacoEditor.loadMonaco().then(function(t){mini.MonacoEditor.monaco||(mini.MonacoEditor.monaco=t);var e=$.extend({},i.defaultOptions,i.options);e.readOnly=i.readOnly,e.value=i.value,e.theme=i.theme,e.language=i.language,i._currentOptions=e,i._loadJsTypes(),i.fire("beforeCreate",{monaco:t}),i._editor=t.editor.create(i.el,i._currentOptions),i.fire("created",{monaco:t,editor:i._editor})})["catch"](function(t){console.error(t)})},_create:function(){this.el=document.createElement("div")},_init:function(){},_initEvent:function(){},_onDidChangeModelContent:function(t){this._events.valuechanged&&this.fire("valuechanged",{})},_loadJsTypes:function(){"javascript"===this.language&&(mini.MonacoEditor.__JsSuggestLoad||(mini.MonacoEditor.__JsSuggestLoad=!0,["jquery.d.ts","miniui.d.ts","epoint.d.ts"].map(function(e){$.ajax({url:mini.MonacoEditor.MONACO_PATH+"/../types/"+e,dataType:"text",success:function(t){mini.MonacoEditor.monaco.languages.typescript.javascriptDefaults.addExtraLib(t,e)}})})))},doLayout:function(){this._editor&&this._editor.layout()},_afterApply:function(){mini.MonacoEditor.superclass._afterApply.apply(this,arguments),this._initEditor()},setEnabled:function(){mini.MonacoEditor.superclass.setEnabled.apply(this,arguments),this._editor&&this._editor.updateOptions({readOnly:this.readOnly})},setReadOnly:function(t){mini.MonacoEditor.superclass.setReadOnly.apply(this,arguments),this.readOnly=!!t,this._editor&&this._editor.updateOptions({readOnly:this.readOnly})},setTheme:function(t){this.theme=t,this._editor&&this._editor.updateOptions({theme:this.theme})},getTheme:function(){return this.theme},getFormValue:function(){return this.getValue()},getValue:function(){return this._editor&&(this.value=this._editor.getValue()),this.value},setValue:function(t){this.value=t,this._editor&&this._editor.setValue(this.value)},insertText:function(t,e){var i=this._editor.getPosition();if(this._editor.executeEdits("",[{range:{startLineNumber:i.lineNumber,startColumn:i.column,endLineNumber:i.lineNumber,endColumn:i.column},text:t}]),e){var n=this.editor.getSelection();n.selectionStartColumn=n.startColumn=n.endColumn,n.selectionStartLineNumber=n.startLineNumber=n.endLineNumber,this._editor.setSelection(n)}this._editor.focus()},format:function(){if(this._editor)try{this._editor._actions["editor.action.formatDocument"].run()}catch(t){console.error(t)}},getAttrs:function(t){var e=mini.MonacoEditor.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["options","language","theme","onvaluechanged","onbeforeCreate","oncreated"]),mini._ParseInt(t,e,["width","height"]),mini._ParseBool(t,e,["loadJsSuggest"]),e}}),mini.regClass(mini.MonacoEditor,"monacoeditor"),mini.MonthRangePicker=function(){mini.MonthRangePicker.superclass.constructor.call(this)},mini.extend(mini.MonthRangePicker,mini.DateRangePicker,{uiCls:"mini-monthrangepicker",format:"yyyy-MM",delimiter:"~",maxDate:"9999-12",minDate:"1753-01",showClearButton:!0,showQuickSelect:!1,footTipText:epoint_local.MonthRangePicker.footTipText,quickSelectText:jQuery.extend({},epoint_local.MonthRangePicker.quickSelectText),customQuickSelect:[],_beforeLaydateInit:function(t){t.type="month",t.range=this.delimiter},_onLaydateBeforeRender:function(){this._setSelectedItems(this.value)},_onLaydateRender:function(){this._updateOkBtn()},_onLaydateViewChanged:function(t,e,i,n,s){var o=0<n?0:4;"month"===t?($(e[o]).hide(),this._adjustMonthView(i,s[0])):$(e[o]).show()},_onLaydateMonthYearItemClick:function(t,e,i){if("year"!==t){var n=e.year+"-"+(e.month+1),s=0===i?e.year:e.year-1;this._pushSelectedItems(n),this._adjustMonthView(this.laydate._laydate.elemCont[0],s),this._adjustMonthView(this.laydate._laydate.elemCont[1],s+1),this._updateOkBtn()}},_adjustMonthView:function(t,i){var n,s,o,e=$(t).find(".laydate-month-list > li").removeClass("layui-this laydate-selected"),r=this;1===this._selectedItems.length?(n=mini.parseDate(this._selectedItems[0])).getFullYear()===i&&e.filter(function(t,e){return parseInt($(e).attr("lay-ym"),10)===n.getMonth()}).addClass("layui-this"):2===this._selectedItems.length&&(n=this._analyzeSelectedItems(),e.each(function(t,e){o=$(e),s=parseInt(o.attr("lay-ym"),10),n.startDate.getFullYear()===i&&n.startDate.getMonth()===s||n.endDate.getFullYear()===i&&n.endDate.getMonth()===s?o.addClass("layui-this"):r._isWithin(n.startDate,n.endDate,new Date(i,s))&&o.addClass("laydate-selected")}))},_updateOkBtn:function(){if(this.laydate){var t=$(this.laydate._laydate.footer).find(".laydate-btns-confirm");2===this._selectedItems.length?t.removeClass("laydate-disabled"):t.addClass("laydate-disabled")}},_onLaydateDone:function(t,e,i){var n=this._analyzeSelectedItems();t&&n?this.setValue({startDate:this._formatDate({year:n.startDate.getFullYear(),month:n.startDate.getMonth()+1}),endDate:this._formatDate({year:n.endDate.getFullYear(),month:n.endDate.getMonth()+1})}):this.setValue(""),this.value.startDate==this._oldValue.startDate&&this.value.endDate==this._oldValue.endDate||(this.fire("valuechanged",{value:this.value,oldValue:this._oldValue}),this._oldValue=this.value)},_selectedItems:[],_setSelectedItems:function(t){t&&t.startDate&&t.endDate?this._selectedItems=[t.startDate,t.endDate]:this._selectedItems=[]},_pushSelectedItems:function(t){2<=this._selectedItems.length?this._selectedItems=[t]:this._selectedItems.push(t)},_analyzeSelectedItems:function(){if(2===this._selectedItems.length){var t=mini.parseDate(this._selectedItems[0]),e=mini.parseDate(this._selectedItems[1]);return t.getFullYear()<e.getFullYear()?{startDate:t,endDate:e}:t.getFullYear()>e.getFullYear()?{startDate:e,endDate:t}:t.getMonth()<e.getMonth()?{startDate:t,endDate:e}:{startDate:e,endDate:t}}},_isWithin:function(t,e,i){return!!(t&&e&&i)&&(!(t.getFullYear()>i.getFullYear())&&(!(e.getFullYear()<i.getFullYear())&&(!(t.getFullYear()===i.getFullYear()&&t.getMonth()>=i.getMonth())&&!(e.getFullYear()===i.getFullYear()&&e.getMonth()<=i.getMonth()))))},setValue:function(t){mini.MonthRangePicker.superclass.setValue.call(this,t),this._setSelectedItems(this.value)},_mergeQuickSelect:function(){this.quickSelect||this._initQuickSelect();var t,e,i,n,s=this.quickSelect.slice(0),o=[];for(t=0,e=s.length;t<e;t++)o.push(s[t].text);for(t=0,e=this.customQuickSelect.length;t<e;t++)i=this.customQuickSelect[t],-1<(n=o.indexOf(i.text))?s[n]=i:s.push(i);return s},_initQuickSelect:function(){this.quickSelect=[{text:this.quickSelectText.thisMonth,start:function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth())},end:function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth())}},{text:this.quickSelectText.thisQuarter,start:function(){var t=new Date,e=t.getMonth(),i=0;return 2<e&&(i=5<e?8<e?9:6:3),new Date(t.getFullYear(),i)},end:function(){var t=new Date,e=t.getMonth(),i=2;return 2<e&&(i=5<e?8<e?11:8:5),new Date(t.getFullYear(),i)}},{text:this.quickSelectText.thisYear,start:function(){var t=new Date;return new Date(t.getFullYear(),0)},end:function(){var t=new Date;return new Date(t.getFullYear(),11)}}]},_renderQuickSelect:function(){var t,e,i=this.laydate._laydate.elem,n=0,s=['<div class="daterange-quick-select">'],o=this._mergeQuickSelect(),r=this;for(s.push('<ul class="quick-select-list">'),t=o.length;n<t;n++)"string"==typeof(e=o[n]).start&&(e.start=mini._getFunctoin(e.start)),"string"==typeof e.end&&(e.end=mini._getFunctoin(e.end)),s.push('<li class="quick-select-item" data-start="'+mini.formatDate(e.start(),this.format)+'" data-end="'+mini.formatDate(e.end(),this.format)+'">'+e.text+"</li>");s.push("</ul>"),s.push("</div>"),mini.addClass(i,"show-quick-select"),mini.append(i,s.join("")),$(i).on("click",".quick-select-item",function(){var t=$(this),e=t.data("start"),i=t.data("end");r.setValue({startDate:e,endDate:i}),r.value.startDate==r._oldValue.startDate&&r.value.endDate==r._oldValue.endDate||(r.fire("valuechanged",{value:r.value,oldValue:r._oldValue}),r._oldValue=r.value),r._tryValidate(),$("body").trigger("click")})},getAttrs:function(t){return mini.MonthRangePicker.superclass.getAttrs.call(this,t)}}),mini.regClass(mini.MonthRangePicker,"monthrangepicker");var __nextTick=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout,o_b,v_b,q_b;function _getNoticeContainer(t){t=t||"topright";var e=mini.NoticeContainer.cache[t];return e||((e=new mini.NoticeContainer).setPosition(t),e.render(document.body),e.on("childRemove",function(){0===jQuery(e.el).children().length&&(delete mini.NoticeContainer.cache[e.position],e.destroy())}),mini.NoticeContainer.cache[t]=e),e.el.style.zIndex=mini.getMaxZIndex(),e}function p_b(t,e){return""!==t?t+e.slice(0,1).toUpperCase()+e.slice(1):e}function r_b(){return q_b?document[p_b(o_b,"hidden")]:undefined}function s_b(){return q_b?document[p_b(o_b,"visibilityState")]:undefined}mini.Notice=function(){mini.Notice.superclass.constructor.apply(this,arguments)},mini.Notice.buttonText=jQuery.extend({},epoint_local.Notice.buttonText),mini.Notice.STATE_STATE_MAP={success:"icon-success",warning:"icon-warn",danger:"icon-error",info:"icon-info"},mini.extend(mini.Notice,mini.Control,{uiCls:"mini-notice",_clearBorder:!1,_transitionShowCls:"mini-notice-show-tran",_transitionHideCls:"mini-notice-hide-tran",_iconCls:"mini-notice-icon",_closeCls:"mini-notice-close",_buttonsElCls:"mini-notice-buttons",_showButtonCls:"mini-notice-show-buttons",_container:null,title:"",content:"",icon:"",state:"",timeout:5e3,showClose:!0,buttons:[],_create:function(){this.buttons=[],this.el=document.createElement("div"),this._headerEl=document.createElement("div"),this._headerEl.className="mini-notice-header",this._titleEl=document.createElement("div"),this._titleEl.className="mini-notice-title",this._titleEl.innerHTML=this.title,this._bodyEl=document.createElement("div"),this._bodyEl.className="mini-notice-body",this._contentEl=document.createElement("div"),this._contentEl.className="mini-notice-content",this._contentEl.innerHTML=this.content,this.content?this._contentEl.style.display="":this._contentEl.style.display="none",this._headerEl.appendChild(this._titleEl),this._bodyEl.appendChild(this._contentEl),this.el.appendChild(this._headerEl),this.el.appendChild(this._bodyEl),this.icon&&this.setIcon(this.icon),this.showClose&&this.setShowClose(this.showClose)},_initEvents:function(){},getTitle:function(){return this.title},setTitle:function(t){this._titleEl.innerHTML=t,16<String(t).length?this._titleEl.title=t:this._titleEl.title=""},getContent:function(){return this.content},setContent:function(t){this.content=this._contentEl.innerHTML=t,this._contentEl.style.display=t?"":"none"},getShowClose:function(){return this.showClose},setShowClose:function(t){this.showClose=!!t;var e=this;jQuery(this._headerEl).find("."+this._closeCls).remove(),this._closeEl=null,this.showClose&&(this._closeEl=document.createElement("span"),this._closeEl.className=this._closeCls+" mini-icon icon-remove",this._headerEl.appendChild(this._closeEl),this._closeEl.onclick=function(){e.close()})},getState:function(){return this.state},setState:function(t){if(this.state=t,this.el.setAttribute("data-state",this.state),!this.icon){var e=mini.Notice.STATE_STATE_MAP[this.state];e&&this.setIcon(e)}},getIcon:function(){return this.icon},setIcon:function(t){(this.icon=t)?(this._iconEl=document.createElement("span"),this._iconEl.className=this._iconCls+" mini-icon "+t,jQuery(this._headerEl).find("."+this._iconCls).remove(),jQuery(this._headerEl).prepend(this._iconEl)):(jQuery(this._headerEl).find("."+this._iconCls).remove(),this._iconEl=null)},getButtons:function(){return this.buttons},setButtons:function(t){(Array.isArray(t)||(t=mini.decode(t),Array.isArray(t)))&&(t.length?this.addCls(this._showButtonCls):this.removeCls(this._showButtonCls),this._createButtons(t))},_createButtons:function(t){if(this.buttons&&this.buttons.length&&(this.buttons.forEach(function(t){t.destroy()}),this._buttonsEl&&this._buttonsEl.parentNode.removeChild(this._buttonsEl),this.buttons=[]),!t||!t.length)return this._buttonsEl&&this._buttonsEl.parentNode.removeChild(this._buttonsEl),void(this.buttons=[]);var n=this,s=this._buttonsEl=document.createElement("div");this._buttonsEl.className=this._buttonsElCls,t.forEach(function(t){var e=new mini.Button,i=mini.Notice.buttonText[t];e.setText(i),e.action=t,e.render(s),e.on("click",function(t){var e=t.sender,i=n.callback;"function"==typeof i&&!1===i(e.action)||n._close()}),n.buttons.push(e)}),this.el.appendChild(s),this.buttons[0].setState("primary")},_bindTransitionEnd:function(){var e=this;return clearTimeout(this._transitionEndTimer),function(t){return e._transitionEndTimer=setTimeout(t,300)}}(),show:function(){this.removeCls(this._transitionHideCls),this.addCls(this._transitionShowCls);var e=this;clearTimeout(this._hideTimer),0<this.timeout?this._bindTransitionEnd(function(t){e.removeCls(e._transitionHideCls),e.removeCls(e._transitionShowCls),e._hideTimer=setTimeout(function(){e.hide()},e.timeout)}):this._bindTransitionEnd(function(){e.removeCls(e._transitionHideCls),e.removeCls(e._transitionShowCls)}),__nextTick(function(){e.removeCls(e.uiCls+"-hide"),e.addCls(e.uiCls+"-show")})},hide:function(){return this.close()},close:function(){var t={cancel:!1};this.fire("beforeClose",t),t.cancel||"function"==typeof this.callback&&!1===this.callback("close")||this._close()},_close:function(){this.removeCls(this._transitionShowCls),this.addCls(this._transitionHideCls);var t=this;this._bindTransitionEnd(function(){t.destroy()}),__nextTick(function(){t.removeCls(t.uiCls+"-show"),t.addCls(t.uiCls+"-hide")})},getAttrs:function(t){var e=mini.Notice.superclass.getAttrs.call(this,t);return mini._parseInt(t,e,["timeout"]),mini._ParseString(t,e,["icon","title","content","buttons","name","state","onbeforeclose"]),mini._ParseBool(t,e,["showClose"]),e}}),mini.regClass(mini.Notice,"notice"),mini.NoticeContainer=function(){mini.NoticeContainer.superclass.constructor.apply(this,arguments)},mini.NoticeContainer.POSITION_ARR=["topleft","topright","bottomleft","bottomright"],mini.NoticeContainer.cache={},mini.extend(mini.NoticeContainer,mini.Control,{uiCls:"mini-notice-container",position:"toptight",_create:function(){var t=document.createElement("div");t.className="mini-notice-container",this.el=t},_initEvents:function(){},getPosition:function(){return this.position},setPosition:function(t){this.position!==t&&-1!==mini.NoticeContainer.POSITION_ARR.indexOf(t)&&(delete mini.NoticeContainer.cache[this.position],this.position=t,(mini.NoticeContainer.cache[this.position]=this).doUpdate())},doUpdate:function(){this.el.setAttribute("data-position",this.position)},getAttrs:function(t){var e=mini.Notice.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["position"]),e}}),mini.regClass(mini.NoticeContainer,"notice-container"),mini.Notice.cache={},mini.Notice.show=function(t){var e,i=_getNoticeContainer(t.position),n=!!t.position&&/bottom/i.test(t.position);return t.name&&(e=mini.getByName(t.name,i)),e?e.set(t):((e=new mini.Notice).set(t),e.on("destroy",function(t){var e=t.sender,i=e._container;i&&i.fire("childRemove"),delete mini.Notice.cache[e.uid]}),(mini.Notice.cache[e.uid]=e)._container=i,e.render(i.el,n?"prepend":"append"),e.addCls(e.uiCls+"-hide")),t.state&&t.icon&&e.setIcon(t.icon),e.show(),e.uid},mini.Notice.hide=function(t){if(t){var e=mini.getByUid(t);e&&e.close()}else for(var i in mini.Notice.cache)if(Object.prototype.hasOwnProperty.call(mini.Notice.cache,i)){var n=mini.Notice.cache[i];n&&n.close()}},mini.Output=function(){mini.Output.superclass.constructor.apply(this,arguments)},mini.extend(mini.Output,mini.Control,{url:"",async:!1,escape:!1,autoLoad:!1,uiCls:"mini-output",_create:function(){this.el=document.createElement("div"),this.el.className="mini-output"},_initEvents:function(){},doLayout:function(){if(this.canLayout()){var t=this.el.childNodes;if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];mini.layout(n)}}},doUpdate:function(){var t=jQuery.ajax({url:this.url,async:this.async}),e=this;t.done(function(t){e.setValue(t)})},setUrl:function(t){this.url=t,this.autoLoad&&this.doUpdate()},getUrl:function(){return this.url},setAutoLoad:function(t){this.autoLoad=!!t},getAutoLoad:function(){return this.autoLoad},setEscape:function(t){this.escape=!!t},getEscape:function(){return this.escape},setAsync:function(t){this.async=t},getAsync:function(){return this.async},setValue:function(t){var e={value:t};this.fire("valuechanged",e),null!==(t=e.value)&&t!==undefined||(t=""),this.escape&&(t=mini.htmlEncode(t)),mini.innerHTML(this.el,t),mini.parse(this.el),this.doLayout()},getAttrs:function(t){var e=mini.Output.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","onvaluechanged"]),mini._ParseBool(t,e,["escape","async","autoLoad"]),e}}),mini.regClass(mini.Output,"output"),mini.OutputText=function(){mini.OutputText.superclass.constructor.apply(this,arguments),this._init()},mini.extend(mini.OutputText,mini.Control,{maxWidth:"",escape:!1,showTitle:!0,numFormat:"",numToChinese:!1,uiCls:"mini-outputtext",set:function(t){if("string"==typeof t)return this;var e=t.maxWidth;delete t.maxWidth;var i=t.escape;delete t.escape;var n=t.showTitle;delete t.showTitle;var s=t.numFormat;delete t.numFormat;var o=t.numToChinese;return delete t.numToChinese,e&&this.setMaxWidth(e),i&&(this.escape=i),mini.isNull(n)||this.setShowTitle(n),s&&(this.numFormat=s),o&&(this.numToChinese=o),mini.OutputText.superclass.set.call(this,t),this},_create:function(){this.el=document.createElement("span")},_init:function(){var t=this;mini.numeralUtil.initNumeral(function(){t.setValue(t.value)})},setValue:function(t){null!==t&&t!==undefined||(t=""),this.value=t,this._updateText(t)},_updateText:function(t){var e;this.numFormat?(e=parseFloat(t),mini.isNumber(e)&&window.numeral&&(t=numeral(e).format(this.numFormat))):!0===this.escape&&(t=(t=mini.htmlEncode(t)).replace(/\n/g,"<br/>")),this.el.innerHTML=t;var i=jQuery(this.el).text();this.showTitle&&mini.setAttr(this.el,"title",i)},setMaxWidth:function(t){(t=t.replace(/(^\s*)|(\s*$)/g,""))?("px"!=t.substr(t.length-2)&&(t+="px"),mini.addClass(this.el,"mini-text-ellipsis")):mini.removeClass(this.el,"mini-text-ellipsis"),this.el.style.maxWidth=t,this.maxWidth=t},getMaxWidth:function(){return this.maxWidth},getEscape:function(){return this.escape},getShowTitle:function(){return this.showTitle},setShowTitle:function(t){this.showTitle=t},setNumFormat:function(t){this.numFormat!==t&&(this.numFormat=t,this._updateText(this.value))},_onSyncControlValueChanged:function(t){var e=t.value;this.setValue(e)},setValueSyncId:function(t){if(this.valueSyncId!==t){var e=mini.get(t),i=mini.get(this.valueSyncId);i&&i.un("valuechanged",this._onSyncControlValueChanged),e&&(this.setValue(e.getValue()),e.on("valuechanged",this._onSyncControlValueChanged,this));var n=this;setTimeout(function(){window.epoint&&epoint.on&&epoint.on("afterInit",function(){n.setValue(e.getValue())})}),this.valueSyncId=t}},getAttrs:function(t){var e=mini.OutputText.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["maxWidth","numFormat","valueSyncId"]),mini._ParseBool(t,e,["escape","showTitle","numToChinese"]),e}}),mini.regClass(mini.OutputText,"outputtext"),mini.PagerTree=function(){mini.PagerTree.superclass.constructor.call(this),mini.addClass(this.el,"mini-tree"),mini.addClass(this.el,"mini-treegrid"),this._Expander=new mini._PagerTree_Expander(this),this._collapseNodes=[],this._expandNodes=[],this.on("beforeload",this.__OnBeforeLoad,this)},mini.extend(mini.PagerTree,mini.DataGrid,{uiCls:"mini-pagertree",treeColumn:"",idField:"id",parentField:"pid",showTreeIcon:!0,iconField:"iconCls",imgField:"img",imgPath:"",leafIconCls:"mini-tree-leaf",folderIconCls:"mini-tree-folder",_expandNodeCls:"mini-tree-expand",_collapseNodeCls:"mini-tree-collapse",_eciconCls:"mini-tree-node-ecicon",_OnCellMouseDown:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellmousedown",t)},_OnCellClick:function(t){mini.findParent(t.htmlEvent.target,this._eciconCls)||mini.findParent(t.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellclick",t)},_OnDrawCell:function(t,e,i,n){var s=mini.PagerTree.superclass._OnDrawCell.call(this,t,e,i,n);return this.treeColumn&&this.treeColumn==e.name&&(s.headerCls+=" mini-tree-treecolumn",s.cellCls+=" mini-tree-treecell",s.cellStyle+=";padding:0;",s.img=t[this.imgField],s.iconCls=this._getNodeIcon(t),s.showTreeIcon=this.showTreeIcon,s.nodeCls="",s.nodeStyle="",this._createTreeCell(s)),s},_createTreeCell:function(t){var e=[],i=t.record,n=this.isLeafNode(i),s=this.getNodeLevel(i),o=this.isExpandedNode(i),r=t.nodeCls;n||(r=o?this._expandNodeCls:this._collapseNodeCls),n||(r+=" mini-tree-parentNode"),e[e.length]='<div class="mini-tree-nodetitle '+r+'" style="'+t.nodeStyle+'">';for(var a=0;a<s-1;a++)e[e.length]='<span class="mini-tree-indent " ></span>';if(e[e.length]=n?'<span class="'+this._eciconCls+'" ></span>':'<i class="'+this._eciconCls+'"></i>',e[e.length]='<span class="mini-tree-nodeshow">',t.showTreeIcon)if(t.img){var l=this.imgPath+t.img;e[e.length]='<span class="mini-tree-icon" style="background-image:url('+l+');"></span>'}else e[e.length]='<span class="'+t.iconCls+' mini-tree-icon mini-icon"></span>';e[e.length]='<span class="mini-tree-nodetext">',e[e.length]=t.cellHtml,e[e.length]="</span>",e[e.length]="</span>",e[e.length]="</div>",t.cellHtml=e.join("")},__OnBeforeLoad:function(t){t.data.__ecconfig=this._getEcConfig()},_getEcConfig:function(){var t={collapseNodes:this._collapseNodes,expandNodes:this._expandNodes};return mini.encode(t)},load:function(){return this._collapseNodes=[],this._expandNodes=[],mini.PagerTree.superclass.load.apply(this,arguments)},expandNode:function(t){if((t=this._dataSource.getbyId(t))&&!this.isLeafNode(t)){var e=t[this.getIdField()];e&&(this._expandNodes.remove(e),this._collapseNodes.remove(e),this._expandNodes.add(e))}this.reload()},collapseNode:function(t){if((t=this._dataSource.getbyId(t))&&!this.isLeafNode(t)){var e=t[this.getIdField()];e&&(this._expandNodes.remove(e),this._collapseNodes.remove(e),this._collapseNodes.add(e))}this.reload()},toggleNode:function(t){(t=this._dataSource.getbyId(t))?this.isExpandedNode(t)?this.collapseNode(t):this.expandNode(t):this.reload()},isExpandedNode:function(t){return t.expanded===undefined||"true"==t.expanded.toString()},isLeafNode:function(t){return t.isLeaf&&"true"==t.isLeaf.toString()},getNodeLevel:function(t){return t._level},_getNodeIcon:function(t){var e=t[this.iconField];return e=e||(this.isLeafNode(t)?this.leafIconCls:this.folderIconCls)},getAttrs:function(t){var e=mini.PagerTree.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["treeColumn","iconField","imgField","imgPath","idField","parentField"]),mini._ParseBool(t,e,["showTreeIcon"]),e}}),mini.regClass(mini.PagerTree,"pagertree"),mini._PagerTree_Expander=function(t){this.owner=t,mini.on(t.el,"click",this.__OnClick,this)},mini._PagerTree_Expander.prototype={__OnClick:function(t){var e=this.owner,i=e.getRecordByEvent(t,!1);if(i){e.isLeafNode(i);if(mini.findParent(t.target,e._eciconCls)){if(e.isLeafNode(i))return;e.toggleNode(i)}}}},mini.Pagination=function(){mini.Pagination.superclass.constructor.apply(this,arguments)},mini.extend(mini.Pagination,mini.Control,{pageIndex:0,pageSize:10,totalCount:0,totalPage:0,showTotalCount:!0,showPageSize:!0,showPageInfo:!0,sizeList:[10,20,50,100],pageInfoText:epoint_local.Pagination.pageInfoText,jumpText:epoint_local.Pagination.jumpText,sizeText:epoint_local.Pagination.sizeText,set:function(t){if("string"==typeof t)return this;var e=t.pageIndex;delete t.pageIndex;var i=t.sizeList;return delete t.sizeList,mini.Pagination.superclass.set.call(this,t),mini.isNull(e)||this.setPageIndex(e),mini.isNull(i)||this.setSizeList(i),this},uiCls:"mini-pagination",_create:function(){this.el=document.createElement("div"),this._updatePager()},_updatePagerButtons:function(){var t,e=parseInt(this.pageSize,10),i=parseInt(this.pageIndex,10),n=parseInt(this.totalCount,10),s=Math.ceil(n/e),o=[];this.showTotalCount&&0<=n&&o.push('<div class="pagination-pagerinfo">'+String.format(this.pageInfoText,n)+"</div>"),o.push('<div class="pagination-buttons">');var r="",a="",l=0;0==i&&(r="disabled");var h='<a class="pagination-button pagination-prev mini-icon '+r+'" action="prev"></a>';if(o.push(h),s<8)for(l=0;l<s;l++)r="",i==l&&(r="pagination-current"),a='<a class="pagination-button '+r+'">'+(l+1)+"</a>",o.push(a);else if(i<6){for(l=0;l<6;l++)r="",i==l&&(r="pagination-current"),a='<a class="pagination-button '+r+'">'+(l+1)+"</a>",o.push(a);t=s<=l+4?s-1:l+4,o.push('<a class="pagination-button pagination-button-ellipsis" action="none" data-index="'+t+'" title="'+t+'">...</a>'),o.push('<a class="pagination-button">'+s+"</a>")}else if(s-6<i)for(o.push('<a class="pagination-button">1</a>'),o.push('<a class="pagination-button pagination-button-ellipsis" action="none" data-index="'+(s-6)+'" title="'+(s-6)+'">...</a>'),l=6;0<l;l--)r="",i==s-l&&(r="pagination-current"),o.push('<a class="pagination-button '+r+'">'+(s-l+1)+"</a>");else{for(o.push('<a class="pagination-button">1</a>'),o.push('<a class="pagination-button pagination-button-ellipsis" action="none" data-index="'+(i-3)+'" title="'+(i-3)+'">...</a>'),l=0;l<3;l++)a='<a class="pagination-button">'+(i-(2-l))+"</a>",o.push(a);t=s<=i+4?s-1:i+4,o.push('<a class="pagination-button pagination-current">'+(i+1)+"</a>"),o.push('<a class="pagination-button pagination-button-ellipsis" action="none" data-index="'+t+'" title="'+t+'">...</a>'),o.push('<a class="pagination-button">'+s+"</a>")}r="",(s-1<=i&&0<=n||-9999==n)&&(r="disabled");var d='<a class="pagination-button pagination-next  mini-icon '+r+'" action="next"></a>';o.push(d),o.push("</div>");var u=o.join(" ");this.el.innerHTML=u},_updatePagerInfo:function(){var t,i=this,e=parseInt(i.pageSize,10),n=parseInt(i.pageIndex,10),s=i.sizeList,o=!1,r=0;if(i.showPageSize){for(t=s.length;r<t;r++)s[r]===e&&(o=!0);o||s.push(e),s.sort(function u(t,e){return t-e});var a=[];for(r=0;r<t;r++)a.push({id:s[r],text:s[r]});i.sizeCombo=new mini.ComboBox,i.sizeCombo.setData(a),i.sizeCombo.setValue(e),i.sizeCombo.on("valuechanged",function(t){var e=parseInt(t.value,10);i._OnPageChanged(0,e)}),i.sizeCombo.render(i.el);var l=document.createElement("span");l.className="pagination-sizeinfo",l.innerHTML=i.sizeText,i.sizeCombo._borderEl.appendChild(l)}if(0<=i.totalCount){var h=document.createElement("span");h.className="pagination-pagerchange";var d=String.format(this.jumpText,n+1);h.innerHTML=d,i.el.appendChild(h)}},_updatePager:function(){this._updatePagerButtons(),this._updatePagerInfo()},_initEvents:function(){mini.Pagination.superclass._initEvents.call(this);var a=this;function e(t){var e=a.pageSize,i=a.totalCount,n=Math.ceil(i/e),s=parseInt(t.val());isNaN(s)?t.val(""):(n<s&&(s=n,t.val(s)),a._OnPageChanged(s-1))}setTimeout(function(){$(a.el).on("click",".pagination-button",function(t){var e=a.pageSize,i=a.pageIndex,n=a.totalCount,s=Math.ceil(n/e),o=$(t.target).attr("action"),r="";"prev"==o?0!=i&&a._OnPageChanged(i-1):"next"==o?(i<s-1||n<0)&&-9999!==n&&a._OnPageChanged(a.pageIndex+1):"none"==o?0<(r=parseInt($(t.target).data("index"),10))&&a._OnPageChanged(r-1):$(t.target).hasClass("current")||0<(r=parseInt($(t.target).text(),10))&&a._OnPageChanged(r-1)}).on("keyup",".pagination-number",function(t){13===t.keyCode&&t.target.value!==a.pageIndex+1&&e($(t.target))}).on("change",".pagination-number",function(t){e($(t.target))})},100)},_OnPageChanged:function(t,e){var i={pageIndex:mini.isNumber(t)?t:this.pageIndex,pageSize:mini.isNumber(e)?e:this.pageSize,cancel:!1};-1<this.totalPage&&i.pageIndex>this.totalPage-1&&(i.pageIndex=this.totalPage-1),i.pageIndex<0&&(i.pageIndex=0),this.fire("beforepagechanged",i),1!=i.cancel&&(this.fire("pagechanged",i),this.update(i.pageIndex,i.pageSize))},update:function(t,e,i){var n=this;mini.isNumber(t)&&(n.pageIndex=parseInt(t)),mini.isNumber(e)&&(n.pageSize=parseInt(e)),mini.isNumber(i)&&(n.totalCount=parseInt(i)),n.totalPage=parseInt(n.totalCount/n.pageSize)+1,n.totalCount<0?n.totalPage=-1:((n.totalPage-1)*n.pageSize==n.totalCount&&(n.totalPage-=1),0==n.totalCount&&(n.totalPage=0),n.pageIndex>n.totalPage-1&&(n.pageIndex=n.totalPage-1),n.totalPage<=0&&(n.totalPage=0)),n.pageIndex<=0&&(n.pageIndex=0),this._updatePager()},setPageIndex:function(t){isNaN(t)||(this.pageIndex=t,this.update())},getPageIndex:function(){return this.pageIndex},setPageSize:function(t){isNaN(t)||(this.pageSize=t,this.update())},getPageSize:function(){return this.pageSize},setTotalCount:function(t){t=parseInt(t),isNaN(t)||(this.totalCount=t,this.update())},getTotalCount:function(){return this.totalCount},setSizeList:function(t){mini.isArray(t)&&(this.sizeList=t,this.update())},getSizeList:function(){return this.sizeList},setShowReloadButton:function(t){},getShowReloadButton:function(){return!1},setShowTotalCount:function(t){this.showTotalCount!==t&&(this.showTotalCount=t,this.update())},getShowTotalCount:function(){return this.showTotalCount},setShowPageSize:function(t){this.showPageSize!==t&&(this.showPageSize=t,this.update())},getShowPageSize:function(){return this.showPageSize},setShowPageInfo:function(t){this.showPageInfo=t,this.setShowTotalCount(t)},getShowPageInfo:function(){return this.showPageInfo},setShowPagerButtonText:function(t){},setShowPagerButtonIcon:function(t){},setPageSizeWidth:function(t){},setShowPageIndex:function(t){},getAttrs:function(t){var e=mini.Pager.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onpagechanged","sizeList","onbeforepagechanged","buttons","sizeText"]),mini._ParseBool(t,e,["showPageSize","showTotalCount","showPageInfo"]),mini._ParseInt(t,e,["pageIndex","pageSize","totalCount"]),"string"==typeof e.sizeList&&(e.sizeList=window.eval(e.sizeList)),e.buttons&&(e.buttons=mini.byId(e.buttons)),e}}),mini.regClass(mini.Pagination,"pagination"),mini.PanelTip=function(){mini.PanelTip.superclass.constructor.apply(this,arguments)},mini.extend(mini.PanelTip,mini.ToolTip,{selector:".paneltip",trigger:"click",uiCls:"mini-paneltip",url:"",tplUrl:"",tpl:"",cssUrl:"",defaultTheme:"light",externalSrc:_rootPath+"/frame/fui/js/libs/",_create:function(){this.el=jQuery('<div class="mini-tooltip mini-paneltip"><div class="mini-tooltip-arrow"></div><i class="mini-paneltip-close"></i><div class="mini-tooltip-inner"></div></div>')[0],this.$element=jQuery(this.el),this.$close=jQuery(".mini-paneltip-close",this.$element),this.$element.appendTo(document.body),this.externalSrc=this.externalSrc||mini.externalSrc},_initEvents:function(){var t=this;this.$close.on("click",function(){t.close()}),this._bindTooltip()},_opened:"",open:function(t){t=jQuery(t)[0]||this.target;var e=jQuery(t).attr("data-guid"),i={element:t,data:{guid:e},cancel:!1};this.fire("beforeopen",i),i.cancel||(this.$element.show(),this._target=t,this._getData(i.data,e),this.fire("open",{element:t}))},_getData:function(t,i){var n=this;this.showLoading(),Util.ajax({url:this.url,data:t,async:!0,success:function(t){var e=mini.decode(t)||"";n._opened=i,window.Mustache?n._renderContent(e):mini.loadJS(n.externalSrc+"mustache.min.js",function(){n._renderContent(e)})}})},_renderContent:function(t){var e=Mustache.render(this.tpl,t);this.setContent(e),this.$close.removeClass("hidden")},_toggle:function(t){if(this._opened&&jQuery(t.currentTarget).attr("data-guid")===this._opened)return void this.applyPlacement();this.close(),this._enter(t)},_leave:function(t){clearTimeout(this.openTimer)},showLoading:function(){this.setContent('<div class="mini-tooltip-loading"></div>'),this.$close.addClass("hidden")},close:function(){this._target=null,this.$element.hide(),this._opened=""},setTplUrl:function(t){this.tplUrl=t,this.tpl=jQuery.trim(mini.loadText(t))},setCssUrl:function(t){this.cssUrl=t,mini.loadCSS(t)},getAttrs:function(t){var e=mini.PanelTip.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["trigger"]),e}}),mini.regClass(mini.PanelTip,"paneltip"),mini.QuarterPicker=function(){mini.QuarterPicker.superclass.constructor.call(this)},mini.extend(mini.QuarterPicker,mini.PopupEdit,{uiCls:"mini-quarterpicker",showPopupOnClick:!0,allowInput:!1,popupHeight:"auto",popupWidth:"auto",maxDate:"9999-q3",_maxDate:{year:9999,quarter:3},minDate:"1753-q0",_minDate:{year:1753,quarter:0},showClearButton:!0,showOkButton:!1,itemText:epoint_local.QuarterPicker.itemText.slice(),yearText:epoint_local.QuarterPicker.yearText,clearText:epoint_local.QuarterPicker.clearText,okText:epoint_local.QuarterPicker.okText,footTipText:"",_createPopup:function(){mini.QuarterPicker.superclass._createPopup.call(this),this._bindPopupEvents()},_bindPopupEvents:function(){var n=this;jQuery(this.popup.el).on("click",".laydate-prev-y",function(t){var e=parseInt($(this).closest(".layui-laydate-header").data("year"),10);n._updatePopupPanel(e-("year"===n._popupPanelView?n._yearContentCount:1))}).on("click",".laydate-next-y",function(t){var e=parseInt($(this).closest(".layui-laydate-header").data("year"),10);n._updatePopupPanel(e+("year"===n._popupPanelView?n._yearContentCount:1))}).on("click",".laydate-set-ym",function(t){var e=parseInt($(this).closest(".layui-laydate-header").data("year"),10);n._popupPanelView="year",n._updatePopupPanel(e)}).on("click",".laydate-btns-clear",function(t){n._compareValue("")||(n.setValue(""),n._OnValueChanged()),n._onBtnClick("clear"),n.hidePopup()}).on("click",".laydate-btns-confirm",function(t){if(!$(this).hasClass("laydate-disabled")){var e=n._getSelectedValue();n._compareValue(e)||(n.setValue(e),n._OnValueChanged()),n._onBtnClick("confirm"),n.hidePopup()}}).on("click",".laydate-quarter-item",function(t){n._onQuarterItemClick($(this))}).on("click",".laydate-year-item",function(t){var e=$(this),i=e.data("year");e.hasClass("laydate-disabled")||(n._popupPanelView="quarter",n._updatePopupPanel(i))})},_onQuarterItemClick:function(t){var e=t.data("year"),i=t.data("quarter");t.hasClass("layui-this")||t.hasClass("laydate-disabled")||(t.addClass("layui-this").siblings().removeClass("layui-this"),this.showOkButton||(this.setValue(this._joinValue(e,i)),this._OnValueChanged(),this.hidePopup()))},_getSelectedValue:function(){var t=$(this.popup.el).find(".laydate-quarter-item.layui-this"),e=t.data("year"),i=t.data("quarter");return this._joinValue(e,i)},showPopup:function(){var t={cancel:!1};if(this.fire("beforeshowpopup",t),!0!==t.cancel){var e=this._getCurYear();this._updatePopupPanel(e),mini.QuarterPicker.superclass.showPopup.call(this)}},_getCurYear:function(){return this._analyzeValue(this.value).year||(new Date).getFullYear()},hidePopup:function(){mini.QuarterPicker.superclass.hidePopup.call(this),this._popupPanelView="quarter"},_popupPanelView:"quarter",_updatePopupPanel:function(t){this.popup&&(this.popup._contentEl.innerHTML=this._createPopupPanel(t))},_yearContentCount:9,_createHeaderYearText:function(t){if("quarter"===this._popupPanelView)return t+this.yearText;var e=parseInt(this._yearContentCount/2,10),i=this._yearContentCount%2;return t-e+this.yearText+" - "+(t+e-1+i)+this.yearText},_createPopupPanel:function(t){var e=[];return e.push('<div class="layui-laydate">'),e.push('<div class="layui-laydate-main laydate-main-list-0">'),e.push('<div class="layui-laydate-header" data-year="'+t+'"><i class="layui-icon laydate-icon laydate-prev-y"></i>'),e.push('<div class="laydate-set-ym"><span>'+this._createHeaderYearText(t)+"</span></div>"),e.push('<i class="layui-icon laydate-icon laydate-next-y"></i></div>'),e.push('<div class="layui-laydate-content">'+this._createContent(t)+"</div>"),e.push("</div>"),e.push(this._createFooter()),e.push("</div>"),e.join("")},_createContent:function(t){return"quarter"===this._popupPanelView?this._createQuarterContent(t):this._createYearContent(t)},_createQuarterContent:function(t){var e,i,n,s=['<ul class="layui-laydate-list laydate-quarter-list">'];e=this.value?this._analyzeValue(this.value).quarter||0:Math.floor((new Date).getMonth()/3);for(var o=0;o<4;o++)i=e===o,n={allowSelect:this._isValueSelectable(t,o),year:t,quarter:o,value:this._joinValue(t,o),text:this._joinText(t,o),html:this.itemText[o]},this.fire("drawquarter",n),s.push('<li class="laydate-quarter-item'+(n.allowSelect?i?" layui-this":"":" laydate-disabled")+'" data-year="'+t+'"data-quarter="'+o+'">'+n.html+"</li>");return s.push("</ul>"),s.join("")},_createYearContent:function(t){for(var e,i,n=['<ul class="layui-laydate-list laydate-year-list">'],s=parseInt(this._yearContentCount/2,10),o=s+this._yearContentCount%2,r=-s;r<o;r++)e=t+r,i={allowSelect:this._isValueSelectable(e),year:e,html:e+this.yearText},this.fire("drawyear",i),n.push('<li class="laydate-year-item'+(i.allowSelect?0===r?" layui-this":"":" laydate-disabled")+'" data-year="'+e+'">'+i.html+"</li>");return n.push("</ul>"),n.join("")},_createFooter:function(){var t=[];return t.push('<div class="layui-laydate-footer"><span class="laydate-footer-tips">'+this.footTipText+"</span>"),t.push('<div class="laydate-footer-btns"><span lay-type="clear" class="laydate-btns-clear'+(this.showClearButton?"":" hidden")+'">'+this.clearText+'</span><span lay-type="confirm" class="laydate-btns-confirm'+(this.showOkButton?"":" hidden")+("year"===this._popupPanelView?" laydate-disabled":"")+'">'+this.okText+"</span></div>"),t.push("</div>"),t.join("")},_valueReg:/^(\d{4})-q([0123])$/,_analyzeValue:function(t){var e=(t=t||"").match(this._valueReg);return{year:e?parseInt(e[1],10):"",quarter:e?parseInt(e[2],10):""}},_joinValue:function(t,e){return/^(\d){4}$/.test(t)&&/^[0123]$/.test(e)?t+"-q"+e:""},_joinText:function(t,e){return/^(\d){4}$/.test(t)&&/^[0123]$/.test(e)?t+this.yearText+this.itemText[e]:""},_isValueSelectable:function(t,e){return!(t>this._maxDate.year||t<this._minDate.year)&&(e===undefined||!(t===this._maxDate.year&&e>this._maxDate.quarter)&&!(t===this._minDate.year&&e<this._minDate.quarter))},_onBtnClick:function(t){var e={action:t,value:this.value};this.fire("btnclick",e)},validateValueFormat:function(t){return!!this._valueReg.test(t)||(console.warn("Invalid value：",t),!1)},setMinDate:function(t){if(this.validateValueFormat(t)){this.minDate=t;var e=this._analyzeValue(t);this._minDate={year:e.year,quarter:e.quarter}}},setMaxDate:function(t){if(this.validateValueFormat(t)){this.maxDate=t;var e=this._analyzeValue(t);this._maxDate={year:e.year,quarter:e.quarter}}},_compareValue:function(t){return this.value===t},setValue:function(t){if(t){if(this.validateValueFormat(t)){this.value=t;var e=this._analyzeValue(t);this.text=this._textEl.value=this._valueEl.value=this._joinText(e.year,e.quarter)}}else this.value=this.text=this._textEl.value=this._valueEl.value=""},getValue:function(){return this.value},getText:function(){return this._textEl.value},getAttrs:function(t){var e=mini.QuarterPicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["minDate","maxDate","onvaluechanged","ondrawquarter","ondrawyear","onbtnclick"]),mini._ParseBool(t,e,["showClearButton","showOkButton"]),e}}),mini.regClass(mini.QuarterPicker,"quarterpicker"),mini.QuarterRangePicker=function(){mini.QuarterRangePicker.superclass.constructor.call(this)},mini.extend(mini.QuarterRangePicker,mini.QuarterPicker,{uiCls:"mini-quarterrangepicker",delimiter:"~",showOkButton:!0,footTipText:epoint_local.QuarterRangePicker.footTipText,_getCurYear:function(){return this._analyzeValue(this.value.startDate).year||(new Date).getFullYear()},showPopup:function(){if(this.value&&this.value.startDate&&this.value.endDate){var t=this._analyzeValue(this.value.startDate),e=this._analyzeValue(this.value.endDate);this._selectedItems=[t,e]}else this._selectedItems=[];mini.QuarterRangePicker.superclass.showPopup.call(this),this._updateOkBtn()},_createPopupPanel:function(t){var e=[];return e.push('<div class="layui-laydate layui-laydate-range">'),"quarter"===this._popupPanelView?(e.push(this._createLeftPanel(t)),e.push(this._createRightPanel(t+1))):e.push(this._createYearPanel(t)),e.push(this._createFooter()),e.push("</div>"),e.join("")},_createLeftPanel:function(t){var e=[];return e.push('<div class="layui-laydate-main laydate-main-list-0">'),e.push('<div class="layui-laydate-header" data-year="'+t+'"><i class="layui-icon laydate-icon laydate-prev-y"></i>'),e.push('<div class="laydate-set-ym"><span>'+this._createHeaderYearText(t)+"</span></div>"),e.push('<i class="layui-icon laydate-icon laydate-next-y"></i></div>'),e.push('<div class="layui-laydate-content">'+this._createQuarterContent(t)+"</div>"),e.push("</div>"),e.join("")},_createRightPanel:function(t){var e=[];return e.push('<div class="layui-laydate-main laydate-main-list-1">'),e.push('<div class="layui-laydate-header" data-year="'+(t-1)+'"><i class="layui-icon laydate-icon laydate-prev-y"></i>'),e.push('<div class="laydate-set-ym"><span>'+this._createHeaderYearText(t)+"</span></div>"),e.push('<i class="layui-icon laydate-icon laydate-next-y"></i></div>'),e.push('<div class="layui-laydate-content">'+this._createQuarterContent(t)+"</div>"),e.push("</div>"),e.join("")},_createQuarterContent:function(t){var e,i,n,s,o,r=['<ul class="layui-laydate-list laydate-quarter-list">'],a=this._analyzeSelectedItems();a&&(e=a.startDate,i=a.endDate);for(var l=0;l<4;l++)n=e&&i&&(e.year===t&&e.quarter===l||i.year===t&&i.quarter===l),s=this._isWithin(e,i,{year:t,quarter:l}),o={allowSelect:this._isValueSelectable(t,l),year:t,quarter:l,value:this._joinValue(t,l),text:this._joinText(t,l),html:this.itemText[l]},this.fire("drawquarter",o),r.push('<li class="laydate-quarter-item'+(o.allowSelect?n?" layui-this":"":" laydate-disabled")+(s?" laydate-selected":"")+'" data-year="'+t+'"data-quarter="'+l+'">'+o.html+"</li>");return r.push("</ul>"),r.join("")},_isWithin:function(t,e,i){return!!(t&&e&&i)&&(!(t.year>i.year)&&(!(e.year<i.year)&&(!(t.year===i.year&&t.quarter>=i.quarter)&&!(e.year===i.year&&e.quarter<=i.quarter))))},_yearContentCount:18,_createYearPanel:function(t){var e=[];return e.push('<div class="layui-laydate-main laydate-main-list">'),e.push('<div class="layui-laydate-header" data-year="'+t+'"><i class="layui-icon laydate-icon laydate-prev-y"></i>'),e.push('<div class="laydate-set-ym"><span>'+this._createHeaderYearText(t)+"</span></div>"),e.push('<i class="layui-icon laydate-icon laydate-next-y"></i></div>'),e.push('<div class="layui-laydate-content">'+this._createYearContent(t)+"</div>"),e.push("</div>"),e.join("")},_selectedItems:[],_analyzeSelectedItems:function(){if(2===this._selectedItems.length){var t=this._selectedItems[0],e=this._selectedItems[1];return t.year<e.year?{startDate:t,endDate:e}:t.year>e.year?{startDate:e,endDate:t}:t.quarter<e.quarter?{startDate:t,endDate:e}:{startDate:e,endDate:t}}},_onQuarterItemClick:function(t){var e=t.data("year"),i=t.data("quarter");t.hasClass("laydate-disabled")||(1<this._selectedItems.length&&(this._selectedItems=[],$(this.popup.el).find(".laydate-quarter-item.layui-this").removeClass("layui-this")),this._selectedItems.push({year:e,quarter:i}),t.addClass("layui-this"),this._updateQuarterItemState(),this._updateOkBtn())},_updateQuarterItemState:function(){var i,n,s,o,t=$(this.popup.el).find(".laydate-quarter-item").removeClass("laydate-selected"),r=this;2===this._selectedItems.length&&(o=this._analyzeSelectedItems(),t.each(function(t,e){i=$(e),n=i.data("year"),s=i.data("quarter"),r._isWithin(o.startDate,o.endDate,{year:n,quarter:s})&&i.addClass("laydate-selected")}))},_updateOkBtn:function(){var t=$(this.popup.el).find(".laydate-btns-confirm");2===this._selectedItems.length?t.removeClass("laydate-disabled"):t.addClass("laydate-disabled")},_getSelectedValue:function(){var t=this._analyzeSelectedItems();return{startDate:t?this._joinValue(t.startDate.year,t.startDate.quarter):"",endDate:t?this._joinValue(t.endDate.year,t.endDate.quarter):""}},value:{startDate:"",endDate:""},_oldValue:{startDate:"",endDate:""},setValue:function(t){if(t){if("string"==typeof t&&(t=mini.JSON.decode(t)),!this.validateValueFormat(t.startDate)||!this.validateValueFormat(t.endDate))return;this.value={startDate:t.startDate,endDate:t.endDate};var e=this._analyzeValue(t.startDate),i=this._analyzeValue(t.endDate);this.text=this._textEl.value=this._joinText(e.year,e.quarter)+" "+this.delimiter+" "+this._joinText(i.year,i.quarter),this._selectedItems=[e,i]}else this.value={startDate:"",endDate:""},this.text=this._textEl.value="",this._selectedItems=[]},getFormValue:function(){return mini.encode(this.value)},_compareValue:function(t){return t=t||{startDate:"",endDate:""},this.value.startDate===t.startDate&&this.value.endDate===t.endDate},_onValueChanged:function(){this.value.startDate===this._oldValue.startDate&&this.value.endDate===this._oldValue.endDate||(this._oldValue=this.value,this.fire("valuechanged",{value:this.value,oldValue:this._oldValue}),this._oldValue=this.value)},validate:function(){var t={value:this.getValue(),errorText:"",isValid:!0};return this.required&&(""!==String(t.value.startDate).trim()&&""!==String(t.value.endDate).trim()||(t.isValid=!1,t.errorText=this.requiredErrorText)),this.fire("validation",t),this.errorText=t.errorText,this.setIsValid(t.isValid),this.isValid()},getAttrs:function(t){var e=mini.QuarterRangePicker.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["delimiter"]),e}}),mini.regClass(mini.QuarterRangePicker,"quarterrangepicker"),mini.Rate=function(){mini.Rate.superclass.constructor.call(this)},mini.extend(mini.Rate,mini.Control,{uiCls:"mini-rate",iconType:"star",size:"big",value:0,maxValue:5,minValue:0,readOnly:!0,_create:function(){var t=[];this.el=document.createElement("ul"),this.el.className="mini-rate mini-rate-"+this.iconType;for(var e=this.minValue;e<this.maxValue;e++)t.push('<li class="mini-rate-default"></li>');this.el.innerHTML=t.join("")},_initEvents:function(){var s=this,o=0,t=$(this.el);function e(t){var e=$(t.target),i=t.pageX-e.offset().left,n=e.index();o=i>e.width()/2?n+1:n+.5,s._showValue(o)}function i(){s._showValue(s.value)}function n(){s.setValue(o)}this.readOnly?(t.off("mousemove","li",e),t.off("mouseleave",i),t.off("click","li",n)):(t.on("mousemove","li",e),t.on("mouseleave",i),t.on("click","li",n))},_resize:function(){var t=$(this.el);"big"===this.size?t.removeClass("mini-rate-small"):"small"===this.size&&t.addClass("mini-rate-small")},_changeType:function(){$(this.el).removeClass("mini-rate-star").removeClass("mini-rate-heart").addClass("mini-rate-"+this.iconType)},_showValue:function(t){var e=$(this.el).children(),i=parseInt(t,10),n=e.eq(i);i===this.maxValue?e.removeClass("mini-rate-default mini-rate-half").addClass("mini-rate-active"):(n.prevAll().removeClass("mini-rate-half mini-rate-default").addClass("mini-rate-active"),n.removeClass("mini-rate-default mini-rate-active mini-rate-half").addClass(i<t?"mini-rate-half":"mini-rate-default"),n.nextAll().removeClass("mini-rate-half mini-rate-active").addClass("mini-rate-default"))},setValue:function(t){(t=parseFloat(t,10))>this.maxValue?t=this.maxValue:t<this.minValue&&(t=this.minValue),this.value=t,this._showValue(this.value)},getValue:function(){return this.value},setMaxValue:function(t){this.maxValue=t,$(this.el).children().remove();for(var e=document.createDocumentFragment(),i=$(e),n=0;n<this.maxValue;n++)$('<li class="mini-rate-default"></li>').appendTo(i);$(this.el).append(i),this.maxValue<this.minValue&&(this.minValue=this.maxValue,this.value=this.maxValue),this.maxValue<this.value&&(this.value=this.maxValue),this.setValue(this.value)},getMaxValue:function(){return this.maxValue},setMinValue:function(t){this.minValue=t,this.minValue>this.maxValue&&(this.maxValue=this.minValue),this.minValue>this.value&&(this.value=this.minValue),this._showValue(this.value)},getMinValue:function(){return this.minValue},setReadOnly:function(t){this.readOnly=t,this._initEvents()},getReadOnly:function(){return this.readOnly},setIconType:function(t){"star"!==t&&"heart"!==t||(this.iconType=t,this._changeType())},getIconType:function(){return this.iconType},setSize:function(t){"big"!==t&&"small"!==t||(this.size=t,this._resize())},getSize:function(){return this.size},getAttrs:function(t){var e=mini.Rate.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["iconType","size","value"]),mini._ParseInt(t,e,["maxValue","minValue"]),mini._ParseBool(t,e,["readOnly"]),e}}),mini.regClass(mini.Rate,"rate"),mini.Repeat=function(){mini.Repeat.superclass.constructor.call(this)},mini.extend(mini.Repeat,mini.ListControl,{templateId:"",templateUrl:"",url:"",externalSrc:"",uiCls:"mini-repeat",template:"",_create:function(){this.el=document.createElement("div"),this.externalSrc=this.externalSrc||mini.externalSrc},setTemplateUrl:function(t){this.templateUrl=t;var e=this;return jQuery.ajax({url:t,async:!1,success:function(t){e.template=jQuery.trim(t)},error:function(){throw new Error("template not found")}})},getTemplateUrl:function(){return this.templateUrl},setTemplateId:function(t){this.templateId=t;var e=document.getElementById(t);if(!e)throw new Error("template not found");this.template=jQuery.trim(e.innerHTML)},getTemplateId:function(){return this.templateId},setData:function(t){if(this.data=t||[],!this.template)throw new Error("template not init");var e=this;window.Mustache?this._renderHtml():mini.loadJS(this.externalSrc+"mustache.min.js",function(){e._renderHtml()})},_destroyChild:function(){var t=mini.getChildControls(this);t.length&&(this.fire("beforeChildDestroy"),t.forEach(function(t){t&&t.destroy()}))},destroy:function(){this._destroyChild(),mini.Repeat.superclass.destroy.call(this)},_renderHtml:function(){var t,e,i=this.data.control,n=this.data.template||this.data,s=[];for(t=0,e=n.length;t<e;t++)s.push(Mustache.render(this.template,n[t]));this._destroyChild(),this.el.innerHTML=s.join("");var o,r,a={controlData:i,template:n,cancel:!1};if((this.fire("beforeChildParse",a),!0!==a.cancel)&&(mini.parse(this.el),i))for(mini.isArray(i)||(i=[]),t=0,e=i.length;t<e;t++)for(var l in o=i[t])Object.prototype.hasOwnProperty.call(o,l)&&(r=mini.get(l,this.el))&&o[l]&&(o[l].data&&(r.loadList?r.loadList(o[l].data):r.setData&&(r.setData(o[l].data),o[l].total&&r.setTotalCount&&r.setTotalCount(o[l].total))),"object"!=typeof o[l]&&r.setValue&&r.setValue(o[l]),o[l].value&&r.setValue&&r.setValue(o[l].value),o[l].text&&r.setText&&r.setText(o[l].text))},getAttrs:function(t){var e=mini.Repeat.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["templateId","templateUrl","onbeforeChildParse","onbeforeChildDestroy"]);for(var i=mini.getChildNodes(t),n=0,s=i.length;n<s;n++){var o=i[n],r=o.getAttribute("property");if(r&&"template"===(r=r.toLowerCase())){this.template=o.innerHTML;break}}return e}}),mini.regClass(mini.Repeat,"repeat"),mini.SlideWindow=function(){mini.SlideWindow.superclass.constructor.apply(this,arguments),this.setAllowDrag(!1),this.setAllowResize(!1)},mini.extend(mini.SlideWindow,mini.Window,{uiCls:"mini-slidewindow",iconCls:"",iconStyle:"",duration:200,visible:!1,x:0,y:0,showModal:!1,allowResize:!1,pageVisibility:(undefined,v_b=!1,"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(t){0==v_b&&document[p_b(t,"hidden")]!=undefined&&(o_b=t,v_b=!0)}),q_b=v_b,{isSupport:q_b,hidden:r_b(),visibilityState:s_b(),getVisibilityState:s_b,eventName:q_b?o_b+"visibilitychange":"",visibilitychange:function(e,t){return t=undefined||!1,q_b&&"function"==typeof e?document.addEventListener(o_b+"visibilitychange",function(t){this.hidden=r_b(),this.visibilityState=s_b(),e.call(this,t)}.bind(this),t):undefined}}),_create:function(){mini.SlideWindow.superclass._create.call(this),this._titleEl.style.paddingRight="0",this.iconCls=this.iconStyle="",this.setDuration(this.duration)},destroy:function(){var t=this;this.hide().then(function(){t._destroy()})},_destroy:function(){this.pageVisibility.isSupport&&jQuery(document).off(this.pageVisibility.eventName+"."+this._id),mini.un(this.el,"mouseover",this.__OnMouseOver,this),mini.un(window,"resize",this.__OnWindowResize,this),mini.Window.superclass.destroy.call(this)},setDuration:function(t){if(!$.isNumeric(t))return!1;this.duration=t;var e=this.duration/1e3+"s";jQuery(this.el).css({"-webkit-transition-duration":e,"-moz-transition-duration":e,"-ms-transition-duration":e,"-o-transition-duration":e,"transition-duration":e})},getDuration:function(){return this.duration},_initEvents:function(){var e=this;mini.Window.superclass._initEvents.call(this),mini._BindEvents(function(){mini.on(this.el,"mouseover",this.__OnMouseOver,this),mini.on(window,"resize",this.__OnWindowResize,this)},this),this.pageVisibility.isSupport&&jQuery(document).on(this.pageVisibility.eventName+"."+this._id,function(t){"visible"===e.pageVisibility.getVisibilityState()&&e.doLayout()})},__OnWindowResize:function(){var t=this;this.pageVisibility.isSupport&&"visible"!==this.pageVisibility.getVisibilityState()||(this.__showWidth=jQuery(window).width(),this.__showHeight=jQuery(window).height(),this.isDisplay()&&(clearTimeout(this.__resizeTimer),this.__resizeTimer=setTimeout(function(){t.doLayout()},20)))},_initButtons:function(){this.buttons=[];var t=this.createButton({name:"close",cls:"mini-tools-back icon-left",visible:this.showCloseButton});this.buttons.push(t)},doLayout:function(){if(!this.canLayout())return!1;mini.setSize(this.el,this.__showWidth,this.__showHeight),mini.Window.superclass.doLayout.call(this)},show:function(){var t=document.body;this.isRender()||this.render(t);var e=this.__showWidth||jQuery(window).width(),i=this.__showHeight||jQuery(window).height(),n=jQuery(this.el);n.css({"z-index":mini.getMaxZIndex(),position:"fixed",width:e,height:i,top:0,left:0}).show(),this.setVisible(!0),mini.isIE8||mini.isIE9?this.doLayout():(clearTimeout(this.__hideTimer),clearTimeout(this.__showTimer),this.__showTimer=setTimeout(function(){n.addClass("show")}))},showAtEl:function(){this.show()},showAtPos:function(){this.show()},hide:function(){var t=$.Deferred(),e=this,i=jQuery(this.el);return mini.isIE8||mini.isIE9?(e.setVisible(!1),t.resolve()):(clearTimeout(this.__hideTimer),clearTimeout(this.__showTimer),i.removeClass("show"),this.__hideTimer=setTimeout(function(){e.setVisible(!1),t.resolve()},this.duration)),t.promise()},max:function(){},restore:function(){}}),mini.regClass(mini.SlideWindow,"slidewindow"),mini.Slider=function(){mini.Slider.superclass.constructor.call(this)},mini.extend(mini.Slider,mini.Control,{uiCls:"mini-slider",width:"200px",formField:!0,minValue:0,maxValue:100,step:1,precision:0,showTooltip:!0,showScale:!0,interval:25,set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value,mini.Slider.superclass.set.call(this,t),mini.isNull(e)||this.setValue(e)},_create:function(){this.el=document.createElement("div"),this.el.className="mini-slider",this.el.innerHTML='<div class="mini-slider-runway"><div class="mini-slider-bar"></div><div class="mini-slider-pointer"></div></div>',this.runway=this.el.firstChild,this.bar=this.runway.firstChild,this.pointer=this.runway.lastChild},_checkDots:function(){var t=$(this.el),e=t.find(".scale-dot"),n=t.find(".mini-slider-pointer");e.each(function(t,e){var i=$(e);i.offset().left<=n.offset().left+10?i.addClass("active"):i.removeClass("active")})},_initEvents:function(){var t,e,i=this,n=$(this.el);function s(){i._checkDots()}function o(){e=i.value,$(window).off("mousemove",r),$(window).off("mouseup",r),$(window).off("mouseup",o),t!==e&&i.fire("valuechanged",{value:e,oldValue:t}),i._checkDots()}function r(t){i._handleChange(t)}this.showScale?$(window).on("mousemove",s):$(window).off("mousemove",s),n.on("mousedown",function a(){t=i.value,$(window).on("mousemove",r),$(window).on("mouseup",r),$(window).on("mouseup",o),i._checkDots()})},_afterApply:function(){this.showTooltip&&(this.toolTip=new mini.ToolTip,this.toolTip.set({target:document,scope:this.el,selector:"[data-slidertooltip]",placement:"top"}),this.toolTip.on("beforeopen",this._onBeforeShowToolTip,this))},_onBeforeShowToolTip:function(t){var e={content:this.value,cancel:!1};this.fire("beforeshowtooltip",e),t.content=e.content,t.cancel=e.cancel},_handleChange:function(t){t.preventDefault&&t.preventDefault();var e,i,n,s,o=this.el,r=o.clientWidth,a=o.getBoundingClientRect().left+window.pageXOffset,l=function h(t,e,i){var n=t-e,s=i-t;return 0<=n&&0<=s?t:Math.abs(n)>=Math.abs(s)?i:e}((t.pageX||(t.touches?t.touches[0].pageX:0))-a,0,r);e=l<=0?(i=0,this.minValue):r<=l?(i=100,this.maxValue):(i=100*l/r,n=100/((this.maxValue-this.minValue)/this.step),e=Math.round(i/n)*n*(this.maxValue-this.minValue)*.01+this.minValue,parseFloat(e.toFixed(this.precision))),this.setValue(e,i),this.showTooltip&&(s={content:e},this.fire("beforeshowtooltip",s),this.toolTip.setContent(s.content))},setPosition:function(t){this.bar.style.width=t+"%",this.pointer.style.left=t+"%"},setValue:function(t,e){t=parseFloat(t),isNaN(t)&&(t=this.minValue),0<=this.precisions&&(t=t.toFixed(this.precisions)),t>this.maxValue?t=this.maxValue:t<this.minValue&&(t=this.minValue),this.value!==t&&(this.value=t,e=mini.isNumber(e)?e:(t-this.minValue)/(this.maxValue-this.minValue)*100,this.setPosition(e),this.showTooltip&&this.pointer.setAttribute("data-slidertooltip",t)),this._checkDots()},getValue:function(){return this.value},setMaxValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.maxValue!==t&&(this.maxValue=t,this._ValueLimit()))},getMaxValue:function(){return this.maxValue},setMinValue:function(t){t=parseFloat(t),isNaN(t)||(t=parseFloat(t),this.minValue!==t&&(this.minValue=t,this._ValueLimit()))},getMinValue:function(){return this.minValue},setStep:function(t){t=parseFloat(t),isNaN(t)||this.step!==t&&(this.step=t,this._adjustPrecision())},getStep:function(){return this.step},setInterval:function(t){isNaN(t)&&(t=0),this.interval=parseInt(t,10);var e=$(this.el).find(".slider-scale"),i=parseInt(this.width,10),n=this.minValue;for(e.empty();n<=this.maxValue;)$('<li class="scale-dot"><span class="scale-value">'+n+"</span></li>").appendTo(e),n+=this.interval;var s=e.children(),o=i/(s.length-1)-10;s.css("marginLeft",o+"px"),s.eq(0).css("marginLeft","0px").addClass("active"),e.width(i+10),this._checkDots()},getInterval:function(){return this.interval},setShowScale:function(t){this.showScale=t;var e=$(this.el);if(this.showScale){if(0<e.find("ul").length)return;$('<ul class="slider-scale"></ul>').appendTo(e),this.setInterval(this.interval)}else e.find(".slider-scale").remove()},getShowScale:function(){return this.showScale},_ValueLimit:function(){this.minValue>this.maxValue&&(this.maxValue=this.minValue+100),this.value<this.minValue&&this.setValue(this.minValue),this.value>this.maxValue&&this.setValue(this.maxValue),this._adjustPrecision()},_adjustPrecision:function(){var t=[this.minValue,this.maxValue,this.step].map(function(t){var e=(""+t).split(".")[1];return e?e.length:0});this.precision=Math.max.apply(null,t)},getAttrs:function(t){var e=mini.Slider.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["onvaluechanged","onbeforeshowtooltip"]),mini._ParseInt(t,e,["interval","maxValue","minValue","step"]),mini._ParseBool(t,e,["showScale"]),e}}),mini.regClass(mini.Slider,"slider"),mini.Spinner=function(){mini.Spinner.superclass.constructor.apply(this,arguments),this._init(),this.setValue(this.minValue||0)},mini.extend(mini.Spinner,mini.ButtonEdit,{uiCls:"mini-spinner",value:0,minValue:NaN,maxValue:NaN,increment:1,decimalPlaces:-1,changeOnMousewheel:!0,allowLoopValue:!0,allowNull:!1,format:"",showNumChinese:!1,_getButtonHtml:function(){return'<span name="trigger" class="mini-buttonedit-button mini-buttonedit-trigger" '+("onmouseover=\"mini.addClass(this, '"+this._buttonHoverCls+"');\" onmouseout=\"mini.removeClass(this, '"+this._buttonHoverCls+"');\"")+'><span class="mini-buttonedit-up"><span class="mini-icon"></span></span><span class="mini-buttonedit-down"><span class="mini-icon"></span></span></span>'},_init:function(){var t=this;mini.numeralUtil.initNumeral(function(){t.fire("_sourceLoad"),t.un("_sourceLoad")})},_initEvents:function(){mini.Spinner.superclass._initEvents.call(this),mini._BindEvents(function(){this.on("buttonmousedown",this.__OnButtonMouseDown,this),mini.on(this.el,"wheel",this.__OnWheel,this)},this)},__OnInputTextChanged:function(t){var e=this.getValue();this._oldValue=e;var i=numeral(this._textEl.value.replace(/\u3002/g,"."));this.setValue(i.value()),i!==this.getValue()&&this._OnValueChanged()},__OnInputKeyDown:function(t){mini.Spinner.superclass.__OnInputKeyDown.call(this,t);var e=mini.Keyboard;if(!this.isReadOnly()&&this.keyNavEnabled)switch(t.keyCode){case e.Top:this._oldValue=this.getValue(),this._doIncrement(!0,!0);break;case e.Bottom:this._oldValue=this.getValue(),this._doIncrement(!1,!0)}},__OnInputKeyUp:function(t){mini.Spinner.superclass.__OnInputKeyUp.call(this,t);var e=this.value,i=this._textEl.value;e!=i&&(this.setValue(i),this._OnValueChanged())},__OnButtonMouseDown:function(t){var e="up"===t.spinType;this._oldValue=this.getValue(),this._doIncrement(e,!1);var i=this,n=setInterval(function(){i._doIncrement(e,!1)},150),s="mouseup."+this.id;jQuery(document).on(s,function(){clearInterval(n),jQuery(document).off(s),i._OnValueChanged()})},_doIncrement:function(t,e){var i;arguments.length<2&&(e=!0),i=t?this.valueData.clone().add(this.increment):this.valueData.clone().subtract(this.increment),this.allowLoopValue?i.value()>this.maxValue?i=numeral(this.minValue):i.value()<this.minValue&&(i=numeral(this.maxValue)):i.value()<this.minValue?i.set(this.minValue):i.value()>this.maxValue&&i.set(this.maxValue),this.setValue(i.value()),e&&this._OnValueChanged()},__OnWheel:function(t){this.isReadOnly()||!1===this.changeOnMousewheel||(t.stopPropagation(),t.preventDefault(),this._oldValue=this.getValue(),0<t.originalEvent.deltaY?this._doIncrement(!1):this._doIncrement(!0))},_setValue:function(t){if("number"!=typeof t&&(t=numeral(t).value()),isNaN(t)||null===t?t=this.allowNull?null:this.minValue:0<=this.decimalPlaces&&(t=parseFloat(t.toFixed(this.decimalPlaces))),this.value=t,this._valueEl.value=t,this._doValueLimit(),this.valueData=numeral(this.value||0),this.setText(this.getFormatValue()),this.showNumChinese){var e=mini.formatAmountToChinese(this.value,this.formatDecimalLength);$(this._textEl).attr("data-tooltip",e),mini._controlTips&&mini._controlTips._target===this._textEl&&mini._controlTips.setContent(e)}},setValue:function(t){window.numeral?this._setValue(t):this.on("_sourceLoad",function(){this._setValue(t)},this)},_restoreValue:function(){},getFormatValue:function(){return this.allowNull&&mini.isNull(this.value)?"":this.format?this.valueData.format(this.format):this.value+""},setFormat:function(t){if("string"==typeof t&&(t=this._oldFormatTransform(t),this.format!==t)){this.format=t,window.numeral&&this.setText(this.getFormatValue());var e=t.match(/\.(0+)/);this.formatDecimalLength=e?e[1].length:null}},_oldFormatTransform:function(t){if(/^[ncp](\d+)?$/.test(t)){var e=t[0];t=t.substr(1)||"";var i=parseInt(t,10)||0;if("n"===e)return 0===i?"0,0":"0,0."+n(i,"0");if("p"===e)return 0===i?"0%":"0."+n(i,"0")+"%";if("c"===e)return 0===i?"$0":"$0."+n(i,"0")}return t;function n(t,e){return 1===t?e:new Array(t+1).join(e)}},getFormat:function(){return this.format},setMaxValue:function(t){t=parseFloat(t),this.maxValue!==t&&(this.maxValue=t,this._doValueLimit())},getMaxValue:function(){return this.maxValue},setMinValue:function(t){t=parseFloat(t),this.minValue!==t&&(this.minValue=t,this._doValueLimit())},_doValueLimit:function(){mini.isNull(this.value)&&this.allowNull||(this.value>this.maxValue?this.setValue(this.maxValue):this.value<this.minValue&&this.setValue(this.minValue))},getMinValue:function(t){return this.minValue},setIncrement:function(t){t=parseFloat(t),isNaN(t)||this.maxValue&&this.minValue&&t>this.maxValue-this.minValue||this.increment!==t&&(this.increment=t)},getIncrement:function(t){return this.increment},setDecimalPlaces:function(t){t=parseInt(t,10),isNaN(t)||t<0||(this.decimalPlaces=t)},getDecimalPlaces:function(){return this.decimalPlaces},setAllowNull:function(t){this.allowNull=t},getAllowNull:function(){return this.allowNull},setAllowLimitValue:function(){},getAllowLimitValue:function(){},setChangeOnMousewheel:function(t){this.changeOnMousewheel=!0===t},getChangeOnMousewheel:function(){return this.changeOnMousewheel},getAttrs:function(t){var e=mini.Spinner.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["minValue","maxValue","increment","decimalPlaces","format"]),mini._ParseBool(t,e,["allowNull","changeOnMousewheel","allowLoopValue","showNumChinese"]),e}}),mini.regClass(mini.Spinner,"spinner"),mini.TabsTreeSelect=function(){mini.TabsTreeSelect.superclass.constructor.call(this)},mini.extend(mini.TabsTreeSelect,mini.ValidatorBase,{mapClass:"",loadChildWhenChecked:!1,autoLoad:!1,resultAsTree:!1,loadWhenChecked:!0,text:"",value:"",width:660,height:353,expandOnLoad:!1,expandOnNodeClick:!0,idField:"id",textField:"text",nodesField:"children",url:"",filterUrl:"",filterMode:"",data:[],tabsConfig:[],tabKeys:[],showTreeIcon:!0,showTreeLines:!0,showFolderCheckBox:!0,parentField:"pid",canCheckParent:!1,checkRecursive:!0,autoCheckParent:!1,checkOnTextClick:!0,showSelectedCount:!0,showSort:!1,allowSort:!1,selectedPanelTitle:epoint_local.TabsTreeSelect.selectedPanelTitle,delimiter:",",showFullPath:!1,fullPathDelimiter:"-",includeRootNode:!1,showBorder:!1,virtualScroll:!1,uiCls:"mini-tabstreeselect",set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;delete t.text;var n=t.data;delete t.data;var s=t.showBorder;delete t.showBorder;var o=t.tabs;delete t.tabs;var r=t.url;delete t.url;var a=t.filterUrl;delete t.filterUrl;var l=t.filterMode;delete t.filterMode;var h=t.autoLoad;delete t.autoLoad;var d=t.showFullPath;delete t.showFullPath;var u=t.fullPathDelimiter;delete t.fullPathDelimiter;var c=t.includeRootNode;
// if (!mini.isNull(textField)) {
// if (!mini.isNull(idField)) {
// if (!mini.isNull(nodesField)) {
return delete t.includeRootNode,mini.TabsTreeSelect.superclass.set.call(this,t),mini.isNull(h)||this.setAutoLoad(h),mini.isNull(r)||this.setUrl(r),mini.isNull(o)||this.setTabs(o,this.autoLoad),mini.isNull(n)||this.setData(n),mini.isNull(e)||this.setValue(e),mini.isNull(i)||this.setText(i),mini.isNull(a)||this.setFilterUrl(a),mini.isNull(l)||this.setFilterMode(l),mini.isNull(d)||(this.showFullPath=d,this.tree.showFullPath=d),mini.isNull(u)||(this.fullPathDelimiter=u,this.tree.fullPathDelimiter=u),mini.isNull(c)||(this.includeRootNode=c,this.tree.includeRootNode=c),s&&(this.el.style.borderWidth="1px"),this},actionTitles:jQuery.extend({},epoint_local.TabsTreeSelect.actionTitles),sortTitles:jQuery.extend({},epoint_local.TabsTreeSelect.sortTitles),_getActionBtn:function(t,e){var i=document.createElement("span");return i.className="mini-tabstreeselect-action mini-icon "+t+("sort"===t?" none":"")+(e?" disabled":""),"removeall"===t?i.className+=" action-icon icon-trash-svg":"recover"===t&&(i.className+=" action-icon icon-back-svg"),i.title=this.actionTitles[t],i.setAttribute("data-tooltip",this.actionTitles[t]),i},_create:function(){this.el=document.createElement("div"),this.el.className="mini-tabstreeselect",this.el.innerHTML='<div class="mini-tabstreeselect-left"><div class="mini-tabstreeselect-header"></div><div class="mini-tabstreeselect-content"></div></div><div class="mini-tabstreeselect-right"><div class="mini-tabstreeselect-header"><div class="mini-tabstreeselect-header-main"><span class="mini-tabstreeselect-header-title">'+this.selectedPanelTitle+'</span><span class="mini-tabstreeselect-header-count hidden"></span></div></div><div class="mini-tabstreeselect-content"></div></div>',this._leftPanel=this.el.firstChild,this._rightPanel=this.el.lastChild,this._leftHeader=this._leftPanel.firstChild,this._rightHeader=this._rightPanel.firstChild.firstChild,this._rightTitle=this._rightHeader.firstChild,this._rightCount=this._rightHeader.lastChild,this._leftHeader.innerHTML='<ul class="mini-tabstreeselect-tabs clearfix"></ul>',this._tabs=this._leftHeader.firstChild,this._leftContent=this._leftPanel.lastChild,this._rightContent=this._rightPanel.lastChild,this.dimensionComboBox=new mini.ComboBox,this.dimensionComboBox.on("valuechanged",this.__onDimensionChanged,this),this.dimensionComboBox.render(this._leftContent),this.dimensionComboBox.hide(),this.tree=new mini.FilterTree,this.tree.setShowTreeIcon(!0),this.tree.setStyle("border:0;width:100%;height:100%;overflow:hidden;"),this.tree.setDefaultRowHeight(33),this.tree.setResultAsTree(this.resultAsTree),this.tree.setCheckRecursive(this.checkRecursive),this.tree.setShowCheckBox(!0),this.tree.setShowFolderCheckBox(this.showFolderCheckBox),this.tree.setExpandOnNodeClick(this.expandOnNodeClick),this.tree.setCheckOnTextClick(this.checkOnTextClick),this.tree.setAutoLoad(!0),this.tree.on("load",this.__OnLoad,this),this.tree.on("nodeclick",this.__OnNodeClick,this),this.tree.on("nodecheck",this.__OnCheckedChanged,this),this.tree.on("expand",this.__OnTreeExpand,this),this.tree.on("collapse",this.__OnTreeCollapse,this),this.tree.on("beforenodecheck",this.__OnTreeBeforeNodeCheck,this),this.tree.on("beforenodeselect",this.__OnTreeBeforeNodeSelect,this),this.tree.on("drawnode",this.__OnDrawNode,this),this.tree.on("loadnode",this.__OnLoadNode,this),this.tree.on("beforeload",this.__OnBeforeLoad,this),this.tree.on("filter",this.__OnFilter,this),this.tree.useAnimation=!0,this.tree.render(this._leftContent),this._rightContent.innerHTML='<div class="mini-tabstreeselect-buttons"></div>',this._buttons=this._rightContent.firstChild,this._listItemTempl='<li class="mini-tabstreeselect-item" guid="{{value}}"><span class="item-name" title="{{name}}">{{name}}</span><i class="mini-tabstreeselect-action mini-icon remove" title="'+this.actionTitles.remove+'"></i></li>',this._selectList=this._selectList({tabsTreeSelect:this,textField:this.textField,idField:this.idField,virtualScroll:this.virtualScroll}),this._rightContent.appendChild(this._selectList.el),this.allowSort?(this._buttons.appendChild(this.sortBtn=this._getActionBtn("sort")),this._buttons.appendChild(this.topBtn=this._getActionBtn("top",!0)),this._buttons.appendChild(this.bottomBtn=this._getActionBtn("bottom",!0))):mini.addClass(this._rightContent,"disable-sort"),this._buttons.appendChild(this.recoverBtn=this._getActionBtn("recover")),this._buttons.appendChild(this.removeallBtn=this._getActionBtn("removeall")),this.selectNodes={},this.selectedCount=0,this.bindEvents()},_selectList:function(t){function e(t){this.tabsTreeSelect=t.tabsTreeSelect,this.nodes=[],this.nodeIdMap={},this.virtualScroll=t.virtualScroll||!1,this.textField=t.textField||"text",this.idField=t.idField||"value",this.el=document.createElement("div"),this.el.className="mini-tabstreeselect-list",this.$views=jQuery('<div class="mini-tabstreeselect-views"></div>').appendTo(this.el),this.viewTpl='<ul class="mini-tabstreeselect-view">{{#.}}'+this.tabsTreeSelect._listItemTempl+"{{/.}}</ul>",this.$view=null,this.$vscroll=null}return jQuery.extend(e.prototype,{initEvents:function(){this.virtualScroll&&(this.vscrollLock=!1,this.viewLock=!1,mini.on(this.$vscroll[0],"scroll",this.__OnVscrollScroll,this),mini.on(this.$views[0],"scroll",this.__OnViewsScroll,this))},unBindEvents:function(){this.$vscroll&&(this.vscrollLock=null,mini.un(this.$vscroll[0],"scroll",this.__OnVscrollScroll,this)),this.$views&&(this.viewLock=null,mini.un(this.$views[0],"scroll",this.__OnViewsScroll,this))},__OnVscrollScroll:function(t){if(this.vscrollLock)this.vscrollLock=!1;else{var e=t.currentTarget.scrollTop/this.ratio,i=Math.floor((e+this.halfLine)/this.oneScreenH);this._render(i),this.viewLock=!0,this.$views[0].scrollTop=e-Math.max((i-1)*this.oneScreenH,0)}},__OnViewsScroll:function(t){if(this.viewLock)this.viewLock=!1;else{this.$cur.position().top>this.halfLine?this._render(this.currentScreenNo-1):this.$next.position().top<this.halfLine&&this._render(this.currentScreenNo+1);var e=Math.max((this.currentScreenNo-1)*this.oneScreenN*this.itemH,0)+t.currentTarget.scrollTop;this.vscrollLock=!0,this.$vscroll[0].scrollTop=e*this.ratio}},doUpdate:function(t,e){this.virtualScroll?this.virtualRender(t,e):this.normalRender(t,e)},virtualRender:function(t,e){if(!this.$vscroll){if(this.$vscroll=jQuery('<div class="mini-tabstreeselect-vscroll"><div class="mini-tabstreeselect-vscroll-content"></div></div>').appendTo(this.el),this.$vscrollContent=this.$vscroll.children().first(),this.viewsH=this.$views.height(),this.halfLine=this.viewsH/2,!this.itemH){var i=jQuery('<ul class="mini-tabstreeselect-view"></ul>').appendTo(this.$views),n=jQuery(this.tabsTreeSelect._listItemTempl).addClass("mini-tabstreeselect-box-measure").appendTo(i);this.itemH=n.outerHeight(!0),n.remove(),i.remove()}this.oneScreenN=Math.max(Math.ceil(this.viewsH/this.itemH),10),this.oneScreenH=this.oneScreenN*this.itemH,this.currentScreenNo=0,this._syncVscrollHeight(),this._render(0,!0),this.initEvents()}var s,o,r,a,l,h=Math.max(this.currentScreenNo-1,0)*this.oneScreenN,d=0===this.currentScreenNo?2*this.oneScreenN-1:h+3*this.oneScreenN-1;if("insert"===t)this._syncVscrollHeight(),l=(s=e.index)+(a=Array.isArray(e.node)?e.node.length:1)-1,(h<=s&&s<=d||h<=l&&l<=d)&&(o=this.$views[0].scrollTop,this._render(this.currentScreenNo,!0),this.$views[0].scrollTop=o);else if("remove"===t)this._syncVscrollHeight(),l=(s=e.index)+(a=Array.isArray(e.node)?e.node.length:1)-1,s<h?(this.$vscroll[0].scrollTop-=this.itemH*this.ratio*(l<h?a:h-s),r=Math.ceil((this.$vscroll[0].scrollTop/this.ratio+this.halfLine)/this.oneScreenH),this._render(r,!0),this.$views[0].scrollTop=this.$vscroll[0].scrollTop/this.ratio-Math.max((r-1)*this.oneScreenH,0)):s<=d&&(o=this.$views[0].scrollTop,this._render(this.currentScreenNo,!0),this.$views[0].scrollTop=o);else if("move"===t){var u=e.oldIndex,c=e.newIndex;(h<=u&&u<=d||h<=c&&c<=d)&&(o=this.$views[0].scrollTop,this._render(this.currentScreenNo,!0),this.$views[0].scrollTop=o),u<h&&h<=c?this.$vscroll[0].scrollTop-=this.itemH*this.ratio:c<h&&h<=u&&(this.$vscroll[0].scrollTop+=this.itemH*this.ratio)}else if("update"===t){if(h<=(s=e.index)&&s<=d&&"text"===e.field){var m=e.value;this.$views.find('[guid="'+e.node[this.idField]+'"] .item-name').text(m).attr("title",m)}}else"clear"===t?(this.$views.empty(),this.currentScreenNo=0,this._syncVscrollHeight()):"refresh"===t&&(this._syncVscrollHeight(),this.currentScreenNo=0,this._render(0,!0))},_syncVscrollHeight:function(){if(this.$vscrollContent){var t=this.nodes.length*this.itemH,e=Math.min(1e7,t);this.ratio=(e-this.viewsH)/(t-this.viewsH),this.$vscrollContent.height(e)}},_render:function(t,e){var i,n,s,o=this;if(e||1<Math.abs(t-this.currentScreenNo))return this.$cur&&this.$cur.remove(),this.$prev&&this.$prev.remove(),this.$next&&this.$next.remove(),i=r(this.nodes.slice((t-1)*this.oneScreenN,t*this.oneScreenN)),this.$prev=$(Mustache.render(this.viewTpl,i)).appendTo(this.$views),n=r(this.nodes.slice(t*this.oneScreenN,(t+1)*this.oneScreenN)),this.$cur=$(Mustache.render(this.viewTpl,n)).appendTo(this.$views),s=r(this.nodes.slice((t+1)*this.oneScreenN,(t+2)*this.oneScreenN)),this.$next=$(Mustache.render(this.viewTpl,s)).appendTo(this.$views),void(this.currentScreenNo=t);function r(t){return t.map(function(t){return{name:t[o.textField],value:t[o.idField]}})}t!==this.currentScreenNo&&(t-this.currentScreenNo==-1?(this.$next&&this.$next.remove(),this.$next=this.$cur,this.$cur=this.$prev,i=r(this.nodes.slice((t-1)*this.oneScreenN,t*this.oneScreenN)),this.$prev=$(Mustache.render(this.viewTpl,i)).prependTo(this.$views)):t-this.currentScreenNo==1&&(this.$prev&&this.$prev.remove(),this.$prev=this.$cur,this.$cur=this.$next,s=r(this.nodes.slice(this.oneScreenN*(t+1),this.oneScreenN*(t+2))),this.$next=$(Mustache.render(this.viewTpl,s)).appendTo(this.$views)),this.currentScreenNo=t)},normalRender:function(t,e){var i,n,s,o,r=this;if(this.$view||(this.$view=jQuery('<ul class="mini-tabstreeselect-view"></ul>').appendTo(this.$views)),"insert"===t)i=[],n=e.node,Array.isArray(n)||(n=[n]),n.forEach(function(t){i.push(Mustache.render(r.tabsTreeSelect._listItemTempl,{name:t[r.textField],value:t[r.idField]}))}),0===e.index?this.$view.prepend(i.join("")):(s=this.$view.children().eq(e.index)).length?jQuery(i.join("")).insertBefore(s):this.$view.append(i.join(""));else if("remove"===t){if(o=jQuery(this.$view.children().eq(e.index)),Array.isArray(e.node))for(var a=1,l=e.node.length;a<l;a++)o=o.add(jQuery(this.$view.children().eq(e.index+a)));o.remove()}else"move"===t?(o=jQuery(this.$view.children().eq(e.oldIndex)).remove(),(s=jQuery(this.$view.children().eq(e.newIndex))).length?s.before(o):this.$view.append(o)):"update"===t?"text"===e.field&&jQuery(this.$view.children().eq(e.index)).find(".item-name").text(e.value).attr("title",e.value):"clear"===t?this.$view.empty():"refresh"===t&&(i=[],this.nodes.forEach(function(t){i.push(Mustache.render(r.tabsTreeSelect._listItemTempl,{name:t[r.textField],value:t[r.idField]}))}),this.$view.html(i.join("")))},doLayout:function(){if(this.virtualScroll){if(this.viewsH=this.$views.height(),this.halfLine=this.viewsH/2,!this.itemH){var t=jQuery('<ul class="mini-tabstreeselect-view"></ul>').appendTo(this.$views),e=jQuery(this.tabsTreeSelect._listItemTempl).addClass("mini-tabstreeselect-box-measure").appendTo(t);this.itemH=e.outerHeight(),e.remove(),t.remove()}this.oneScreenN=Math.max(Math.ceil(this.viewsH/this.itemH),10),this.oneScreenH=this.oneScreenN*this.itemH,this.$vscroll[0].scrollTop=0}},cloneNode:function(t){var e={};return e[this.idField]=t[this.idField],e[this.textField]=this.tabsTreeSelect.tree.getItemText(t),e},append:function(t){var e=this;if(Array.isArray(t)){var i=[];t.forEach(function(t){e.nodeIdMap[t[e.idField]]||i.push(e.cloneNode(t))}),i.forEach(function(t){e.nodes.push(t),e.nodeIdMap[t[e.idField]]=t}),this.doUpdate("insert",{index:this.nodes.length-i.length,node:i})}else if(!this.nodeIdMap[t[this.idField]]){var n=this.cloneNode(t);this.nodes.push(n),this.nodeIdMap[n[this.idField]]=n,this.doUpdate("insert",{index:this.nodes.length-1,node:n})}},prepend:function(t){var e=this;if(Array.isArray(t)){var i=[];t.forEach(function(t){e.nodeIdMap[t[e.idField]]||i.push(e.cloneNode(t))}),this.nodes=i.concat(this.nodes),i.forEach(function(t){e.nodeIdMap[t[e.idField]]=t}),this.doUpdate("insert",{index:0,node:i})}else if(!this.nodeIdMap[t[this.idField]]){var n=this.cloneNode(t);this.nodes.unshift(n),this.nodeIdMap[n[this.idField]]=n,this.doUpdate("insert",{index:0,node:n})}},insertAfter:function(t,e){var i=null;if("object"==typeof e?i=this.nodeIdMap[e[this.idField]]:"string"==typeof e&&(i=this.nodeIdMap[e]),i){var n=null,s=null;if("object"==typeof t?s=this.nodeIdMap[t[this.idField]]:"string"==typeof t&&(s=this.nodeIdMap[t]),s){var o=this.nodes.indexOf(s);this.nodes.splice(o,1),n=this.nodes.indexOf(i),this.nodes.splice(n+1,0,s),this.doUpdate("move",{oldIndex:o,newIndex:n+1,node:s})}else{var r=this.cloneNode(t);n=this.nodes.indexOf(i),this.nodes.splice(n+1,0,r),this.nodeIdMap[r[this.idField]]=r,this.doUpdate("insert",{index:n+1,node:r})}}},insertBefore:function(t,e){var i=null;if("object"==typeof e?i=this.nodeIdMap[e[this.idField]]:"string"==typeof e&&(i=this.nodeIdMap[e]),i){var n=null,s=null;if(s="object"!=typeof t?this.nodeIdMap[t]:this.nodeIdMap[t[this.idField]]){var o=this.nodes.indexOf(s);this.nodes.splice(o,1),n=this.nodes.indexOf(i),this.nodes.splice(n,0,s),this.doUpdate("move",{oldIndex:o,newIndex:n,node:s})}else{var r=this.cloneNode(t);n=this.nodes.indexOf(i),this.nodes.splice(n,0,r),this.nodeIdMap[r[this.idField]]=r,this.doUpdate("insert",{index:n,node:r})}}},remove:function(t){var e=this,i=[],n=null;if("string"==typeof t?(n=this.nodeIdMap[t])&&i.push({index:this.nodes.indexOf(n),node:n}):Array.isArray(t)?t.forEach(function(t){(n=e.nodeIdMap[t[e.idField]])&&i.push({index:e.nodes.indexOf(n),node:n})}):"object"==typeof t&&(n=this.nodeIdMap[t[this.idField]])&&i.push({index:this.nodes.indexOf(n),node:n}),i.length){var s;for(i.sort(function(t,e){return t.index-e.index}),s=i.length-1;0<=s;s--)n=i[s],this.nodes.splice(n.index,1),delete this.nodeIdMap[n.node[this.idField]];var o=(n=i[0]).index,r=[n.node];for(s=1;s<i.length;s++)(n=i[s]).index!==i[s-1].index+1?(this.doUpdate("remove",{index:o,node:r}),r=[n.node],o=n.index):r.push(n.node);r.length&&this.doUpdate("remove",{index:o,node:r})}},moveTop:function(t){this.insertBefore(t,this.nodes[0])},canMoveTop:function(t){var e=this.nodeIdMap[t];return 0!==this.nodes.indexOf(e)},moveBottom:function(t){this.insertAfter(t,this.nodes[this.nodes.length-1])},canMoveBottom:function(t){var e=this.nodeIdMap[t];return this.nodes.indexOf(e)!==this.nodes.length-1},clear:function(){this.nodes=[],this.nodeIdMap={},this.doUpdate("clear")},findNode:function(t){if(t)return this.nodeIdMap[t]},setNodes:function(t){this.clear(),this.append(t)},getNodes:function(){var i=this;return this.nodes.map(function(t){var e={};return e[i.idField]=t[i.idField],e[i.textField]=t[i.textField],e})},getValue:function(){var e=this;return this.nodes.map(function(t){return t[e.idField]}).join(",")},getText:function(){var e=this;return this.nodes.map(function(t){return t[e.textField]}).join(",")},setText:function(t){var e=this.nodeIdMap[t[this.idField]];if(e){var i=t[this.textField];e[this.textField]=i,this.doUpdate("update",{index:this.nodes.indexOf(e),field:"text",value:i,node:e})}},setVirtualScroll:function(t){this.virtualScroll!==!!t&&(this.virtualScroll=!!t,this.virtualScroll?(this.unBindEvents(),this.$views.empty(),this.$view=null):(this.unBindEvents(),this.$views.empty(),this.$vscroll.remove(),this.$vscroll=null),this.doUpdate("refresh"))},getCount:function(){return this.nodes.length}}),new e(t)},__OnDrawNode:function(t){this.fire("drawnode",t)},__OnTreeBeforeNodeCheck:function(t){t.tree=t.sender,this.fire("beforenodecheck",t)},__OnTreeBeforeNodeSelect:function(t){t.tree=t.sender,this.fire("beforenodeselect",t)},__OnTreeExpand:function(t){this.fire("treeexpand",t)},__OnTreeCollapse:function(t){this.fire("treecollapse",t)},__OnNodeClick:function(t){this.fire("nodeclick",{node:t.node})},__OnBeforeLoad:function(t){this.fire("beforeload",t)},__OnCheckedChanged:function(t){var e=t.node;if(this.loadWhenChecked||!(t.isLeaf||!this.checkRecursive&&this.canCheckParent||this._getIsLoaded(e))){var i={node:e,eventType:"checkedchanged"};this.showSort&&(i.direction=this._curAutoSortDirection);var n={url:this.treeUrl,data:i,sender:this};this.fire("beforecheckload",n),this._loadValue(n)}else e.checked?this._addNode(e):this._removeNode(e)},_getIsLoaded:function(t){if(this.tree.isLeaf(t))return!0;var e=this.tree.getChildNodes(t),i=e.length;if(!i)return!1;for(var n=0;n<i;n++)if(!this._getIsLoaded(e[n]))return!1;return!0},__OnLoadNode:function(t){var e=t.node,i=this.idField,n=this.tree,s=this.selectNodes;n.eachChild(e,function(t){s[t[i]]?n.checkNode(t):t.checked&&!t.isLeaf?n.checkNode(t):n.uncheckNode(t)}),!e.checked||this.checkRecursive||s[e[i]]||this.tree.uncheckNode(e)},__OnLoad:function(t){this.fire("load",t)},__OnFilter:function(t){},__onDimensionChanged:function(t){var e=this.tabsConfig[this._activeTabIndex],i=this.tabKeys[this._activeTabIndex],n=e.url+"&dimension="+t.value,s=e.filterUrl,o=this.tree._filterInput.getValue();s&&this.tree.setFilterUrl(s+"&dimension="+t.value),this._setLastDimensionValue(i,t.value),o&&"server"===this.tree.filterMode?(this.tree.setAutoLoad(!1),this.tree.setUrl(n),this.treeUrl=n,this.tree._doFilter(o)):(this.tree.url=n,this.tree.setUrl(n),this.treeUrl=n,o&&this.tree._doFilter(o))},_addNode:function(t){this._selectList.el.style.height||(this._selectList.el.style.height=jQuery(this._rightContent).height()-jQuery(this._buttons).outerHeight(!0)+"px",this._selectList.doLayout());var e=t[this.idField];if(this.canCheckParent||this.tree.isLeaf(t)&&!this.selectNodes[e])this.selectNodes[e]=t,"none"!=this._curAutoSortDirection?this._addNodeByDirection(t,this._curAutoSortDirection):this._selectList.append(t);else{var i=this.tree.getChildNodes(t);if(i.length||this.tree.isLeaf(t))for(var n=0,s=i.length;n<s;n++)this._addNode(i[n]);else this.loadChildWhenChecked&&(this.tree._dataSource.loadParams.needAll=!0,this.tree.loadNode(t),this.tree._dataSource.loadParams.needAll=!1)}this._setSelectedCount()},_addNodeByDirection:function(t,e){for(var i,n,s=this.tree.getValue().split(","),o=t[this.idField],r=0,a=s.length;r<a&&s[r]!==o;r++);i="asc"===e?s[r-1]:s[r+1],(n=this._selectList.findNode(i))?this._selectList.insertAfter(t,n):this._selectList.prepend(t)},_removeNode:function(t){var i=this,e=this._getTreeNodeAsList(t);e.forEach(function(t){var e=t[i.idField];delete i.selectNodes[e]}),this._selectList.remove(e),this._setSelectedCount()},_getTreeNodeAsList:function(t,e){if((e=e||[]).push(t),this.checkRecursive&&!this.tree.isLeaf(t))for(var i=this.tree.getChildNodes(t),n=0,s=i.length;n<s;n++)this._getTreeNodeAsList(i[n],e);return e},bindEvents:function(){var n=this;jQuery(this._tabs).on("click","> li",function(){var t=jQuery(this),e=t.index();t.hasClass("active")||n.activeTab(e)}),jQuery(this._selectList.el).on("click",".remove",function(){var t=jQuery(this.parentNode),e=t.attr("guid"),i=n.tree.getNode(e);t.hasClass("selected")&&(n.selectedListNode=null),i?(n._removeNode(i),n.tree.uncheckNode(i)):(n._selectList.remove(e),delete n.selectNodes[e],n._setSelectedCount()),n._updateButtons()}).on("mousedown",".mini-tabstreeselect-item",function(t){n.allowSort&&(n.dragItem=this,n.getDrag().start(t))}).on("click",".mini-tabstreeselect-item",function(){var t=jQuery(this);t.hasClass("selected")||(n.selectedListNode&&n.selectedListNode.removeClass("selected"),t.addClass("selected"),n.selectedListNode=t,n._updateButtons())}),jQuery(this._buttons).on("click",".mini-tabstreeselect-action",function(){var t;mini.hasClass(this,"disabled")||(mini.hasClass(this,"sort")&&n.toggleAutoSort(),mini.hasClass(this,"top")?(t=n.selectedListNode.attr("guid"),n._selectList.moveTop(t),n.toggleAutoSort(!0)):mini.hasClass(this,"bottom")?(t=n.selectedListNode.attr("guid"),n._selectList.moveBottom(t),n.toggleAutoSort(!0)):mini.hasClass(this,"removeall")?n.clearAll():mini.hasClass(this,"recover")&&(n.setValue(n.value),n.setText(n.text)),n._updateButtons())})},getDrag:function(){return this.drag||(this.drag=new mini.Drag({capture:!1,onStart:mini.createDelegate(this._OnDragStart,this),onMove:mini.createDelegate(this._OnDragMove,this),onStop:mini.createDelegate(this._OnDragStop,this)})),this.drag},_OnDragStart:function(t){this._dragProxy=mini.append(document.body,'<div class="mini-tabstreeselect-proxy"></div>'),this._dragProxy.innerHTML='<div class="mini-tabstreeselect-proxy-inner">'+this.dragItem.outerHTML+"</div>",mini.setXY(this._dragProxy,t.now[0]+15,t.now[1]+18),mini.setWidth(this._dragProxy,mini.getBox(this.dragItem).width),this.feedbackLine=mini.append(document.body,"<div class='mini-feedback-line'></div>"),mini.addClass(this.dragItem,"dragging")},_OnDragMove:function(t){var e=t.now[0],i=t.now[1];mini.setXY(this._dragProxy,e+15,i+18),this.targetItem=this.insertAction=null;var n=mini.findParent(t.event.target,"mini-tabstreeselect-item");if(n){this.targetItem=n,this.insertAction="before";var s=mini.getBox(this.targetItem);i>s.y+s.height/2&&(this.insertAction="after"),this.feedbackLine.style.display="block","after"==this.insertAction?mini.setXY(this.feedbackLine,s.x,s.y+s.height):mini.setXY(this.feedbackLine,s.x,s.y),mini.setWidth(this.feedbackLine,s.width)}else this.feedbackLine.style.display="none"},_removeDrag:function(){mini.removeNode(this._dragProxy),mini.removeNode(this.feedbackLine),this._dragProxy=this.feedbackLine=this.dragItem=this.targetItem=null},_OnDragStop:function(t){if(this.targetItem){var e=this.targetItem.getAttribute("guid"),i=this.dragItem.getAttribute("guid");"before"==this.insertAction?this._selectList.insertBefore(i,e):this._selectList.insertAfter(i,e),this.toggleAutoSort(!0)}mini.removeClass(this.dragItem,"dragging"),this._removeDrag()},_curAutoSortDirection:"none",toggleAutoSort:function(t){if(this.showSort){var e=t?"none":this._getNextAutoSortDirection();mini.removeClass(this.sortBtn,"asc desc none"),mini.addClass(this.sortBtn,e),this.sortBtn.setAttribute("title",this.sortTitles[e]),"none"!=(this._curAutoSortDirection=e)&&this._serverSort(e)}},_getNextAutoSortDirection:function(){switch(this._curAutoSortDirection){case"asc":return"desc";case"desc":default:return"asc"}},
//     var needServerSort = treeValue.split(',').length != this.getValue().split(',').length;
_serverSort:function(t){var e=this.getValue(),i={value:e,direction:t,eventType:"sortChanged"},n={url:this.treeUrl,data:i,sender:this};this.fire("beforesortchanged",n),e&&1<e.split(",").length&&this._loadValue(n)},_loadValue:function(t){var h=this,e=setTimeout(function(){h.mask(),h.isMask=!0},100);jQuery.ajax({url:t.url,data:t.data,type:"post",dataType:"json",success:function(t){var e={data:t};if(h.fire("beforeloadvalue",e),!e.cancel&&(t=e.value!==undefined?{value:e.value,text:e.text}:mini.getSecondRequestData(t))){var i,n,s,o=h.getValue(),r=0,a=0,l=[];if(h.selectNodes={},h.canCheckParent&&h.tree.uncheckAllNodes(),t.value){for(i=t.value.split(","),n=t.text.split(","),a=i.length;r<a;r++)(s=h.tree.getNode(i[r]))?h.tree.checkNode(s):((s={})[h.idField]=i[r],s[h.textField]=n[r]),h.selectNodes[i[r]]=s,l.push(s);h._selectList.setNodes(l)}else h._selectList.setNodes("");h._updateButtons(),h._setSelectedCount(a),o!=h.getValue()&&h._OnValueChanged()}},complete:function(){e&&clearTimeout(e),h.isMask&&(h.unmask(),h.isMask=!1)}})},_updateButtons:function(){function t(t){mini.removeClass(t,"disabled")}function e(t){mini.addClass(t,"disabled")}var i=this.selectedListNode?this.selectedListNode.attr("guid"):null;if(!i)return e(this.topBtn),void e(this.bottomBtn);this._selectList.canMoveTop(i)?t(this.topBtn):e(this.topBtn),this._selectList.canMoveBottom(i)?t(this.bottomBtn):e(this.bottomBtn)},getSelectedNodes:function(){var e=this;return this._selectList.getNodes().map(function(t){return{value:t[e.idField],text:t[e.textField]}})},setSelectedNodes:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=this.tree.getNode(t[i].value);s?this.tree.checkNode(s):((s={})[this.textField]=t[i].text,s[this.idField]=t[i].value,this.selectNodes[t[i].value]=s),e.push(s)}this._selectList.append(e)},clearAll:function(t){
// if (!this._selectList.innerHTML) return;
this._selectList.clear(),this.selectNodes={},this.selectedListNode=null,t||this.tree.uncheckAllNodes(),this._setSelectedCount(0)},setValue:function(t,e){var i=(this.value=t).split(",");if(this.clearAll(e),t){for(var n=[],s=0,o=i.length;s<o;s++){var r=this.tree.getNode(i[s]);r?e||this.tree.checkNode(r):(r={})[this.textField]=r[this.idField]=i[s],this.selectNodes[i[s]]=r,n.push(r)}this._selectList.append(n),this._updateButtons(),this._setSelectedCount(o)}},getValue:function(){return this._selectList.getValue()},setText:function(t){if(this.text=t)for(var e,i,n=t.split(","),s=this.value.split(","),o=0,r=s.length;o<r;o++)i=s[o],(e=this.selectNodes[i])&&(e[this.textField]=n[o],this._selectList.setText(e))},getText:function(){return this._selectList.getText()},setSelectedPanelTitle:function(t){this.selectedPanelTitle=t,this._rightTitle.innerHTML=t},_setSelectedCount:function(t){
// if (count !== undefined) {
//     if (this.selectedCount !== 0) {
this.showSelectedCount&&(0!==(t=0<=t?t:this._selectList.getCount())?mini.removeClass(this._rightCount,"hidden"):mini.addClass(this._rightCount,"hidden"),this._rightCount.innerHTML=t)},setShowSelectedCount:function(t){this.showSelectedCount=!0===t,this.showSelectedCount?mini.removeClass(this._rightCount,"hidden"):mini.addClass(this._rightCount,"hidden")},getShowSelectedCount:function(){return this.showSelectedCount},doLayout:function(){var t=jQuery(this.el).height();this._leftPanel.style.height=t+"px",this._rightPanel.style.height=t+"px";var e=jQuery(this._rightContent).height()-jQuery(this._buttons).outerHeight(!0);this._selectList.el.style.height=(0<=e?e:0)+"px",this._selectList.doLayout(),this.tree.doLayout()},setTabs:function(t,e){var i,n,s=[],o=0<this.url.indexOf("?");for(this.tabsConfig=[],this.tabKeys=[],i=0,n=t.length;i<n;i++){s.push("<li>"+t[i].tabText+"</li>");var r=(o?"&":"?")+"tabKey="+t[i].tabKey;this.tabsConfig.push({url:this.url+r,filterMode:t[i].filterMode,filterUrl:this.filterUrl?this.filterUrl+r:undefined,showDimension:t[i].showDimension}),this.tabKeys.push(t[i].tabKey),t[i].showDimension&&(this.showDimension=!0)}this._tabs.innerHTML=s.join(""),this.doLayout(),this.activeTab(0,e)},addTab:function(t,e){var i=(0<this.url.indexOf("?")?"&":"?")+"tabKey="+t.tabKey;this.tabsConfig.push({url:this.url+i,filterMode:t.filterMode,filterUrl:this.filterUrl?this.filterUrl+i:undefined}),this.tabKeys.push(t.tabKey),jQuery("<li>"+t.tabText+"</li>").appendTo(this._tabs),this.doLayout(),!1!==e&&this.activeTab(this.tabsConfig.length-1,!0)},_getDimensionKey:function(t){return this.id+"_"+t},_getLastDimensionValue:function(t){var e=this._getDimensionKey(t);return mini.Cookie.get(e)},_setLastDimensionValue:function(t,e){document.cookie=this._getDimensionKey(t)+"="+escape(e)+";path="+window.location.pathname},_activeTabIndex:0,activeTab:function(t,e){var i,n,s,o=this.tabsConfig[t],r=jQuery(this._tabs).children().eq(t);if(o){r.hasClass("active")||(r.siblings(".active").removeClass("active"),r.addClass("active")),this._activeTabIndex=t;var a=this.tree._filterInput.getValue();this.tree._filterKey=a,n=o.url,s=o.filterUrl,o.showDimension?((i=this._getLastDimensionValue(this.tabKeys[t]))?this.dimensionComboBox.setValue(i):i=this.dimensionComboBox.getValue(),n+="&dimension="+i,s&&(s+="&dimension="+i),this.dimensionComboBox.show(),this.tree.setHeight($(this._leftContent).height()-this.dimensionComboBox.getHeight()-5)):(this.dimensionComboBox.hide(),this.tree.setHeight("100%")),o.filterMode&&this.tree.setFilterMode(o.filterMode),s&&this.tree.setFilterUrl(s);var l=a&&"server"===this.tree.filterMode;if(!this.url)return;l?(this.tree.setAutoLoad(!1),this.tree.setUrl(n),this.treeUrl=n,this.tree._doFilter(a)):(!1===e?this.tree.setAutoLoad(!1):this.tree.setAutoLoad(!0),this.tree._dataSource.ajaxData={activeTab:!0},this.tree.setUrl(n),this.tree._dataSource.ajaxData=null,this.tree._dataSource.loadParams&&(this.tree._dataSource.loadParams.activeTab=!1),this.treeUrl=n,!l&&!1!==e||this.tree.setAutoLoad(!0),a&&this.tree._doFilter(a))}},setData:function(data){"string"==typeof data&&(data=eval("("+data+")"));var treeData=data.tree||data,dimensionData=data.dimension;mini.isArray(treeData)||(treeData=[]),this.resultAsTree?this.tree.setData(treeData):this.tree.loadList(treeData),mini.isArray(dimensionData)||(dimensionData=[]),this.dimensionComboBox.setData(dimensionData),this.data=data},getData:function(){return this.data},setUrl:function(t){this.url=t,this._updateTabsUrl()},getUrl:function(){return this.url},getAutoLoad:function(){return this.autoLoad},setAutoLoad:function(t){this.autoLoad=t},setTabKeys:function(t){this.tabKeys=t,this._updateTabsUrl()},_updateTabsUrl:function(){var t,e=Math.min(this.tabKeys.length,this.tabsConfig.length),i=0<this.url.indexOf("?");if(0<e){for(t=0;t<e;t++){var n=(i?"&":"?")+"tabKey="+this.tabKeys[t];this.tabsConfig[t].url=this.url+n,this.tabsConfig[t].filterUrl=this.filterUrl?this.filterUrl+n:undefined}this.activeTab(0,this.autoLoad)}},load:function(){this.tree.load()},setResultAsTree:function(t){this.resultAsTree=t,this.tree&&this.tree.setResultAsTree(t)},getResultAsTree:function(){return this.resultAsTree},setParentField:function(t){this.parentField=t,this.tree&&this.tree.setParentField(t)},getParentField:function(){return this.parentField},setDataField:function(t){this.dataField=t,this.tree&&this.tree.setDataField(t)},getDataField:function(){return this.dataField},setIdField:function(t){this.tree&&this.tree.setIdField(t),this.idField=t},getIdField:function(){return this.idField},getTextField:function(){return this.textField},setTextField:function(t){this.textField=t,this.tree&&this.tree.setTextField(t)},getNodesField:function(){return this.nodesField},setNodesField:function(t){this.nodesField=t,this.tree&&this.tree.setNodeField(t)},setShowTreeIcon:function(t){this.showTreeIcon=t,this.tree&&this.tree.setShowTreeIcon(t)},getShowTreeIcon:function(){return this.showTreeIcon},setShowTreeLines:function(t){this.showTreeLines=t,this.tree&&this.tree.setShowTreeLines(t)},getShowTreeLines:function(){return this.showTreeLines},setShowFolderCheckBox:function(t){this.showFolderCheckBox=t,this.tree&&this.tree.setShowFolderCheckBox(t)},getShowFolderCheckBox:function(){return this.showFolderCheckBox},setFilterUrl:function(t){this.filterUrl=t,this.tree&&this.tree.setFilterUrl(t)},getFilterUrl:function(){return this.filterUrl},setFilterMode:function(t){this.filterMode=t,this.tree&&this.tree.setFilterMode(t)},getFilterMode:function(){return this.filterMode},setCanCheckParent:function(t){this.canCheckParent=t,this.tree&&this.tree.setCheckRecursive(!t)},getCanCheckParent:function(){return this.canCheckParent},setCheckRecursive:function(t){this.checkRecursive=t,this.tree&&this.tree.setCheckRecursive(t)},getCheckRecursive:function(){return this.checkRecursive},setAutoCheckParent:function(t){this.autoCheckParent=t,this.tree&&this.tree.setAutoCheckParent(t)},getAutoCheckParent:function(){return this.AutoCheckParent},setExpandOnLoad:function(t){this.expandOnLoad=t,this.tree&&this.tree.setExpandOnLoad(t)},getExpandOnLoad:function(){return this.expandOnLoad},setCheckOnTextClick:function(t){this.checkOnTextClick=t,this.tree&&this.tree.setCheckOnTextClick(t)},setExpandOnNodeClick:function(t){this.expandOnNodeClick=t,this.tree&&this.tree.setExpandOnNodeClick(t)},getShowFullPath:function(){return this.showFullPath},getFullPathDelimiter:function(){return this.fullPathDelimiter},getVirtualScroll:function(){return this.virtualScroll},setVirtualScroll:function(t){this.virtualScroll!==!!t&&(this.virtualScroll=!!t,jQuery(this._selectList.el)[(this.virtualScroll?"add":"remove")+"Class"]("mini-tabstreeselect-virtual-scroll"),this._selectList.setVirtualScroll(this.virtualScroll),this.tree.setVirtualScroll(this.virtualScroll))},setAllowSort:function(t){this.allowSort!==!!t&&(this.allowSort=!!t,this.allowSort?(mini.removeClass(this._rightContent,"disable-sort"),this.showSort&&this._buttons.appendChild(this.sortBtn=this._getActionBtn("sort")),this._buttons.appendChild(this.topBtn=this._getActionBtn("top",!0)),this._buttons.appendChild(this.bottomBtn=this._getActionBtn("bottom",!0)),this._updateButtons()):(mini.addClass(this._rightContent,"disable-sort"),this.sortBtn&&(this._buttons.removeChild(this.sortBtn),this.sortBtn=null),this._buttons.removeChild(this.topBtn),this.topBtn=null,this._buttons.removeChild(this.bottomBtn),this.bottomBtn=null))},getAllowSort:function(){return this.allowSort},setShowSort:function(t){this.showSort!==!!t&&(this.showSort=!!t,this.showSort&&this.allowSort?this._buttons.insertBefore(this.sortBtn=this._getActionBtn("sort"),this._buttons.firstChild):this.sortBtn&&(this._buttons.removeChild(this.sortBtn),this.sortBtn=null))},getShowSort:function(){return this.showSort},getAttrs:function(t){var e=mini.TabsTreeSelect.superclass.getAttrs.call(this,t);mini._ParseString(t,e,["data","textField","pinyinField","idField","nodesField","parentField","dataField","onbeforenodecheck","onbeforenodeselect","onnodeclick","url","filterUrl","filterMode","onbeforeload","onload","ontreeexpand","ontreecollapse","ondrawnode","onbeforeloadvalue","selectedPanelTitle","fullPathDelimiter"]),mini._ParseBool(t,e,["expandOnNodeClick","expandOnLoad","resultAsTree","showTreeIcon","virtualScroll","showTreeLines","showFolderCheckBox","canCheckParent","showBorder","loadChildWhenChecked","autoLoad","checkRecursive","autoCheckParent","showFullPath","includeRootNode","checkOnTextClick","showSelectedCount","showSort","allowSort","loadWhenChecked"]);var i,n,s=[],o=mini.getChildNodes(t),r=null;for(i=0,n=o.length;i<n;i++)r={},mini._ParseString(o[i],r,["tabText","tabKey","filterMode","showDimension"]),s.push(r);return e.tabs=s,e}}),mini.regClass(mini.TabsTreeSelect,"tabstreeselect"),mini.TreeSelect=function(){this.data=[],mini.TreeSelect.superclass.constructor.apply(this,arguments)},mini.extend(mini.TreeSelect,mini.PopupEdit,{loadWhenChecked:!1,valueFromSelect:!1,text:"",value:"",autoCheckParent:!1,expandOnLoad:!1,valueField:"id",textField:"text",nodesField:"children",dataField:"",delimiter:",",multiSelect:!1,data:[],url:"",allowInput:!1,showTreeIcon:!1,showTreeLines:!0,resultAsTree:!1,parentField:"pid",checkRecursive:!1,showFolderCheckBox:!1,showRadioButton:!1,showFilter:!1,filterMode:"client",filterUrl:"",showFullPath:!1,includeRootNode:!1,popupHeight:200,popupWidth:"100%",popupMaxHeight:250,popupMinWidth:100,setAjaxData:function(t){this.ajaxData=t,this.tree.setAjaxData(t)},setAjaxType:function(t){this.ajaxType=t,this.tree.setAjaxType(t)},setAjaxOptions:function(t){this.ajaxOptions=t,this.tree.setAjaxOptions(t)},set:function(t){if("string"==typeof t)return this;var e=t.value;delete t.value;var i=t.text;delete t.text;var n=t.url;delete t.url;var s=t.data;delete t.data;var o=t.showFullPath;delete t.showFullPath;var r=t.fullPathDelimiter;delete t.fullPathDelimiter;var a=t.includeRootNode;delete t.includeRootNode;var l=t.autoLoad;return delete t.autoLoad,mini.TreeSelect.superclass.set.call(this,t),mini.isNull(s)||this.setData(s),mini.isNull(l)||(this.autoLoad=l,this.tree&&this.tree.setAutoLoad(l)),mini.isNull(n)||this.setUrl(n),mini.isNull(e)||this.setValue(e),mini.isNull(i)||this.setText(i),mini.isNull(o)||(this.showFullPath=o,this.tree.showFullPath=o),mini.isNull(r)||(this.fullPathDelimiter=r,this.tree.fullPathDelimiter=r),mini.isNull(a)||(this.includeRootNode=a,this.tree.includeRootNode=a),this},uiCls:"mini-treeselect",_createPopup:function(){mini.TreeSelect.superclass._createPopup.call(this),this.tree=new mini.FilterTree,this.tree.setShowTreeIcon(!0),this.tree.setStyle("border:0;width:100%;height:100%;overflow:hidden;"),this.tree.setResultAsTree(this.resultAsTree),this.tree.render(this.popup._contentEl),this.tree.setCheckRecursive(this.checkRecursive),this.tree.setShowFolderCheckBox(this.showFolderCheckBox),this.tree.setShowRadioButton(this.showRadioButton),this.tree.setExpandOnNodeClick(this.expandOnNodeClick),this.autoLoad!==undefined&&this.tree.setAutoLoad(this.autoLoad),mini.isNull(this.defaultRowHeight)||(this.tree.defaultRowHeight=this.defaultRowHeight);var e=this;this.tree.on("nodeclick",function(t){setTimeout(function(){e.__OnNodeClick(t)},10)},this),this.tree.on("nodecheck",this.__OnCheckedChanged,this),this.tree.on("expand",this.__OnTreeExpand,this),this.tree.on("collapse",this.__OnTreeCollapse,this),this.tree.on("beforenodecheck",this.__OnTreeBeforeNodeCheck,this),this.tree.on("beforenodeselect",this.__OnTreeBeforeNodeSelect,this),this.tree.on("drawnode",this.__OnDrawNode,this),this.tree.useAnimation=!1,this.tree.set({showToolbar:this.showFilter,filterMode:this.filterMode,filterUrl:this.filterUrl}),this.tree.on("filter",this.__OnFilter,this),this.tree.on("beforeload",function(t){e.fire("beforeload",t)},this),this.tree.on("load",function(t){e.fire("load",t)},this),this.tree.on("loaderror",function(t){e.fire("loaderror",t)},this),this.tree.on("loadnode",this.__OnLoadNode,this)},__OnLoadNode:function(t){this.fire("loadnode",t)},_getIsLoaded:function(t){if(this.tree.isLeaf(t))return!0;var e=this.tree.getChildNodes(t),i=e.length;if(!i)return!1;for(var n=0;n<i;n++)if(!this._getIsLoaded(e[n]))return!1;return!0},__OnDrawNode:function(t){!1===t.node.ckr&&(t.showCheckBox=!1,t.showRadioButton=!1),this.fire("drawnode",t)},__OnTreeBeforeNodeCheck:function(t){t.tree=t.sender,this.fire("beforenodecheck",t)},__OnTreeBeforeNodeSelect:function(t){t.tree=t.sender,this.fire("beforenodeselect",t),t.cancel&&(this._nohide=!0)},__OnTreeExpand:function(t){this.multiSelect||this.tree.setValue(this.value,!1)},__OnTreeCollapse:function(t){},__OnFilter:function(){this.tree.setValue(this.value)},findItems:function(t){return this.tree.findNodes(this.tree.getIdField(),t)},findNodes:function(t){return this.tree.getNodesByValue(t)},getSelectedNode:function(){return this.getSelectedNodes()[0]},getCheckedNodes:function(t){var e=this.tree.getNodesByValue(this.value);return!1===t&&(t="leaf"),e=this.tree._dataSource.doGetCheckedNodes(e,t)},getSelectedNodes:function(){return this.tree.getNodesByValue(this.value)},getParentNode:function(t){return this.tree.getParentNode(t)},getChildNodes:function(t){return this.tree.getChildNodes(t)},showPopup:function(){var t={cancel:!1};if(this.fire("beforeshowpopup",t),this._firebeforeshowpopup=!1,1!=t.cancel){this.popup.el.style.height;mini.TreeSelect.superclass.showPopup.call(this),this.tree.setValue(this.value,!1),this.expandOnPopup&&this.tree.expandPath(this.value),this._nohide=!1}},expandOnPopup:!1,setExpandOnPopup:function(t){this.expandOnPopup=t},getExpandOnPopup:function(){return this.expandOnPopup},__OnPopupHide:function(t){this.__doFocusCls(),this.tree.clearFilter(),this.fire("hidepopup")},getItem:function(t){return"object"==typeof t?t:this.data[t]},indexOf:function(t){return this.data.indexOf(t)},getAt:function(t){return this.data[t]},loadList:function(t,e,i){this.tree.loadList(t,e,i),this.data=this.tree.getData(),this._getCheckedValue()},getList:function(){return this.tree.getList()},load:function(t){this.tree.load(t),this.data=this.tree.data,this._getCheckedValue()},_eval:function(_){return eval("("+_+")")},setData:function(t){"string"==typeof t&&(t=this._eval(t)),mini.isArray(t)||(t=[]),this.tree.setData(t),this.data=this.tree.data,this._getCheckedValue()},getData:function(){return this.data},_getCheckedValue:function(){var t=this.tree.getValue();this.setValue(t)},setUrl:function(t){this.getPopup(),this.tree.setUrl(t),this.url=this.tree.url,this.data=this.tree.data},getUrl:function(){return this.url},virtualScroll:!1,setVirtualScroll:function(t){this.tree&&this.tree.setVirtualScroll(t),this.virtualScroll=t},getVirtualScroll:function(){return this.virtualScroll},defaultRowHeight:32,setDefaultRowHeight:function(t){this.tree&&(this.tree.defaultRowHeight=t),this.defaultRowHeight=t},getDefaultRowHeight:function(){return this.defaultRowHeight},pinyinField:"tag",setPinyinField:function(t){this.pinyinField=t},getPinyinField:function(){return this.pinyinField},setTextField:function(t){this.tree&&this.tree.setTextField(t),this.textField=t},getTextField:function(){return this.textField},setNodesField:function(t){this.tree&&this.tree.setNodesField(t),this.nodesField=t},getNodesField:function(){return this.nodesField},setDataField:function(t){this.tree&&this.tree.setDataField(t),this.dataField=t},getDataField:function(){return this.dataField},getValue:function(){var t=mini.TreeSelect.superclass.getValue.call(this);return this.valueFromSelect&&t&&0==this.findItems(t).length?"":t},setValue:function(t,e){
//if (this.value != value) {
var i=this.tree.getValueAndText(t);""!=i[1]||this.valueFromSelect||(i[0]=t,i[1]=t),this.value=t,this._valueEl.value=t,!e&&this.tree&&this.tree.setValue(t),this.text=this._textEl.value=mini.htmlDecode(i[1]),this._doEmpty()},setMultiSelect:function(t){this.multiSelect!=t&&(this.multiSelect=t,this.tree.setShowCheckBox(t),this.tree.setAllowSelect(!t),this.tree.setEnableHotTrack(!t))},getMultiSelect:function(){return this.multiSelect},__OnNodeClick:function(t){if(!this.multiSelect){var e=this.tree.getSelectedNode(),i=this.tree.getValueAndText(e)[0];if(i){var n=this.getValue();this.setValue(i),n!==this.getValue()&&this._OnValueChanged()}!0!==this._nohide&&(this.hidePopup(),this.focus()),this._nohide=!1,this.fire("nodeclick",{node:t.node})}},__OnCheckedChanged:function(t){var e=t.node,i=this;if(this.loadWhenChecked||this.checkRecursive&&!t.isLeaf&&!this._getIsLoaded(e)){var n={node:e,eventType:"checkedchanged"},s={url:this.url,data:n,sender:this};this.fire("beforecheckload",s),jQuery.ajax({url:s.url,data:s.data,type:"post",dataType:"json",success:function(t){if(t=mini.getSecondRequestData(t)){var e=i.getValue();i.setValue(t.value,!0),i.setText(t.text),e!==i.getValue()&&i._OnValueChanged(),i.focus()}}})}else e.checked?this._addNode(e):this._removeNode(e),this._OnValueChanged(),this.focus()},_addNode:function(t,e){var i,n,s=t[this.valueField],o=this.tree.getItemText(t),r=this.getValue(),a=this.getText(),l=this.tree;if(t.cantChecked||!l.isLeaf(t)&&this.checkRecursive||(r?(","+r+",").indexOf(","+s+",")<0&&(this.setValue(r+","+s),this.setText(a+","+o)):(this.setValue(s),this.setText(o))),this.checkRecursive&&!e){if(!l.isLeaf(t)){var h=l.getChildNodes(t);for(i=0,n=h.length;i<n;i++)this._addNode(h[i])}var d=l.getAncestors(t);for(d.reverse(),i=0,n=d.length;i<n;i++){var u=d[i];u.checked=c(u),u.checked&&this._addNode(u,!0)}}function c(t){for(var e=l.getChildNodes(t),i=0,n=e.length;i<n;i++){var s=e[i];if(!l.isCheckedNode(s))return!1}return!0}},_removeNode:function(t,e){var i,n,s=","+t[this.valueField]+",",o=","+this.tree.getItemText(t)+",",r=","+this.getValue()+",",a=","+this.getText()+",";if(0<=r.indexOf(s)&&(r=(r=r.replace(s,",")).substring(1,r.length-1||1),a=(a=a.replace(o,",")).substring(1,a.length-1||1),this.setValue(r),this.setText(a)),this.checkRecursive&&!e){var l=this.tree.getChildNodes(t);for(i=0,n=l.length;i<n;i++)this._removeNode(l[i]);var h=this.tree.getAncestors(t);for(h.reverse(),i=0,n=h.length;i<n;i++)this._removeNode(h[i],!0)}},__OnInputKeyDown:function(t){var e={htmlEvent:t};if(this.fire("keydown",e),8==t.keyCode&&(this.isReadOnly()||0==this.allowInput))return!1;if(9!=t.keyCode){if(!this.isReadOnly()){var i=this;switch(t.keyCode){case 27:this.isShowPopup()&&t.stopPropagation(),this.hidePopup();break;case 13:setTimeout(function(){i.fire("enter",e)},10);break;case 37:break;case 38:t.preventDefault();break;case 39:break;case 40:t.preventDefault(),this.showPopup();break;default:0==this.allowInput||setTimeout(function(){i._doQuery()},10)}}}else this.isShowPopup()&&this.hidePopup()},_doQuery:function(){if(!this.multiSelect){var n=this.textField,s=this.pinyinField,o=this._textEl.value.toLowerCase();this.tree.filter(function(t){var e=String(t[n]?t[n]:"").toLowerCase(),i=String(t[s]?t[s]:"").toLowerCase();return-1!=e.indexOf(o)||-1!=i.indexOf(o)}),this.tree.expandAll(),this.showPopup()}},setCheckRecursive:function(t){this.checkRecursive=t,this.tree&&this.tree.setCheckRecursive(t)},getCheckRecursive:function(){return this.checkRecursive},setResultAsTree:function(t){this.resultAsTree=t,this.tree&&this.tree.setResultAsTree(t)},getResultAsTree:function(){return this.resultAsTree},setParentField:function(t){this.parentField=t,this.tree&&this.tree.setParentField(t)},getParentField:function(){return this.parentField},setValueField:function(t){this.tree&&this.tree.setIdField(t),this.valueField=t},getValueField:function(){return this.valueField},setShowTreeIcon:function(t){this.showTreeIcon=t,this.tree&&this.tree.setShowTreeIcon(t)},getShowTreeIcon:function(){return this.showTreeIcon},setShowTreeLines:function(t){this.showTreeLines=t,this.tree&&this.tree.setShowTreeLines(t)},getShowTreeLines:function(){return this.showTreeLines},setShowFolderCheckBox:function(t){this.showFolderCheckBox=t,this.tree&&this.tree.setShowFolderCheckBox(t)},getShowFolderCheckBox:function(){return this.showFolderCheckBox},setShowRadioButton:function(t){this.showRadioButton=t,this.tree&&this.tree.setShowRadioButton(t)},getShowRadioButton:function(){return this.showRadioButton},setAutoCheckParent:function(t){this.autoCheckParent=t,this.tree&&this.tree.setAutoCheckParent(t)},getAutoCheckParent:function(){return this.autoCheckParent},setExpandOnLoad:function(t){this.expandOnLoad=t,this.tree&&this.tree.setExpandOnLoad(t)},getExpandOnLoad:function(){return this.expandOnLoad},setValueFromSelect:function(t){this.valueFromSelect=t},getValueFromSelect:function(){return this.valueFromSelect},expandOnNodeClick:!1,setExpandOnNodeClick:function(t){this.expandOnNodeClick=t,this.tree&&this.tree.setExpandOnNodeClick(t)},getExpandOnNodeClick:function(){return this.expandOnNodeClick},getFilterUrl:function(){return this.filterUrl||this.url},getShowFilter:function(){return this.showFilter},setShowFilter:function(t){this.showFilter=t,this.tree.set({showToolbar:t})},setFilterUrl:function(t){this.filterUrl=t,this.tree.setFilterUrl(t)},getFilterMode:function(){return this.filterMode},setFilterMode:function(t){this.filterMode=t,this.tree.setFilterMode(t)},clear:function(){this.tree._filterInput.setValue(""),this.tree._filterInput.setText(""),this.tree._doFilter("")},getShowFullPath:function(){return this.showFullPath},getFullPathDelimiter:function(){return this.fullPathDelimiter},getAttrs:function(t){var e=mini.TreeSelect.superclass.getAttrs.call(this,t);if(mini._ParseString(t,e,["url","data","textField","pinyinField","valueField","nodesField","parentField","onbeforenodecheck","onbeforenodeselect","expandOnLoad","onnodeclick","onbeforeload","onload","onloaderror","ondrawnode","filterMode","filterUrl","fullPathDelimiter"]),mini._ParseBool(t,e,["expandOnNodeClick","multiSelect","resultAsTree","checkRecursive","showTreeIcon","showTreeLines","showFolderCheckBox","showRadioButton","autoLoad","autoCheckParent","valueFromSelect","virtualScroll","expandOnPopup","showFilter","showFullPath","includeRootNode","loadWhenChecked"]),mini._ParseInt(t,e,["defaultRowHeight"]),e.expandOnLoad){var i=parseInt(e.expandOnLoad);mini.isNumber(i)?e.expandOnLoad=i:e.expandOnLoad="true"==e.expandOnLoad}return e}}),mini.regClass(mini.TreeSelect,"TreeSelect"),mini.UserControl=function(){mini.UserControl.superclass.constructor.call(this)},mini.extend(mini.UserControl,mini.Control,{value:"",tplUrl:"",cssUrl:"",isUserControl:!0,_create:function(){this.el=document.createElement("div");var t=this;if(this.cssUrl&&!document.getElementById(this.uiCls+"-style")){var e=document.getElementsByTagName("head")[0],i=document.createElement("link");i.href=_rootPath+"/"+this.cssUrl,i.rel="stylesheet",i.type="text/css",i.id=this.uiCls+"-style",i.onload=function(){t._doLayoutChild(),t._afterCssLoaded()},e.appendChild(i)}},_afterApply:function(){this.parseTpl()},init:function(){},_doLayoutChild:function(){mini.getChildControls(this.el).forEach(function(t){t.doLayout&&t.doLayout()})},_afterCssLoaded:function(){},parseTpl:function(){var s=this,o=mini.uiClasses[this.uiCls];function t(t){o._tplHTML=t;var e=Mustache,i=$.trim(t),n=e.render(i,s.tplData);s.el.innerHTML=n,mini.parse(s.el),s.controls={},s.init(),window.DtoUtils&&DtoUtils.bindBeforeLoad(s.el)}this.setTplData(),o._tplHTML?t(o._tplHTML):jQuery.ajax({url:_rootPath+"/"+this.getTplUrl(),async:!1,type:"post",dataType:"html",success:t})},getTplUrl:function(){var t=mini.Cookie.get("epoint_local");return"string"==typeof this.tplUrl?this.tplUrl:this.tplUrl[t]||this.tplUrl.zh_CN},setTplData:function(){this.tplData={controlId:this.id}},setData:function(t){for(var e in t)this.controls[e]&&t[e]&&("object"!=typeof t[e]&&this.controls[e].setValue&&this.controls[e].setValue(t[e]),t[e].value&&this.controls[e].setValue&&this.controls[e].setValue(t[e].value),t[e].data&&(this.controls[e].loadList?this.controls[e].loadList(t[e].data):this.controls[e].setData&&(this.controls[e].setData(t[e].data),t[e].total&&this.controls[e].setTotalCount&&this.controls[e].setTotalCount(t[e].total))))},getValue:function(){var t={};for(var e in this.controls)this.controls[e].getValue&&(t[e]=this.controls[e].getValue());return t},setValue:function(t){this.value=t}}),mini.VerifyCode=function(){mini.VerifyCode.superclass.constructor.apply(this,arguments)},mini.extend(mini.VerifyCode,mini.Control,{mapClass:"com.epoint.basic.faces.verifycode.VerifyCode",autoLoad:!1,ignorecase:!0,url:"",width:78,height:32,charLength:4,changeAnotherText:epoint_local.VerifyCode.changeAnotherText,uiCls:"mini-verifycode",set:function(t){if("string"==typeof t)return this;var e=t.url;return delete t.url,mini.VerifyCode.superclass.set.call(this,t),e&&this.setUrl(e),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<img title="'+this.changeAnotherText+'"></img>',this._img=this.el.firstChild},_initEvents:function(){var t=this;mini.on(this._img,"click",function(){t._doLoad({width:parseInt(this.width),height:parseInt(this.height),charLength:t.charLength})})},setData:function(t){this.value=t.value,this._img.src=/^data:image/.test(t.src)?t.src:Util.getRightUrl(t.src),this.uuid=t.uuid},setUrl:function(t){this.url=t,this.autoLoad&&this._doLoad({width:parseInt(this.width),height:parseInt(this.height),charLength:this.charLength})},getUrl:function(){return this.url},_doLoad:function(t){t=t||{};var a={url:this.url,async:!1,type:this.ajaxType?this.ajaxType:"post",data:t,params:t,cache:!1,cancel:!1};if(this.fire("beforeload",a),a.data!=a.params&&a.params!=t&&(a.data=a.params),1!=a.cancel){var l=me=this,h=a.url;mini.copyTo(a,{success:function(t,e,i){delete a.params;var n={text:t,result:null,sender:me,options:a,xhr:i},s=null;try{mini_doload(n),s=(s=n.result)||mini.decode(t)}catch(r){1==mini_debugger&&alert(h+"\njson is error.")}var o={data:(s={data:s}).data,cancel:!1,result:s};l.fire("preload",o),1!=o.cancel&&(l.setData(o.data),delete o.cancel,l.fire("load",o))},error:function(t,e){var i={xhr:t,text:t.responseText,textStatus:e,errorMsg:t.responseText,errorCode:t.status};1==mini_debugger&&alert(h+"\n"+i.errorCode+"\n"+i.errorMsg),l.fire("loaderror",i)}}),this._ajaxer=mini.ajax(a)}},getAttrs:function(t){var e=mini.VerifyCode.superclass.getAttrs.call(this,t);return mini._ParseString(t,e,["url","data","onbeforeload","onload","onloaderror","onpreload"]),mini._ParseBool(t,e,["autoLoad","ignorecase"]),mini._ParseInt(t,e,["charLength"]),e}}),mini.regClass(mini.VerifyCode,"verifycode"),mini.WebEditor=function(){mini.WebEditor.superclass.constructor.call(this)},mini.extend(mini.WebEditor,mini.ValidatorBase,{mapClass:"",width:"100%",height:"350px",readOnly:!1,editstyle:"coolblue",editSkin:"flat10",value:"",uiCls:"mini-webeditor",formField:!0,_editorModel:window.EpFrameSysParams&&EpFrameSysParams.editor_model||"ewebeditor",extraUEditorConfig:{},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<textarea style="display:none"></textarea>',this._fromEditor=this.el.firstChild,this._editor=new mini.TextArea,this._editor.setVisible(!1),this._editor.render(this.el);var t=this;this.externalSrc=this.externalSrc||mini.externalSrc,"ewebeditor"===this._editorModel?window.EWEBEDITOR?this._initEditor():mini.loadJS(this.externalSrc+"ewebeditor/ewebeditor.js",function(){t._initEditor()}):window.UE?this._initEditor():mini.loadJS(this.externalSrc+"ueditor/ueditor.config.js",function(){mini.loadJS(t.externalSrc+"ueditor/ueditor.all.js",function(){t._initEditor()})})},render:function(t){mini.WebEditor.superclass.constructor.call(this,t)},_initEditor:function(){var t=this;setTimeout(function(){t._doInitEditor()},1)},_doInitEditor:function(){if(!1!==this.isRender()&&!this.editor){var e=this;if(this._editor.set({name:this.id,id:this.id+"_editor"}),this._fromEditor.id=this.id+"_fromEditor","ewebeditor"===this._editorModel){this.editor=EWEBEDITOR.Replace(this._fromEditor.id,{width:this.width.replace("px",""),height:this.height.replace("px",""),readonly:this.readOnly?"2":"",style:this.editstyle,skin:this.editSkin});var i=window.EWEBEDITOR_EVENT;window.EWEBEDITOR_EVENT=function(t){"LoadComplete"===t.flag&&(e.readOnlyChanged&&e.editor.setReadOnly(e.readOnly?"2":""),e._loadComplete=!0,e.fire("init",{sender:e,type:"init"})),i&&i(t)}}else this.editor=UE.getEditor(this._fromEditor.id,$.extend({initialFrameWidth:this.width.replace("px",""),readonly:this.readOnly,enableAutoSave:!this.readOnly},this.extraUEditorConfig||{})),this.editor.ready(function(){e.editor.container.parentElement.style.display="",e.value&&e.editor.setContent(e.value),e._$toolbar=jQuery(e.editor.container).find(".edui-editor-toolbarbox"),e._$footer=jQuery(e.editor.container).find(".edui-editor-bottomContainer"),e.setHeight(e.height),e.fire("init",{sender:e,type:"init"})})}},getEditor:function(){return this.editor},getEditorPromise:function(e){var i=this,n=jQuery.Deferred(),s=0;return function o(){if(50<s++)return n.reject(new Error("富文本控件初始化超时！"));var t=i.editor;t?setTimeout(function(){n.resolve(t),"function"==typeof e&&e(t)}):setTimeout(o,20)}(),n.promise()},setValue:function(t){this.value=this._fromEditor.value=t,"ewebeditor"===this._editorModel?window.EWEBEDITOR&&EWEBEDITOR.SetHtmlAsync(this._fromEditor.id,t):this.editor&&this.editor.isReady&&this.editor.setContent(t)},getValue:function(){if("ewebeditor"===this._editorModel){if(this.editor&&this.editor.getHTML)return this.editor.getHTML()}else if(this.editor&&this.editor.isReady)return this.editor.getContent();return this.value},setSubmitData:function(){this._editor&&this._editor.setValue(this.getValue())},getSubmitData:function(){return this._editor?this._editor.getValue():this.getValue()},setReadOnly:function(t){this.editor&&("ewebeditor"===this._editorModel?this._loadComplete?this.editor.setReadOnly(t?"2":""):this.readOnlyChanged=!0:this.editor.isReady&&(t?this.editor.setDisabled("fullscreen"):this.editor.setEnabled())),this.readOnly=t},getReadOnly:function(){return this.readOnly},setHeight:function(t){"ueditor"===this._editorModel&&(t="100%"==t?jQuery(this.el.parentElement).height():parseInt(t))&&(this.height=t,this.editor&&this.editor.isReady&&this.editor.setHeight(t-this._$toolbar.height()-this._$footer.height()))},setExtraUEditorConfig:function(t){"object"==typeof t?this.extraUEditorConfig=t:t+""===t&&(this.extraUEditorConfig=window.eval("("+t+")"))},getExtraUEditorConfig:function(){return this.extraUEditorConfig},getAttrs:function(t){var e=mini.WebEditor.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["value","text","editstyle","editSkin","oninit","extraUEditorConfig"]),mini._ParseBool(t,e,["readOnly"]),e}}),mini.regClass(mini.WebEditor,"webeditor"),mini.WebUploader=function(){mini.WebUploader.superclass.constructor.call(this)},mini.extend(mini.WebUploader,mini.Control,{uiCls:"mini-webuploader",mapClass:"com.epoint.basic.faces.fileupload.WebUploader",dataImport:!1,showDefaultUI:!0,uiType:"oa",needChunkLocal:!1,_minSize:!1,minSizeCls:"min-size",serverFileNum:0,serverFiles:undefined,fileSizeLimit:window.EpFrameSysParams&&EpFrameSysParams.file_limit_size,fileSingleSizeLimit:window.EpFrameSysParams&&EpFrameSysParams.file_single_limit_size,limitType:window.EpFrameSysParams&&EpFrameSysParams.file_limit_type,fileNameLengthLimit:window.EpFrameSysParams&&EpFrameSysParams.file_limit_namelength||0,fileNameLengthErrorText:"选择的文件名称长度过长！</br>文件名最长为{0}个字符",specialCharacterErrorText:"文件名称中不能包含特殊字符！",showSecrecyLevel:!1,previewUrl:window.EpFrameSysParams?EpFrameSysParams.upload_preview_url:"",previewExt:window.EpFrameSysParams?EpFrameSysParams.upload_preview_text:"",batchDownloadUrl:window.EpFrameSysParams?EpFrameSysParams.upload_batch_download_url:"",editUrl:"",editExt:"",defaultSecrecyLevel:(window.EpFrameSysParams&&EpFrameSysParams.defaultSecrecyLevel)===undefined?undefined:EpFrameSysParams.defaultSecrecyLevel,uploadUrl:"",mimeTypes:"",auto:!0,fileNumLimit:undefined,chunked:!1,chunkSize:5120,chunkRetry:2,duplicate:undefined,needMD5:!1,btnState:"default",showIcon:!0,compress:!1,timeout:12e4,threads:3,externalSrc:"",state:"pending",dnd:"",showBatchDownloadBtn:!1,pickerText:epoint_local.WebUploader.pickerText,startText:epoint_local.WebUploader.startText,pauseText:epoint_local.WebUploader.pauseText,batchDownloadText:epoint_local.WebUploader.batchDownloadText,tipText:"",numLimitErrorText:epoint_local.WebUploader.numLimitErrorText,sizeLimitErrorText:epoint_local.WebUploader.sizeLimitErrorText,typeDeniedErrorText:epoint_local.WebUploader.typeDeniedErrorText,sizeErrorText:epoint_local.WebUploader.sizeErrorText,emptyFileErrorText:epoint_local.WebUploader.emptyFileErrorText,duplicateErrorText:epoint_local.WebUploader.duplicateErrorText,uploadErrorText:epoint_local.WebUploader.uploadErrorText,secrecyLevelSaveErrorText:epoint_local.WebUploader.secrecyLevelSaveErrorText,noflashInnerHTML:epoint_local.WebUploader.noflashInnerHTML,noflashPageWarning:epoint_local.WebUploader.noflashPageWarning,getUiType:function(){return this.uiType},setUiType:function(t){this.uiType!==t&&(this.uiType=t,this.uiFun=mini.WebUploaderUI[this.uiType],this._unbindDefaultUIEvents(),this._bindDefaultUIEvents())},setAction:function(t){this.action=t,this.controlData={id:this.id,type:"webuploader",mapClass:this.mapClass,action:this.action,showDefaultUI:this.showDefaultUI,dataOptions:this["data-options"]};var e=t.split(".");if(!(e.length<2)){var i=Util.getRightUrl("/rest/"+e[0]+"/"+e[1]+"?isCommondto=true"),n=/\([\w\W]*\)/,s=i.match(n);s&&(i=i.replace(n,""),this.cmdParams=s[0].replace("(","[").replace(")","]"));var o=Util.getUrlParams();i=Util.addUrlParams(i,o,"ignore"),this.setUploadUrl(i)}},_afterApply:function(){this._initUIEvents()},setData:function(t){this._uploader&&this._uploader.reset();var e=t.files||t,i=t.secrecyLevels,n=t.clientGuid;this.serverFileNum=e.length,this.setFileNumLimit(this.fileNumLimit),n&&(this._clientGuid=n),i&&i.levels&&i.levels.length&&(this.setShowSecrecyLevel(!0),this.setSecrecyLevels(i));var s,o=[];this.serverFiles={};for(var r=0,a=e.length;r<a;r++)e[r].attachFileName||(e[r].attachFileName=""),s={id:e[r].attachGuid,name:e[r].attachFileName,ext:e[r].attachFileName.substr(e[r].attachFileName.lastIndexOf(".")+1),size:e[r].attachLength,date:e[r].uploadDateTime,fileGuid:e[r].attachGuid,downloadUrl:e[r].downloadUrl,preparams:e[r].preparams||e[r].downloadUrl,hideDelete:e[r].readonly,secrecyLevel:e[r].secrecyLevel,uploadDate:e[r].uploadDate,success:!0},this.serverFiles[s.fileGuid]=s,this.showDefaultUI&&o.push(this._generateFileList(s));this.showDefaultUI&&jQuery(o.join("")).appendTo(jQuery(this._fileList).empty()),this.adjustBatchDownloadBtnVisibility(),this.fire("load",{sender:this,eventType:"load",data:t})},_getUIFun:function(t){return this.uiFun||(this.uiFun=mini.WebUploaderUI[this.uiType]),this.uiFun[t]||function(){}},removeFile:function(t,e){var i=t.id||t,n=t.guid||t.fileGuid,s=this;if(i!==n?this._uploader.removeFile(i,!0):(this.serverFileNum--,this._uploader.option("fileNumLimit",this.fileNumLimit-this.serverFileNum),this.serverFiles[n]=null,delete this.serverFiles[n]),this.showDefaultUI&&(jQuery(this._fileList).find("#"+i).remove(),mini._controlTips&&mini._controlTips.hide()),n&&e){var o={commonDto:mini.encode(this.getCommonData())};this.cmdParams&&(o.cmdParams=this.cmdParams),o[this.id+"_action"]="delete",o[this.id+"_attachGuid"]=n,this.dataImport&&(o[this.id+"_import"]=!0);var r={sender:this,eventType:"beforefileremove",fileGuid:n,data:o};this.fire("beforefileremove",r),$.ajax({url:this.uploadUrl,data:r.data,dataType:"json",type:"post"}).done(function(t){t=mini.getSecondRequestData(t),s.fire("fileremovesuccess",{sender:s,eventType:"fileremovesuccess",fileGuid:n,data:t})})}this.adjustBatchDownloadBtnVisibility()},clearFile:function(t){this.showDefaultUI?this._getUIFun("clearFile").call(this,t):(this._uploader&&this._uploader.reset(),this.serverFiles={},this.serverFileNum=0,this.setFileNumLimit(this.fileNumLimit),console&&console.warn&&console.warn("非默认UI下使用此方法需要自行完成文件的删除操作")),this.adjustBatchDownloadBtnVisibility()},setFileNumLimit:function(t){if(this.fileNumLimit=t){var e=this;e._uploader?e._uploader.option("fileNumLimit",t-e.serverFileNum):this.getUploaderPromise().then(function(){e._uploader.option("fileNumLimit",t-e.serverFileNum)})}},_initEvents:function(){},_initUIEvents:function(){this.showDefaultUI&&(mini.addClass(this.el,"mini-uploader-ui-"+this.uiType),this._bindDefaultUIEvents())},_bindDefaultUIEvents:function(){this._isBindDefaultUIEvent||(this._getUIFun("bindEvents").call(this),this.enableSort&&this._getUIFun("bindEnableSort").call(this),this._isBindDefaultUIEvent=!0)},_unbindDefaultUIEvents:function(){var t=jQuery(this._fileList);t.off("click",".mini-uploader-remove").off("click",".mini-uploader-retry").off("click",".mini-uploader-secrecy"),jQuery("body").off("mousedown.secrecyLevelList"+this.uid),t.sortable("instance")&&t.sortable("destroy"),this._isBindDefaultUIEvent=!1},_isBindSecrecyEvent:!1,_bindSecrecyEvents:function(){if(!this._isBindSecrecyEvent){var n=this;jQuery(this._fileList).on("click",".mini-uploader-secrecy",function(){var t=jQuery(this),e=t.attr("canEdit"),i=t.siblings(".mini-uploader-remove").attr("fileGuid");"true"===e&&n.showSecrecyLevelList(t,i)}),jQuery("body").on("mousedown.secrecyLevelList"+this.uid,function(t){$(t.target).hasClass("mini-uploader-secrecy")||$(t.target).closest(".mini-secrecylevel-list").length||n.hideSecrecyLevelList()}),jQuery(document).on("mousewheel",function(){n.hideSecrecyLevelList()}),this._isBindSecrecyEvent=!0}},_queuedNum:0,_beforeFileQueued:function(t){if(this.serverFileNum+this._queuedNum>this.fileNumLimit)return this._uploader.trigger("error","Q_EXCEED_NUM_LIMIT",this.fileNumLimit,t),!1;if(/[\u4e00-\u9fa5]/.test(t.ext))return this._uploader.trigger("error","Q_TYPE_DENIED",this.limitType,t),!1;var e=t.name.lastIndexOf(".");if(e=-1!==e?t.name.substring(0,e):t.name,this.fileNameLengthLimit&&mini.getStrLengthUft8(e)>this.fileNameLengthLimit)return mini.alert(String.format(this.fileNameLengthErrorText,this.fileNameLengthLimit)),!1;
// var specialReg = /^(?!\.)[^\\\/:\*\?"<>\|\%\;]{1,225}$/;
if(this._events.beforefilequeued){var i={source:this,sender:this,type:"beforefilequeued",file:t,cancel:!1};return this.fire("beforefilequeued",i),!i.cancel}},_onFileQueued:function(t){this._queuedNum++,this.fire("filequeued",{file:t})},_onFilesQueued:function(t){var e={source:this,sender:this,type:"onfilesqueued",files:t,errorContent:this._errorContent};if(this.showDefaultUI){for(var i="",n=[],s=0,o=t.length;s<o;s++,i=[])i=this._generateFileList({id:t[s].id,name:t[s].name,ext:t[s].ext,size:t[s].size,date:mini.formatDate(new Date,"yyyy-MM-dd")}),n.push(i);jQuery(this._fileList).append(n.join(""))}this._events.filesqueued&&this.fire("filesqueued",e),this._errorContent&&mini.alert(this._errorContent),this._errorContent="",this._queuedNum=0},_generateFileList:function(t){return t.fileGuid=t.fileGuid||"",this._getUIFun("generateFileList").call(this,t)},_onFileDequeued:function(t){this.fire("filedequeued",{file:t})},_onReset:function(){this.fire("reset")},_needPostData:!0,_onStartUpload:function(){if(this.postData&&this._needPostData){this._uploader.stop();var t=this,e={commonDto:mini.encode(this.getCommonData())};this.cmdParams&&(e.cmdParams=this.cmdParams),e[this.id+"_incache"]=!0,e[this.id+"_postData"]=this.postData,e[this.id+"_fileCount"]=this._uploader.getFiles().length,e[this.id+"_fileLoadedCount"]=this._uploader.getStats().successNum,Util.ajax({url:this.uploadUrl,data:e,dataType:"json"}).done(function(){t._needPostData=!1,t._uploader.upload()})}this.fire("startupload")},_onStopUpload:function(){this.fire("stopupload")},_onUploadFinished:function(){this._needPostData=!0,this.fire("uploadfinished")},_onUploadStart:function(t){this._events.uploadstart?this.fire("uploadstart",{file:t}):this.showDefaultUI&&this._getUIFun("onUploadStart").call(this,t)},_onUploadBeforeSend:function(t,e,i){if(e.commonDto=mini.encode(this.getCommonData()),this.cmdParams&&(e.cmdParams=this.cmdParams),this.chunked){e[this.id+"_action"]="chunk";var n=t.file;e.uploadGuid=n.uuid,e.fileMD5=this._fileMD5[n.id],e.chunkSize=1024*this.chunkSize}else e[this.id+"_action"]="upload",this.needMD5&&(e.fileMD5=this._fileMD5[e.id],delete this._fileMD5[e.id]);this.dataImport&&(e[this.id+"_import"]=!0),e[this.id+"_postData"]=this.postData,e[this.id+"_fileCount"]=this._uploader.getFiles().length,e[this.id+"_fileLoadedCount"]=this._uploader.getStats().successNum,"object"==typeof e.lastModifiedDate?e.lastModifiedDate=e.lastModifiedDate.toISOString():e.lastModifiedDate||(e.lastModifiedDate=t.file.lastModifiedDate.toISOString());var s={sender:this,object:t,data:e,headers:i};this.fire("uploadbeforesend",s),e=jQuery.extend(e,s.data)},_onUploadAccept:function(t,e){if(!(e=mini.getSecondRequestData(e)))return!1;if(e=mini.decode(e.data||e),this.showDefaultUI&&!this.chunked&&this._getUIFun("onUploadAccept").call(this,t,e),this._events.uploadaccept){var i={source:this,sender:this,type:"uploadaccept",object:t,ret:e};if(this.fire("uploadaccept",i),i.cancel)return!1}return this.fire("filesuccess",{source:this,sender:this,type:"filesuccess",file:t.file,data:e}),!0},_onUploadProgress:function(t,e){this.showDefaultUI&&this._getUIFun("onUploadProgress").call(this,t,e),this._events.uploadprogress&&this.fire("uploadprogress",{file:t,percentage:e})},_onUploadSuccess:function(t,e){var i=e?mini.getSecondRequestData(e):{};if(i.uploadFailed)return mini.alert(i.failedMsg||this.uploadErrorText),void this.removeFile(t);this.showDefaultUI&&this._getUIFun("onUploadSuccess").call(this,t,e),this._events.uploadsuccess&&this.fire("uploadsuccess",{file:t,ret:e})},_onUploadError:function(t,e){this.showDefaultUI&&this._getUIFun("onUploadError").call(this,t,e),this._events.uploaderror&&this.fire("uploaderror",{file:t,reason:e})},_onUploadComplete:function(t){this.showDefaultUI&&this._getUIFun("onUploadComplete").call(this,t),this._events.uploadcomplete&&this.fire("uploadcomplete",{file:t}),this.adjustBatchDownloadBtnVisibility()},_onBeforeMd5File:function(t){t.data.commonDto=mini.encode(this.getCommonData()),this.cmdParams&&(t.data.cmdParams=this.cmdParams),t.data[this.id+"_action"]="queryFileStatus",t.data[this.id+"_postData"]=this.postData,this.fire("beforemd5file",t)},_onMd5File:function(t,e){if("1"===(t=mini.getSecondRequestData(t)).status){var i=t.result;i.fileFinished?(this._uploader.skipFile(e),this.showDefaultUI&&this._getUIFun("onMd5FileFinished").call(this,i,e)):(this._existFileParts=i.existFileParts||"",this._existFileParts=","+this._existFileParts+",")}},_onBeforeMd5FileFinished:function(t){t.data.commonDto=mini.encode(this.getCommonData()),this.cmdParams&&(t.data.cmdParams=this.cmdParams),t.data[this.id+"_action"]="finishUpload",t.data[this.id+"_postData"]=this.postData,this.fire("beforemd5filefinished",t)},_onMd5FileFinished:function(t,e){var i=mini.getSecondRequestData(t);if(i.uploadFailed)return mini.alert(i.failedMsg||this.uploadErrorText),void this.removeFile(e);i=i.result||i,this.showDefaultUI&&this._getUIFun("onMd5FileFinished").call(this,i,e),this.fire("finishedmd5file",{source:this,sender:this,type:"finishedmd5file",file:e,data:i})},_getSize:function(t){for(var e="B";1024<t&&"T"!==e;)switch(t=(t/1024).toFixed(1),e){case"B":e="KB";break;case"KB":e="M";break;case"M":e="G";break;case"G":e="T"}return t+e},getCommonData:function(){return this.controlData||(this.controlData={id:this.id,type:"webuploader",mapClass:this.mapClass,action:this.action,showDefaultUI:this.showDefaultUI,needChunkLocal:this.needChunkLocal,dataOptions:this["data-options"]}),[this.controlData,this.getViewdata()]},getViewdata:function(){var t=mini.get("_common_hidden_viewdata");return this.viewData||(this.viewData={id:"_common_hidden_viewdata",type:"hidden",value:""}),t&&(this.viewData.value=t.getValue()),this.viewData},setShowDefaultUI:function(t){this.showDefaultUI=t,this.controlData&&(this.controlData.showDefaultUI=t),t||mini.removeClass(this.el,"oa")},setPostData:function(t){this.postData=t},secrecyLevelItems:[],_generateSecrecyLevelList:function(){for(var t,e=this.id+"-secrecylevel-popup",i=['<div class="mini-popup" id="'+e+'"><ul class="mini-secrecylevel-list" style="position: static;display: block;">'],n=0,s=this.secrecyLevelItems.length;n<s;n++)t=this.secrecyLevelItems[n],i.push('<li guid="'+t.id+'">'+t.text+"</li>");i.push("</ul></div>"),this._$secrecyLevelList=jQuery(i.join("")).appendTo("body"),mini.parse(this._$secrecyLevelList[0]),this._$secrecyLevelList=$("#"+e);var o=this;this._$secrecyLevelList.on("click","li",function(){var t=$(this),e=t.attr("guid"),i=t.text(),n=o._$secrecyLevelList.attr("guid");o._onSecrecyLevelChange(e,i,n)})},showSecrecyLevelList:function(t,e){if(this.showSecrecyLevel){this._$secrecyLevelList||this._generateSecrecyLevelList(),this._$currentSecrecyLevel=t,this._$secrecyLevelList.attr("guid",e);var i=mini.get(this._$secrecyLevelList[0]);i&&i.showAtEl(t[0])}},hideSecrecyLevelList:function(){var t=this._$secrecyLevelList&&mini.get(this._$secrecyLevelList[0]);t&&t.hide()},_onSecrecyLevelChange:function(i,n,s){var o=this,t={commonDto:mini.encode(this.getCommonData())};t[this.id+"_action"]="updateSecrecyLevel",t[this.id+"_attachGuid"]=s,t[this.id+"_secrecyLevel"]=i,$.ajax({url:this.uploadUrl,data:t,dataType:"json",type:"post"}).done(function(t){if((t=mini.getSecondRequestData(t)).success)o._$currentSecrecyLevel.text(n).attr("guid",i),o.fire("secrecylevelchanged",{sender:o,eventType:"secrecylevelchanged",fileGuid:s,data:t});else{var e=t.msg||o.secrecyLevelSaveErrorText;mini.showTips({content:e,state:"warning",y:"center"})}}).always(function(){o.hideSecrecyLevelList()})},setSecrecyLevels:function(t){this.secrecyLevelItems=t.levels,this.defaultSecrecyLevel===undefined&&(this.defaultSecrecyLevel=t["default"]),this._$secrecyLevelList&&(this._$secrecyLevelList.remove(),this._$secrecyLevelList=undefined),this._highestSecrecyLevel=undefined},setShowSecrecyLevel:function(t){(this.showSecrecyLevel=t)&&!this._isBindSecrecyEvent&&this._bindSecrecyEvents()},getHighestSecrecyLevel:function(){if(this._highestSecrecyLevel)return this._highestSecrecyLevel;if(!this.secrecyLevelItems||!this.secrecyLevelItems.length)return{};for(var t=this.secrecyLevelItems[0],e=1,i=this.secrecyLevelItems.length;e<i;e++)this.secrecyLevelItems[e].id>t.id&&(t=this.secrecyLevelItems[e]);return this._highestSecrecyLevel=t},setEnableSort:function(t){(this.enableSort=t)&&this._getUIFun("bindEnableSort").call(this)},setFileMoreActionsMenu:function(t){this.fileMoreActionsMenu=t;var e=mini.byId(t);e&&(mini.parse(t),e=mini.get(t),this._fileMoreActionsMenu=mini.getAndCreate(e))},setMinSize:function(t){!0!==t&&(t=!1),this._minSize=t,jQuery(this._fileList)[t?"addClass":"removeClass"](this.minSizeCls)},getMinSize:function(){return this._minSize},_setFunBtnVisable:function(t,e,i){var n=jQuery(this._fileList).find(".mini-uploader-item");i=!0===i,("number"==typeof t?n.eq(t).find(".file-func"):n.find(".file-func")).find("."+e+"-file")[i?"removeClass":"addClass"]("hidden")},setEditBtnVisable:function(t,e){this._setFunBtnVisable(t,"edit",e)},setPreviewBtnVisable:function(t,e){this._setFunBtnVisable(t,"preview",e)},setDeleteBtnVisable:function(t,e){this._setFunBtnVisable(t,"delete",e)},setUploadBtnVisable:function(t){t=!0===t,jQuery(this._buttons)[t?"removeClass":"addClass"]("hidden")},getUploadBtnVisable:function(){return jQuery(this._buttons).hasClass("hidden")},setFileItemWidth:function(t){this.fileItemWidth=t,jQuery(this._fileList).find("> .mini-uploader-item").css("width",t)},getFileItemWidth:function(){return this.fileItemWidth},setShowAsFileList:function(t){!0===t?(this.showAsFileList=!0,jQuery(this._buttons).addClass("hidden"),jQuery(this._fileList).addClass("readonly")):(this.showAsFileList=!1,jQuery(this._buttons).removeClass("hidden"),jQuery(this._fileList).removeClass("readonly"))},getShowAsFileList:function(){return this.showAsFileList},set:function(t){if("string"==typeof t)return this;var e=t.pickerText;return delete t.pickerText,t.menu&&jQuery(t.menu).length&&(this._showSplit=!0,this.menu=t.menu,delete t.menu),t.fileList&&jQuery(t.fileList).length&&(this.setFileList(jQuery(t.fileList)[0]),delete t.fileList),"showIcon"in t||!this.el||(t.showIcon=!jQuery(this.el).closest(".fui-toolbar, .fui-toolbat-bottom").length),mini.WebUploader.superclass.set.call(this,t),e&&(this.pickerText=e,this._pickerText.innerHTML=e),this._initUploader(),this},_create:function(){this.el=document.createElement("div"),this.el.innerHTML='<div class="mini-uploader-btns"><label class="mini-btn-pick"><i class="mini-button-icon icon-upload"></i><span class="mini-btn-pick-text">'+this.pickerText+'</span></label></div><div class="mini-uploader-tips">'+(this.tipText||"")+'</div><div class="mini-uploader-list"></div>',this._buttons=this.el.firstChild,this._tipsEl=this.el.childNodes[1],this._fileList=this.el.lastChild,this._$fileList=jQuery(this._fileList),this._picker=this._buttons.firstChild,this._pickerText=this._picker.lastChild,this._uploadBtn=new mini.Button,this._uploadBtn.setText(this.startText),this._uploadBtn.render(this._buttons),this._batchDownloadBtn=new mini.Button,this._batchDownloadBtn.set({text:this.batchDownloadText,cls:"mini-uploader-batch-download",visible:!1}),this._batchDownloadBtn.render(this._buttons),this.showIcon&&mini.addClass(this._buttons,"show-icon"),this._errorContent="",this._buttons.style.visibility="hidden",this.on("render",this._initUploader,this)},getMD5Summary:function(t){return t.size<10485760?[t]:[t,0,10240]},_isInit:!1,_initUploader:function(){var t=this;this.isInit||(this.externalSrc=this.externalSrc||mini.externalSrc,window.WebUploader?this._createUploader():mini.loadJS(this.externalSrc+"webuploader/webuploader.min.js",function(){t._createUploader()}),this._showSplit&&(this._splitBtn=new mini.MenuButton,this._splitBtn.setMenu(this.menu),this._splitBtn.render(jQuery(this.el).find(".mini-btn-pick")[0],"after"),mini.addClass(this._buttons,"dropdown-menu"),"primary"===this.btnState&&this._splitBtn.setState("primary")),this.isInit=!0)},_createUploader:function(){var t=null,r=this;this.limitType&&(t={extensions:this.limitType,mimeTypes:this.mimeTypes}),this._fileMD5={},this.chunked&&!this._isInit?(this._hasFinishedList={},
// if (!window.isRegWebUploader) {
WebUploader.Uploader.register({"before-send-file":"preupload","before-send":"checkchunk","after-send-file":"finished"},{preupload:function(i){if(this.owner===r._uploader){var t=this.owner,n=this.options.server,s=WebUploader.Deferred(),e=$(i.source._refer).closest(".mini-webuploader");if((r=mini.getAndCreate(e[0])).chunked){var o=r.getMD5Summary(i.source);return t.md5File.apply(t,o).fail(function(){s.reject()}).then(function(t){r._fileMD5[i.id]=t,i.uuid=mini.UUID();var e={url:n,data:{fileMD5:t,fileName:i.name,fileSize:i.size,lastModifiedDate:i.lastModifiedDate.toISOString(),uploadGuid:i.uuid}};o[1]!==undefined&&(e.data.fileMD5Start=o[1],i.md5Start=o[1]),o[2]!==undefined&&(e.data.fileMD5End=o[2],i.md5End=o[2]),r._onBeforeMd5File(e),$.ajax(e.url,{dataType:"json",data:e.data,type:"post",success:function(t){r._onMd5File(t,i),s.resolve()},error:function(){s.reject(),$.ajaxSettings.error&&$.ajaxSettings.error.apply(this,arguments)}})}),s.promise()}}},checkchunk:function(t){if(this.owner===r._uploader&&r.chunked){var e=","+t.chunk+",",i=$.Deferred();return-1<r._existFileParts.indexOf(e)?i.reject():i.resolve(),i.promise()}},finished:function(e){if(this.owner===r._uploader){var t=WebUploader.Deferred();if(r.chunked){if(r._hasFinishedList[e.id])return r._hasFinishedList[e.id]=!1,void delete r._hasFinishedList[e.id];var i={url:r.uploadUrl,data:{fileMD5:r._fileMD5[e.id],fileName:e.name,fileSize:e.size,lastModifiedDate:e.lastModifiedDate.toISOString(),fileMD5Start:e.md5Start,fileMD5End:e.md5End,uploadGuid:e.uuid,contentType:e.type}};r._onBeforeMd5FileFinished(i),$.ajax(i.url,{dataType:"json",data:i.data,type:"post",success:function(t){r._onMd5FileFinished(t,e),delete r._fileMD5[e.id]},error:function(){t.reject(),$.ajaxSettings.error&&$.ajaxSettings.error.apply(this,arguments)}})}}}})):this.needMD5&&WebUploader.Uploader.register({"before-send-file":"preupload"},{preupload:function(e){if(this.owner===r._uploader){var t=this.owner,i=WebUploader.Deferred(),n=r.getMD5Summary(e.source);return n[1]!==undefined&&(e.md5Start=n[1]),n[2]!==undefined&&(e.md5End=n[2]),t.md5File.apply(t,n).fail(function(){i.reject()}).then(function(t){r._fileMD5[e.id]=t,i.resolve()}),i.promise()}}}),this.dnd&&!jQuery(this.dnd).length&&(window.console&&window.console.error&&console.error("配置的上传拖拽元素选择器无效，无法找到 "+this.dnd+" 这个元素"),this.dnd="");try{this._uploader=WebUploader.create({swf:this.externalSrc+"webuploader/Uploader.swf",server:this.uploadUrl,pick:{id:this._picker,multiple:1!=this.fileNumLimit},dnd:this.dnd,auto:this.auto,fileNumLimit:this.fileNumLimit,fileSizeLimit:1024*this.fileSizeLimit,fileSingleSizeLimit:1024*this.fileSingleSizeLimit,accept:t,chunked:this.chunked,chunkSize:1024*this.chunkSize,chunkRetry:this.chunkRetry,compress:this.compress,duplicate:this.duplicate,timeout:this.timeout,threads:this.threads})}catch(e){if("Runtime Error"!=e.message)throw e;if(mini.isIE9||mini.isIE8||mini.isIE7||mini.isIE6)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(i){r.el.innerHTML=r.noflashInnerHTML,mini.showPageWarning({html:r.noflashPageWarning})}return}this._uploader.on("beforeFileQueued",function(t){return r._beforeFileQueued(t)}).on("fileQueued",function(t){r._onFileQueued(t)}).on("filesQueued",function(t){r._onFilesQueued(t)}).on("fileDequeued",function(t){r._onFileDequeued(t)}).on("dndAccept",function(t){return r._onDndAccept(t)}).on("reset",function(){r._onReset()}).on("startUpload",function(){r._onStartUpload()}).on("stopUpload",function(){r._onStopUpload()}).on("uploadFinished",function(){r._onUploadFinished()}).on("uploadStart",function(t){r._onUploadStart(t)}).on("uploadBeforeSend",function(t,e,i){r._onUploadBeforeSend(t,e,i)}).on("uploadAccept",function(t,e){return r._onUploadAccept(t,e)}).on("uploadProgress",function(t,e){r._onUploadProgress(t,e)}).on("uploadSuccess",function(t,e){r._onUploadSuccess(t,e)}).on("uploadError",function(t,e){r._onUploadError(t,e)}).on("uploadComplete",function(t){r._onUploadComplete(t)}).on("all",function(t){"startUpload"===t?r.state="uploading":"stopUpload"===t?r.state="paused":"uploadFinished"===t&&(r.state="done"),r.auto||"uploading"!==r.state?r._uploadBtn.setText(r.startText):r._uploadBtn.setText(r.pauseText)}).on("error",function(t){r._onFilePickError(t)}).on("ready",function(){r._uploaderPick=r._picker.lastChild,r._pickerText=jQuery(r._picker).find(".mini-btn-pick-text")[0],r.enabled||(r._uploader.disable(),jQuery(r._uploaderPick).detach()),r.fire("init",{sender:r,type:"init"})}),this.auto?this._uploadBtn.hide():this._uploadBtn.on("click",function(){"uploading"===r.state?r._uploader.stop(!0):r._uploader.upload()}),this.showBatchDownloadBtn&&this._batchDownloadBtn.on("click",function(){r.batchDownload()}),this._buttons.style.visibility="visible",this._isInit=!0},getFileList:function(){return this._fileList},setFileList:function(t){t&&this._fileList!=t&&(this._fileList=t,this._$fileList=jQuery(t).addClass("mini-uploader-list"),this._unbindDefaultUIEvents&&this._unbindDefaultUIEvents(),this._initUIEvents&&this._initUIEvents())},getUploader:function(){
// if (!this._uploader) {
//     while (!this._uploader && diff < 1) {
return this._uploader},getUploaderPromise:function(e){var i=this,n=jQuery.Deferred(),s=0;return function o(){if(50<s++)return n.reject(new Error("上传控件初始化超时！"));var t=i._uploader;t?setTimeout(function(){n.resolve(t),"function"==typeof e&&e(t)}):setTimeout(o,20)}(),n.promise()},retry:function(t){this._uploader.retry(t)},refresh:function(){this._uploader&&this._uploader.refresh()},_onFilePickError:function(t){switch(t){case"Q_EXCEED_NUM_LIMIT":this._errorContent=String.format(this.numLimitErrorText,this.fileNumLimit);break;case"Q_EXCEED_SIZE_LIMIT":this._errorContent=String.format(this.sizeLimitErrorText,this.fileSizeLimit);break;case"Q_TYPE_DENIED":this._errorContent=String.format(this.typeDeniedErrorText,this.limitType);break;case"F_EXCEED_SIZE":this._errorContent=String.format(this.sizeErrorText,this.fileSingleSizeLimit);break;case"Q_EMPTY_FILE":this._errorContent=this.emptyFileErrorText;break;case"F_DUPLICATE":this._errorContent=this.duplicateErrorText}this._errorContent&&mini.alert(this._errorContent),this._errorContent=""},_onDndAccept:function(t){var e={sender:this,files:t,cancel:!1};if(this.fire("dndAccept",e),!0===e.cancel)return this._uploader.reset(),!1},_existFileParts:"",setUploadUrl:function(t){this.uploadUrl=t,this._uploader&&this._uploader.option("server",t)},getUploadUrl:function(){return this.uploadUrl},setAuto:function(t){this.auto=t,this._uploader&&this._uploader.option("auto",t)},getAuto:function(){return this.auto},defaultCompres:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0,noCompressIfLarger:!1,compressSize:0},setCompress:function(t){this.compress=!!t&&this.defaultCompres,this._uploader&&this._uploader.option("compress",this.compress)},getCompress:function(){return!!this.compress},getFileNumLimit:function(){return this.fileNumLimit},setFileSizeLimit:function(t){this.fileSizeLimit=t,this._uploader&&this._uploader.option("fileSizeLimit",1024*t)},getFileSizeLimit:function(){return this.fileSizeLimit},setFileSingleSizeLimit:function(t){this.fileSingleSizeLimit=t,this._uploader&&this._uploader.option("fileSingleSizeLimit",1024*t)},getFileSingleSizeLimit:function(){return this.fileSingleSizeLimit},getLimitType:function(){return this.limitType},setLimitType:function(t){this.limitType!=t&&(this.limitType=t,this._uploader&&(this._uploader.options.accept||(this._uploader.options.accept=[{}]),this._uploader.options.accept[0].extensions=this.limitType,this._uploader._init({accept:this._uploader.options.accept})))},getMimeTypes:function(){return this.mimeTypes},setMimeTypes:function(t){var i=this._uploader;this.mimeTypes!==t&&(this.mimeTypes=t,this._uploader&&(this._uploader.options.accept||(this._uploader.options.accept=[{}]),this._uploader.options.accept[0].mimeTypes=this.mimeTypes,"flash"!=this._uploader.predictRuntimeType()&&function n(t){var e=jQuery(i.options.pick.id).find('input[type="file"]');e.length?e.attr("accept",t):setTimeout(function(){n(t)},100)}(this.mimeTypes)))},setVisible:function(t){this.visible=t,this.el&&(t?(mini.removeClass(this.el,"invisible"),mini.removeClass(this._buttons,"webuploader-element-invisible")):(mini.addClass(this.el,"invisible"),mini.addClass(this._buttons,"webuploader-element-invisible")))},setEnabled:function(t){this.enabled=t,this.enabled?(this.removeCls(this._disabledCls),this._$fileList.removeClass(this._disabledCls),jQuery(this._uploaderPick).appendTo(this._picker),this._uploader&&this._uploader.enable(),this._uploadBtn&&this._uploadBtn.enable()):(this.addCls(this._disabledCls),this._$fileList.addClass(this._disabledCls),this._uploader&&this._uploader.disable(),this._uploadBtn&&this._uploadBtn.disable(),jQuery(this._uploaderPick).detach()),this._doReadOnly()},getDuplicate:function(){return this.duplicate},setPickerText:function(t){this.pickerText=t,this._pickerText.innerHTML=t},getPickerText:function(){return this.pickerText},setShowIcon:function(t){(this.showIcon=t)?mini.addClass(this._buttons,"show-icon"):mini.removeClass(this._buttons,"show-icon")},getShowIcon:function(){return this.showIcon},setTipText:function(t){this.tipText=t,this._tipsEl&&(this._tipsEl.innerText=t)},getTipText:function(){return this.tipText},setBtnState:function(t){"primary"===(this.btnState=t)?(mini.addClass(this._buttons,"mini-uploader-btns-primary"),this._splitBtn&&this._splitBtn.setState("primary")):(mini.removeClass(this._buttons,"mini-uploader-btns-primary"),this._splitBtn&&this._splitBtn.setState("default"))},setShowBatchDownloadBtn:function(t){this.showBatchDownloadBtn=t,this.adjustBatchDownloadBtnVisibility()},getShowBatchDownloadBtn:function(){return this.showBatchDownloadBtn},batchDownload:function(){if(this.batchDownloadUrl&&this._clientGuid){var t=this.batchDownloadUrl,e=t.indexOf("?");t+=(-1<e?"&":"?")+"clientGuid="+this._clientGuid,window.open(_rootPath+"/"+t,"_blank")}},adjustBatchDownloadBtnVisibility:function(){var t,e=this.serverFileNum;this.showBatchDownloadBtn&&this.batchDownloadUrl?(this._uploader&&(e=e+(t=this._uploader.getStats()).successNum-t.cancelNum),1<e?this._batchDownloadBtn.show():this._batchDownloadBtn.hide()):this._batchDownloadBtn.hide()},getAttrs:function(t){var e=mini.WebUploader.superclass.getAttrs.call(this,t);return e.text=t.innerHTML,mini._ParseString(t,e,["uploadUrl","limitType","mimeTypes","onbeforefilequeued","onfilequeued","onfilesqueued","onfiledequeued","onreset","onstartupload","onstopupload","onuploadfinished","onuploadstart","onuploadbeforesend","onuploadaccept","onuploadprogress","onuploadsuccess","onuploaderror","onuploadcomplete","pickerText","tipText","onbeforemd5file","onbeforemd5filefinished","oninit","dnd","ondndAccept","editurl","editext","previewurl","previewext","menu","fileList","btnState","batchDownloadText","tipText"]),mini._ParseBool(t,e,["auto","chunked","compress","needMD5","duplicate","showIcon","showBatchDownloadBtn"]),mini._ParseInt(t,e,["fileNumLimit","fileSizeLimit","fileSingleSizeLimit","chunkSize","chunkRetry","timeout","threads"]),e},getExtraAttrs:function(t){var e={};return mini._ParseString(t,e,["onfinishedmd5file","onfilesuccess","onbeforefileremove","onfileremovesuccess","postData","onload","onfileremove","onsecrecylevelchanged","previewUrl","previewExt","editUrl","editExt","fileMoreActionsMenu","menu","uiType","fileItemWidth","onbeforepreview","onbeforeedit","clientGuidBind"]),mini._ParseBool(t,e,["dataImport","showDefaultUI","needChunkLocal","enableSort","minSize","showAsFileList"]),mini._ParseInt(t,e,["fileNameLengthLimit"]),e}}),mini.regClass(mini.WebUploader,"webuploader");var defaultUI={generateFileList:function(t){var e=!0;t.downloadUrl?t.downloadUrl=_rootPath+"/"+(-1!==t.downloadUrl.indexOf("attachGuid")?t.downloadUrl:t.downloadUrl+(-1!==t.downloadUrl.indexOf("?")?"&":"?")+"attachGuid="+t.fileGuid):e=!(t.downloadUrl="javascript:void(0);");var i=[];if(i.push('<div id="'+t.id+'" class="mini-uploader-item'+(t.success?" success":"")+'">'),i.push('<a href="'+t.downloadUrl+(e?'" target="_blank" class="mini-uploader-info">':'" class="mini-uploader-info">')+t.name+"</a>"),t.size&&i.push('<span class="mini-uploader-size">('+this._getSize(t.size)+(t.date?"/"+t.date:"")+")</span>"),i.push('<span class="mini-uploader-error"></span>'),this.showSecrecyLevel){var n=t.secrecyLevel===undefined?this.defaultSecrecyLevel:t.secrecyLevel,s=function(t){for(var e=0,i=t.length;e<i;e++)if(t[e].id===n)return t[e].text;return""}(this.secrecyLevelItems);s||(n=this.getHighestSecrecyLevel().id,s=this.getHighestSecrecyLevel().text),i.push('<span class="mini-uploader-secrecy" canEdit="'+!t.hideDelete+'" guid="'+n+'">'+s+"</span>")}return i.push('<span class="mini-uploader-progressbar" style="display: none;"></span>'),this.enabled&&!t.hideDelete&&i.push('<a href="javascript:void(0)" class="mini-uploader-remove" fileId="'+t.id+'" fileGuid="'+t.fileGuid+'">'+epoint_local.delete_text+"</a>"),i.push("</div>"),i.join("")},clearFile:function(t){if(this._uploader){var e=jQuery(this._fileList).find(".mini-uploader-item");if(!e.length)return;for(var i=e.length-1;0<=i;--i){var n=e.eq(i).find(".mini-uploader-remove"),s=n.attr("fileId"),o=n.attr("fileguid");this.removeFile({id:s,guid:o},t)}}jQuery(this._fileList).empty()},bindEvents:function(){var s=this,o=jQuery(this._fileList);o.on("click",".mini-uploader-remove",function(){if(!o.hasClass("mini-disabled")){var t=jQuery(this),e=t.attr("fileId"),i=t.attr("fileGuid");if(s._events.fileremove){var n={source:s,sender:s,type:"fileremove",file:{id:e,guid:i}};s.fire("fileremove",n)}else s.removeFile({id:e,guid:i},!0)}}).on("click",".mini-uploader-retry",function(){var t=jQuery(this).attr("fileId");s.retry(t)})},onUploadStart:function(t){var e=mini.byId(t.id),i=jQuery(".mini-uploader-progressbar",e),n=new mini.ProgressBar;n.set({id:t.id+"_pb",width:"100%",value:0}),n.render(i[0]),i.show()},onUploadAccept:function(t,e){var i=e.attachGuid,n=e.downloadUrl;i&&(jQuery("#"+t.file.id+" > .mini-uploader-remove").attr("fileGuid",i),n&&jQuery("#"+t.file.id+" > .mini-uploader-info").attr("href",_rootPath+"/"+n).attr("target","_blank"))},onUploadProgress:function(t,e){var i=mini.byId(t.id),n=jQuery(".mini-uploader-progressbar",i),s=mini.get(t.id+"_pb");s||((s=new mini.ProgressBar).set({id:t.id+"_pb",width:"100%",value:0}),s.render(n[0])),s.setValue((100*e).toFixed(2))},onUploadSuccess:function(t,e){var i=jQuery("#"+t.id);i.addClass("success"),i.find(".mini-uploader-error").html("").hide()},onUploadError:function(t,e){jQuery("#"+t.id).find(".mini-uploader-error").html(epoint_local.WebUploaderUI.uploadErrorText+'<a href="#" class="mini-uploader-retry" fileId="'+t.id+'">'+epoint_local.retry_text+"</a>").show()},onUploadComplete:function(t){jQuery("#"+t.id).find(".mini-uploader-progressbar").fadeOut()},onMd5FileFinished:function(t,e){var i=t.attachGuid,n=t.downloadUrl;i&&(jQuery("#"+e.id+" > .mini-uploader-remove").attr("fileGuid",i),n&&jQuery("#"+e.id+" > .mini-uploader-info").attr("href",_rootPath+"/"+n))}},oaUI={generateFileList:function(t){var e,i=!0,n=[],s=(t.ext||"").toLowerCase();t.downloadUrl?t.downloadUrl=_rootPath+"/"+(-1!==t.downloadUrl.indexOf("attachGuid")?t.downloadUrl:t.downloadUrl+(-1!==t.downloadUrl.indexOf("?")?"&":"?")+"attachGuid="+t.fileGuid):i=!(t.downloadUrl="javascript:void(0);");var o=this.fileItemWidth?'style="width:'+this.fileItemWidth+'"':"",r="mini-uploader-item mini-uploader-ui-oa"+(this.fileItemWidth?" inline":"");return n.push('<div id="'+t.id+'" fileId="'+t.id+'" fileGuid="'+t.fileGuid+'" class="'+r+(t.success?" success":"")+'"'+o+">"),n.push('<b class="file-type '+oaUI._typeToTypecls(s)+'"></b>'),n.push('<div class="file-info">'),n.push('<a title="'+t.name+'" href="'+t.downloadUrl+(i?'" target="_blank" class="mini-uploader-info">':'" class="mini-uploader-info">')+t.name+"</a>"),t.size&&n.push('<span class="mini-uploader-size">'+this._getSize(t.size)+"</span>"),n.push('<span class="mini-uploader-date">'+(t.uploadDate?t.uploadDate:"")+"</span>"),n.push('<span class="mini-uploader-error"></span>'),n.push('<span class="mini-uploader-progressbar" style="display: none;"></span>'),n.push('<div class="file-func clearfix">'),e=this.previewUrl&&-1!==this.previewExt.indexOf(s)&&t.preparams?"":" hidden",n.push('<span class="preview-file action-icon icon-view-svg '+e+'" data-preparams="'+(t.preparams?t.preparams:"")+'" title="'+epoint_local.preview_text+'"  data-tooltip="'+epoint_local.preview_text+'">'+epoint_local.preview_text+"</span>"),e=this.editUrl&&-1!==this.editExt.indexOf(s)?"":" hidden",n.push('<span class="edit-file action-icon icon-modify-svg '+e+'" title="'+epoint_local.edit_text+'" data-tooltip="'+epoint_local.edit_text+'">'+epoint_local.edit_text+"</span>"),t.hideDelete||n.push('<span class="delete-file action-icon icon-trash-svg" fileId="'+t.id+'" fileGuid="'+t.fileGuid+'" title="'+epoint_local.delete_text+'" data-tooltip="'+epoint_local.delete_text+'">'+epoint_local.delete_text+"</span>"),this._fileMoreActionsMenu&&n.push('<span class="more-action action-icon icon-omit"></span>'),n.push("</div>"),n.push("</div>"),n.push("</div>"),n.join("")},clearFile:function(t){if(this._uploader){var e=jQuery(this._fileList).find(".mini-uploader-item");if(!e.length)return;for(var i=e.length-1;0<=i;--i){var n=e.eq(i),s=n.attr("fileId"),o=n.attr("fileguid");this.removeFile({id:s,guid:o},t)}}jQuery(this._fileList).empty()},bindEvents:function(){var h=this,s=jQuery(this._fileList);s.on("click",".delete-file",function(){if(!s.hasClass("mini-disabled")){var t=jQuery(this).closest(".mini-uploader-item"),e=t.attr("fileId"),i=t.attr("fileGuid");if(h._events.fileremove){var n={source:h,sender:h,type:"fileremove",file:{id:e,guid:i}};h.fire("fileremove",n)}else h.removeFile({id:e,guid:i},!0)}}).on("click",".preview-file",function(t){if(t.stopPropagation(),h.previewUrl){var e=$(this),i=e.data("preparams");if(i){var n=e.closest(".mini-uploader-item"),s=n.find(".mini-uploader-info").text(),o=n.attr("fileGuid"),r=h.previewUrl;if(o){var a=s.lastIndexOf(".");r+="?fname="+o+(-1===a?"":s.substr(a))}var l={source:h,sender:h,type:"beforepreview",cancel:!1,file:{name:s,guid:o,previewUrl:r+=(o?"&":"?")+i}};h.fire("beforepreview",l),l.cancel||epoint.openTopDialog(epoint_local.WebUploaderUI.filePreviewTitle,r)}else mini.alert(epoint_local.WebUploaderUI.cantPreviewAlert)}}).on("click",".edit-file",function(t){if(t.stopPropagation(),h.editUrl){var e=$(this).closest(".mini-uploader-item"),i=e.attr("fileGuid"),n=e.find(".mini-uploader-info").text();if(i){var s=Util.getRootPath()+h.editUrl;-1!==h.editUrl.indexOf("attachGuid=")?s+=i:s+=(-1!==h.editUrl.indexOf("?")?"&":"?")+"attachGuid="+i;var o={source:h,sender:h,type:"beforeedit",cancel:!1,file:{name:n,guid:i,editUrl:s}};h.fire("beforeedit",o),o.cancel||epoint.openTopDialog(epoint_local.WebUploaderUI.fileEditTitle,s)}else mini.alert(epoint_local.WebUploaderUI.cantEditAlert)}}).on("click",".more-action",function(){var t=$(this),e=t.offset(),i=t.closest(".mini-uploader-item");h._fileMoreActionsMenu.$targetFile=i,h._fileMoreActionsMenu.showAtPos(e.left,e.top+t.height()-10)}).on("click",".mini-uploader-retry",function(){var t=jQuery(this).attr("fileId");h.retry(t)})},bindEnableSort:function(){var i=this,n=jQuery(this._fileList);this.enableSort&&n.sortable({revert:!0,handle:".file-type",update:function(){var t=n.sortable("toArray",{attribute:"fileGuid"}),e={commonDto:mini.encode(i.getCommonData())};e[i.id+"_action"]="saveSort",e.sort=t.join(","),Util.ajax({url:i.uploadUrl,dataType:"json",data:e,type:"post",success:function(){}})}})},onUploadStart:function(t){var e=mini.byId(t.id),i=jQuery(".mini-uploader-progressbar",e),n=mini.get(t.id+"_pb"),s=jQuery(".mini-uploader-error",e);mini.addClass(e,"progressing"),n?n.setValue(0):((n=new mini.ProgressBar).set({id:t.id+"_pb",width:"100%",value:0}),n.render(i[0])),s.html("").hide(),i.show()},onUploadAccept:function(t,e){var i=e.attachGuid,n=e.downloadUrl,s=e.preparams||e.downloadUrl,o=e.uploadDate,r="",a=t.file,l=a.name.lastIndexOf(".");if(-1!==l&&(r=a.name.substr(l+1).toLowerCase()),i){var h=jQuery("#"+t.file.id);h.attr("fileGuid",i),n&&h.find(".mini-uploader-info").attr("href",_rootPath+"/"+n).attr("target","_blank"),this.previewUrl&&r&&-1!==this.previewExt.indexOf(r)&&s&&h.find(".preview-file").data("preparams",s).removeClass("hidden"),o&&(h.removeClass("progressing").find(".mini-uploader-progressbar").hide(),h.find(".mini-uploader-date").text(o))}},onUploadProgress:function(t,e){var i=mini.byId(t.id),n=jQuery(".mini-uploader-progressbar",i),s=mini.get(t.id+"_pb");s||((s=new mini.ProgressBar).set({id:t.id+"_pb",width:"100%",value:0}),s.render(n[0])),s.setValue((100*e).toFixed(2))},onUploadSuccess:function(t,e){jQuery("#"+t.id).addClass("success").removeClass("error")},onUploadError:function(t,e){jQuery("#"+t.id).addClass("error").find(".mini-uploader-error").html(epoint_local.WebUploaderUI.uploadErrorText+'<a href="#" class="mini-uploader-retry" fileId="'+t.id+'">'+epoint_local.retry_text+"</a>").show()},onUploadComplete:function(t){jQuery("#"+t.id).removeClass("progressing").find(".mini-uploader-progressbar").hide()},onMd5FileFinished:function(t,e){var i=t.attachGuid,n=t.downloadUrl,s=t.uploadDate;i&&(jQuery("#"+e.id).attr("fileGuid",i),n&&jQuery("#"+e.id+" .mini-uploader-info").attr("href",_rootPath+"/"+n),s&&jQuery("#"+e.id).find(".mini-uploader-date").text(s))},_typeToTypecls:function(t){return"."===t.charAt(0)?t.substring(1):t.toLowerCase()}},Ygc,zmc,Amc,Bmc,Tmc,Umc,Vmc,Wmc,Ymc,yqc,Hqc,zqc,Aqc,Dqc,Eqc,Fqc,Gsc,Jsc,vzc,wzc,vAc,wAc,zAc,xAc,SAc,TAc,UAc,VAc,bBc,cBc,dBc;function Xmc(t,e){return(t*e).toFixed(6)+"px"}function Cqc(t,e){var i=t.find('[role="control"]'),n=2*i.length,s=t.data("newsection");t.addClass("form-row"),!0===t.data("inline")&&(t.addClass("inline"),e.inline=!0),s&&t.addClass("newsection");for(var o=0,r=i.length;o<r;o++)Fqc(i.eq(o),n,e)}function Iqc(t){Hqc||yqc(function(){(Hqc=new mini.ToolTip).set({target:document,trigger:"hover",selector:".form-tooltip",placement:"top",autoHide:!0})});var d=Util.getFrameSysParam("ui_form_arrangement"),u=Util.getFrameSysParam("ui_form_showcolon");t.each(function(t,e){var i,n,s=yqc(e);e.hasAttribute("vertical")||e.hasAttribute("data-vertical")?i=s.data("vertical")||"true"==s.attr("vertical"):(i="vertical"===d)&&s.closest(".fui-search,.fui-condition").length&&(i=!1),n=e.hasAttribute("showcolon")?"true"===s.attr("showcolon"):e.hasAttribute("data-showcolon")?s.data("showcolon"):u===undefined||u,s.data("showcolon",n),i&&s.addClass("vertical");var o=s.find('[role="form"]'),r=s.find('[role="row"]');s.addClass("hidden"),o.addClass("form-inner");for(var a=0,l=r.length;a<l;a++)Cqc(r.eq(a),{isVertical:i,showColon:n});o.removeAttr("role"),r.removeAttr("role"),Kqc(s),function h(t){if(!t.length)return;yqc.each(t,function(t,e){var i=yqc(e),n=i.data("errormode");n&&(n=n.toLowerCase(),i.find('.form-control > [class*="mini-"]').each(function(t,e){var i=yqc(e);i.attr("errormode")||i.attr("errormode",n)}))})}(s),s.removeClass("hidden")})}function Kqc(t){t.length&&yqc.each(t,function(t,e){var i=yqc(e),n=i.attr("label-width");if(n){var o=parseInt(n,10)||0;o&&(Util.browsers.isIE8?window.console&&console.error("您的浏览器不支持label-width的配置"):i.hasClass("vertical")?window.console&&console.error("vertical 下不支持label-width的配置"):i.find(".form-row").each(function(t,e){yqc(e).children().each(function(t,e){var i=yqc(e);if(i.hasClass("form-label"))i.css("width",o);else if(i.hasClass("form-control")){var n=(e.className.match(/span\d/)||[])[0];if(!n)return;var s=Aqc[n];s&&i.css("width","calc("+s+" - "+o+"px)")}})}))}})}function Lqc(t){return mini.getChildControls(t)[0]}function Mqc(t){var e=yqc(t);if(e.length&&e.is(".form-row")){var i,n=e.closest(".fui-form").hasClass("vertical"),s=e.children(".form-control").not(".hidden");0===s.length?e.addClass("hidden"):e.removeClass("hidden");var o=[];if(s.each(function(t,e){(i=parseInt(e.getAttribute("span"),10))||o.push(e)}),o.length){var r=2*s.length;i=n?Eqc[r+""]:Dqc[r+""],o.forEach(function(t){yqc(t).removeClass("span1 span2 span3 span4 span5 span6").addClass("span"+i)})}}}function Hsc(t){var e=t||Gsc(".fui-tabs");e.length&&Gsc(".fui-content").css("padding",0),e.each(function(t,e){var i=Gsc(e);if(!i.data("fui-tab-parse")){var n=i.attr("target");if(!n)return console.error("fui-tabs必须配置容器");var s=Gsc(n)[0];if(!s)return console.error("fui-tabs必须配置容器");i.on("click",".fui-tab",function(){Gsc(this).addClass("active").siblings().removeClass("active");var t=this.getAttribute("url");t&&(s.src=Util.getRightUrl(t));var e=function r(t){if(!t)return null;var e=t.split("."),i=window[e[0]],n=window,s=1,o=e.length;for(;i&&s<o;)i=(n=i)[e[s]],s++;return{fun:i,scope:n}}(i.attr("onactivechanged"));e&&"function"==typeof e.fun&&e.fun.call(e.scope,{index:Gsc(this).index(),name:this.textContent||this.innerText,url:t,tab:this}),e=null});var o=parseInt(i.attr("activeIndex"),10)||0;(o<0||o>i.find(">.fui-tab").length)&&(o=0),i.find(">.fui-tab:eq("+o+")").trigger("click"),i.data("fui-tab-parse",!0)}})}function xzc(t){if(this.$el=wzc(t),this.$el.length&&!(this.$el.children().length<2)){if("true"===this.$el[0].getAttribute(this.ATTRIBUTE_PREFIX+"init")){var e=xzc.instances[this.$el[0].getAttribute(this.ATTRIBUTE_PREFIX+"uid")];if(!e)return;return e.update(),e}this.eventNamespace=xzc.name+"-"+this.uid,this.$el[0].setAttribute(this.ATTRIBUTE_PREFIX+"init","true"),this.uid=Util.uuid(),this.$el[0].setAttribute(this.ATTRIBUTE_PREFIX+"uid",this.uid),(xzc.instances[this.uid]=this).$el.css("position","relative"),this.isOver=!1,this.$extArea=wzc('<div class="toolbar-ext-area"></div>').appendTo(this.$el),this.$el.hasClass("fui-toolbar-bottom")?this.$extArea.css("bottom","100%"):this.$extArea.css({top:"100%"}),this.limit_w=this.$el.width(),this.$lastNormalChild=null,this.$firstRightChild=null,this._insertToggleBtn(),this.calcLimited(),this.initEvent(),this.update()}}function yAc(t){this.cfg=wAc.extend({},xAc,t),this.__onDestroy=t.ondestroy,this.__onLoad=t.onload,this._init()}function XAc(e){var i=function(t){var e="frame/fui/js/widgets/navpages";return VAc&&(e=VAc),e+"/"+t+"/"+t}(e);SAc.ajax(Util.getRightUrl(i+"_snippet.html")).done(function(t){TAc.replaceWith(t),-1!=SAc.inArray(e,["leftAccNav","leftAccTree"])&&Util.layoutInstance.parse(),Util.loadCss(i+".css"),Util.loadJs(i+".js")})}function eBc(t){var e=t.children().filter(function(t,e){var i=cBc(e);return/(?:mini-button|mini-webuploader)/.test(e.className)&&i.is(":visible")}),i=e.length-1;e.each(function(t,e){cBc(e).removeClass("mini-btn-group-first mini-btn-group-last"),dBc&&dBc.takeRecords(),0===t&&(cBc(e).addClass("mini-btn-group-first"),dBc&&dBc.takeRecords()),t===i&&(cBc(e).addClass("mini-btn-group-last"),dBc&&dBc.takeRecords())})}function fBc(t){cBc(t||".fui-toolbar .mini-btn-group, .fui-toolbar-bottom .mini-btn-group").each(function(t,e){eBc(cBc(e))})}mini.WebUploaderUI={"default":defaultUI,oa:oaUI},mini.externalSrc=_rootPath+"/frame/fui/js/widgets/",mini.regHtmlAttr("action"),mini.regHtmlAttr("bind"),mini.regHtmlAttr("extraId"),Ygc=window,jQuery,Ygc.mini_doload=function(t){var e,i,n,s=mini.decode(t.text,!1);s[Util.BODY_ENCRYPT_PARAM_NAME]&&(s=Util.decrypt(s[Util.BODY_ENCRYPT_PARAM_NAME]),s=mini.decode(s)),e=s.custom,s=s.controls||s,mini.isArray(s)&&s[0]&&s[0].id&&("_common_hidden_viewdata"===(i=s[s.length-1]).id&&((n=mini.get("_common_hidden_viewdata"))||((n=new mini.Hidden).setId("_common_hidden_viewdata"),n.render(document.body)),n.setValue(i.value)),s=s[0].total!==undefined?s[0]:s[0].data),(!s||mini.isArray(s)&&0===s.length)&&e&&(s=e),t.result=s},mini.copyTo(mini,{getSecondRequestData:function(t){if(t[Util.BODY_ENCRYPT_PARAM_NAME]&&(t=Util.decrypt(t[Util.BODY_ENCRYPT_PARAM_NAME]),t=mini.decode(t)),!t||!t.status)return[];var e,i,n=t.status,s=parseInt(n.code,10),o=n.text,r=n.url,a=n.state||"error",l="warning"===a?epoint_local.warning_tip:epoint_local.error_tip;if(!(300<=s))return t=t.controls||t,mini.isArray(t)&&t[0]&&t[0].id&&("_common_hidden_viewdata"===(e=t[t.length-1]).id&&((i=mini.get("_common_hidden_viewdata"))||((i=new mini.Hidden).setId("_common_hidden_viewdata"),i.render(document.body)),i.setValue(e.value)),t=t[0]),t;if(r){0!==r.indexOf("http")&&(r=_rootPath+"/"+r);var h=n.top?top:window;h.Util&&h.Util.getSafeLocation?h.Util.getSafeLocation().setHref(r):h.location.href=r}else o&&mini.showMessageBox({title:l,buttons:["ok"],message:o,iconCls:"mini-messagebox-"+a})}}),mini.ListControl.ajaxType="post",mini.ajax=function(t){return t.dataType||(t.dataType="text"),t.data=Util.encryptAjaxParams(t.url,t.data),window.jQuery.ajax(t)},window.EpFrameSysParams&&1===EpFrameSysParams.security_vtype_positivenum_enable&&(mini._minimumNumber=0),function(){function on(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i)}function assign(){for(var t=arguments[0],e=1,i=arguments.length,n="",s=null,o=Object.prototype.hasOwnProperty;e<i;e++)for(n in s=arguments[e])o.call(s,n)&&(t[n]=s[n]);return t}window.console||(window.console={log:function(){},dir:function(){},dirxml:function(){},info:function(){},warn:function(){},error:function(){}});var class2type={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object","[object Error]":"error","[object Symbol]":"symbol"};function getType(t){if(null==t)return t+"";var e=Object.prototype.toString.call(t);return"object"==typeof t||"function"==typeof t?class2type[e]||"object":typeof t}var DAY_MILLISECONDS=864e5,DEFAULT_COOKIE_OPTIONS={path:window._rootPath?window._rootPath+"/":"/"},setCookieDefaultOption=function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(DEFAULT_COOKIE_OPTIONS[e]=t[e])},writeCookie=function(t,e,i){if(i&&"object"==getType(i)||(i=assign({},DEFAULT_COOKIE_OPTIONS,i||{})),"number"==getType(i.expires)){var n=i.expires;i.expires=new Date,i.expires.setMilliseconds(i.expires.getMilliseconds()+n*DAY_MILLISECONDS)}return document.cookie=[encodeURIComponent(t),"=",e,i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")},readCookie=function(t){for(var e=t?undefined:{},i=document.cookie?document.cookie.split("; "):[],n=0,s=i.length;n<s;n++){var o=i[n].split("="),r=decodeURIComponent(o.shift()),a=o.join("=");if(t===r){e=a;break}t||a===undefined||(e[r]=a)}return e},removeCookie=function(t,e){return(e=e||{}).expires=-1,writeCookie(t,"",e),!readCookie(t)};function SafeLocation(){var n=this;this.origin=location.origin,this._writeProps=["protocol","host","hostname","port","pathname","search","username","password"],this._isSupportDescriptor=!!Object.defineProperties,this._isSupportDescriptor?Object.defineProperties(this,{protocol:{get:function(){return location.protocol},set:function(t){location.protocol=t}},host:{get:function(){return location.host},set:function(t){location.host=t}},hostname:{get:function(){return location.hostname},set:function(t){location.hostname=t}},port:{get:function(){return location.port},set:function(t){location.port=t}},pathname:{get:function(){return location.pathname},set:function(t){location.pathname=t}},search:{get:function(){return location.search},set:function(t){location.search=t}},username:{get:function(){return location.username},set:function(t){location.username=t}},password:{get:function(){return location.password},set:function(t){location.password=t}},href:{get:function(){return location.href},set:function(t){location.href=t}},hash:{get:function(){return location.hash},set:function(t){"#"!=(t||"")[0]&&(t="#"+t),location.hash=t}}}):on(window,"hashchange",function(){n.href=location.href,n.hash=location.hash});for(var s=this._writeProps.concat(["href","hash"]),t=0,e=s.length;t<e;t++){var i=s[t],o=i[0].toUpperCase()+i.substr(1);!function(e,t){n._isSupportDescriptor?n["set"+t]=function(t){n[e]=t}:(n[e]=location[e],n["set"+t]=function(t){n[e]=location[e]=t}),n["get"+t]=function(){return n[e]}}(i,o)}this._isSupportDescriptor||setInterval(function(){for(var t=0,e=s.length;t<e;t++){var i=s[t];n[i]!=location[i]&&(location[i]=n[i])}},50)}function htmlEscape(t){var e=document.createElement("div");e.appendChild(document.createTextNode(t));var i=e.innerHTML;return e=null,i}function htmlUnescape(t){if("string"!=typeof t)return t;if(0===t.length)return"";var e=t;return e=(e=(e=(e=(e=(e=e.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&nbsp;/g," ")).replace(/&#39;/g,"'")).replace(/&quot;/g,'"')).replace(/&amp;/g,"&")}function getSafeHtml(t){if(t)return t=t.replace(/<script(.*?)>/gi,"<noscript$1>").replace(/<\/script>/gi,"</noscript>")}function safeEval(code){return/function/.test(code)&&console.warn("eval [function] 关键字"),eval(code)}SafeLocation.prototype.replace=function(t){location.replace(t)},SafeLocation.prototype.reload=function(){location.reload()},SafeLocation.prototype.assign=function(t){location.assign(t)},SafeLocation.prototype.toString=function(){return this.href};var SafeUtil={writeCookie:writeCookie,readCookie:readCookie,removeCookie:removeCookie,setCookieDefaultOption:setCookieDefaultOption,location:new SafeLocation,htmlEscape:htmlEscape,htmlUnescape:htmlUnescape,getSafeHtml:getSafeHtml,safeEval:safeEval,getSafeLocation:function(){return SafeUtil.location}};window.Util||(window.Util={}),assign(Util,SafeUtil)}(),
/*!
 * Util工具类
 */
function(a,c){a.epoint_local||(a.epoint_local={});var t=c(a),i=c("body"),n=c(document),r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function s(){if(!(this instanceof s))return new s;this.__events={}}s.installTo=function(e){if("object"!=typeof e)throw new TypeError("obj must be an object");if(e.__events!==undefined)throw new Error("此对象已经存在 __events 属性了。");return"function"==typeof Object.defineProperty?(Object.defineProperty(e,"__events",{value:{},configurable:!0,enumerable:!1,writable:!0}),["on","off","fire","one"].forEach(function(t){Object.defineProperty(e,t,{value:s.prototype[t],configurable:!0,enumerable:!1,writable:!0})})):(e.__events={},e.on=s.prototype.on,e.off=s.prototype.off,e.fire=s.prototype.fire,e.one=s.prototype.one),e},c.extend(s.prototype,{on:function(t,e){return"string"!==Util._getType(t)?console.error("The Event name must be a string"):"function"!==Util._getType(e)?console.error("The Event handler must be a function"):(t=t.toLowerCase(),this.__events[t]||(this.__events[t]=[]),this.__events[t].push(e)),this},fire:function(t,e,i){if("string"!==Util._getType(t))return console.error("The Event name must be a string"),this;t=t.toLowerCase();var n=this.__events[t];if(n&&n.length){for(var s=0,o=n.length;s<o;++s)n[s].call(i||this,{type:t,target:this,data:e});return this}},off:function(t,e){var i=this.__events[t];if(i&&i.length){if(e)for(var n=0;n<i.length;++n)e===i[n]&&(i.splice(n,1),--n);else this.__events[t]=i=[];return this}},one:function(t,e){var i=this;return this.on(t,function n(){i.off(t,n),e.apply(this||i,arguments)}),this}}),a.Util||(a.Util={});var o=c("body > .page-loading");c.extend(Util,{hidePageLoading:function(){o.length&&o.fadeOut(300,function(){o.remove()})},getWinSize:function(){return{width:t.width(),height:t.height()}},getBdSize:function(){return{width:i.width(),height:i.height()}},getDocSize:function(){return{width:n.width(),height:n.height()}},getScrollSize:function(){return{left:document.body.scrollLeft||document.documentElement.scrollLeft,top:document.body.scrollTop||document.documentElement.scrollTop}},
//     if (!query) {
getZIndex:function(){return mini.getMaxZIndex()},uuid:function(t,e){var i,n,s=r,o=[];if(e=e||s.length,t)for(i=0;i<t;i++)o[i]=s[0|Math.random()*e];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",i=0;i<36;i++)o[i]||(n=0|16*Math.random(),o[i]=s[19==i?3&n|8:n]);return o.join("")},getModalCover:function(t){var e=c("<div></div>",{id:t+"-cover"}).addClass("modal-dialog-cover hidden"),i=document.createElement("iframe");return i.width="100%",i.height="100%",i.scrolling="no",i.frameBorder=0,i.src="about:blank",c(i).appendTo(e),e},getRootPath:function(){var t=window.Util.getSafeLocation(),e=t.hostname,i=t.protocol,n=t.port?":"+t.port:"",s=(_rootPath!==undefined?_rootPath:"/"+t.pathname.split("/")[1])+"/";return/^(http|https|ftp|data:)/g.test(s)?s:i+"//"+e+n+s},getHash:function(t){var e=(t||location.href).indexOf("#");return-1===e?"":t.substr(e)},removeHash:function(t){var e=t.indexOf("#");return-1===e?t:t.substring(0,e)},getRightUrl:function(t,e){if(!t)return"";var i=Util.removeHash(Util.getSafeLocation().href),n=i.indexOf("?");-1!==n&&(i=i.substr(0,n));var s=-1!==t.indexOf("./")||-1!==t.indexOf("../");return/^(http|https|ftp|data:)/g.test(t)||(t=s?i.substr(0,i.lastIndexOf("/")+1)+t:("/"===t.substring(0,1)&&(t=t.substring(1)),Util.getRootPath()+t)),e?t:Util.encryptUrlParams?Util.encryptUrlParams(t):t},browsers:{isIE67:!1,isIE8:!!document.all&&document.querySelector&&!document.addEventListener,isIE9:!!document.all&&document.addEventListener&&!window.atob,isIE10:!!document.all&&window.atob,isIE11:"-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,isIE:!!document.all&&document.compatMode||"-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,isWebkit:"WebkitAppearance"in document.documentElement.style,isFirefox:!!navigator.userAgent.match(/firefox/i),isEdge:/Edge\/([\d.]+)/.test(navigator.userAgent)},toInt:function(t){var e=parseInt(t,10);return e||0},openSelfWin:function(t){a.Util.getSafeLocation().setHref(t)},_loadedJs:{},loadJs:function(n,t){if(this._loadedJs[n])return this._loadedJs[n].callbacks||(this._loadedJs[n].callbacks=[]),void this._loadedJs[n].callbacks.push(t);var e=document.createElement("script");function i(){var t=Util._loadedJs[n].callbacks;if(t){for(var e=0,i=t.length;e<i;e++)t[e]();Util._loadedJs[n].callbacks=undefined}}e.type="text/javascript",e.readyState?e.onreadystatechange=function(){"loaded"!==e.readyState&&"complete"!==e.readyState||(e.onreadystatechange=null,i())}:e.onload=function(){i(),e.onload=null},this._loadedJs[n]={},t&&(this._loadedJs[n].callbacks=[t]),e.src=a.SrcBoot?SrcBoot.handleResPath(n):Util.getRightUrl(n),document.getElementsByTagName("head")[0].appendChild(e)},_lazyLoadStyle:document.getElementById("lazy-load-style"),loadCss:function(t,e,i,n){if(n===undefined&&(n=!0),Util.browsers.isIE&&n&&this._lazyLoadStyle){var s='@import "'+(a.SrcBoot?SrcBoot.handleResPath(t):Util.getRightUrl(t))+'";';return"styleSheet"in this._lazyLoadStyle?this._lazyLoadStyle.styleSheet.cssText+=s:c(this._lazyLoadStyle).text(c(this._lazyLoadStyle).text()+s)}var o=c("<link/>",{href:a.SrcBoot?SrcBoot.handleResPath(t):Util.getRightUrl(t),rel:"stylesheet",type:"text/css"});e&&c(e).length?o["insert"+(i=i||"After")](e):(e=document.getElementsByTagName("head")[0],o.appendTo(e))},loadPageModule:function(e){c.ajax({type:"get",dataType:"html",url:a.SrcBoot?SrcBoot.handleResPath(e.templ):this.getRightUrl(e.templ),data:{},beforeSend:function(t){e.css&&Util.loadCss(e.css,document.getElementById("common-skin"),"Before",!0),c.ajaxSettings.beforeSend(t)},success:function(t){c(t).appendTo("body"),e.js&&Util.loadJs(e.js,function(){e.callback&&e.callback()})}})},clearHtml:function(t){return t.replace(/(\r\n|\n|\r)/g,"").replace(/[\t ]+</g,"<").replace(/>[\t ]+</g,"><").replace(/>[\t ]+$/g,">")},_ajaxErr:function(t,e,i){console.error("status: %s, error: %s",e,i),console.error("%c后台返回的数据："+t.responseText,"font-size: 16px;");var n=t.responseJSON;n&&n.status&&n.status.text?mini.showMessageBox({title:epoint_local.error_tip,buttons:["ok"],message:n.status.text,iconCls:"mini-messagebox-error"}):-1===[400,401,403,404,429,500,503].join(";").indexOf(t.status)&&mini.showMessageBox({title:epoint_local.error_tip,buttons:["ok"],message:epoint_local.ajax_error_text,iconCls:"mini-messagebox-error"})},_handleStatusCode:function(t){function i(t,i){var n,s=t.responseJSON,o=i,r=null;if(!s)try{s=mini.decode(t.responseText)}catch(e){}s&&s.status&&s.status.text||("string"==typeof s?o=s:s&&(o=s.error,r=s.stackError,n=s._common_hidden_viewdata),o=o||epoint_local.ajax_error_text,n&&Util.setCommonViewData(n),a.epoint&&a.epoint.onAjaxStatusError&&a.epoint.onAjaxStatusError(o,r,t.status,t)||(r?(mini.showMessageBox({title:epoint_local.error_tip,buttons:["ok"],iconCls:"mini-messagebox-error",message:o+'<a class="messagebox-error-detail" href="javascript:;">'+epoint_local.detail_text+"...</a>"}),c("body").on("click",".messagebox-error-detail",function(){var t='<div id="message-dialog-detail" style="display:none;padding: 0 20px; position: fixed;width: 80%;left:10%;top: 5%;height: 90%;z-index:'+Util.getZIndex()+';background-color:#fff;border:1px solid #ccc;"><div class="messagebox-close-btn" style="width: 20px;height:20px;position:absolute;right: -10px;top: -10px;border-radius:50%;background-color:rgba(0,0,0,.7);color:#fff;line-height: 18px;text-align:center;cursor:pointer;">&times;</div><div style="width:100%;height:100%;overflow-y:auto;">'+r+"</div></div>";c("#message-dialog-detail").remove(),c("body").append(t),c("#message-dialog-detail").show()}).on("click",".messagebox-close-btn",function(){c("#message-dialog-detail").remove()})):mini.showMessageBox({title:epoint_local.error_tip,buttons:["ok"],message:o,iconCls:"mini-messagebox-error",callback:function(t){a.epoint&&a.epoint.ajaxStatusErrorAlertCallback&&a.epoint.ajaxStatusErrorAlertCallback(t)}})))}return{400:function(t){i(t)},401:function(t){var e=t.responseJSON||mini.decode(t.responseText),i="";if(e&&(i=e.url))return 0!==i.indexOf("http")&&(i=Util.getRootPath()+i,i=Util.addHtmlToUrl(i)),void(top.Util&&top.Util.getSafeLocation?top.Util.getSafeLocation().replace(i):top.location.replace(i));var n=e?e._common_hidden_viewdata:undefined;n&&Util.setCommonViewData(n),top.window.quickLogin!==undefined?top.quickLogin.show():top.Util.loadPageModule({templ:"frame/fui/js/widgets/quicklogin/quicklogin.tpl",css:"frame/fui/js/widgets/quicklogin/quicklogin.min.css",js:"frame/fui/js/widgets/quicklogin/quicklogin.js",callback:function(){top.quickLogin.show()}})},403:function(t){i(t)},404:function(t){i(t,epoint_local.ajax_error_text)},500:function(t){i(t)},503:function(t){i(t,epoint_local.service_error_text)},429:function(t){var e=t.responseJSON||mini.decode(t.responseText),i=e?e._common_hidden_viewdata:undefined;i&&Util.setCommonViewData(i),window.showInterceptTips!==undefined?showInterceptTips(e):(Util.loadCss("frame/fui/js/widgets/intercepttips/intercepttips.css"),Util.loadJs("frame/fui/js/widgets/intercepttips/intercepttips.js",function(){showInterceptTips(e)}))}}},ajax:function(h){var t=Util.getSafeLocation().href.match(/^https?:\/\/.*\/fui\/pages\/themes\/(\w+)\/\1/i),e=t&&t[1],i="true"===Util._getUrlParams(h.url,"isCommondto"),d=mini.get("_common_hidden_viewdata");(h=c.extend({},{type:"POST",dataType:"json",error:Util._ajaxErr},h)).url=Util.getRightUrl(h.url,h.noEncryption),h.data=h.data||{},e&&(h.data=c.extend({themeId:e,pageId:Util.getUrlParams("pageId")||e},h.data)),i&&!h.data.commonDto&&d&&(h.data.commonDto=mini.encode([{id:"_common_hidden_viewdata",type:"hidden",value:d.getValue()}])),h.data=Util.addReplayAttackData(h.data,h.url),h.data=c.extend(Util.getUrlParams(),h.data),h.noEncryption||(h.data=Util.encryptAjaxParams(h.url,h.data));var u=h.success;u&&(h.success=null,delete h.success);function n(t){t[Util.BODY_ENCRYPT_PARAM_NAME]&&(t=Util.decrypt(t[Util.BODY_ENCRYPT_PARAM_NAME]),t=mini.decode(t));var e=t.status,i=t.controls;if(i&&i.length&&"_common_hidden_viewdata"===(d=i[i.length-1]).id&&Util.setCommonViewData(d.value),(t=t.custom===undefined?t:t.custom)&&"object"!=typeof t&&"json"===h.dataType.toLowerCase()&&(t=JSON.parse(t)),e){var n=parseInt(e.code,10),s=e.text||"",o=e.url,r=1===n||200===n?epoint_local.success_text:epoint_local.failed_text,a=1===n||200===n?"success":"danger";if(o){0!==o.indexOf("http")&&(o=Util.getRootPath()+o,o=Util.addHtmlToUrl(o));var l=e.top?top:window;return void(l.Util&&l.Util.getSafeLocation?l.Util.getSafeLocation().replace(o):l.location.replace(o))}s&&mini.showTips({content:"<b>"+r+"</b> <br/>"+s,state:a,x:"center",y:"top",timeout:3e3}),1===n||200===n?u&&(u.apply(this,[t,arguments[1],arguments[2]]),u=null):h.fail&&h.fail.call(this,s,e)}else u&&(u.apply(this,[t,arguments[1],arguments[2]]),u=null);return t}!1===h.async&&(h.success=n);var s=c.ajax(h),o=s.then(n);if(o.success=o.done,o.error=o.fail,o.complete=o.always,o.abort=s.abort,!1===h.async){var r=o.done;o.done=function(){return console.error("[Ajax Tips]:您正在使用同步请求，回调应通过配置项的 success 进行配置。\ndone then 回调中已经是异步，可能导致您的业务逻辑受到影响"),r.apply(o,arguments)}}return o},clearIframe:function(t){var i=t[0];i.src="about:blank";try{i.contentWindow.document.write(""),i.contentWindow.document.close()}catch(e){}try{i.parentNode.removeChild(i)}catch(e){t.remove()}},noop:function(){},_layoutDatagridInContent:function(){var t=mini.get("datagrid");t&&t.doLayout&&t.doLayout()},timeChunk:function(e,i,n,t,s){var o,r;return function(){r=setInterval(function(){e.length||(clearInterval(r),s&&s()),function(){for(var t=0;t<Math.min(n||1,e.length);t++)o=e.shift(),i(o)}()},t||100)}},redrawPseudoEl:function(t){if(this.browsers.isIE8){var e=c(t);e.addClass("content-empty"),setTimeout(function(){e.removeClass("content-empty")},0)}},getModuleProps:function(t){return{url:c.trim(t.getAttribute("modurl")),name:t.getAttribute("modname"),code:t.getAttribute("modcode"),isBlank:"true"===t.getAttribute("isblank")}},UserEvent:s,_sysParamNameMapping:{fileSizeLimit:"file_limit_size",fileLimitType:"file_limit_type",uploadPreviewUrl:"upload_preview_url",uploadPreviewText:"upload_preview_text",enableCustomSort:"ui_customsort_enable",noUseTabsNav:"ui_use_tabsnav",gridPageSize:"ui_grid_pagesize",fileNameLengthLimit:"attach_filename_limitlength",gridAllowUnselect:"grid_allow_unselect",adjustGridPageSize:"grid_adjust_pagesize",editorModel:"editor_model",alertToTips:"alert_to_tips",messageSound:"message_sound"},getFrameSysParam:function(t){if(a.EpFrameSysParams)return a.EpFrameSysParams[t]===undefined&&"ui_use_tabsnav"===(t=Util._sysParamNameMapping[t])?!a.EpFrameSysParams[t]:a.EpFrameSysParams[t]},getThemeName:function(){return Util.readCookie("_theme_")},getSkinName:function(){var t=this.getThemeName();return Util.readCookie("_"+t+"_skin_")||"default"},getFirstScrollEl:function(t){return t.scrollHeight>t.clientHeight?t:t.parentElement?this.getFirstScrollEl(t.parentElement):null},getRightIPv6Url:function(t){var e=Util.getSafeLocation(),i=e.hostname;if(Util.browsers.isIE&&/:/.test(i)){var n=-1!=t.indexOf("./")||-1!=t.indexOf("../"),s=e.protocol+"//"+i.replace(/:/g,"-").replace(/%/g,"s").replace(/\[/g,"").replace(/\]/g,"")+".ipv6-literal.net"+(e.port?":"+e.port:"");return/^(http|https|ftp|data:)/g.test(t)||(t=n?s+e.pathname.substr(0,e.pathname.lastIndexOf("/")+1)+t:("/"===t.substring(0,1)&&(t=t.substring(1)),s+(_rootPath!==undefined?_rootPath:"/"+e.pathname.split("/")[1])+"/"+t)),t}return Util.getRightUrl(t)},_getType:function(t){return c.type(t)},setCommonViewData:function(t){var e=mini.get("_common_hidden_viewdata");e||((e=new mini.Hidden).setId("_common_hidden_viewdata"),e.render(document.body)),e.setValue(t)},addReplayAttackData:function(t,e){function i(t){return encodeURIComponent(t).replace(/'/g,"%27").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\(/g,"%28").replace(/\)/g,"%29")}var n=Util.uuid(),s=Date.now(),o=function l(t){var e=(t=Util.removeHash(t)).indexOf("?");if(-1===e)return"";var i=t.substr(e+1);return i.length?(-1<i.indexOf(Util.URL_ENCRYPT_PARAM_NAME)&&-1<(i=i.substr(i.indexOf(Util.URL_ENCRYPT_PARAM_NAME)+Util.URL_ENCRYPT_PARAM_NAME.length+1)).indexOf("&")&&(i=i.substr(0,i.indexOf("&"))),i):""}(e),r=t.commonDto||"",a=t.cmdParams||"";return 10240<r.length&&(r=r.length+""),c.extend(t,{replaynoticeid:n,reqtime:s,paramsign:Util.encryptSM(n+";"+s+";"+i(o)),dtosign:Util.encryptSM(n+";"+s+";"+i(r)+";"+i(a))}),t},cachePageData:function(t,e){e=e||window.location.pathname,"object"==typeof t&&(t=JSON.stringify(t)),localStorage.setItem(e,t)},getPageData:function(t){t=t||window.location.pathname;var i=localStorage.getItem(t);try{i=JSON.parse(i)}catch(e){}return i},clearPageData:function(t){!0===t?localStorage.clear():(t=t||window.location.pathname,localStorage.removeItem(t))},addHtmlToUrl:function(t){if(1===parseInt(Util.getFrameSysParam("dto_with_suffix"),10)&&t.indexOf(".html")<0){var e=t.indexOf("?");e<0?t+=".html":t=t.substr(0,e)+".html"+t.substr(e)}return t},adjustRequestContextCmd:function(t){var e=Util.getFrameSysParam("requestcontext_cmd_alias");return e&&(t=t.replace("?cmd=","?"+e+"=")),t},encryptRSA:function(t,e,i){if(!e){if(!(e=Util.getFrameSysParam("rsa_publicExponent")))throw new Error("the second param [publicExponent] can not be empty");e=e.substring(1)}if(!(i=i||Util.getFrameSysParam("rsa_modulus")))throw new Error("the third param [modulus] can not be empty");var n=RSAUtils.getKeyPair(e,"",i);return t=RSAUtils.encryptedString(n,t)},encryptSM2:function(t,e){if(!(e=e||Util.getFrameSysParam("security_sm2encode_pubk")))throw new Error("the second param [sm2PubKey] can not be empty");return t=sm2Encrypt(t,e,0)},encryptSM:function(t,e){return"sm2"===e?Util.encryptSM2(t):sm3Encrypt(t)},render:function(t,e,i){var n;return 0===t.indexOf("#")&&(t=Util.clearHtml(c(t).html())),n=Mustache.render(t,e),i&&c(i).html(n),n},renderPager:function(t,e){var i=mini.get(t);i&&e&&("function"==typeof e.callback&&(i.__F9_RENDER_PAGER=e.callback,i.on("pagechanged",function(t){i.__F9_RENDER_PAGER(t.pageIndex,t.pageSize)}),delete e.callback),i.set(e))},debounce:function(i,n,s){var o;return n=n||17,function(){var t=arguments,e=s||this;clearTimeout(o),o=setTimeout(function(){i.apply(e,t)},n)}},throttle:function(n,s,o){s=s||200;var r,a=+new Date;return function(){clearTimeout(r);var t=arguments,e=o||this,i=+new Date-a;s<=i?(n.apply(e,t),a=+new Date):r=setTimeout(function(){n.apply(e,t),a=+new Date},s-i)}}}),c.extend(Util.browsers,function l(){var t=document.createElement("div"),e=!1,i=!1,n=null,s=null,o=null,r=null;return"transition"in t.style?(e=!0,n="transitionend"):"-webkit-transition"in t.style?(e=!0,n="webkitTransitionEnd"):"-moz-transition"in t.style?(e=!0,n="mozTransitionEnd"):"-o-transition"in t.style&&(e=!0,n="oTransitionEnd"),"animation"in t.style||"-moz-animation"in t.style?(i=!0,s="animationend",o="animationiteration",r="animationstart"):"-webkit-animation"in t.style&&(i=!0,s="webkitAnimationEnd",o="webkitAnimationIteration",r="webkitAnimationStart"),t=null,{isSupportTransition:e,isSupportAnimation:i,animationend:s,animationiteration:o,animationstart:r,transitionend:n}}()),Util.browsers.isEdge&&c("body").addClass("edge"),Util.fixIframeNoScroll=function(){c("body").add("html").css({height:"100%",overflow:"hidden"}),c("form:eq(0)").css({height:"100%",overflow:"auto"})},Util._fixIframeNoScroll=Util.fixIframeNoScroll,Util._clearIframe=Util.clearIframe,Util._loadPageModule=Util.loadPageModule,Util.getAbsoluteUrl=Util.getRightUrl}(this,jQuery),function(t,e){var i=Element.prototype,s="",n="";"function"==typeof i.requestFullscreen?(s="requestFullscreen",n="exitFullscreen"):["webkit","moz","ms","o"].forEach(function(t){"function"==typeof(t+"RequestFullscreen")[t]&&(s=t+"RequestFullScreen",n=t+"ExitFullscreen")});var o={requestFullscreen:s?function(t,e){t=t||document.documentElement;var i=1<arguments.length?t[s](e):t[s]();return i&&i.then?i:Promise.resolve()}:function(){return Promise.reject(new Error("requestFullscreen is not supported"))},exitFullscreen:n?function(){var t=document[n]();return t&&t.then?t:Promise.resolve()}:function(){return Promise.reject(new Error("exitFullscreen is not supported"))},createFullScreenToggle:function(t,e,i){if(s){t=t||document.documentElement;var n={enter:function(){return o.requestFullscreen(t,i)},exit:function(){return o.exitFullscreen()},toggle:function(){n.fullscreenState?n.exit():n.enter()},onchange:"function"==typeof e?e:function(){}};return t.addEventListener("fullscreenchange",function(){n.fullscreenState=!!document.fullscreenElement,n.onchange(n.fullscreenState)}),n}console.error("requestFullscreen is not supported")}};e.extend(t.Util,o)}(this,this.jQuery),zmc=this,Amc=jQuery,Bmc={_timer:null,updateSkin:function(t){var e=this;this._timer&&clearTimeout(this._timer),Amc('[name="fui-ui-style"][data-name="'+t+'"]').prop("disabled",!1),Amc('[name="fui-theme-style"][data-name="'+t+'"]').prop("disabled",!1),this._timer=setTimeout(function(){Amc('[name="fui-ui-style"]').not('[data-name="'+t+'"]').prop("disabled",!0),Amc('[name="fui-theme-style"]').not('[data-name="'+t+'"]').prop("disabled",!0),e._timer=null},200)},postToChild:function(i,t){var e=document.getElementsByTagName("iframe"),n=this;t&&setTimeout(function(){n._postMessage(zmc,i)});try{Amc.each(e,function(t,e){setTimeout(function(){n._postMessage(e.contentWindow,i)})})}catch(s){console.error(s),e=null}e=null},_postMessage:function(t,e){t.postMessage(JSON.stringify({type:"skinChange",skin:e}),"*")},init:function(){var n=this;Amc(zmc).on("message",function(t){if((t=t.originalEvent).data)try{var e=JSON.parse(t.data);"skinChange"===e.type&&e.skin&&(n.updateSkin(e.skin),n.postToChild(e.skin))}catch(i){}})}},Bmc.init(),Util.skinSwitcher=Bmc,Tmc=this,Umc=jQuery,Vmc=Tmc.HtmlBaseFontSize||100,Wmc=Tmc.BodyBaseFontSize||14,Ymc={doUpdateFontSize:function(t){t&&!isNaN(parseFloat(t,10))&&(document.documentElement.style.fontSize=Xmc(Vmc,t),document.body.style.fontSize=Xmc(Wmc,t),setTimeout(function(){Umc(Tmc).trigger("resize")},200))},updateFontSize:function(t){t=t.ratio||t,this.doUpdateFontSize(t),this.postToChild(JSON.stringify({ratio:t,type:"fontSizeChange"}))},postToChild:function(e){[].slice.call(document.getElementsByTagName("iframe")).forEach(function(t){t.contentWindow.postMessage(e,"*")})},saveFontSizeRatio:function(t){(t=parseFloat(t,10))&&!isNaN(t)&&(Util.writeCookie("_font_size_ratio_",t,{expires:365,path:window._rootPath?window._rootPath+"/":"/"}),this.updateFontSize(t))},init:function(){var n=this;Tmc.addEventListener("message",function(t){var e=t.data;try{e&&e+""===e&&(e=JSON.parse(e)),"fontSizeChange"===e.type&&n.updateFontSize(e)}catch(i){}})}},Tmc.addEventListener&&Ymc.init(),Tmc.Util.fontSizeSwitcher=Ymc,function(n,x){var C={onToggle:Util.noop,toggleTop:Util.noop,toggleLeft:Util.noop,toggleRight:Util.noop,toggleBottom:Util.noop,toggle:function(t,e){var i="toggle"+t[0].toUpperCase()+t.substr(1);this[i]&&this[i](e)}},b=x("body"),E={animate:!1,autoHide:!0,delay:20,ghost:!1},o=150,T=49,S=".f9-layout",a=Util.browsers.isIE8,k=Util.browsers.isIE9;function t(){var l=x(".fui-top"),h=x(".fui-left"),s=x(".fui-main, .fui-right"),u=x(".fui-rightbar"),c=x(".fui-bottom"),t=l.add(h).add(s).add(u).add(c),d=[],m=[],f=[],p=[];if(function o(){var i=!0;return x.each([l,h,s,u,c],function(t,e){if(1<e.length)return i=!1,console.error(e[0],"布局区域重复， 一个区域仅能出现一次"),!1}),i&&t.each(function(t,e){if(x(e).parent()[0]!==document.body)return i=!1,console.error(e,"不在body下，布局结构错误！！！"),!1}),i}()){C.fire("beforeParse");var e=x(".page-loading").length,i=x.fn;!e&&t.length&&(i=x('<div class="page-loading"></div>').appendTo("body")).css("height"),function r(){var t,e,i=1===l.length,n=1===c.length;d=i?"true"===l.attr("inset")?(t=!0,b.addClass("with-fui-top-inset"),[s]):(b.addClass("with-fui-top"),[h,s,u]):[];m=n?"true"===c.attr("inset")?(e=!0,b.addClass("with-fui-bottom-inset"),[s]):(b.addClass("with-fui-bottom"),[h,s,u]):[];h.length?(b.addClass("with-fui-left"),f=[s],i&&t&&f.push(l),n&&e&&f.push(c)):f=[];u.length?(b.addClass("with-fui-right"),p=[s],i&&t&&p.push(l),n&&e&&p.push(c)):p=[];s.hasClass("fui-right")&&s.addClass("fui-main")}(),x.each([l,h,u,c],function(t,e){!function i(t){if(!t.length)return;if("false"!==t.attr("toggle")){var e=x('<span class="fui-layout-toggle"></span>').appendTo(t);t[0].removeAttribute("toggle"),t.hasClass("fui-top")&&e.addClass("icon-totop"),t.hasClass("fui-bottom")&&e.addClass("icon-tobottom"),t.hasClass("fui-left")&&e.addClass("icon-toleft"),t.hasClass("fui-rightbar")&&e.addClass("icon-toright")}}(e)}),M(h),M(u),function _(){if(!l.length)return;var t="true"===l.attr("closed");function e(t){t?(l.removeClass("closed"),n(l.data("height")||l.outerHeight(!0))):(l.addClass("closed"),n(0)),C.fire("_toggle",{region:"top",state:t?"opened":"closed"})}l.off("click"+S,".fui-layout-toggle").on("click"+S,".fui-layout-toggle",function(){e(!!l.hasClass("closed"))}),C.toggleTop=function(t){e(t!==undefined?!!t:l.hasClass("closed"))},t&&l.find(".fui-layout-toggle").trigger("click");function n(i){x.each(d,function(t,e){e.css("top",i)})}var i=parseInt(l.attr("min-height"),10)||T,s=parseInt(l.attr("max-height"),10),o=D(parseInt(l.attr("default-height"),10),i,s),r=I("top")||o||0;r&&(l.css("height",r),t||n(r));if("false"===l.attr("resize"))return;x('<div class="fui-layout-resizebar"></div>').appendTo(l);var a=0;l.resizable(x.extend({},E,{maxHeight:s||L("top"),minHeight:i,helper:"fui-top-resize-helper",handles:{s:".fui-top > .fui-layout-resizebar"},start:function(){b.addClass("row-resizing"),a=l.outerWidth(!0)},resize:function(t,e){e.helper.css("width",a)},stop:function(t,e){b.removeClass("row-resizing");var i=Math.round(e.size.height);l.css({width:"",height:i}).data("height",i),n(i),F("top",i),g("top")}})),s||x(window).on("resize"+S+"top",function(){l.resizable("option","maxHeight",L("top"))})}(),function v(){if(!h.length)return;var t="true"===h.attr("closed");function e(t){t?(h.removeClass("closed"),n(h.data("width")||h.outerWidth(!0))):(h.addClass("closed"),n(0)),C.fire("_toggle",{region:"left",state:t?"opened":"closed"})}h.off("click"+S,".fui-layout-toggle").on("click"+S,".fui-layout-toggle",function(){e(!!h.hasClass("closed"))}),C.toggleLeft=function(t){e(t!==undefined?!!t:h.hasClass("closed"))},t&&h.find(".fui-layout-toggle").trigger("click");function n(i){x.each(f,function(t,e){e.css("left",i)})}var i=parseInt(h.attr("min-width"),10)||T,s=parseInt(h.attr("max-width"),10),o=D(parseInt(h.attr("default-width"),10),i,s),r=I("left")||o||0;r&&(h.css("width",r),t||n(r));if("false"===h.attr("resize"))return;x('<div class="fui-layout-resizebar"></div>').appendTo(h);var a=0;h.resizable(x.extend({},E,{maxWidth:s||L("left"),minWidth:i,helper:"fui-left-resize-helper",handles:{e:".fui-left > .fui-layout-resizebar"},start:function(){b.addClass("col-resizing"),a=h.outerHeight(!0)},resize:function(t,e){e.helper.css("height",a)},stop:function(t,e){b.removeClass("col-resizing");var i=Math.round(e.size.width);h.css({width:i,height:""}).data("width",i),n(i),F("left",i),g("left")}})),s||x(window).on("resize"+S+"left",function(){h.resizable("option","maxWidth",L("left"))})}(),function y(){if(!u.length)return;function e(t){t?(u.removeClass("closed"),i(u.data("width")||u.outerWidth(!0))):(u.addClass("closed"),i(0)),C.fire("_toggle",{region:"rightbar",state:t?"opened":"closed"})}u.off("click"+S,".fui-layout-toggle").on("click"+S,".fui-layout-toggle",function(){e(!!u.hasClass("closed"))}),C.toggleRight=function(t){e(t!==undefined?!!t:u.hasClass("closed"))};var t="true"===u.attr("closed");t&&u.find(".fui-layout-toggle").trigger("click");function i(i){x.each(p,function(t,e){e.css("right",i)})}var n=parseInt(u.attr("min-width"),10)||T,s=parseInt(u.attr("max-width"),10),o=D(parseInt(u.attr("default-width"),10),n,s),r=I("rightbar")||o||0;r&&(u.css("width",r),t||i(r));if("false"===u.attr("resize"))return;x('<div class="fui-layout-resizebar"></div>').appendTo(u);var a=0,l=0,h=L("rightbar"),d=0;u.resizable(x.extend({},E,{helper:"fui-rightbar-resize-helper",handles:{e:".fui-rightbar > .fui-layout-resizebar"},start:function(){b.addClass("col-resizing"),h=s||L("rightbar"),a=parseInt(u.css("top"),10)||0,l=parseInt(u.css("bottom"),10)||0},resize:function(t,e){var i=e.size.width-e.originalSize.width;d=D(d=e.originalSize.width-i,n,h),e.helper.css({left:"auto",right:0,top:a,bottom:l,width:d,height:""})},stop:function(){b.removeClass("col-resizing"),u.css({left:"",width:d,height:""}).data("width",d),i(d),F("rightbar",d),g("rightbar")}}))}(),function w(){if(!c.length)return;function e(t){t?(c.removeClass("closed"),i(c.data("height")||c.outerHeight(!0))):(c.addClass("closed"),i(0)),C.fire("_toggle",{region:"bottom",state:t?"opened":"closed"})}c.off("click"+S,".fui-layout-toggle").on("click"+S,".fui-layout-toggle",function(){e(!!c.hasClass("closed"))}),C.toggleBottom=function(t){e(t!==undefined?!!t:c.hasClass("closed"))};var t="true"===c.attr("closed");t&&c.find(".fui-layout-toggle").trigger("click");function i(i){x.each(m,function(t,e){e.css("bottom",i)})}var n=parseInt(c.attr("min-height"),10)||T,s=parseInt(c.attr("max-height"),10),o=D(parseInt(c.attr("default-height"),10),n,s),r=I("bottom")||o||0;r&&(c.css("height",r),t||i(r));if("false"===c.attr("resize"))return;x('<div class="fui-layout-resizebar"></div>').appendTo(c);var a=0,l=0,h=L("bottom"),d=0;c.resizable(x.extend({},E,{helper:"fui-bottom-resize-helper",handles:{s:".fui-bottom > .fui-layout-resizebar"},start:function(){b.addClass("row-resizing"),h=s||L("bottom"),a=parseInt(c.css("right"),10)||0,l=parseInt(c.css("left"),10)||0},resize:function(t,e){var i=e.size.height-e.originalSize.height;d=D(d=e.originalSize.height-i,n,h),e.helper.css({left:l,right:a,top:"auto",bottom:0,width:"",height:d})},stop:function(){b.removeClass("row-resizing"),c.css({top:"",width:"",height:d}).data("height",d),i(d),F("bottom",d),g("bottom")}}))}(),t.filter(function(t,e){var i=x(e);return!i.hasClass("fui-main")&&"false"!==i.attr("resize")}).length&&x('<div class="fui-layout-cover"></div>').appendTo(s),e||i.fadeOut(function(){i.remove()}),setTimeout(function(){t.addClass("fui-layout-tran")},1e3),C.fire("parse"),C.fire("afterParse");var n={}}function g(t){if(a||k)return C.fire("afterResize",{region:t});clearTimeout(n[t]),n[t]=setTimeout(function(){C.fire("afterResize",{region:t})},200)}}function I(t){var e="FRAME_LAYOUT_SIZE_"+t+"-"+location.pathname,i=parseInt(localStorage.getItem(e),10);if("top"===t||"bottom"===t){if(i<T)return T;var n=L(t);return n<i?n:i}if("left"!==t&&"rightbar"!==t)return 0;if(i<o)return o;var s=L(t);return s<i?s:i}function F(t,e){var i="FRAME_LAYOUT_SIZE_"+t+"-"+location.pathname;localStorage.setItem(i,e)}function D(t,e,i){return x.isNumeric(t)?x.isNumeric(e)&&t<e?e:x.isNumeric(i)&&i<t?i:t:NaN}function L(t){if("left"===t||"rightbar"===t){var e=function s(t){return 10*Math.round(t/10)}(.4*window.innerWidth);return 0<e?e<o?o:e:NaN}if("top"===t||"bottom"===t){var i=window.innerHeight,n=Math.round(.3*i);return 0<n?n<T?T:n:NaN}}function M(t){if(t.length){var e=t.find('> [role="head"]'),i=e.attr("title"),n=t.find('> [role="body"]'),s=t.hasClass("fui-left")?"left":"rightbar";e.length&&e.addClass("fui-"+s+"-hd").append(function o(t,e){return t?'<h4 class="fui-'+e+'-title">'+t+"</h4>":""}(i,s)).removeAttr("role"),n.length&&n.addClass("fui-"+s+"-bd").removeAttr("role")}}function s(){n.Util._layoutDatagridInContent&&Util._layoutDatagridInContent()}Util.UserEvent.installTo(C),C.on("afterResize",function(){x(window).trigger("resize"),s()});var r={};C.on("_toggle",function(t){var e=t.data;!function i(t,e){if(a||k)return C.fire("toggle"+t,e),void C.fire("toggle",e);clearTimeout(r[t]),r[t]=setTimeout(function(){C.fire("toggle"+t,e),C.fire("toggle",e)},200)}(e.region,e)}),C.on("toggle",function(t){var e=t.data,i=e.region;"left"===i&&Util.leftRight.onToggle(),n.adjustContentHeight&&n.adjustContentHeight(),s(),C.onToggle(i,e.state)}),x.extend(C,{parse:t}),Util.layoutInstance=C,Util.leftRight||(Util.leftRight={}),Util.leftRight.onToggle||(Util.leftRight.onToggle=Util.noop),Util.leftRight.parse||(Util.leftRight.parse=t),t()}(this,this.jQuery),
/*!
 * 解析表单布局
 */
yqc=jQuery,zqc=yqc(".fui-form"),Aqc={span1:"33.3333%",span2:"50%",span3:"66.6667%",span4:"83.3333%",span5:"100%"},Dqc={2:5,4:2,6:1},Eqc={2:6,4:3,6:2},Fqc=function(t,e,i){var n,s="true"===t[0].getAttribute("starred"),o=t[0].getAttribute("label"),r=function(t,e,i){var n=[];return""!==t&&i&&i.showColon&&(t+="："),n.push('<label class="form-label'),e&&n.push(" required"),n.push('">'+t+"</label>"),n.join("")}(o||"",s,i),a=t.data("tooltip");if(a&&t.data("tooltip","").removeAttr("data-tooltip"),i.isVertical){if(n=(n=parseInt(t[0].getAttribute("span"),10))?6<n?6:n<1?1:n:Eqc[e+""],a){var l='<span class="form-tooltip action-icon icon-confirm" data-tooltip="'+a+'"></span>';i.inline||(l+="<br>"),t.prepend(l)}else i.inline||(r+="<br>");t.addClass("form-control").addClass("span"+n).prepend(r).removeAttr("role")}else if((n=parseInt(t[0].getAttribute("span"),10))?(n=6<n?6:n<2?2:n,n-=1):n=Dqc[e+""],t.addClass("form-control").addClass("span"+n).before(r).removeAttr("role"),a){var h=yqc('<span class="form-tooltip action-icon icon-confirm"></span>').attr("data-tooltip",a);h.appendTo(t),function d(t){var e=t.prev(),i=e[0].style.width,n="";/px$/.test(i)&&(n=parseInt(i,10)-30);n=n||"calc( "+(i||"100%")+" - 30px )";e.css("width",n)}(h)}},Util.form={parse:function(t){if(t.length)return Iqc(t)},setLabelWidth:function(t,e){var i=yqc(e||".fui-form");/^\d+(px)?$/.test(t)?(i.attr("label-width",t),Kqc(i)):window.console&&console.error("label宽度配置仅支持数值或 xxpx 的形式")},showField:function(t){var e=yqc(t),i=e.closest(".fui-form.vertical").length,n=e.prev(),s=Lqc(e[0]),o=e.closest(".form-row");i?e.removeClass("hidden"):e.add(n).removeClass("hidden"),s&&s.originEnabled&&s.setEnabled(!0),Mqc(o)},setRequired:function(t,e){var i=yqc(t),n=i.closest(".fui-form.vertical").length?i.find(">.form-label"):i.prev(),s=null,o=i.find('>[class*="mini-"]');1===o.length&&(s=mini.getAndCreate(o[0])),e?(n.addClass("required"),s&&s.setRequired&&s.setRequired(!0)):(n.removeClass("required"),s&&s.setRequired&&s.setRequired(!1))},hideField:function(t){var e=yqc(t),i=e.closest(".fui-form.vertical").length,n=e.prev(),s=Lqc(e[0]),o=e.closest(".form-row");i?e.addClass("hidden"):e.add(n).addClass("hidden"),s&&s.enabled&&(s.setEnabled(!1),s.originEnabled=!0),Mqc(o)},setLabel:function(t,e){var i,n=yqc(t);i=n.find("> .form-label").length?n.find("> .form-label"):n.prev(),n.attr("label",e),n.closest(".fui-form").data("showcolon")&&e&&(e+="："),i.text(e)}},Iqc(zqc),Gsc=this.jQuery,Jsc={parse:Hsc,activeTab:function(t,e){(e||Gsc(".fui-tabs")).find(">.fui-tab:eq("+t+")").trigger("click")},setTabName:function(t,e){if(t){"#"!=t[0]&&(t="#"+t);var i=Gsc(t),n=i.find(">.fui-tab-num");i.text(e),n.length&&i.appendTo(i)}},setTabUrl:function(t,e){if(t){"#"!=t[0]&&(t="#"+t);var i=Gsc(t);i.attr("url",e),i.hasClass("active")&&i.removeClass("active").trigger("click")}},setTabNum:function(t,e){if(t){"#"!=t[0]&&(t="#"+t);var i=Gsc(t);e+""===e&&(e=parseInt(e,10)||0);var n=i.find(">.fui-tab-num");e<=0?n.remove():(e=99<e?"99+":e,n.length?n.text(e):Gsc('<span class="fui-tab-num"></span>').text(e).appendTo(i))}}},Util.tab=Jsc,Hsc(),function Ksc(){if(function n(){return window.top!==window&&!!/_winid=/.test(location.search)}()){var t=Gsc(".fui-title");if(t.addClass("hidden"),t.parent().hasClass("fui-top")&&!t.siblings().length&&Util.layoutInstance.toggleTop(!1),Gsc(".fui-notice").length&&!Gsc('.fui-toolbar a[role="helper"], .fui-toolbar-bottom a[role="helper"]').length){var e=Gsc(".fui-toolbar"),i=Gsc(".fui-toolbar-bottom");e.length&&!e.find('a[role="helper"]').length?Gsc('<a role="helper">'+epoint_local.helper_text+"</a>").appendTo(e):i.length&&!i.find('a[role="helper"]').length&&Gsc('<a role="helper">'+epoint_local.helper_text+"</a>").appendTo(i),e=i=null}}}(),function Msc(){var t=Gsc(".fui-title .fui-title-text");t.length&&(t.attr("bind")||t.attr("bind","getPageTitleByUrl"),t.hasClass("mini-outputtext")||t.addClass("mini-outputtext"),t.text()&&t.attr("value",t.text()))}(),Util.Title={handles:{share:function(){},help:function(){},refresh:function(){location.reload()}}},Gsc(".fui-title").on("mousedown",".mini-button",function(){var t=mini.get(this);if(!t||t.getEnabled()){var e=Gsc(this).data("role");if(e){var i=Util.Title.handles[e];"function"==typeof i&&i.call(this)}}}),
/*!
 * contentpage结构content区域计算
 */
function(n,s){var o=s(".fui-title"),r=s(".fui-toolbar"),a=s(".fui-condition"),l=s(".fui-notice"),h=s(".fui-content"),d=s(".fui-toolbar-bottom");if(n.adjustContentHeight=Util.noop,h.length){function u(t){var e=0;return!t.length||t.hasClass("hidden")||~["fixed","absolute"].indexOf(t.css("position"))||(e=t.outerHeight(!0)),e}function t(){var t=h.parent().innerHeight()||s(n).height(),i=0;"BODY"!==h.parent()[0].tagName?s.each(h.siblings(),function(t,e){i+=u(s(e))}):(i+=u(o),i+=u(r),i+=u(a),i+=u(l),i+=u(d)),h.css("height",t-i),Util._layoutDatagridInContent()}var i=0;s(n).on("resize.contentPage",function(){i&&clearTimeout(i),i=setTimeout(t,50),[].slice.call(document.getElementsByTagName("iframe")).forEach(function(t){try{t.contentWindow.$("body").trigger("resize")}catch(e){}})}),n.adjustContentHeight=t,s(t),r.add(d).find(".mini-webuploader").each(function(t,e){var i=s(e);i.attr("filelist")||!1===i.attr("showdefaultui")||(i.attr("showdefaultui",!1),console.warn("toolbar 中的上传控件必须自己实现 UI，或者将 fileList 指定到页面其他 dom 容器中！"))})}}(this,jQuery),
/*!
 * contentpage条件区域condition交互与视图解析
 */
function(d,u){var c=u(".fui-condition"),m=c.attr("data-shownum")||1;if(m=m<1?1:m,c.length){var f=[];f.push('<span class="cond-srh-btn-text l">'+d.epoint_local.search_text+"</span>"),f.push('<i class="cond-srh-btn-toggle l" title="'+d.epoint_local.search_title+'"></i>');function t(){var t=c.find(".fui-form");if(t.length){function i(t){p.toggleClass("hidden",t),s.length&&s.toggleClass("opened",!t),window.adjustContentHeight()}var n,e,s=c.find('[role="searcher"]'),o=s.attr("callback"),r=t.find(".form-row"),a=r.length,l=m<a;if(s.length)s.addClass("cond-srh-btn clearfix").removeAttr("role"),u(f[0]).appendTo(s),s.on("click",".cond-srh-btn-text",function(t){var e=(n=n||function(){var t,e="";if(o){var i=o.split(".");e=d[i[0]],t=d;for(var n=1,s=i.length;e&&n<s;)e=(t=e)[i[n]],n++}return{fun:e,scope:t}}()).fun,i=n.scope;e&&"function"==typeof e&&e.call(i,t)}),l&&(s.length&&u(f[1]).appendTo(s),s.addClass("multi"),s.on("click",".cond-srh-btn-toggle",function(t){t.preventDefault();var e=s.hasClass("opened");i(e)})),e=Util.browsers.isIE?function(){var t=document.activeElement;t&&t.blur(),s.find(".cond-srh-btn-text").trigger("click"),t&&t.focus()}:function(){s.find(".cond-srh-btn-text").trigger("click")},c.on("keyup",function(t){13===t.which&&e()});if(l){var h="true"===c.attr("opened");p=r.filter(function(t){if(m-1<t)return h||r.eq(t).addClass("hidden"),!0}),h&&(c.removeAttr("opened"),u(function(){i(!1)}))}}}
//     if (!fixed) {
var p=null;Util.condition={hideToggleBtn:function(){c.find(".cond-srh-btn-toggle").addClass("hidden")},showToggleBtn:function(){c.find(".cond-srh-btn-toggle").removeClass("hidden")}},(d.initCondition=t)()}}(this,jQuery),function(t,e){var i=e(".fui-notice");if(i.length){var n=e(".fui-toolbar:not(.bottom)"),s=e(".fui-toolbar-bottom"),o=n.add(s).find('[role="helper"]');if(o.length||(o=e('.fui-title [data-role="help"]')).length&&(mini.parse(o[0]),o=e('.fui-title [data-role="help"]')),o.length){if(!o.hasClass("mini-button"))if(o.addClass("fui-toolbar-helper").attr("title",o.text()).empty(),o.parent(".fui-toolbar").length){o.addClass("r");var r=n.find("> .r").eq(0);r.length?o.insertBefore(r):o.appendTo(n)}else o.addClass("fixed").appendTo("body");var a=!(!o[0].getAttribute("showtype")&&"tooltip"!==o[0].getAttribute("data-showtype")),l=e('<span class="notice-close-btn"></span>').appendTo(i);if(a){var h=i[0].innerHTML,d=new mini.ToolTip;d.set({target:document,trigger:"click",selector:'.fui-toolbar-helper, .mini-button[data-role="help"]',placement:"bottom",autoHide:!1,theme:"light",defaultTheme:"light",onbeforeopen:function(t){o.addClass("active"),o.hasClass("fixed")&&e(d.el).css("margin-right",5),t.content=h,t.cancel=!1}}),d.addCls("fui-toolbar-tooltip"),e(window).on("resize",function(){o.removeClass("active"),d.close()}),e(window).on("mousedown",function(t){e(t.target).closest('.fui-toolbar-tooltip,.mini-button[data-role="help"]').length||(o.removeClass("active"),d.close())}),e(".fui-toolbar-tooltip").on("click",".notice-close-btn",function(){o.removeClass("active"),d.close()})}else{i.wrapInner('<div class="fui-notice-inner"></div>'),o.toggleClass("active hidden",!i.hasClass("hidden")),o.on("click",function(){i.toggleClass("hidden",!i.hasClass("hidden")),o.toggleClass("active",!i.hasClass("hidden")),o.hasClass("fixed")&&o.hasClass("active")?o.addClass("hidden"):o.removeClass("hidden"),o.hasClass("mini-button")&&!i.hasClass("hidden")&&i.css({position:"absolute",left:"0",right:"0",top:e(".fui-title")[0].getBoundingClientRect().bottom}),window.adjustContentHeight()}),l.on("click",function(){o.trigger("click")})}}else console.error('当前页面存在 【.fui-notice】 区域，但工具栏中不存在【[role="helper"]】按钮， 帮助提示功能无法正常使用')}}(0,jQuery),
/*!
 * 高级搜索布局
 */
function(l,u){var n=u(".fui-title"),s=u(".fui-search"),o=u(".fui-toolbar:eq(0)"),r=u(".fui-notice"),a=u(".fui-content"),h=u(".fui-toolbar-bottom"),t=s.data("type");if(s.length&&o.length){var d,c,m,f,p="true"===s.attr("opened");if(!p){d=u("<i></i>",{"data-status":"close"}).addClass("fui-search-trigger r"),t&&d.addClass(t);var i=o.find(".r");i.length?i.eq(0).hasClass("fui-toolbar-helper")?i.eq(0).after(d):i.eq(0).before(d):d.appendTo(o),c=u('<div class="fui-search-cover hidden"></div>'),a.css("position","relative").append(c);var g=function(i){var n=mini.get(i.relatedSearchId);n&&(i.on("valuechanged",function(t){var e=t.value;n.setValue(e)}),n.on("valuechanged",function(t){var e=t.value;i.setValue(e)}))};u(function(){!function(){if(m=s[0].getAttribute("primaryControl")){var e=mini.get(m),i=e.type;if(e&&("textbox"===i||"combobox"===i)){var t,n=s[0].getAttribute("primaryWidth");"textbox"===i?d.after('<input type="text" id="toolbar-search-'+m+'" emptyText="'+(window.epoint_local.empty_beginning_text+u(e.el).parent().prev().text().slice(0,-1))+'" class="mini-buttonedit fui-primary-search r" style="'+(n?"width:"+n+"px":"")+'">'):"combobox"===i&&d.after('<input id="toolbar-search-'+m+'" emptyText="'+(window.epoint_local.empty_beginning_text+u(e.el).parent().prev().text().slice(0,-1))+'" bind="'+e.bind+'" action="'+e.action+'" class="mini-combobox fui-primary-search r" style="'+(n?"width:"+n+"px":"")+'">'),mini.parse(o[0]),(f=mini.get("toolbar-search-"+m)).on("valuechanged",function(){var t=this.value;e.setValue(t),"combobox"===i?e.setText(this.text):"textbox"===i&&e.setText(t)}),e.on("valuechanged",function(t){var e=t.value;f.setValue(e),"combobox"===i?f.setText(t.selected.text):"textbox"===i&&f.setText(e)}),t=Util.browsers.isIE?function(){var t=document.activeElement;t&&t.blur(),_.trigger("click"),t&&t.focus()}:function(){_.trigger("click")},f.on("enter",t),f.on("buttonclick",function(){_.trigger("click")})}}}(),function(){var t,e,i=u(".fui-toolbar-search",o)[0];if(i)for(var n=0,s=(t=mini.getChildControls(i)).length;n<s;n++)(e=t[n]).relatedSearchId&&e.relatedSearchId!==m&&g(e)}()})}var _=s.find('[role="searcher"]'),v=s.find('[role="reset"]'),y=s.find('[role="close"]'),w=u('<div class="fui-search-footer"></div>'),x=[];x.push('<span class="fui-search-srh-btn ">'+l.epoint_local.search_text+"</span>"),x.push('<span class="fui-search-reset-btn ">'+l.epoint_local.reset_text+"</span>"),x.push('<span class="fui-search-close-btn ">'+l.epoint_local.close_text+"</span>"),_.length&&u(x[0]).appendTo(_),v.length&&u(x[1]).appendTo(v),!p&&y.length&&u(x[2]).appendTo(y),x=null,w.append(_).append(v).append(y).appendTo(s);var C=u('<div class="fui-search-result hidden clearfix"><span class="l fui-search-desc">'+window.epoint_local.selected_text+'：</span><div class="l fui-search-list-wrap"><ul class="fui-search-list  clearfix"></ul></div><div class="fui-search-result-btns r"><span class="fui-search-l l invisible"></span><span class="fui-search-r l invisible"></span><span class="fui-search-removeall l" title="'+epoint_local.remove_all_text+'"></span></div></div>').appendTo(s),b=C.find(".fui-search-list-wrap"),E=b.find(".fui-search-list"),T=C.find(".fui-search-l"),S=T.next(),k={searcher:function(){B("open")},close:function(){B("open")},open:function(){E.children().length?B("searcher"):B("close")}};p||d.on("click",function(t){var e=d.data("status");k[e]()});var I;s.on("click","a",function(t){var e=u(this).attr("role");I=I||function(){var t={searcher:_.length?_.attr("callback"):"",reset:v.length?v.attr("callback"):"",close:y.length?y.attr("callback"):""},e={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){for(var n=t[i].split("."),s=l[n[0]],o=l,r=1,a=n.length;s&&r<a;)s=(o=s)[n[r]],r++;e[i]={fun:s,scope:o}}return e}(),N(e,t),"reset"===e?M(t):B(e)});function F(){if(!L.length)return[];var t=mini.getChildControls(L[0]);if(1<t.length)for(var e=t[0],i=1,n=t.length;i<n;i++)mini.isAncestor(t[i].el,e.el)?(t.splice(i-1,1),i--,n--):mini.isAncestor(e.el,t[i].el)&&(t.splice(i,1),i--,n--),e=t[i];return t}function D(t){return Mustache.render(P,t)}var L=s.find(".fui-form"),M=function(t){!function(){for(var t=F(),e=[],i=0,n=t.length;i<n;++i)"hidden"!==t[i].type&&(t[i].setText&&!1!==t[i]._clearText&&t[i].setText(""),t[i].setValue(t[i].defaultValue||""),t[i].doValueChanged&&e.push({doValueChanged:t[i].doValueChanged,control:t[i]}));for(i=0,n=e.length;i<n;i++)e[i].doValueChanged.call(e[i].control)}(),E.empty(),C.addClass("hidden");var e=I&&I.searcher;e&&"function"==typeof e.fun&&e.fun.call(e.scope,t),O=!1},O=!1,N=function(t,e){var i=I[t];i&&"function"==typeof i.fun&&i.fun.call(i.scope,e)},P='<li class="fui-search-item l"><span class="fui-search-item-label l">{{label}}</span><span class="fui-search-item-text l" title="{{text}}">{{text}}</span><span class="fui-search-item-remove l" title="'+epoint_local.remove_text+'" {{#value}} data-value="{{value}}" {{/value}} data-id="{{id}}"></span></li>';C.on("click",".fui-search-item-remove",function(t){var e=u(this),i=e.data("id");if(i){var n=mini.get(i);if(!n)return;if("checkboxlist"===n.type){var s=function(t,e){return(","+t+",").replace(","+e+",",",").replace(/^,|,$/g,"")}(n.getValue(),e.data("value"));n.setValue(s)}else n.setValue(""),n.setText&&!1!==n._clearText&&n.setText("");n.doValueChanged&&n.doValueChanged()}e.parent(".fui-search-item").remove(),j(),0===E.find(".fui-search-item").length&&(O=!1,B("close")),N("searcher",t)}).on("click",".fui-search-removeall",function(t){M(t),B("close")}).on("click",".fui-search-item",function(t){t.stopPropagation(),u(this).addClass("active").siblings().removeClass("active")}),u("body").on("click",function(){E.children().removeClass("active")}).on("keyup",function(t){27===t.which&&B("close")});var B=function(t){if("searcher"===t){if(p)return;s.css({top:""}),function(){for(var t=!1,e=F(),i=[],n=0,s=e.length;n<s;n++){var o,r=e[n];if("hidden"!==r.type){var a=r.getText?r.getText():r.getValue();if(a=!1!==r._clearText?a:r.checked?a:"")if(t=!0,(o=u(r.el).parent().attr("label")||"")&&(o+="："),"checkboxlist"===r.type){var l=r.getValue().split(",");a=a.split(",");for(var h=0,d=l.length;h<d;++h)i.push(D({label:o,value:l[h],text:a[h],id:r.id}))}else i.push(D({label:o,text:a,id:r.id}))}}return E.empty(),t&&u(i.join("")).appendTo(E),O=t}()?(o.removeClass("searchopen"),C.removeClass("hidden"),s.removeClass("hidden").removeClass("open").addClass("searcher"),$(),d.data("status","searcher").removeClass("close")):(o.removeClass("searchopen"),s.addClass("hidden").removeClass("open").removeClass("searcher"),d.data("status","close").removeClass("close"),C.addClass("hidden")),c.addClass("hidden"),j()}else if("close"===t)O?(s.removeClass("hidden").removeClass("open").addClass("searcher"),C.removeClass("hidden")):(s.addClass("hidden").removeClass("open").removeClass("searcher"),C.addClass("hidden")),s.css({top:""}),o.removeClass("searchopen"),d.data("status","close").removeClass("close"),c.addClass("hidden");else if("open"===t){o.addClass("searchopen"),s.removeClass("hidden").removeClass("searcher").addClass("open"),$(),s.css({top:o.position().top+o.outerHeight()}),d.data("status","open").addClass("close"),C.addClass("hidden"),c.removeClass("hidden");for(var e=F(),i=0,n=e.length;i<n;i++)e[i]._doInputLayout&&e[i]._doInputLayout()}W()};if(!p){var A,V,R,U=0,H=0,j=function(){C.is(":visible")&&(A=A||C.find(".fui-search-desc").outerWidth()+C.find(".fui-search-result-btns").outerWidth(),V=C.width(),R=V-A-10,b.css("width",R),U=0,E.find(".fui-search-item").each(function(t,e){U+=u(e).outerWidth()+10}),H=U-R>>0),0<H?(T.removeClass("invisible"),S.removeClass("invisible"),E.animate({marginLeft:-H})):(T.addClass("invisible"),S.addClass("invisible"),E.animate({marginLeft:0}))};S.on("click",function(){var t=-parseInt(E.css("margin-left"),10),e=Math.min(100,H-t);E.is(":animated")||H<=t||E.animate({marginLeft:"-="+e+"px"})}),T.on("click",function(){var t=-parseInt(E.css("margin-left"),10),e=Math.min(100,t);E.is(":animated")||t<0||E.animate({marginLeft:"+="+e+"px"})}),u(l).on("resize",function(){j()})}u(l).off("resize.contentPage").on("resize",function(){W(),[].slice.call(document.getElementsByTagName("iframe")).forEach(function(t){try{t.contentWindow.$("body").trigger("resize")}catch(e){}})});function z(t){var e=0;return!t.length||t.hasClass("hidden")||~["fixed","absolute"].indexOf(t.css("position"))||(e=t.outerHeight(!0)),e}var W=function(){var t=a.parent().innerHeight()||u(l).height(),i=0;"BODY"!==a.parent()[0].tagName?u.each(a.siblings(),function(t,e){i+=z(u(e))}):(i+=z(n),i+=z(o),i+=z(s),i+=z(r),i+=z(h)),a.css("height",t-i),Util._layoutDatagridInContent()};l.adjustContentHeight=W,p?(s.css({position:"relative",top:"0","box-shadow":"none"}),y.addClass("hidden"),s.addClass("open"),u(function(){setTimeout(W,60)})):s.addClass("hidden"),Util.advanceSearch={_isHide:!1,hide:function(){this._isHide||(p||(d.addClass("hidden"),f.hide(),c.addClass("hidden")),s.addClass("hidden"),O&&M(),W(),this._isHide=!0)},show:function(){this._isHide&&(p?(s.removeClass("hidden"),W()):(d.removeClass("hidden"),f.show()),this._isHide=!1)}}}function $(){mini.getChildControls(s[0]).forEach(function(t){t.doLayout()})}}(window,jQuery),function(n,l){var o=l(".fui-content");function r(){this.parse()}function h(t){return t<10&&(t="0"+t),t}function a(t,e){return'<li class="acc-menu-item" data-ref="'+t+'" title="'+e+'">'+e+"</li>"}r.parse=function(){Util.accordion=new r},l.extend(r.prototype,{parse:function(){var t=l(".fui-accordions");t.length&&(this.$accsWrap=t,this._accs=this.$accsWrap.find('[role="accordion"]'),this._parse(),this._initEvent())},_parse:function(){this.showNav=0<o.length&&this.$accsWrap.attr("showNav"),this.showNav===undefined?this.showNav=Util.getFrameSysParam("showAccordionsNav"):this.showNav="true"===this.showNav;var t=this.$accsWrap.find('[role="accordion"]');l.each(t,function(t,e){var i=l(e),n=i.find('[role="head"]'),s=i.find('[role="body"]');if(!i.data("accordion")){i.data("accordion",!0);var o="false"!==i.attr("opened"),r=n.attr("title");i.addClass("fui-accordion"),n.addClass("fui-acc-hd"),s.addClass("fui-acc-bd"),o?i.addClass("opened"):i.addClass("closed"),o?s.show():s.hide(),l(function a(t,e){var i=[];return i.push('<span class="fui-acc-order">'+h(t)+"</span>"),i.push('<i class="fui-acc-toggle"></i>'),i.push('<h4 class="fui-acc-title">'+e+"</h4>"),i.join("")}(t+1,r)).prependTo(n)}}),this.showNav?this._buildNav():(this.$accsWrap.removeClass(".shownav"),l(".fui-acc-return").remove(),l(".fui-acc-menu").remove())},_buildNav:function(){var t=this.$accsWrap.find('[role="accordion"]'),s=[],o=this;l.each(t,function(t,e){var i,n=l(e).find('[role="head"]').attr("title");o.showNav&&(i=e.id?e.id:e.id="accordion_"+t,s.push(a(i,n)))}),this.$accNav=l(".fui-acc-menu");var e=0;this.$accNav.length&&(e=this.$accNav.find(".acc-menu-item.active").index(),this.$accNav.remove()),this.$accNav=l(function i(t){var e=[];return e.push('<div class="fui-acc-menu">'),e.push('<ul class="acc-menu-list">'),e.push(t),e.push("</ul>"),e.push("</div>"),e.join("")}(s.join(""))),this.$accNav.appendTo(document.body),l(".fui-acc-return").remove(),this.$accReturn=l('<div class="fui-acc-return" title="'+epoint_local.back_to_top_text+'" style="display:none;"></div>').appendTo(document.body),this.$accsWrap.addClass("shownav"),this.$accNav.find(".acc-menu-item").eq(e).addClass("active"),this._setNavPos(),this._adjustNavDisplay()},_setNavPos:function(){if(this.showNav){var t=(o.width()-this.$accsWrap.outerWidth())/2;t<17&&(t=17),this.$accNav.css("right",t),this.$accNav.css("top",this.$accsWrap[0].offsetTop),this.$accReturn.css("right",t)}},_adjustNavDisplay:function(){this.showNav&&(2<this.$accsWrap.find('[role="accordion"]').filter(function(t,e){return!l(e).hasClass("hidden")}).length?(this.$accsWrap.addClass("shownav"),this.$accNav.removeClass("hidden"),this.$accReturn.removeClass("hidden")):(this.$accsWrap.removeClass("shownav"),this.$accNav.addClass("hidden"),this.$accReturn.addClass("hidden")))},_initEvent:function(){var t,s=this;if(this.$accsWrap.off("click.fui-accordion",".fui-acc-toggle").on("click.fui-accordion",".fui-acc-toggle",function(){var t=l(this).closest(".fui-accordion"),e=t.hasClass("opened"),i=t.attr("ontoggle");t.toggleClass("closed",e).toggleClass("opened",!e),t.find(">.fui-acc-bd").stop(!0)[e?"slideUp":"slideDown"](200),i&&n[i]&&n[i](e?"closed":"opened")}),o.off("scroll.fui-accordion").on("scroll.fui-accordion",function(){var e=l(".fui-accordion:not(.hidden)"),i=l(".acc-menu-item:not(.hidden)");clearTimeout(t),t=setTimeout(function(){e.each(function(t,e){if(0<=l(e).offset().top)return i.eq(t).addClass("active").siblings().removeClass("active"),!1});var t=e.eq(0).offset().top;s.showNav&&(t<=-100?s.$accReturn.show():s.$accReturn.hide())},200)}),l(n).off("resize.fui-accordion").on("resize.fui-accordion",function(){s._setNavPos()}),this.showNav){l("body").off("click.fui-accordion").on("click.fui-accordion",function(t){var e=l(t.target),i=e.data("ref"),n=l(Util.getFirstScrollEl(s.$accsWrap.find(".fui-accordion")[0]));e.closest(s.$accNav).length?e.hasClass("acc-nav-trigger")?s.$accNav.toggleClass("active"):e.hasClass("acc-menu-item")&&(l("#"+i).hasClass("closed")&&l("#"+i).find(".fui-acc-toggle").trigger("click"),function o(t,e){var i=t.data("ref"),n=l("#"+i);if(e&&e.length){var s=e[0].style.position;e[0].style.position="relative",d(n[0].offsetTop,e),e[0].style.position=s}t.addClass("active").siblings().removeClass("active")}(e,n)):s.$accNav.removeClass("active"),e.hasClass("fui-acc-return")&&d(0,n)});var e=n.adjustContentHeight;n.adjustContentHeight=function(){e(),s._setNavPos()}}},_accTpl:'<div role="accordion" class="fui-accordion {{status}}"><div class="fui-acc-hd" role="head" title="{{title}}"><span class="fui-acc-order">{{order}}</span><i class="fui-acc-toggle"></i><h4 class="fui-acc-title">{{title}}</h4></div><div class="fui-acc-bd" role="body"><iframe frameborder="0" width="100%" height="{{contentHeight}}" src="{{url}}"></iframe></div></div>',showItem:function(t){var e=this._accs.eq(t);if(e.length&&e.hasClass("hidden")&&(e.removeClass("hidden"),this._updateOrders()),this.showNav){var i=this._getAccNavs().eq(t);i.length&&i.hasClass("hidden")&&i.removeClass("hidden"),this._adjustNavDisplay(),o.trigger("scroll")}},hideItem:function(t){var e=this._accs.eq(t);if(e.length&&!e.hasClass("hidden")&&(e.addClass("hidden"),this._updateOrders()),this.showNav){var i=this._getAccNavs().eq(t);i.length&&!i.hasClass("hidden")&&i.addClass("hidden"),this._adjustNavDisplay(),o.trigger("scroll")}},hideNav:function(){this.showNav&&(this.showNav=!1,this.$accNav.addClass("hidden"),this.$accReturn.addClass("hidden"),this.$accsWrap.removeClass("shownav"))},expandItem:function(t){var e=this._accs.eq(t);e.length&&!e.hasClass("hidden")&&(e.removeClass("closed").addClass("opened"),e.find(">.fui-acc-bd").stop(!0).slideDown(200))},collapseItem:function(t){var e=this._accs.eq(t);e.length&&!e.hasClass("hidden")&&(e.removeClass("opened").addClass("closed"),e.find(">.fui-acc-bd").stop(!0).slideUp(200))},setTitle:function(t,e){var i=this._accs.eq(e);i.length&&i.find('[role="head"]').attr("title",t).find(".fui-acc-title").html(t);if(this.showNav){var n=this._getAccNavs().eq(e);n.length&&n.html(t).attr("title",t)}},addItem:function(t,e,i,n){var s=Mustache.render(this._accTpl,{title:t,url:e,status:i?"opened":"closed",contentHeight:n||"100%"});if(l(s).appendTo(this.$accsWrap).data("accordion",!0),this._accs=this.$accsWrap.find('[role="accordion"]'),this._updateOrders(),this.showNav){var o=this._accs.length-1,r=this._accs[o];s=a(r.id?r.id:r.id="accordion_"+o,t),l(s).appendTo(this.$accNav.find(".acc-menu-list")),this._accNavs=this.$accNav.find(".acc-menu-item"),this._adjustNavDisplay()}},addItemHtml:function(t,e,i){if(0!==arguments.length){var n;n=1===arguments.length?l(t).appendTo(this.$accsWrap):"before"===i?l(t).insertBefore(this.$accsWrap.find('[role="accordion"]').eq(e)):l(t).insertAfter(this.$accsWrap.find('[role="accordion"]').eq(e)),r.parse(this.$accsWrap);try{mini.parse(n[0]),n=null}catch(s){}}},autoToggleItemVisible:function(){var n=this;this.$accsWrap.find('[role="accordion"]').each(function(t,e){var i=l(e).find('[role="body"]');0===i.children().not(".fui-form").length&&(0===i.children(".fui-form").find(".form-control").not(".hidden").length?n.hideItem(t):n.showItem(t))})},_updateOrders:function(){var s=0;l.each(this._accs,function(t,e){var i=l(e),n=i.find(".fui-acc-order");i.hasClass("hidden")||n.html(h(++s))})},_getAccNavs:function(){return this._accNavs||(this._accNavs=this.$accNav?this.$accNav.find(".acc-menu-item"):undefined),this._accNavs}});var d=Util.browsers.isIE?function(t,e){e.stop(!0).animate({scrollTop:t},500)}:function(t,e){e[0].scrollTop=t},t=l(".fui-accordions");t.length?Util.accordion=new r(t):Util.accordion={parse:r.parse}}(this,jQuery),vzc=this,wzc=jQuery,xzc.instances={},xzc.getInstance=function(t){return t?xzc.instances[wzc(t).attr(xzc.prototype.ATTRIBUTE_PREFIX+"uid")]:null},wzc.extend(xzc.prototype,{ATTRIBUTE_PREFIX:"overflow-",ignoreSelectors:[".fui-toolbar-helper",".fui-search-trigger",".fui-primary-search",".fui-toolbar-search",".fui-toolbar-over-trigger",".toolbar-ext-area"].join(","),update:function(){var t=this.calcInnerWidth(),e=this.$trigger.is(":visible")?0:this.$trigger.outerWidth(!0);return t>this.limit_w?(this.isOver=!0,this.$trigger.removeClass("hidden"),this.moveToExtArea(t+e)):this.restoreToToolbar(t),this},calcLimited:function(){this.limit_w=this.$el.width()},initEvent:function(){var i=this;this.$trigger.on("click."+this.eventNamespace,function(){i.toggle()}),wzc(vzc).on("resize."+this.eventNamespace,Util.throttle(function(){i.calcLimited(),i.update()},Util.browsers.isIE?100:50)),wzc(vzc).on("mousedown."+this.eventNamespace,function(t){var e=wzc(t.target);e.closest(i.$trigger).length||e.closest(".mini-popup").length||e.closest(i.$extArea).length||i.toggle(!1)})},watchOrDirtyCheck:function(){var t,e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,i=Util.debounce(function(){this.calcLimited(),this.update()},20,this);if(e){var n=new e(function(){i(),n.takeRecords()});return n.observe(this.$el[0],{childList:!0,attributes:!0,subtree:!0}),function(){n.disconnect()}}return t=setInterval(function(){i()},100),function(){clearInterval(t)}},_insertToggleBtn:function(){if(this.$trigger=wzc("<i></i>").addClass("fui-toolbar-over-trigger hidden r icon-rightdouble action-icon"),this.$el.hasClass("fui-toolbar-bottom")&&!this.$el.hasClass("left"))this.$trigger.prependTo(this.$el);else{var t=this.$el.find(".r");t.length?t.eq(0).before(this.$trigger):this.$trigger.appendTo(this.$el)}},toggle:function(t){if(this.isOver){if(t===undefined)return this.$trigger.toggleClass("active"),this.$extArea.slideToggle(200,e);t?(this.$trigger.addClass("active"),this.$extArea.slideDown(200,e)):(this.$trigger.removeClass("active"),this.$extArea.slideUp(200))}function e(){var t=wzc(this);t.is(":visible")&&(t.css("z-index",Util.getZIndex()),wzc(vzc).trigger("resize"))}},calcInnerWidth:function(){var r=0;return this.$el.children().each(function(t,e){var i=wzc(e);if(i.hasClass("toolbar-ext-area")){var s=0,n=i.is(":visible");return n||i.addClass("hidden-accessible").show(),i.css("width","10000px").children().each(function(t,e){var i=wzc(e),n=i.is(":hidden")?0:i.outerWidth(!0);i.data("width",n),s+=n}),n||i.removeClass("hidden-accessible").hide(),void i.data("width",s).css("width",s+2)}var o=i.is(":hidden")?0:i.outerWidth(!0)+1;i.data("width",o),r+=o}),r},getToolbarLastChild:function(){var t,e=this.$el.find("> .r"),i=0;for(i=0,t=e.length;i<t;i++){var n=e.eq(i);if(!n.filter(this.ignoreSelectors).length&&!n.is(":hidden"))return n}var s=this.$el.children().filter(function(t,e){var i=wzc(e);return!i.hasClass("r")&&!i.is(":hidden")});for(i=s.length-1;0<i;i--){var o=s.eq(i);if(!o.filter(this.ignoreSelectors).length)return o}},moveToExtArea:function(t){t=t||this.calcInnerWidth();var e=0,i=0;do{var n=this.getToolbarLastChild();if(!n||!n.length){this.$firstRightChild=this.$lastNormalChild=null;break}n.hasClass("r")?this.$firstRightChild=n.next():this.$lastNormalChild=n.prev(),e+=i=n.data("width"),t-=i,n.prependTo(this.$extArea)}while(t>this.limit_w);if(e){var s=(this.$extArea.data("width")||0)+e;this.$extArea.css("width",s+2).data("width",s)}},getFirstExtraChild:function(){return this.$extArea.children(":eq(0)")},restoreToRightPos:function(t){t.hasClass("r")?this.$firstRightChild&&this.$firstRightChild.length?(this.$firstRightChild.before(t),this.$firstRightChild=t):t.appendTo(this.$targetChild):this.$lastNormalChild&&this.$lastNormalChild.length?(this.$lastNormalChild.after(t),this.$lastNormalChild=t):t.appendTo(this.$el)},_restorable:function(t,e){return!!t.length&&e+t.data("width")<=this.limit_w},restoreToToolbar:function(t,e){for(var i=this.getFirstExtraChild();e&&i.length||this._restorable(i,t);){this.restoreToRightPos(i);var n=(this.$extArea.data("width")||0)-i.data("width");this.$extArea.data("width",n),t+=i.data("width"),i=this.getFirstExtraChild()}this.$extArea.css("width",this.$extArea.data("width")+2),!e&&this.$extArea.children().length||this.allRestore()},allRestore:function(){this.isOver=!1,this.$trigger.addClass("hidden").data("width",0).removeClass("active"),this.$extArea.hide()},destroy:function(){for(var t in this.$trigger.off("click"),wzc(vzc).off("resize."+this.eventNamespace),wzc(vzc).off("mousedown."+this.eventNamespace),this.restoreToToolbar(null,!0),this.$trigger.remove(),this.$extArea.remove(),this.$el[0].removeAttribute(this.ATTRIBUTE_PREFIX+"uid"),this.$el[0].removeAttribute(this.ATTRIBUTE_PREFIX+"init"),xzc.instances[this.uid]=null,delete xzc.instances[this.uid],this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=null,delete this[t])}}),vzc.ToolbarOverflow=xzc,wzc(function(){wzc(".fui-toolbar:eq(0), .fui-toolbar-bottom:eq(0)").each(function(t,e){new xzc(e)})}),vAc=this,wAc=jQuery,xAc={showModal:!0,showCloseButton:!0,width:600,height:400},yAc.prototype={constructor:yAc,_init:function(){this.$container=wAc('<div class="lightdialog hidden"><iframe width="100%" height="100%" frameborder="0"></iframe><i class="lightdialog-close hidden"></i></div>'),this.$iframe=this.$container.children("iframe"),this.$closeIcon=this.$container.children(".lightdialog-close"),this.$iframe[0].src=Util.getRightUrl(this.cfg.url);var e=this;this.$iframe.on("load",function(){e._doLoadIframe()}),this.cfg.showModal&&(this.$modal=wAc('<div class="lightdialog-modal hidden"></div>').appendTo("body")),this.cfg.showCloseButton&&(this.$closeIcon.removeClass("hidden"),this.$closeIcon.on("click",function(){var t=!0;try{e.__onDestroy&&(t=e.__onDestroy("close"))}catch(ex){console.error(ex)}if(!1===t)return!1;e.close()})),this.$container.appendTo("body")},_doLoadIframe:function(){var i=this;try{this.$iframe[0].contentWindow.Owner=vAc,this.$iframe[0].contentWindow.CloseOwnerWindow=function n(t){var e=!0;try{i.__onDestroy&&(e=i.__onDestroy(t))}catch(ex){console.error(ex)}if(!1===e)return!1;setTimeout(function(){i.close()},10)}}catch(e){}this.__onLoad&&this.__onLoad()},_doRemoveIFrame:function(){this.$iframe&&(this.__onDestroy&&this.__onDestroy("close"),Util.clearIframe(this.$iframe),this.$iframe=null)},show:function(){var t=Util.getWinSize(),e=parseInt(this.cfg.width,10),i=parseInt(this.cfg.height),n=(t.width-e)/2,s=(t.height-i)/2;this.cfg.showModal&&this.$modal.css("z-index",Util.getZIndex()).removeClass("hidden"),this.$container.css({left:n,top:s,width:e,height:i,zIndex:Util.getZIndex()}).removeClass("hidden")},close:function(){this._doRemoveIFrame(),this.$container.remove(),this.$modal&&this.$modal.remove()},getIFrameEl:function(){return this.$iframe?this.$iframe[0]:undefined}},wAc.extend(Util,{openLightDialog:function(t){var e=new yAc(t);return e.show(),e},openTopLightDialog:function(t){return zAc||function e(t){try{t.Util&&t.Util.openLightDialog&&(zAc=t),t.parent&&t.parent!=t&&e(t.parent)}catch(ex){}}(vAc),zAc.Util.openLightDialog(t)}}),
/*!
 * 通过body master属性动态载入导航模板资源
 */
SAc=jQuery,TAc=SAc("body > .master-content"),UAc=TAc.attr("master"),VAc=TAc.attr("srcdir"),SAc(function(){TAc.length&&XAc(UAc)}),bBc=this,cBc=this.jQuery,Util.adaptButtonGroup=fBc,cBc(bBc).on("load",function(){fBc(),bBc.MutationObserver&&function t(){dBc=new MutationObserver(function(t){t.forEach(function(t){switch(t.type){case"childList":!function i(t){var e=cBc(t.target);e.hasClass("mini-btn-group")&&eBc(e)}(t);break;case"attributes":!function e(t){"style"!==t.attributeName&&"class"!==t.attributeName||eBc(cBc(t.target).closest(".mini-btn-group"))}(t)}})}),cBc(".fui-toolbar .mini-btn-group, .fui-toolbar-bottom .mini-btn-group").each(function(t,e){dBc.observe(e,{childList:!0,attributes:!0,attributeOldValue:!0,characterData:!1,subtree:!0})}),cBc(bBc).on("beforeunload",function(){dBc.disconnect()})}()})}();
//# sourceMappingURL=miniui.min.js.map